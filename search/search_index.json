{"config":{"lang":["zh"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"TQuant Lab\uff1a\u4e00\u7ad9\u5f0f\u91cf\u5316\u7814\u7a76\u5e73\u53f0","text":"<p>Info</p> <p>\u6b61\u8fce\u4f86\u5230 TQuant Lab\uff01\u672c\u5e73\u53f0\u6574\u5408\u4e86\u5168\u53f0\u6700\u5b8c\u5584\u7684\u91cf\u5316\u8cc7\u6599\u3001\u6700\u5f37\u5927\u7684\u4e8b\u4ef6\u9a45\u52d5\u578b\u56de\u6e2c\u5f15\u64ce\uff0c\u4ee5\u53ca\u5c08\u696d\u7684\u7e3e\u6548\u5206\u6790\u5de5\u5177\u3002\u7121\u8ad6\u60a8\u662f\u91cf\u5316\u7814\u7a76\u65b0\u624b\u6216\u8cc7\u6df1\u5c08\u5bb6\uff0cTQuant Lab \u90fd\u80fd\u52a9\u60a8\u5c07\u7b56\u7565\u60f3\u6cd5\u8f49\u5316\u70ba\u5be6\u6230\u6210\u679c\u3002</p> <p>TQuant Lab \u5177\u5099\u4e09\u5927\u6838\u5fc3\u512a\u52e2\uff1a</p> <ul> <li>\u5353\u8d8a\u6578\u64da\u54c1\u8cea\uff1a\u6574\u5408\u9f90\u5927\u4e14\u7d93\u56b4\u683c\u9a57\u8b49\u7684 PIT\uff08Point In Time\uff09\u8cc7\u6599\u5eab\uff0c\u78ba\u4fdd\u56de\u6e2c\u7d50\u679c\u771f\u5be6\u53ef\u9760\u3002</li> <li>\u5f37\u5927\u56de\u6e2c\u5f15\u64ce\uff1a\u63a1\u7528 Zipline \u4e8b\u4ef6\u9a45\u52d5\u578b\u56de\u6e2c\u6846\u67b6\uff0c\u652f\u63f4\u8907\u96dc\u7b56\u7565\u908f\u8f2f\u3001\u6a21\u7d44\u5316\u5efa\u69cb\u8207\u9ad8\u6548\u6a21\u64ec\u3002</li> <li>\u5168\u65b9\u4f4d\u5206\u6790\u5de5\u5177\uff1a\u5167\u5efa Pyfolio \u8207 Alphalens \u7b49\u5c08\u696d\u5957\u4ef6\uff0c\u63d0\u4f9b\u8a73\u7d30\u7e3e\u6548\u6307\u6a19\u8207\u8996\u89ba\u5316\u5831\u544a\uff0c\u52a9\u60a8\u7cbe\u6e96\u8a55\u4f30\u7b56\u7565\u8868\u73fe\u3002</li> </ul>"},{"location":"#_1","title":"\u5feb\u901f\u5c0e\u89bd","text":"<p>\u4ee5\u4e0b\u662f TQuant Lab \u624b\u518a\u7684\u4e3b\u8981\u7ae0\u7bc0\uff0c\u9ede\u64ca\u53ef\u5feb\u901f\u524d\u5f80\uff1a</p> <ul> <li>\u9996\u9801\uff1a\u5e73\u53f0\u6982\u89bd\u8207\u6700\u65b0\u8cc7\u8a0a\u3002</li> <li>\u6559\u5b78\uff1a\u5f9e\u5165\u9580\u5230\u5be6\u6230\uff0c\u9010\u6b65\u5f15\u5c0e\u60a8\u5b78\u7fd2 TQuant Lab \u7684\u4f7f\u7528\u65b9\u6cd5\u3002</li> <li>\u6838\u5fc3\u6982\u5ff5\uff1a\u6df1\u5165\u7406\u89e3 Zipline \u5f15\u64ce\u3001Pipeline\u3001\u4ea4\u6613\u65e5\u66c6\u7b49\u95dc\u9375\u7406\u8ad6\u3002</li> <li>\u64cd\u4f5c\u6307\u5357\uff1a\u63d0\u4f9b\u8a73\u7d30\u7684\u5b89\u88dd\u3001\u8cc7\u6599\u7ba1\u7406\u8207\u56de\u6e2c\u8a2d\u5b9a\u6559\u5b78\u3002</li> <li>API \u53c3\u8003\uff1a\u67e5\u95b1\u6240\u6709 Zipline\u3001Pipeline\u3001Pyfolio \u7b49\u6838\u5fc3 API \u7684\u8a73\u7d30\u6587\u4ef6\u3002</li> </ul>"},{"location":"#_2","title":"\u76f8\u95dc\u9023\u7d50","text":"<ul> <li>TQuant Lab\uff5c\u4e00\u7ad9\u5f0f\u91cf\u5316\u7814\u7a76\uff0c\u6253\u9020\u5c08\u5c6c\u65bc\u4f60\u7684\u6295\u8cc7\u7814\u7a76\u91d1\u9470 </li> <li>GitHub - tejtw/TQuant-Lab: \u4f7f\u7528\u6587\u4ef6\u3001\u7a0b\u5f0f\u7bc4\u4f8b </li> <li>PYPI - zipline-tej </li> <li>TEJ\u5b98\u7db2 - \u5927\u4e2d\u83ef\u6700\u503c\u5f97\u4fe1\u8cf4\u7684\u91d1\u878d\u89e3\u6c7a\u65b9\u6848 | TEJ\u53f0\u7063\u7d93\u6fdf\u65b0\u5831 </li> <li>TQuant Lab \u8a02\u95b1\u9023\u7d50</li> </ul>"},{"location":"assets/","title":"CSS/HTML/JavaScript \u7d50\u69cb\u6574\u7406\u8aaa\u660e","text":""},{"location":"assets/#_1","title":"\u6574\u7406\u524d\u7684\u554f\u984c","text":""},{"location":"assets/#1-css","title":"1. CSS \u91cd\u8907\u554f\u984c","text":"<ul> <li><code>docs/zh-TW/assets/stylesheets/extra.css</code> (1389 \u884c)</li> <li><code>public/assets/stylesheets/extra.css</code> (872 \u884c) </li> <li><code>docs/en/assets/stylesheets/extra.css</code> (25 \u884c)</li> <li>\u5167\u5d4c\u5728 <code>main.html</code> \u4e2d\u7684 CSS (~200 \u884c)</li> <li>\u5167\u5d4c\u5728 <code>public/index.html</code> \u4e2d\u7684 <code>&lt;style&gt;</code> \u6a19\u7c64</li> </ul>"},{"location":"assets/#2-javascript-html","title":"2. JavaScript \u6df7\u5728 HTML \u4e2d","text":"<ul> <li><code>config/zh-TW/overrides/main.html</code> \u5167\u6709\u5927\u91cf JavaScript (~300 \u884c)</li> <li>\u4e3b\u984c\u5207\u63db\u3001\u5074\u908a\u6b04\u3001\u8f09\u5165\u52d5\u756b\u7b49\u908f\u8f2f\u6df7\u96dc</li> </ul>"},{"location":"assets/#3","title":"3. \u6c92\u6709\u6e05\u695a\u7684\u7d44\u7e54\u7d50\u69cb","text":"<ul> <li>\u6a23\u5f0f\u6c92\u6709\u6309\u529f\u80fd\u5206\u985e</li> <li>\u540c\u6a23\u7684\u6a23\u5f0f\u91cd\u8907\u5b9a\u7fa9\u591a\u6b21</li> </ul>"},{"location":"assets/#_2","title":"\u6574\u7406\u5f8c\u7684\u7d50\u69cb","text":""},{"location":"assets/#_3","title":"\u6a94\u6848\u7d50\u69cb","text":"<pre><code>docs/zh-TW/assets/\n\u251c\u2500\u2500 stylesheets/\n\u2502   \u251c\u2500\u2500 extra.css           # \u4e3b\u8981\u6a23\u5f0f\u6a94\uff08\u5df2\u6574\u7406\uff09\n\u2502   \u2514\u2500\u2500 extra.backup.css    # \u539f\u59cb\u5099\u4efd\n\u251c\u2500\u2500 javascripts/\n\u2502   \u251c\u2500\u2500 mathjax.js          # \u6578\u5b78\u516c\u5f0f\u652f\u63f4\n\u2502   \u2514\u2500\u2500 theme.js            # \u4e3b\u984c\u7ba1\u7406\u3001UI \u4e92\u52d5\uff08\u65b0\u589e\uff09\n</code></pre>"},{"location":"assets/#css-extracss","title":"CSS \u7d50\u69cb (<code>extra.css</code>)","text":"<p>\u6309\u529f\u80fd\u5206\u985e\u7d44\u7e54\uff1a 1. CSS Variables - \u984f\u8272\u3001\u9670\u5f71\u8b8a\u6578 2. Layout &amp; Grid - \u7248\u9762\u914d\u7f6e 3. Sidebar Styles - \u5074\u908a\u6b04\u6a23\u5f0f 4. Light Theme - \u6dfa\u8272\u4e3b\u984c 5. Dark Theme - \u6df1\u8272\u4e3b\u984c 6. Typography - \u5b57\u9ad4\u6392\u7248 7. Header &amp; Footer - \u9801\u9996\u9801\u5c3e 8. Search Box - \u641c\u5c0b\u6846 9. Code Blocks - \u7a0b\u5f0f\u78bc\u5340\u584a 10. Admonitions - \u63d0\u793a\u5340\u584a 11. Tables - \u8868\u683c 12. Links - \u9023\u7d50 13. Mermaid Diagrams - \u6d41\u7a0b\u5716 14. UI Components - \u6309\u9215\u3001\u958b\u95dc 15. Loading Animation - \u8f09\u5165\u52d5\u756b 16. Theme Transitions - \u4e3b\u984c\u5207\u63db\u52d5\u756b 17. Utilities - \u5de5\u5177\u985e</p>"},{"location":"assets/#javascript-themejs","title":"JavaScript \u7d50\u69cb (<code>theme.js</code>)","text":"<p>\u6309\u529f\u80fd\u5206\u985e\uff1a 1. Theme Management - \u4e3b\u984c\u7ba1\u7406 2. TQuantLab Button - \u8a02\u95b1\u6309\u9215 3. Custom Theme Toggle - \u81ea\u8a02\u4e3b\u984c\u5207\u63db 4. Sidebar Toggle - \u5074\u908a\u6b04\u958b\u95dc 5. Loading Animation - \u8f09\u5165\u52d5\u756b 6. Theme Transition Effects - \u4e3b\u984c\u5207\u63db\u7279\u6548</p>"},{"location":"assets/#mainhtml","title":"main.html \u7c21\u5316","text":"<p>\u5f9e 695 \u884c\u7c21\u5316\u70ba\u7d04 20 \u884c\uff0c\u53ea\u4fdd\u7559\uff1a - \u6a21\u677f\u7e7c\u627f - GitHub \u901a\u77e5\u6a6b\u5e45</p>"},{"location":"assets/#_4","title":"\u5099\u4efd\u6a94\u6848","text":"\u539f\u59cb\u6a94\u6848 \u5099\u4efd\u4f4d\u7f6e <code>docs/zh-TW/assets/stylesheets/extra.css</code> <code>extra.backup.css</code> <code>config/zh-TW/overrides/main.html</code> <code>main.backup.html</code>"},{"location":"assets/#_5","title":"\u6ce8\u610f\u4e8b\u9805","text":"<ol> <li>public \u8cc7\u6599\u593e\uff1a\u9019\u662f MkDocs \u5efa\u7f6e\u5f8c\u7684\u8f38\u51fa\u8cc7\u6599\u593e\uff0c\u6703\u5728\u6bcf\u6b21 <code>mkdocs build</code> \u6642\u91cd\u65b0\u751f\u6210</li> <li>\u958b\u767c\u6642\u4fee\u6539\uff1a\u61c9\u4fee\u6539 <code>docs/</code> \u548c <code>config/</code> \u4e2d\u7684\u539f\u59cb\u6a94\u6848</li> <li>\u5982\u9700\u9084\u539f\uff1a\u4f7f\u7528 <code>.backup</code> \u6a94\u6848\u9084\u539f</li> </ol>"},{"location":"assets/#_6","title":"\u4f7f\u7528\u65b9\u5f0f","text":"<pre><code># \u958b\u767c\u6a21\u5f0f\ncd config/zh-TW\nmkdocs serve\n\n# \u5efa\u7f6e\nmkdocs build\n</code></pre>"},{"location":"concepts/alphalens-overview/","title":"Alphalens \u56e0\u5b50\u5206\u6790\u6982\u8ad6","text":"<p>Info</p> <p>\u672c\u9801\u4ecb\u7d39 TQuant Lab \u4e2d\u6574\u5408\u7684\u5f37\u5927\u56e0\u5b50\u5206\u6790\u5de5\u5177 Alphalens\uff0c\u5167\u5bb9\u6db5\u84cb\u5176\u6838\u5fc3\u529f\u80fd\u3001\u5982\u4f55\u5f9e Pipeline \u56e0\u5b50\u6578\u64da\u4e2d\u751f\u6210\u56e0\u5b50\u5206\u6790\u5831\u544a\uff0c\u4ee5\u53ca\u5982\u4f55\u89e3\u8b80\u5831\u544a\u4e2d\u7684\u95dc\u9375\u6307\u6a19\u548c\u5716\u8868\uff0c\u5e6b\u52a9\u60a8\u6df1\u5165\u8a55\u4f30\u56e0\u5b50\u7684\u6709\u6548\u6027\u3002</p> <p>\u5728\u91cf\u5316\u6295\u8cc7\u4e2d\uff0c\u56e0\u5b50 (Factor) \u662f\u9a45\u52d5\u7b56\u7565\u7684\u6838\u5fc3\u3002\u4e00\u500b\u6709\u6548\u7684\u56e0\u5b50\u80fd\u5920\u9810\u6e2c\u8cc7\u7522\u672a\u4f86\u7684\u5831\u916c\uff0c\u5f9e\u800c\u70ba\u7b56\u7565\u5e36\u4f86\u8d85\u984d\u6536\u76ca\u3002\u7136\u800c\uff0c\u5982\u4f55\u79d1\u5b78\u5730\u8a55\u4f30\u4e00\u500b\u56e0\u5b50\u7684\u6709\u6548\u6027\u3001\u7a69\u5b9a\u6027\u4ee5\u53ca\u5176\u6f5b\u5728\u7684\u4ea4\u6613\u6210\u672c\uff0c\u662f\u56e0\u5b50\u7814\u7a76\u4e2d\u7684\u95dc\u9375\u6311\u6230\u3002Alphalens \u6b63\u662f\u70ba\u4e86\u89e3\u6c7a\u9019\u4e9b\u554f\u984c\u800c\u8a2d\u8a08\u7684 Python \u5957\u4ef6\u3002</p> <p>Alphalens \u80fd\u5920\u5c07\u60a8\u5f9e Pipeline \u4e2d\u751f\u6210\u7684\u56e0\u5b50\u6578\u64da\uff0c\u8207\u5e02\u5834\u50f9\u683c\u6578\u64da\u7d50\u5408\uff0c\u81ea\u52d5\u8a08\u7b97\u4e00\u7cfb\u5217\u6a19\u6e96\u5316\u7684\u56e0\u5b50\u5206\u6790\u6307\u6a19\u548c\u8996\u89ba\u5316\u5716\u8868\uff0c\u5e6b\u52a9\u60a8\u5168\u9762\u4e86\u89e3\u56e0\u5b50\u7684\u54c1\u8cea\u3002</p>"},{"location":"concepts/alphalens-overview/#1-alphalens","title":"1. Alphalens \u7684\u6838\u5fc3\u6982\u5ff5","text":"<p>\u5728\u6df1\u5165\u4e86\u89e3 Alphalens \u7684\u4f7f\u7528\u4e4b\u524d\uff0c\u8b93\u6211\u5011\u5148\u56de\u9867\u5e7e\u500b\u6838\u5fc3\u6982\u5ff5\uff1a</p>"},{"location":"concepts/alphalens-overview/#factor","title":"\u56e0\u5b50 (Factor)","text":"<ul> <li>\u5b9a\u7fa9 \uff1a\u56e0\u5b50\u662f\u80fd\u5920\u89e3\u91cb\u6216\u9810\u6e2c\u8cc7\u7522\u5831\u916c\u7684\u7279\u5fb5\u3002\u4f8b\u5982\uff0c\u5e02\u503c\u3001\u672c\u76ca\u6bd4\u3001\u52d5\u91cf\u3001\u6ce2\u52d5\u7387\u7b49\u90fd\u53ef\u4ee5\u662f\u56e0\u5b50\u3002</li> <li>\u4f86\u6e90 \uff1a\u5728 TQuant Lab \u4e2d\uff0c\u56e0\u5b50\u901a\u5e38\u900f\u904e Zipline Pipeline \u751f\u6210\u3002</li> </ul>"},{"location":"concepts/alphalens-overview/#factor-returns","title":"\u56e0\u5b50\u5831\u916c (Factor Returns)","text":"<ul> <li>\u5b9a\u7fa9 \uff1a\u5c07\u80a1\u7968\u6839\u64da\u56e0\u5b50\u503c\u9032\u884c\u5206\u7d44\uff08\u4f8b\u5982\uff0c\u5206\u70ba 5 \u500b\u5206\u4f4d\u6578\u7d44\uff09\uff0c\u7136\u5f8c\u8a08\u7b97\u6bcf\u500b\u5206\u7d44\u5728\u672a\u4f86\u4e00\u6bb5\u6642\u9593\u5167\u7684\u5e73\u5747\u5831\u916c\u3002\u56e0\u5b50\u5831\u916c\u8861\u91cf\u4e86\u56e0\u5b50\u503c\u9ad8\u4f4e\u8207\u672a\u4f86\u5831\u916c\u4e4b\u9593\u7684\u95dc\u4fc2\u3002</li> <li>\u591a\u7a7a\u7d44\u5408 \uff1a\u901a\u5e38\u6703\u6bd4\u8f03\u56e0\u5b50\u503c\u6700\u9ad8\u7684\u5206\u7d44\uff08\u591a\u982d\uff09\u8207\u6700\u4f4e\u7684\u5206\u7d44\uff08\u7a7a\u982d\uff09\u4e4b\u9593\u7684\u5831\u916c\u5dee\u7570\uff0c\u4ee5\u8a55\u4f30\u56e0\u5b50\u7684\u9810\u6e2c\u80fd\u529b\u3002</li> </ul>"},{"location":"concepts/alphalens-overview/#information-coefficient-ic","title":"\u8cc7\u8a0a\u4fc2\u6578 (Information Coefficient, IC)","text":"<ul> <li>\u5b9a\u7fa9 \uff1aIC \u8861\u91cf\u4e86\u56e0\u5b50\u503c\u8207\u672a\u4f86\u5831\u916c\u4e4b\u9593\u7684 \u79e9\u76f8\u95dc\u6027 (Rank Correlation) \u3002\u7c21\u55ae\u4f86\u8aaa\uff0c\u5b83\u8a55\u4f30\u4e86\u56e0\u5b50\u5c0d\u672a\u4f86\u5831\u916c\u7684\u9810\u6e2c\u80fd\u529b\u3002</li> <li>\u7bc4\u570d \uff1aIC \u503c\u4ecb\u65bc -1 \u5230 1 \u4e4b\u9593\u3002<ul> <li><code>IC &gt; 0</code>\uff1a\u56e0\u5b50\u503c\u8d8a\u9ad8\uff0c\u672a\u4f86\u5831\u916c\u8d8a\u9ad8\uff08\u6b63\u76f8\u95dc\uff09\u3002</li> <li><code>IC &lt; 0</code>\uff1a\u56e0\u5b50\u503c\u8d8a\u9ad8\uff0c\u672a\u4f86\u5831\u916c\u8d8a\u4f4e\uff08\u8ca0\u76f8\u95dc\uff09\u3002</li> <li><code>IC = 0</code>\uff1a\u56e0\u5b50\u8207\u672a\u4f86\u5831\u916c\u7121\u95dc\u3002</li> </ul> </li> <li>\u91cd\u8981\u6027 \uff1a\u4e00\u500b\u7a69\u5b9a\u4e14\u986f\u8457\u70ba\u6b63\uff08\u6216\u8ca0\uff09\u7684 IC \u503c\uff0c\u662f\u56e0\u5b50\u6709\u6548\u6027\u7684\u91cd\u8981\u8b49\u64da\u3002</li> </ul>"},{"location":"concepts/alphalens-overview/#factor-rank-autocorrelation","title":"\u56e0\u5b50\u6392\u5e8f\u81ea\u76f8\u95dc (Factor Rank Autocorrelation)","text":"<ul> <li>\u5b9a\u7fa9 \uff1a\u8861\u91cf\u56e0\u5b50\u5728\u4e0d\u540c\u6642\u9593\u9ede\u4e0a\u7684\u6392\u5e8f\u7a69\u5b9a\u6027\u3002\u4f8b\u5982\uff0c\u4e00\u500b\u80a1\u7968\u4eca\u5929\u5728\u56e0\u5b50\u503c\u4e0a\u6392\u540d\u9760\u524d\uff0c\u90a3\u9ebc\u5b83\u660e\u5929\u662f\u5426\u4ecd\u7136\u6392\u540d\u9760\u524d\uff1f</li> <li>\u91cd\u8981\u6027 \uff1a\u9ad8\u81ea\u76f8\u95dc\u6027\u610f\u5473\u8457\u56e0\u5b50\u503c\u8b8a\u5316\u7de9\u6162\uff0c\u9019\u6709\u52a9\u65bc\u964d\u4f4e\u7b56\u7565\u7684\u63db\u624b\u7387 (Turnover)\uff0c\u5f9e\u800c\u6e1b\u5c11\u4ea4\u6613\u6210\u672c\u3002\u4f4e\u81ea\u76f8\u95dc\u6027\u5247\u53ef\u80fd\u5c0e\u81f4\u9ad8\u63db\u624b\u7387\u3002</li> </ul>"},{"location":"concepts/alphalens-overview/#2-alphalens","title":"2. Alphalens \u5de5\u4f5c\u6d41\u7a0b","text":"<p>\u4f7f\u7528 Alphalens \u9032\u884c\u56e0\u5b50\u5206\u6790\u7684\u6a19\u6e96\u6d41\u7a0b\u5982\u4e0b\uff1a</p>"},{"location":"concepts/alphalens-overview/#1","title":"\u6b65\u9a5f 1\uff1a\u6e96\u5099\u56e0\u5b50\u6578\u64da\u8207\u50f9\u683c\u6578\u64da","text":"<p>\u60a8\u9700\u8981\u6e96\u5099\u5169\u500b\u4e3b\u8981\u7684\u6578\u64da\u96c6\uff1a</p> <ol> <li> <p>\u56e0\u5b50\u6578\u64da (Factor Data) \uff1a</p> <ul> <li>\u4e00\u500b Pandas Series \u6216 DataFrame\uff0c\u7d22\u5f15\u70ba <code>(\u65e5\u671f, \u8cc7\u7522)</code> \u7684 MultiIndex\u3002</li> <li>\u503c\u70ba\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u65e5\u671f\u4e0a\u7684\u56e0\u5b50\u503c\u3002</li> <li>\u901a\u5e38\u4f86\u81ea Zipline Pipeline \u7684\u8f38\u51fa\u3002</li> </ul> </li> <li> <p>\u50f9\u683c\u6578\u64da (Pricing Data) \uff1a</p> <ul> <li>\u4e00\u500b Pandas DataFrame\uff0c\u7d22\u5f15\u70ba <code>\u65e5\u671f</code>\uff0c\u6b04\u4f4d\u70ba <code>\u8cc7\u7522</code>\u3002</li> <li>\u503c\u70ba\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u65e5\u671f\u4e0a\u7684\u6536\u76e4\u50f9\uff08\u6216\u5176\u4ed6\u7528\u65bc\u8a08\u7b97\u5831\u916c\u7684\u50f9\u683c\uff09\u3002</li> <li>\u901a\u5e38\u4f86\u81ea Zipline \u7684 <code>data.history()</code> \u6216\u76f4\u63a5\u5f9e TEJ \u7372\u53d6\u3002</li> </ul> </li> </ol>"},{"location":"concepts/alphalens-overview/#2-get_clean_factor_and_forward_returns","title":"\u6b65\u9a5f 2\uff1a\u6e05\u6d17\u8207\u5c0d\u9f4a\u6578\u64da (get_clean_factor_and_forward_returns)","text":"<p>\u9019\u662f Alphalens \u5de5\u4f5c\u6d41\u7a0b\u4e2d\u6700\u95dc\u9375\u7684\u4e00\u6b65\u3002<code>alphalens.utils.get_clean_factor_and_forward_returns()</code> \u51fd\u6578\u6703\u81ea\u52d5\u8655\u7406\u4ee5\u4e0b\u4efb\u52d9\uff1a</p> <ul> <li>\u6578\u64da\u5c0d\u9f4a \uff1a\u5c07\u56e0\u5b50\u6578\u64da\u8207\u50f9\u683c\u6578\u64da\u6309\u65e5\u671f\u548c\u8cc7\u7522\u9032\u884c\u5c0d\u9f4a\u3002</li> <li>\u8a08\u7b97\u672a\u4f86\u5831\u916c \uff1a\u6839\u64da\u6307\u5b9a\u7684\u6301\u6709\u671f (<code>periods</code>)\uff0c\u8a08\u7b97\u6bcf\u500b\u8cc7\u7522\u5728\u56e0\u5b50\u503c\u767c\u5e03\u5f8c\u672a\u4f86\u4e00\u6bb5\u6642\u9593\u7684\u5831\u916c\u7387\u3002</li> <li>\u6578\u64da\u6e05\u6d17 \uff1a\u8655\u7406\u7f3a\u5931\u503c\u3001\u7570\u5e38\u503c\uff0c\u4e26\u78ba\u4fdd\u6578\u64da\u683c\u5f0f\u7b26\u5408 Alphalens \u7684\u8981\u6c42\u3002</li> </ul> <p>\u6b64\u51fd\u6578\u63d0\u4f9b\u591a\u500b\u53c3\u6578\u4f86\u63a7\u5236\u56e0\u5b50\u7684\u5206\u7d44\u65b9\u5f0f\uff1a</p> <ul> <li> <p><code>quantiles</code> (int, default 5)\uff1a</p> <ul> <li>\u7528\u9014 \uff1a\u5c07\u56e0\u5b50\u503c\u5206\u70ba\u6307\u5b9a\u6578\u91cf\u7684\u5206\u4f4d\u6578\u7d44\u3002\u4f8b\u5982\uff0c<code>quantiles=5</code> \u6703\u5c07\u80a1\u7968\u5206\u70ba 5 \u7d44\uff0c\u6bcf\u7d44\u5305\u542b\u5927\u81f4\u76f8\u540c\u6578\u91cf\u7684\u80a1\u7968\u3002</li> <li>\u9069\u7528\u5834\u666f \uff1a\u7576\u60a8\u5e0c\u671b\u6309\u80a1\u7968\u6578\u91cf\u5e73\u5747\u5206\u7d44\u6642\u4f7f\u7528\u3002</li> </ul> </li> <li> <p><code>bins</code> (list or array, optional)\uff1a</p> <ul> <li>\u7528\u9014 \uff1a\u63d0\u4f9b\u81ea\u5b9a\u7fa9\u7684\u56e0\u5b50\u503c\u908a\u754c\u4f86\u9032\u884c\u5206\u7d44\u3002\u4f8b\u5982\uff0c<code>bins=[-np.inf, -1, 0, 1, np.inf]</code> \u6703\u5c07\u56e0\u5b50\u503c\u5206\u70ba\u5c0f\u65bc -1\u3001-1 \u5230 0\u30010 \u5230 1\u3001\u5927\u65bc 1 \u7684\u56db\u7d44\u3002</li> <li>\u9069\u7528\u5834\u666f \uff1a\u7576\u60a8\u5e0c\u671b\u6839\u64da\u56e0\u5b50\u503c\u7684\u5be6\u969b\u5206\u4f48\u6216\u7279\u5b9a\u95be\u503c\u9032\u884c\u5206\u7d44\u6642\u4f7f\u7528\u3002</li> </ul> </li> <li> <p><code>binning_by_group</code> (bool, default False)\uff1a</p> <ul> <li>\u7528\u9014 \uff1a\u7576\u8a2d\u7f6e\u70ba <code>True</code> \u6642\uff0c\u6703\u6839\u64da <code>groupby</code> \u53c3\u6578\u6307\u5b9a\u7684\u7d44\uff08\u4f8b\u5982\u884c\u696d\uff09\u5206\u5225\u9032\u884c\u5206\u4f4d\u6578\u6216\u5206\u7bb1\u64cd\u4f5c\u3002</li> <li>\u9069\u7528\u5834\u666f \uff1a\u7576\u60a8\u5e0c\u671b\u5728\u6bcf\u500b\u884c\u696d\u5167\u90e8\u7368\u7acb\u9032\u884c\u56e0\u5b50\u5206\u7d44\uff0c\u4ee5\u6d88\u9664\u884c\u696d\u504f\u898b\u6642\u4f7f\u7528\u3002</li> </ul> </li> </ul> <pre><code>import alphalens as al\nimport pandas as pd\nimport numpy as np\n\n# \u5047\u8a2d factor_data \u662f\u60a8\u5f9e Pipeline \u7372\u53d6\u7684\u56e0\u5b50\u503c (MultiIndex: date, asset)\n# \u5047\u8a2d pricing_data \u662f\u60a8\u7372\u53d6\u7684\u80a1\u7968\u50f9\u683c\u6578\u64da (DataFrame: index=date, columns=asset)\n\n# \u70ba\u4e86\u6f14\u793a\uff0c\u6211\u5011\u5275\u5efa\u4e00\u4e9b\u6a21\u64ec\u6578\u64da\nfactor_data = pd.Series(np.random.rand(100), index=pd.MultiIndex.from_product([[pd.Timestamp('2023-01-01', tz='utc')], ['2330', '2454', '2303', '2881']]))\npricing_data = pd.DataFrame(np.random.rand(10, 4), index=pd.date_range('2023-01-01', periods=10, tz='utc'), columns=['2330', '2454', '2303', '2881'])\n\n# \u7bc4\u4f8b 1: \u4f7f\u7528 quantiles \u9032\u884c\u5206\u7d44 (\u9810\u8a2d\u884c\u70ba)\nfactor_data_quantiles = al.utils.get_clean_factor_and_forward_returns(\n    factor=factor_data,\n    prices=pricing_data,\n    periods=(1, 5, 10), # \u8a08\u7b97\u672a\u4f86 1, 5, 10 \u5929\u7684\u5831\u916c\n    quantiles=5, # \u5c07\u56e0\u5b50\u5206\u70ba 5 \u500b\u5206\u4f4d\u6578\u7d44\n    groupby=None,\n    max_loss=0.35\n)\n\n# \u7bc4\u4f8b 2: \u4f7f\u7528 bins \u9032\u884c\u81ea\u5b9a\u7fa9\u5206\u7d44\nfactor_data_bins = al.utils.get_clean_factor_and_forward_returns(\n    factor=factor_data,\n    prices=pricing_data,\n    periods=(1, 5, 10),\n    bins=[-np.inf, 0.2, 0.4, 0.6, 0.8, np.inf], # \u81ea\u5b9a\u7fa9 5 \u500b\u5206\u7bb1\u908a\u754c\n    groupby=None,\n    max_loss=0.35\n)\n\n# \u7bc4\u4f8b 3: \u5047\u8a2d\u6709\u884c\u696d\u5206\u7d44\u6578\u64da\uff0c\u4e26\u6309\u884c\u696d\u9032\u884c\u5206\u7d44 (binning_by_group=True)\n# industry_data = pd.Series(..., index=pd.MultiIndex.from_product(...))\n# factor_data_by_group = al.utils.get_clean_factor_and_forward_returns(\n# factor=factor_data,\n# prices=pricing_data,\n# periods=(1, 5, 10),\n# quantiles=5,\n# groupby=industry_data, # \u50b3\u5165\u884c\u696d\u5206\u7d44\u6578\u64da\n# binning_by_group=True, # \u5728\u6bcf\u500b\u884c\u696d\u5167\u90e8\u7368\u7acb\u5206\u7d44\n# max_loss=0.35\n# )\n\nprint(\"\u4f7f\u7528 quantiles \u5206\u7d44\u7684\u6578\u64da\u982d\u90e8\uff1a\")\nprint(factor_data_quantiles.head())\n</code></pre>"},{"location":"concepts/alphalens-overview/#3-tear-sheet","title":"\u6b65\u9a5f 3\uff1a\u751f\u6210\u56e0\u5b50\u5206\u6790\u5831\u544a (Tear Sheet)","text":"<p>Alphalens \u63d0\u4f9b\u4e86\u591a\u7a2e Tear Sheet \u51fd\u6578\uff0c\u7528\u65bc\u751f\u6210\u4e0d\u540c\u5074\u91cd\u9ede\u7684\u5831\u544a\u3002\u6700\u5e38\u7528\u7684\u662f <code>create_full_tear_sheet()</code>\uff0c\u5b83\u6703\u751f\u6210\u4e00\u4efd\u5305\u542b\u6240\u6709\u6a19\u6e96\u5206\u6790\u5716\u8868\u548c\u6307\u6a19\u7684\u7d9c\u5408\u5831\u544a\u3002</p> <pre><code># \u751f\u6210\u5b8c\u6574\u7684\u56e0\u5b50\u5206\u6790\u5831\u544a\nal.tears.create_full_tear_sheet(factor_data_cleaned)\n\n# \u60a8\u4e5f\u53ef\u4ee5\u751f\u6210\u7279\u5b9a\u985e\u578b\u7684\u5831\u544a\uff0c\u4f8b\u5982\uff1a\n# al.tears.create_returns_tear_sheet(factor_data_cleaned) # \u50c5\u5831\u916c\u76f8\u95dc\u5206\u6790\n# al.tears.create_information_tear_sheet(factor_data_cleaned) # \u50c5 IC \u76f8\u95dc\u5206\u6790\n# al.tears.create_turnover_tear_sheet(factor_data_cleaned) # \u50c5\u63db\u624b\u7387\u76f8\u95dc\u5206\u6790\n</code></pre>"},{"location":"concepts/alphalens-overview/#3-alphalens","title":"3. \u89e3\u8b80 Alphalens \u95dc\u9375\u5716\u8868\u8207\u6307\u6a19","text":"<p>Alphalens \u5831\u544a\u63d0\u4f9b\u4e86\u8c50\u5bcc\u7684\u8996\u89ba\u5316\u548c\u7d71\u8a08\u6578\u64da\uff0c\u5e6b\u52a9\u60a8\u5168\u9762\u8a55\u4f30\u56e0\u5b50\u7684\u54c1\u8cea\u3002</p>"},{"location":"concepts/alphalens-overview/#_1","title":"\u56e0\u5b50\u5831\u916c\u5206\u6790","text":"<ul> <li> <p>\u5206\u4f4d\u6578\u7d2f\u7a4d\u5831\u916c\u5716 (Cumulative Returns by Factor Quantile)     \u6b64\u5716\u5c07\u80a1\u7968\u6309\u56e0\u5b50\u503c\u5206\u70ba\u4e0d\u540c\u7684\u5206\u4f4d\u6578\u7d44\uff08\u4f8b\u5982 5 \u7d44\uff09\uff0c\u7136\u5f8c\u7e6a\u88fd\u6bcf\u500b\u5206\u4f4d\u6578\u7d44\u7684\u7d2f\u7a4d\u5831\u916c\u3002\u4e00\u500b\u6709\u6548\u7684\u56e0\u5b50\u901a\u5e38\u6703\u986f\u793a\u51fa\u56e0\u5b50\u503c\u6700\u9ad8\u7684\u5206\u7d44\uff08\u591a\u982d\uff09\u7d2f\u7a4d\u5831\u916c\u986f\u8457\u9ad8\u65bc\u56e0\u5b50\u503c\u6700\u4f4e\u7684\u5206\u7d44\uff08\u7a7a\u982d\uff09\u7684\u8da8\u52e2\u3002</p> </li> <li> <p>\u5206\u4f4d\u6578\u5e73\u5747\u5831\u916c\u689d\u5f62\u5716 (Mean Return by Quantile Bar Plot)     \u6b64\u5716\u4ee5\u689d\u5f62\u5716\u7684\u5f62\u5f0f\u5c55\u793a\u6bcf\u500b\u56e0\u5b50\u5206\u4f4d\u6578\u7d44\u7684\u5e73\u5747\u5831\u916c\u3002\u7406\u60f3\u60c5\u6cc1\u4e0b\uff0c\u60a8\u6703\u770b\u5230\u5831\u916c\u7387\u96a8\u8457\u56e0\u5b50\u5206\u4f4d\u6578\u7684\u589e\u52a0\u800c\u55ae\u8abf\u905e\u589e\uff08\u6216\u905e\u6e1b\uff09\u3002</p> </li> </ul>"},{"location":"concepts/alphalens-overview/#ic","title":"\u8cc7\u8a0a\u4fc2\u6578 (IC) \u5206\u6790","text":"<ul> <li> <p>IC \u6642\u9593\u5e8f\u5217\u5716 (IC Time Series)     \u6b64\u5716\u986f\u793a\u4e86 IC \u503c\u96a8\u6642\u9593\u7684\u8b8a\u5316\u3002\u60a8\u53ef\u4ee5\u89c0\u5bdf IC \u7684\u7a69\u5b9a\u6027\u3001\u5747\u503c\u548c\u6ce2\u52d5\u6027\u3002\u4e00\u500b\u597d\u7684\u56e0\u5b50\u61c9\u8a72\u6709\u7a69\u5b9a\u4e14\u986f\u8457\u7684 IC \u503c\u3002</p> </li> <li> <p>IC \u5206\u4f48\u76f4\u65b9\u5716 (IC Histogram)     \u6b64\u5716\u5c55\u793a\u4e86 IC \u503c\u7684\u983b\u7387\u5206\u4f48\u3002\u60a8\u53ef\u4ee5\u5224\u65b7 IC \u503c\u662f\u5426\u96c6\u4e2d\u5728\u6b63\u503c\u5340\u57df\uff0c\u4ee5\u53ca\u5176\u5206\u4f48\u662f\u5426\u63a5\u8fd1\u5e38\u614b\u5206\u4f48\u3002</p> </li> <li> <p>\u6708\u5ea6 IC \u71b1\u529b\u5716 (Monthly IC Heatmap)     \u6b64\u5716\u4ee5\u71b1\u529b\u5716\u7684\u5f62\u5f0f\u5c55\u793a\u56e0\u5b50\u5728\u6bcf\u5e74\u5404\u6708\u4efd\u7684\u5e73\u5747 IC \u503c\uff0c\u6709\u52a9\u65bc\u767c\u73fe\u56e0\u5b50\u662f\u5426\u5b58\u5728\u5b63\u7bc0\u6027\u6548\u61c9\u3002</p> </li> </ul>"},{"location":"concepts/alphalens-overview/#_2","title":"\u63db\u624b\u7387\u5206\u6790","text":"<ul> <li> <p>\u56e0\u5b50\u63db\u624b\u7387\u5716 (Factor Turnover)     \u6b64\u5716\u8861\u91cf\u4e86\u56e0\u5b50\u5206\u4f4d\u6578\u7d44\u4e2d\u80a1\u7968\u7684\u63db\u624b\u901f\u5ea6\u3002\u9ad8\u63db\u624b\u7387\u610f\u5473\u8457\u56e0\u5b50\u503c\u8b8a\u5316\u983b\u7e41\uff0c\u53ef\u80fd\u5c0e\u81f4\u8f03\u9ad8\u7684\u4ea4\u6613\u6210\u672c\u3002</p> </li> <li> <p>\u56e0\u5b50\u6392\u5e8f\u81ea\u76f8\u95dc\u5716 (Factor Rank Autocorrelation)     \u6b64\u5716\u986f\u793a\u4e86\u56e0\u5b50\u6392\u5e8f\u7684\u7a69\u5b9a\u6027\u3002\u9ad8\u81ea\u76f8\u95dc\u6027\u610f\u5473\u8457\u56e0\u5b50\u503c\u5728\u4e00\u6bb5\u6642\u9593\u5167\u76f8\u5c0d\u7a69\u5b9a\uff0c\u6709\u52a9\u65bc\u964d\u4f4e\u63db\u624b\u7387\u3002</p> </li> </ul>"},{"location":"concepts/alphalens-overview/#4-demeaning","title":"4. \u53bb\u5e02\u5834\u5316 (Demeaning) \u6982\u5ff5","text":"<p>\u5728\u56e0\u5b50\u5206\u6790\u4e2d\uff0c\u300c\u53bb\u5e02\u5834\u5316 (Demeaning)\u300d\u662f\u4e00\u500b\u91cd\u8981\u7684\u6982\u5ff5\uff0c\u5b83\u65e8\u5728\u6d88\u9664\u6574\u9ad4\u5e02\u5834\u6ce2\u52d5\u5c0d\u56e0\u5b50\u5831\u916c\u7684\u5f71\u97ff\uff0c\u5f9e\u800c\u66f4\u6e05\u6670\u5730\u63ed\u793a\u56e0\u5b50\u672c\u8eab\u7684\u9810\u6e2c\u80fd\u529b\u3002</p>"},{"location":"concepts/alphalens-overview/#_3","title":"\u4ec0\u9ebc\u662f\u53bb\u5e02\u5834\u5316\uff1f","text":"<p>\u7576\u6211\u5011\u8a08\u7b97\u80a1\u7968\u5831\u916c\u6642\uff0c\u9019\u4e9b\u5831\u916c\u5f80\u5f80\u5305\u542b\u5169\u90e8\u5206\uff1a\u4e00\u90e8\u5206\u4f86\u81ea\u5e02\u5834\u7684\u6574\u9ad4\u6ce2\u52d5\uff0c\u53e6\u4e00\u90e8\u5206\u4f86\u81ea\u80a1\u7968\u81ea\u8eab\u7684\u7279\u8cea\uff08\u5373\u56e0\u5b50\uff09\u3002\u53bb\u5e02\u5834\u5316\u5c31\u662f\u5c07\u6bcf\u6a94\u80a1\u7968\u7684\u5831\u916c\u7387\u6263\u9664\u5168\u5e02\u5834\uff08\u6216\u7279\u5b9a\u7d44\u5225\uff09\u7684\u5e73\u5747\u5831\u916c\uff0c\u4f7f\u5f97\u5206\u6790\u7684\u91cd\u9ede\u805a\u7126\u65bc\u56e0\u5b50\u5e36\u4f86\u7684\u76f8\u5c0d\u6536\u76ca\uff0c\u800c\u975e\u5e02\u5834\u7684\u6f32\u8dcc\u3002</p>"},{"location":"concepts/alphalens-overview/#demeaned","title":"demeaned \u53c3\u6578\u7684\u4f7f\u7528","text":"<p>Alphalens \u7684\u8a31\u591a\u51fd\u6578\uff08\u7279\u5225\u662f\u8207\u5831\u916c\u76f8\u95dc\u7684\u5206\u6790\u51fd\u6578\uff0c\u4f8b\u5982 <code>alphalens.tears.create_returns_tear_sheet</code> \u6216 <code>alphalens.performance.mean_return_by_quantile</code>\uff09\u90fd\u63d0\u4f9b\u4e86 <code>demeaned</code> \u53c3\u6578\u3002\u7576 <code>demeaned</code> \u8a2d\u7f6e\u70ba <code>True</code> \u6642\uff0cAlphalens \u6703\u5728\u8a08\u7b97\u56e0\u5b50\u5831\u916c\u4e4b\u524d\uff0c\u5c0d\u80a1\u7968\u5831\u916c\u9032\u884c\u53bb\u5e02\u5834\u5316\u8655\u7406\u3002</p> <ul> <li><code>demeaned=True</code>\uff1a\u8a08\u7b97\u53bb\u5e02\u5834\u5316\u5f8c\u7684\u56e0\u5b50\u5831\u916c\uff0c\u6709\u52a9\u65bc\u8a55\u4f30\u56e0\u5b50\u7684 \u7d14\u7cb9 Alpha \u8ca2\u737b \u3002</li> <li><code>demeaned=False</code> (\u9810\u8a2d\u503c)\uff1a\u8a08\u7b97\u539f\u59cb\u56e0\u5b50\u5831\u916c\uff0c\u5305\u542b\u5e02\u5834\u6ce2\u52d5\u7684\u5f71\u97ff\u3002</li> </ul> <pre><code>import alphalens as al\n\n# \u5047\u8a2d factor_data_cleaned \u662f\u7d93\u904e get_clean_factor_and_forward_returns \u8655\u7406\u5f8c\u7684\u6578\u64da\n\n# \u7bc4\u4f8b 1: \u8a08\u7b97\u672a\u53bb\u5e02\u5834\u5316\u7684\u56e0\u5b50\u5831\u916c (\u9810\u8a2d\u884c\u70ba)\nal.tears.create_returns_tear_sheet(factor_data_cleaned, demeaned=False)\n\n# \u7bc4\u4f8b 2: \u8a08\u7b97\u53bb\u5e02\u5834\u5316\u5f8c\u7684\u56e0\u5b50\u5831\u916c\nal.tears.create_returns_tear_sheet(factor_data_cleaned, demeaned=True)\n\n# \u60a8\u4e5f\u53ef\u4ee5\u5728\u8a08\u7b97 mean_return_by_quantile \u6642\u6307\u5b9a demeaned \u53c3\u6578\n# mean_return_by_q_demeaned = al.performance.mean_return_by_quantile(\n# factor_data_cleaned, \n# demeaned=True\n# )\n</code></pre>"},{"location":"concepts/alphalens-overview/#_4","title":"\u4f55\u6642\u4f7f\u7528\u53bb\u5e02\u5834\u5316\uff1f","text":"<ul> <li>\u8a55\u4f30\u56e0\u5b50\u7d14\u7cb9 Alpha \uff1a\u7576\u60a8\u5e0c\u671b\u8a55\u4f30\u56e0\u5b50\u5728\u5254\u9664\u5e02\u5834\u5f71\u97ff\u5f8c\u7684\u7368\u7acb\u9810\u6e2c\u80fd\u529b\u6642\uff0c\u61c9\u4f7f\u7528\u53bb\u5e02\u5834\u5316\u3002</li> <li>\u6bd4\u8f03\u4e0d\u540c\u56e0\u5b50 \uff1a\u5728\u6bd4\u8f03\u4e0d\u540c\u56e0\u5b50\u7684\u8868\u73fe\u6642\uff0c\u53bb\u5e02\u5834\u5316\u53ef\u4ee5\u63d0\u4f9b\u66f4\u516c\u5e73\u7684\u57fa\u790e\uff0c\u56e0\u70ba\u5b83\u6e1b\u5c11\u4e86\u5e02\u5834\u98a8\u683c\u5c0d\u6bd4\u8f03\u7684\u5e72\u64fe\u3002</li> <li>\u69cb\u5efa\u4e2d\u6027\u7b56\u7565 \uff1a\u5c0d\u65bc\u65e8\u5728\u69cb\u5efa\u5e02\u5834\u4e2d\u6027\u7b56\u7565\u7684\u7814\u7a76\u8005\u4f86\u8aaa\uff0c\u53bb\u5e02\u5834\u5316\u662f\u7406\u89e3\u56e0\u5b50\u8ca2\u737b\u7684\u95dc\u9375\u4e00\u6b65\u3002</li> </ul>"},{"location":"concepts/alphalens-overview/#_5","title":"\u7e3d\u7d50","text":"<p>Alphalens \u662f\u91cf\u5316\u56e0\u5b50\u7814\u7a76\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u5de5\u5177\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u5957\u6a19\u6e96\u5316\u3001\u7cfb\u7d71\u5316\u7684\u65b9\u6cd5\u4f86\u8a55\u4f30\u56e0\u5b50\u7684\u9810\u6e2c\u80fd\u529b\u3001\u7a69\u5b9a\u6027\u548c\u4ea4\u6613\u6210\u672c\u3002\u900f\u904e\u719f\u7df4\u904b\u7528 Alphalens \u751f\u6210\u4e26\u89e3\u8b80\u56e0\u5b50\u5206\u6790\u5831\u544a\uff0c\u4e26\u7406\u89e3 <code>quantiles</code>\u3001<code>bins</code>\u3001<code>binning_by_group</code> \u4ee5\u53ca\u300c\u53bb\u5e02\u5834\u5316 (Demeaning)\u300d\u7b49\u95dc\u9375\u53c3\u6578\uff0c\u60a8\u53ef\u4ee5\u66f4\u79d1\u5b78\u5730\u7be9\u9078\u548c\u512a\u5316\u60a8\u7684\u6295\u8cc7\u56e0\u5b50\uff0c\u5f9e\u800c\u69cb\u5efa\u51fa\u66f4\u5177\u7af6\u722d\u529b\u7684\u91cf\u5316\u7b56\u7565\u3002</p>"},{"location":"concepts/calendars/","title":"\u6838\u5fc3\u6982\u5ff5\uff1a\u4ea4\u6613\u65e5\u66c6 (Trading Calendars)","text":"<p>Info</p> <p>\u672c\u9801\u8aaa\u660e\u4ea4\u6613\u65e5\u66c6\u5728\u91cf\u5316\u56de\u6e2c\u4e2d\u7684\u91cd\u8981\u6027\uff0c\u4ee5\u53ca\u5982\u4f55\u5728 TQuant Lab \u4e2d\u4f7f\u7528\u548c\u61c9\u7528\u4ea4\u6613\u65e5\u66c6\u3002</p>"},{"location":"concepts/calendars/#_1","title":"\u70ba\u4ec0\u9ebc\u9700\u8981\u4ea4\u6613\u65e5\u66c6\uff1f","text":"<p>\u91d1\u878d\u5e02\u5834\u4e26\u975e\u5168\u5e74\u7121\u4f11\u3002\u5404\u570b\u5e02\u5834\u90fd\u6709\u81ea\u5df1\u7684\u4ea4\u6613\u6642\u9593\u3001\u5047\u65e5\u3001\u4ee5\u53ca\u56e0\u7279\u6b8a\u4e8b\u4ef6\uff08\u5982\u98b1\u98a8\uff09\u7684\u4f11\u5e02\u65e5\u3002\u5728\u9032\u884c\u91cf\u5316\u56de\u6e2c\u6642\uff0c\u5982\u679c\u5ffd\u7565\u4e86\u9019\u4e9b\u975e\u4ea4\u6613\u65e5\uff0c\u53ef\u80fd\u6703\u5c0e\u81f4\u4ee5\u4e0b\u56b4\u91cd\u554f\u984c\uff1a</p> <ol> <li>\u4e0d\u5207\u5be6\u969b\u7684\u4ea4\u6613\uff1a\u7b56\u7565\u53ef\u80fd\u6703\u5728\u5e02\u5834\u4f11\u5e02\u6642\u7522\u751f\u4ea4\u6613\u8a0a\u865f\u4e26\u8a66\u5716\u4e0b\u55ae\uff0c\u9019\u5728\u73fe\u5be6\u4e16\u754c\u4e2d\u662f\u4e0d\u53ef\u80fd\u7684\u3002</li> <li>\u932f\u8aa4\u7684\u7e3e\u6548\u8a08\u7b97\uff1a\u82e5\u5c07\u975e\u4ea4\u6613\u65e5\u7d0d\u5165\u5831\u916c\u7387\u8a08\u7b97\uff0c\u6703\u7a00\u91cb\u6ce2\u52d5\u7387\uff0c\u9ad8\u4f30\u590f\u666e\u6bd4\u7387\u7b49\u98a8\u96aa\u6307\u6a19\u3002</li> <li>\u524d\u8996\u504f\u5dee (Lookahead Bias)\uff1a\u82e5\u5728\u5047\u65e5\u62ff\u5230\u4e0b\u4e00\u500b\u958b\u76e4\u65e5\u7684\u8cc7\u8a0a\uff0c\u6703\u7522\u751f\u4e0d\u516c\u5e73\u7684\u9810\u77e5\u512a\u52e2\u3002</li> </ol> <p>\u56e0\u6b64\uff0c\u4e00\u500b\u6e96\u78ba\u7684\u4ea4\u6613\u65e5\u66c6\u662f\u4efb\u4f55\u56b4\u8b39\u56de\u6e2c\u6846\u67b6\u7684\u57fa\u790e\u3002\u5b83\u5b9a\u7fa9\u4e86\u56de\u6e2c\u904e\u7a0b\u4e2d\u6bcf\u4e00\u5929\u662f\u5426\u70ba\u300c\u4ea4\u6613\u65e5\u300d\uff08session\uff09\uff0c\u4ee5\u53ca\u8a72\u65e5\u7684\u958b\u76e4\u8207\u6536\u76e4\u6642\u9593\u3002</p>"},{"location":"concepts/calendars/#zipline","title":"Zipline \u4e2d\u7684\u65e5\u66c6\u6a5f\u5236","text":"<p>Zipline \u900f\u904e\u4e00\u500b\u5f37\u5927\u7684\u65e5\u66c6\u7cfb\u7d71\u4f86\u6a21\u64ec\u771f\u5be6\u4e16\u754c\u7684\u4ea4\u6613\u6642\u9593\u3002\u6bcf\u500b\u56de\u6e2c\u90fd\u5fc5\u9808\u7d81\u5b9a\u4e00\u500b\u7279\u5b9a\u7684\u4ea4\u6613\u65e5\u66c6\u3002\u9019\u500b\u65e5\u66c6\u7269\u4ef6\u6703\u544a\u8a34\u56de\u6e2c\u5f15\u64ce\uff1a</p> <ul> <li>\u54ea\u4e9b\u65e5\u671f\u662f\u4ea4\u6613\u65e5\u3002</li> <li>\u6bcf\u500b\u4ea4\u6613\u65e5\u7684\u78ba\u5207\u958b\u76e4\u6642\u9593\u8207\u6536\u76e4\u6642\u9593\u3002</li> <li>\u662f\u5426\u6709\u63d0\u65e9\u6536\u76e4\u7684\u72c0\u6cc1\u3002</li> </ul>"},{"location":"concepts/calendars/#tquant-lab","title":"\u5728 TQuant Lab \u4e2d\u53d6\u5f97\u65e5\u66c6","text":"<p>TQuant Lab \u5167\u5efa\u4e86\u53f0\u7063\u5e02\u5834\u7684\u4ea4\u6613\u65e5\u66c6\uff0c\u60a8\u53ef\u4ee5\u900f\u904e <code>get_calendar</code> \u51fd\u6578\u8f15\u6613\u53d6\u5f97\u3002\u53f0\u7063\u8b49\u5238\u4ea4\u6613\u6240\u7684\u5b98\u65b9\u65e5\u66c6\u540d\u7a31\u70ba <code>XTAI</code>\uff0c\u800c TQuant Lab \u70ba\u4e86\u65b9\u4fbf\u4f7f\u7528\u8005\uff0c\u5c07\u5176\u8a3b\u518a\u70ba <code>TEJ</code>\u3002</p> <p>\u56e0\u6b64\uff0c\u5728 TQuant Lab \u74b0\u5883\u4e2d\uff0c<code>TEJ</code> \u662f\u60a8\u6700\u5e38\u6703\u7528\u5230\u7684\u4ea4\u6613\u65e5\u66c6\u3002</p> <pre><code>from zipline.utils.calendar_utils import get_calendar\n\n# \u53d6\u5f97\u53f0\u7063\u5e02\u5834\u7684\u4ea4\u6613\u65e5\u66c6\ntaiwan_calendar = get_calendar('TEJ')\n\n# \u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5b98\u65b9\u540d\u7a31 XTAI\uff0c\u5169\u8005\u662f\u76f8\u540c\u7684\n# taiwan_calendar_xtai = get_calendar('XTAI')\n</code></pre>"},{"location":"concepts/calendars/#_2","title":"\u5982\u4f55\u61c9\u7528\u65bc\u56de\u6e2c","text":"<p>\u5728\u8a2d\u5b9a\u4e26\u57f7\u884c <code>run_algorithm</code> \u51fd\u6578\u6642\uff0c\u60a8\u53ef\u4ee5\u900f\u904e <code>trading_calendar</code> \u53c3\u6578\u5c07\u60a8\u60f3\u4f7f\u7528\u7684\u65e5\u66c6\u50b3\u5165\u3002\u9019\u6a23\u4e00\u4f86\uff0c\u6574\u500b\u56de\u6e2c\u904e\u7a0b\u5c31\u6703\u56b4\u683c\u9075\u5b88\u8a72\u65e5\u66c6\u5b9a\u7fa9\u7684\u4ea4\u6613\u6642\u9593\u3002</p> <pre><code>from zipline import run_algorithm\nfrom zipline.utils.calendar_utils import get_calendar\nimport pandas as pd\n\n# ... (\u6b64\u8655\u7701\u7565 initialize, handle_data \u7b49\u51fd\u6578\u7684\u5b9a\u7fa9)\n\n# \u57f7\u884c\u56de\u6e2c\u6642\uff0c\u50b3\u5165 TEJ \u65e5\u66c6\nresults = run_algorithm(\n    start=pd.Timestamp('2020-01-01', tz='utc'),\n    end=pd.Timestamp('2024-09-30', tz='utc'),\n    initialize=initialize,\n    capital_base=1000000,\n    bundle='tquant_future',\n    trading_calendar=get_calendar('TEJ') # &lt;--- \u5728\u6b64\u6307\u5b9a\u4ea4\u6613\u65e5\u66c6\n)\n</code></pre>"},{"location":"concepts/calendars/#_3","title":"\u7e3d\u7d50","text":"<p>\u4f7f\u7528\u6b63\u78ba\u7684\u4ea4\u6613\u65e5\u66c6\u662f\u78ba\u4fdd\u56de\u6e2c\u6e96\u78ba\u6027\u7684\u57fa\u672c\u8981\u6c42\u3002\u5728 TQuant Lab \u4e2d\uff0c\u60a8\u61c9\u8a72\u96a8\u6642\u5728 <code>run_algorithm</code> \u51fd\u6578\u4e2d\u660e\u78ba\u6307\u5b9a <code>trading_calendar=get_calendar('TEJ')</code>\uff0c\u4ee5\u78ba\u4fdd\u60a8\u7684\u7b56\u7565\u884c\u70ba\u8207\u53f0\u7063\u5e02\u5834\u7684\u771f\u5be6\u958b\u4f11\u5e02\u72c0\u6cc1\u4fdd\u6301\u4e00\u81f4\u3002</p>"},{"location":"concepts/performance-metrics/","title":"\u7e3e\u6548\u6307\u6a19\u8207\u56de\u6e2c\u5206\u6790","text":"<p>Info</p> <p>\u672c\u9801\u89e3\u91cb\u4e86\u6700\u91cd\u8981\u7684\u5e7e\u500b\u7e3e\u6548\u6307\u6a19\uff0c\u5e6b\u52a9\u4f60\u5224\u65b7\u4e00\u500b\u7b56\u7565\u662f\u5426\u503c\u5f97\u4ea4\u6613\u3002\u5167\u5bb9\u6db5\u84cb\u5831\u916c\u3001\u98a8\u96aa\u8207\u7d9c\u5408\u8a55\u4f30\u6307\u6a19\uff0c\u4ee5\u53ca\u5e38\u898b\u7684\u56de\u6e2c\u9677\u9631\u3002</p>"},{"location":"concepts/performance-metrics/#1","title":"1. \u6982\u8ff0","text":"<p>\u5728\u7de8\u5beb\u4ea4\u6613\u7b56\u7565\u5f8c\uff0c\u5982\u4f55\u8a55\u4f30\u7b56\u7565\u7684\u512a\u52a3\uff1f\u4e0d\u540c\u7684\u7e3e\u6548\u6307\u6a19\u5f9e\u4e0d\u540c\u89d2\u5ea6\u53cd\u6620\u4e86\u7b56\u7565\u7684\u8868\u73fe\u3002\u672c\u9801\u9762\u89e3\u91cb\u4e86\u6700\u91cd\u8981\u7684\u5e7e\u500b\u6307\u6a19\uff0c\u5e6b\u52a9\u4f60\u5224\u65b7\u4e00\u500b\u7b56\u7565\u662f\u5426\u503c\u5f97\u4ea4\u6613\u3002</p>"},{"location":"concepts/performance-metrics/#2","title":"2. \u70ba\u4ec0\u9ebc\u9700\u8981\u4e86\u89e3\u9019\u4e9b\u6307\u6a19\uff1f","text":"<p>\u4e00\u500b\u770b\u8d77\u4f86\u5e74\u5316\u5831\u916c 20% \u7684\u7b56\u7565\uff0c\u53ef\u80fd\u5728\u5e02\u5834\u6ce2\u52d5\u6642\u8667\u640d 50%\uff0c\u9019\u7a2e\u9ad8\u98a8\u96aa\u7684\u7b56\u7565\u4e26\u4e0d\u9069\u5408\u6240\u6709\u6295\u8cc7\u8005\u3002\u7e3e\u6548\u6307\u6a19\u5e6b\u52a9\u4f60\u5728\u300c\u5831\u916c\u300d\u548c\u300c\u98a8\u96aa\u300d\u4e4b\u9593\u53d6\u5f97\u5e73\u8861\u3002</p>"},{"location":"concepts/performance-metrics/#3","title":"3. \u6838\u5fc3\u6307\u6a19","text":""},{"location":"concepts/performance-metrics/#31","title":"3.1. \u5831\u916c\u6307\u6a19","text":""},{"location":"concepts/performance-metrics/#311-total-return","title":"3.1.1. \u7e3d\u5831\u916c (Total Return)","text":"<p>\u5b9a\u7fa9 : \u5f9e\u7b56\u7565\u958b\u59cb\u5230\u7d50\u675f\uff0c\u6295\u5165\u7684\u8cc7\u91d1\u5171\u589e\u9577\u4e86\u591a\u5c11\u767e\u5206\u6bd4\u3002</p> <p>\u8a08\u7b97 : (\u6700\u7d42\u8cc7\u7522 - \u521d\u59cb\u8cc7\u7522) / \u521d\u59cb\u8cc7\u7522</p> <p>\u89e3\u8b80 : - 20% \u7e3d\u5831\u916c = \u521d\u59cb 100 \u842c\u8b8a\u6210 120 \u842c - \u4e0d\u8003\u616e\u6642\u9593\u56e0\u7d20\uff0c\u53ea\u770b\u7d55\u5c0d\u589e\u9577</p>"},{"location":"concepts/performance-metrics/#312-annualized-return","title":"3.1.2. \u5e74\u5316\u5831\u916c (Annualized Return)","text":"<p>\u5b9a\u7fa9 : \u5c07\u7e3d\u5831\u916c\u8f49\u63db\u70ba\u5e74\u5747\u589e\u9577\u7387\uff0c\u4fbf\u65bc\u6bd4\u8f03\u4e0d\u540c\u6642\u9593\u9577\u5ea6\u7684\u7b56\u7565\u3002</p> <p>\u8a08\u7b97 : (1 + \u7e3d\u5831\u916c) ^ (1 / \u5e74\u6578) - 1</p> <p>\u89e3\u8b80 : - \u5047\u8a2d\u56de\u6e2c\u671f 3 \u5e74\uff0c\u7e3d\u5831\u916c 30%\uff0c\u5e74\u5316\u5831\u916c \u2248 9% - \u4fbf\u65bc\u8207\u5e02\u5834\u57fa\u6e96\u6307\u6578\u5c0d\u6bd4</p>"},{"location":"concepts/performance-metrics/#32","title":"3.2. \u98a8\u96aa\u6307\u6a19","text":""},{"location":"concepts/performance-metrics/#321-maximum-drawdown","title":"3.2.1. \u6700\u5927\u8667\u640d (Maximum Drawdown)","text":"<p>\u5b9a\u7fa9 : \u5f9e\u5cf0\u503c\u5230\u8c37\u503c\uff0c\u7b56\u7565\u8cc7\u7522\u66fe\u7d93\u4e0b\u8dcc\u7684\u6700\u5927\u5e45\u5ea6\u3002</p> <p>\u542b\u7fa9 : - Max Drawdown -20% \u610f\u5473\u8457\u6700\u7cdf\u7cd5\u7684\u60c5\u6cc1\u4e0b\uff0c\u8cc7\u7522\u4e0b\u8dcc\u4e86 20% - \u53cd\u6620\u4e86\u7b56\u7565\u7684\u300c\u6700\u58de\u72c0\u6cc1\u300d</p> <p>\u70ba\u4ec0\u9ebc\u91cd\u8981 : - \u5e6b\u52a9\u8a55\u4f30\u5fc3\u7406\u627f\u53d7\u80fd\u529b - \u4e00\u500b\u5e74\u5316 15% \u4f46 Max Drawdown -50% \u7684\u7b56\u7565\u53ef\u80fd\u4e0d\u9069\u5408\u4fdd\u5b88\u6295\u8cc7\u8005</p>"},{"location":"concepts/performance-metrics/#322-volatility","title":"3.2.2. \u6ce2\u52d5\u7387 (Volatility)","text":"<p>\u5b9a\u7fa9 : \u7b56\u7565\u6bcf\u65e5\u5831\u916c\u7684\u6a19\u6e96\u5dee\uff0c\u8861\u91cf\u56de\u5831\u7684\u4e0d\u7a69\u5b9a\u7a0b\u5ea6\u3002</p> <p>\u89e3\u8b80 : - \u6ce2\u52d5\u7387\u9ad8 = \u7b56\u7565\u8868\u73fe\u5ffd\u9ad8\u5ffd\u4f4e - \u6ce2\u52d5\u7387\u4f4e = \u7b56\u7565\u8868\u73fe\u7a69\u5b9a</p>"},{"location":"concepts/performance-metrics/#4","title":"4. \u7d9c\u5408\u8a55\u4f30\uff1a\u590f\u666e\u6bd4\u7387","text":""},{"location":"concepts/performance-metrics/#41","title":"4.1. \u5b9a\u7fa9","text":"<p>\u590f\u666e\u6bd4\u7387 (Sharpe Ratio) = (\u7b56\u7565\u5e74\u5316\u5831\u916c - \u7121\u98a8\u96aa\u5831\u916c\u7387) / \u6ce2\u52d5\u7387</p> <p>\u9019\u500b\u516c\u5f0f\u7d50\u5408\u4e86\u300c\u5831\u916c\u300d\u548c\u300c\u98a8\u96aa\u300d\uff0c\u7528\u4e00\u500b\u55ae\u4e00\u7684\u6578\u5b57\u8a55\u4f30\u7b56\u7565\u7684\u6548\u7387\u3002</p>"},{"location":"concepts/performance-metrics/#42","title":"4.2. \u89e3\u8b80","text":"\u590f\u666e\u6bd4\u7387 \u8a55\u50f9 \u8aaa\u660e &lt; 0 \u5f88\u5dee \u8667\u640d 0 - 0.5 \u4e0d\u4f73 \u5831\u916c\u4e0d\u8db3\u4ee5\u88dc\u511f\u98a8\u96aa 0.5 - 1.0 \u4e00\u822c \u9084\u4e0d\u932f 1.0 - 2.0 \u512a\u79c0 \u5831\u916c\u76f8\u5c0d\u65bc\u98a8\u96aa\u662f\u5408\u7406\u7684 &gt; 2.0 \u5091\u51fa \u975e\u5e38\u7a69\u5b9a\u4e14\u9ad8\u56de\u5831"},{"location":"concepts/performance-metrics/#43","title":"4.3. \u70ba\u4ec0\u9ebc\u4f7f\u7528\u590f\u666e\u6bd4\u7387\uff1f","text":"<ul> <li>\u53ef\u6bd4\u6027 : \u4e0d\u540c\u7b56\u7565\u7684\u590f\u666e\u6bd4\u7387\u53ef\u4ee5\u76f4\u63a5\u6bd4\u8f03</li> <li>\u98a8\u96aa\u8abf\u6574 : \u9ad8\u5831\u916c\u4f46\u9ad8\u98a8\u96aa\u7684\u7b56\u7565\u4e0d\u4e00\u5b9a\u6bd4\u4f4e\u5831\u916c\u4f4e\u98a8\u96aa\u7684\u7b56\u7565\u66f4\u597d</li> </ul>"},{"location":"concepts/performance-metrics/#5","title":"5. \u5176\u4ed6\u5e38\u898b\u6307\u6a19","text":""},{"location":"concepts/performance-metrics/#51-win-rate","title":"5.1. \u52dd\u7387 (Win Rate)","text":"<p>\u5b9a\u7fa9 : \u6b63\u5831\u916c\u65e5\u6578 / \u7e3d\u4ea4\u6613\u65e5\u6578</p> <p>\u89e3\u8b80 : - 50% \u52dd\u7387 = \u7b56\u7565\u4e00\u534a\u6642\u9593\u76c8\u5229\uff0c\u4e00\u534a\u6642\u9593\u8667\u640d - \u9ad8\u52dd\u7387\u4e0d\u4e00\u5b9a\u610f\u5473\u8457\u9ad8\u5229\u6f64\uff08\u53ef\u80fd\u5f88\u591a\u5c0f\u8d0f\u5229\u4f46\u5c11\u6578\u5927\u8667\u640d\uff09</p>"},{"location":"concepts/performance-metrics/#52-profit-factor","title":"5.2. \u5229\u6f64\u56e0\u5b50 (Profit Factor)","text":"<p>\u5b9a\u7fa9 : \u7e3d\u5229\u6f64 / \u7e3d\u8667\u640d</p> <p>\u89e3\u8b80 : - 2.0 \u7684\u5229\u6f64\u56e0\u5b50 = \u6bcf\u8667\u640d 1 \u5143\uff0c\u5c31\u8cfa 2 \u5143 - &gt; 1.5 \u7b97\u4e0d\u932f</p>"},{"location":"concepts/performance-metrics/#6","title":"6. \u5e38\u898b\u9677\u9631","text":""},{"location":"concepts/performance-metrics/#61-overfitting","title":"6.1. \u904e\u5ea6\u64ec\u5408 (Overfitting)","text":"<p>\u5728\u6b77\u53f2\u6578\u64da\u4e0a\u8868\u73fe\u5b8c\u7f8e\u7684\u7b56\u7565\uff0c\u5728\u771f\u5be6\u4ea4\u6613\u4e2d\u53ef\u80fd\u8868\u73fe\u4e0d\u4f73\u3002\u9019\u662f\u56e0\u70ba\u7b56\u7565\u88ab\u300c\u904e\u5ea6\u8abf\u6574\u300d\u5230\u6b77\u53f2\u6578\u64da\u7684\u7279\u6027\u3002</p>"},{"location":"concepts/performance-metrics/#62-survivorship-bias","title":"6.2. \u751f\u5b58\u504f\u5dee (Survivorship Bias)","text":"<p>\u53ea\u770b\u9084\u5728\u4ea4\u6613\u7684\u80a1\u7968\uff0c\u5ffd\u8996\u5df2\u7d93\u9000\u5e02\u7684\u516c\u53f8\uff0c\u6703\u9ad8\u4f30\u7b56\u7565\u7684\u8868\u73fe\u3002</p>"},{"location":"concepts/performance-metrics/#63-look-ahead-bias","title":"6.3. \u5e78\u5b58\u8005\u504f\u5dee (Look-ahead Bias)","text":"<p>\u5728\u56de\u6e2c\u4e2d\u4f7f\u7528\u4e86\u300c\u672a\u4f86\u7684\u4fe1\u606f\u300d\u3002\u4f8b\u5982\uff0c\u7528\u4eca\u65e5\u6536\u76e4\u50f9\u5224\u65b7\u6628\u65e5\u662f\u5426\u61c9\u8a72\u8cb7\u5165\uff0c\u9019\u5728\u771f\u5be6\u4ea4\u6613\u4e2d\u662f\u4e0d\u53ef\u80fd\u7684\u3002</p>"},{"location":"concepts/performance-metrics/#7","title":"7. \u4e0b\u4e00\u6b65","text":"<ul> <li>\u2192 \u5982\u4f55\u904b\u884c\u4e00\u500b\u5b8c\u6574\u7684\u56de\u6e2c\uff1f</li> <li>\u2192 \u81ea\u8a02\u7e3e\u6548\u5206\u6790\u5831\u8868</li> </ul> <p>\u6700\u5f8c\u66f4\u65b0 : 2025-11-07 \u7248\u672c : 1.0 \u5be9\u67e5\u72c0\u614b : \u8349\u7a3f</p>"},{"location":"concepts/pipeline-overview/","title":"Pipeline \u6295\u8cc7\u8a0a\u865f\u751f\u6210","text":"<p>Info</p> <p>\u672c\u9801\u6df1\u5165\u89e3\u91cb Zipline Pipeline \u7684\u904b\u4f5c\u539f\u7406\uff0c\u5305\u62ec\u5176\u6838\u5fc3\u7d44\u4ef6\uff08Factors, Filters, Classifiers\uff09\u3001\u8cc7\u6599\u96c6 (DataSets) \u7684\u6982\u5ff5\u3001\u4ee5\u53ca\u5982\u4f55\u900f\u904e Pipeline \u9ad8\u6548\u5730\u751f\u6210\u4ea4\u6613\u8a0a\u865f\uff0c\u70ba\u4f7f\u7528\u8005\u5efa\u7acb\u5c0d Pipeline \u7684\u5168\u9762\u7406\u89e3\u3002</p> <p>Zipline Pipeline \u662f\u4e00\u500b\u5f37\u5927\u4e14\u9ad8\u6548\u7684\u5de5\u5177\uff0c\u5c08\u70ba\u5728\u5927\u91cf\u7684\u8b49\u5238\u6642\u9593\u5e8f\u5217\u6578\u64da\u4e0a\u9032\u884c\u9ad8\u6548\u8a08\u7b97\u800c\u8a2d\u8a08\u3002\u5728\u91cf\u5316\u4ea4\u6613\u4e2d\uff0c\u6211\u5011\u7d93\u5e38\u9700\u8981\u5c0d\u6574\u500b\u5e02\u5834\u7684\u80a1\u7968\u8a08\u7b97\u5404\u7a2e\u6307\u6a19\uff08\u5982\u79fb\u52d5\u5e73\u5747\u3001\u6ce2\u52d5\u7387\uff09\uff0c\u4e26\u6839\u64da\u9019\u4e9b\u6307\u6a19\u7be9\u9078\u51fa\u7b26\u5408\u7279\u5b9a\u689d\u4ef6\u7684\u80a1\u7968\u6c60\u3002\u5982\u679c\u4f7f\u7528\u50b3\u7d71\u7684 for-loop \u9010\u4e00\u8655\u7406\u6bcf\u96bb\u80a1\u7968\uff0c\u7576\u80a1\u7968\u6578\u91cf\u9f90\u5927\u6216\u8a08\u7b97\u8907\u96dc\u6642\uff0c\u6548\u7387\u6703\u975e\u5e38\u4f4e\u4e0b\u3002</p> <p>\u5b83\u5c07\u6240\u6709\u8a08\u7b97 \u5411\u91cf\u5316 (Vectorized)\uff0c\u5229\u7528\u5e95\u5c64\u512a\u5316\u7684 <code>NumPy</code> \u548c <code>Pandas</code> \u904b\u7b97\uff0c \u4e00\u6b21\u6027 \u5730\u5c0d\u6240\u6709\u8cc7\u7522\u9032\u884c\u6a6b\u622a\u9762\u8a08\u7b97\uff0c\u5f9e\u4ece\u800c\u6975\u5927\u5730\u63d0\u5347\u4e86\u904b\u7b97\u6548\u7387\u3002</p>"},{"location":"concepts/pipeline-overview/#1-pipeline","title":"1. Pipeline \u7c21\u4ecb","text":"<p>\u60a8\u53ef\u4ee5\u5c07 Pipeline \u60f3\u50cf\u6210\u4e00\u689d\u8655\u7406\u8b49\u5238\u6578\u64da\u7684\u300c\u7ba1\u7dda\u300d\u3002\u6578\u64da\u5f9e\u4e00\u7aef\u6d41\u5165\uff0c\u7d93\u904e\u7ba1\u7dda\u4e2d\u4e00\u7cfb\u5217\u7684\u8655\u7406\u7ad9\uff08\u8a08\u7b97\u3001\u7be9\u9078\u3001\u5206\u985e\uff09\uff0c\u6700\u7d42\u5728\u53e6\u4e00\u7aef\u7522\u51fa\u4e00\u500b\u7d50\u69cb\u5316\u7684\u6578\u64da\u8868 (DataFrame)\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u60a8\u5728\u7576\u5929\u4ea4\u6613\u6240\u9700\u8981\u7684\u6240\u6709\u8cc7\u8a0a\u3002</p> <p>\u5728 Zipline \u7b56\u7565\u4e2d\uff0cPipeline \u7684\u4e3b\u8981\u8077\u8cac\u662f\u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u958b\u76e4\u524d\uff0c\u70ba <code>handle_data</code> \u51fd\u6578\u6e96\u5099\u597d\u7576\u65e5\u7814\u7a76\u6240\u9700\u7684\u6578\u64da\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u8a08\u7b97\u6bcf\u96bb\u80a1\u7968\u7684 20 \u65e5\u79fb\u52d5\u5e73\u5747\u50f9\u3002</li> <li>\u7be9\u9078\u51fa\u7576\u524d\u5e02\u503c\u6392\u540d\u524d 10% \u7684\u80a1\u7968\u3002</li> <li>\u6a19\u8a18\u51fa\u6bcf\u96bb\u80a1\u7968\u6240\u5c6c\u7684\u7522\u696d\u985e\u5225\u3002</li> </ul>"},{"location":"concepts/pipeline-overview/#2-pipeline","title":"2. Pipeline \u7684\u4e09\u5927\u6838\u5fc3\u7d44\u4ef6","text":"<p>Pipeline \u4e3b\u8981\u7531\u4e09\u7a2e\u985e\u578b\u7684\u7d44\u4ef6\u69cb\u6210\uff0c\u5b83\u5011\u53ef\u4ee5\u88ab\u9748\u6d3b\u5730\u7d44\u5408\uff0c\u4ee5\u69cb\u5efa\u8907\u96dc\u7684\u6578\u64da\u8655\u7406\u908f\u8f2f\u3002</p>"},{"location":"concepts/pipeline-overview/#factors","title":"Factors (\u56e0\u5b50)","text":"<ul> <li>\u4f5c\u7528\uff1a\u8a08\u7b97\u4e00\u500b\u6578\u503c\u3002\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u6642\u9593\u9ede\u90fd\u6703\u88ab\u8ce6\u4e88\u4e00\u500b\u7531 Factor \u8a08\u7b97\u51fa\u7684\u6d6e\u9ede\u6578\u6216\u6574\u6578\u3002</li> <li>\u7bc4\u4f8b\uff1a<ul> <li><code>SimpleMovingAverage(inputs=[TWEquityPricing.close], window_length=20)</code>\uff1a\u8a08\u7b97 20 \u65e5\u6536\u76e4\u50f9\u7684\u79fb\u52d5\u5e73\u5747\u3002</li> <li><code>Momentum(inputs=[TWEquityPricing.close], window_length=10)</code>\uff1a\u8a08\u7b97 10 \u65e5\u52d5\u91cf\u3002</li> <li><code>CustomFactor</code>\uff1a\u60a8\u53ef\u4ee5\u7e7c\u627f <code>CustomFactor</code> \u985e\u5225\u4f86\u5275\u5efa\u81ea\u5df1\u7684\u56e0\u5b50\uff0c\u5be6\u73fe\u4efb\u610f\u8907\u96dc\u7684\u8a08\u7b97\u908f\u8f2f\u3002</li> </ul> </li> </ul>"},{"location":"concepts/pipeline-overview/#filters","title":"Filters (\u6ffe\u7db2)","text":"<ul> <li>\u4f5c\u7528\uff1a\u7be9\u9078\u51fa\u4e00\u7d44\u7b26\u5408\u689d\u4ef6\u7684\u8cc7\u7522\u3002\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u6642\u9593\u9ede\u90fd\u6703\u88ab\u8ce6\u4e88\u4e00\u500b\u5e03\u6797\u503c (True/False)\u3002</li> <li>\u7bc4\u4f8b\uff1a<ul> <li><code>SimpleMovingAverage(...) &gt; 100</code>\uff1a\u7be9\u9078\u51fa 20 \u65e5\u5747\u7dda\u5927\u65bc 100 \u7684\u80a1\u7968\u3002</li> <li><code>MarketCap().top(100)</code>\uff1a\u7be9\u9078\u51fa\u5e02\u503c\u6392\u540d\u524d 100 \u7684\u80a1\u7968\u3002</li> <li><code>StaticAssets([...])</code>\uff1a\u7be9\u9078\u51fa\u4e00\u500b\u975c\u614b\u7684\u80a1\u7968\u5217\u8868\u3002</li> </ul> </li> </ul>"},{"location":"concepts/pipeline-overview/#classifiers","title":"Classifiers (\u5206\u985e\u5668)","text":"<ul> <li>\u4f5c\u7528\uff1a\u70ba\u8cc7\u7522\u9032\u884c\u5206\u985e\u3002\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u6642\u9593\u9ede\u90fd\u6703\u88ab\u8ce6\u4e88\u4e00\u500b\u6a19\u7c64\uff08\u901a\u5e38\u662f\u5b57\u4e32\u6216\u6574\u6578\uff09\uff0c\u7528\u65bc\u5206\u7d44\u3002</li> <li>\u7bc4\u4f8b\uff1a<ul> <li><code>Sector()</code>\uff1a\u8fd4\u56de\u6bcf\u96bb\u80a1\u7968\u6240\u5c6c\u7684\u7522\u696d\u985e\u5225\u3002 <p>\u8a73\u898b\uff1a\u5167\u5efa\u56e0\u5b50/\u6ffe\u7db2/\u5206\u985e\u5668</p> </li> </ul> </li> </ul>"},{"location":"concepts/pipeline-overview/#3-datasets","title":"3. \u8cc7\u6599\u96c6 (DataSets)","text":"<p>Pipeline \u9700\u8981\u5f9e\u4e00\u500b\u5b9a\u7fa9\u597d\u7684\u8cc7\u6599\u96c6\u4e2d\u7372\u53d6\u539f\u59cb\u6578\u64da\u3002TQuant Lab \u63d0\u4f9b\u4e86\u591a\u7a2e\u5167\u5efa\u7684\u8cc7\u6599\u96c6\uff1a</p> <ul> <li><code>TWEquityPricing</code>\uff1a\u63d0\u4f9b\u53f0\u7063\u5e02\u5834\u7684\u80a1\u7968\u50f9\u91cf\u8cc7\u6599\uff0c\u5305\u62ec\u958b\u3001\u9ad8\u3001\u4f4e\u3001\u6536\u3001\u91cf (<code>open</code>, <code>high</code>, <code>low</code>, <code>close</code>, <code>volume</code>)\u3002</li> <li><code>TQDataSet</code> / <code>TQAltDataSet</code>\uff1a\u63d0\u4f9b\u7531 TEJ \u6574\u7406\u7684\u8ca1\u52d9\u3001\u975e\u8ca1\u52d9\u6578\u64da\uff0c\u4f8b\u5982 <code>Market_Cap_Dollars</code> (\u5e02\u503c)\u3001<code>PER</code> (\u672c\u76ca\u6bd4) \u7b49\u3002</li> </ul> <p>\u8a73\u898b\uff1a\u8cc7\u6599\u96c6 (\u6982\u8ad6)</p>"},{"location":"concepts/pipeline-overview/#4-pipeline","title":"4. Pipeline \u7684\u904b\u4f5c\u6d41\u7a0b","text":"<p>\u5728\u4e00\u500b\u5178\u578b\u7684 Zipline \u7b56\u7565\u4e2d\uff0cPipeline \u7684\u904b\u4f5c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <pre><code>graph TD\n    subgraph \"\u6bcf\u65e5\u76e4\u524d (before_trading_start)\"\n        A[1. \u5b9a\u7fa9 make_pipeline \u51fd\u6578] --&gt; B[2. \u8a3b\u518a Pipeline];\n        B --&gt; C[3. Zipline \u5f15\u64ce\u57f7\u884c Pipeline];\n        C --&gt; D[4. \u7522\u751f\u7576\u65e5\u8a0a\u865f DataFrame];\n    end\n\n    subgraph \"\u6bcf\u65e5\u76e4\u4e2d (handle_data)\"\n        D --&gt; E[5. \u7372\u53d6 Pipeline \u8f38\u51fa];\n        E --&gt; F[6. \u57f7\u884c\u4ea4\u6613\u908f\u8f2f];\n    end\n\n    A -- \u5305\u542b Factors, Filters, Classifiers --&gt; B;\n    B -- `attach_pipeline(make_pipeline(), 'my_pipe')` --&gt; C;\n    E -- `pipeline_output('my_pipe')` --&gt; F;</code></pre> <ol> <li> <p>\u5b9a\u7fa9 <code>make_pipeline()</code> \u51fd\u6578\uff1a     \u60a8\u9700\u8981\u5275\u5efa\u4e00\u500b\u540d\u70ba <code>make_pipeline()</code> \u7684\u51fd\u6578\uff0c\u4e26\u5728\u5176\u4e2d\u5b9a\u7fa9 Pipeline \u7684\u7d50\u69cb\uff0c\u5305\u62ec\u8981\u8a08\u7b97\u7684 Factors\u3001\u7be9\u9078\u7684 Filters \u7b49\u3002</p> <pre><code>from zipline.pipeline import Pipeline\nfrom zipline.pipeline.factors import SimpleMovingAverage\nfrom zipline.pipeline.data import TWEquityPricing\n\ndef make_pipeline():\n    mean_close_20 = SimpleMovingAverage(inputs=[TWEquityPricing.close], window_length=20)\n\n    return Pipeline(\n        columns={\n            'mean_close_20': mean_close_20\n        },\n        screen = (mean_close_20 &gt; 10) # \u50c5\u8a08\u7b97\u5747\u7dda\u5927\u65bc 10 \u7684\u80a1\u7968\n    )\n</code></pre> </li> <li> <p>\u5728 <code>initialize</code> \u4e2d\u8a3b\u518a Pipeline\uff1a     \u4f7f\u7528 <code>attach_pipeline()</code> \u51fd\u6578\u5c07\u60a8\u5b9a\u7fa9\u7684 <code>make_pipeline</code> \u8a3b\u518a\u5230 Zipline \u5f15\u64ce\u4e2d\uff0c\u4e26\u70ba\u5176\u547d\u540d\uff08\u4f8b\u5982 <code>'my_pipe'</code>\uff09\u3002</p> <pre><code>def initialize(context):\n    attach_pipeline(make_pipeline(), 'my_pipe')\n</code></pre> </li> <li> <p>\u5728 <code>handle_data</code> \u4e2d\u7372\u53d6\u7d50\u679c\uff1a     \u5728 <code>handle_data</code> \u51fd\u6578\u4e2d\uff0c\u4f7f\u7528 <code>pipeline_output()</code> \u4e26\u50b3\u5165\u60a8\u4e4b\u524d\u8a2d\u5b9a\u7684\u540d\u7a31\uff0c\u5373\u53ef\u7372\u53d6\u4e00\u500b Pandas DataFrame\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u7576\u5929 Pipeline \u8a08\u7b97\u548c\u7be9\u9078\u5f8c\u7684\u7d50\u679c\u3002</p> <pre><code>def handle_data(context, data):\n    pipe_results = pipeline_output('my_pipe')\n\n    # pipe_results \u662f\u4e00\u500b DataFrame\uff0c\u5305\u542b\u4e86\u6240\u6709\u901a\u904e screen \u7be9\u9078\u7684\u80a1\u7968\n    # \u4ee5\u53ca\u60a8\u5728 columns \u4e2d\u5b9a\u7fa9\u7684 'mean_close_20' \u6b04\u4f4d\n    for asset in pipe_results.index:\n        mean_price = pipe_results.loc[asset, 'mean_close_20']\n        # ... \u57f7\u884c\u60a8\u7684\u4ea4\u6613\u908f\u8f2f ...\n</code></pre> </li> </ol>"},{"location":"concepts/pipeline-overview/#5-customfactor","title":"5. \u81ea\u8a02\u56e0\u5b50 (CustomFactor)","text":"<p>\u7576\u5167\u5efa\u7684\u56e0\u5b50\u7121\u6cd5\u6eff\u8db3\u60a8\u7684\u9700\u6c42\u6642\uff0c\u53ef\u4ee5\u900f\u904e\u7e7c\u627f <code>CustomFactor</code> \u985e\u5225\u4f86\u5275\u5efa\u81ea\u5df1\u7684\u56e0\u5b50\u3002\u60a8\u53ea\u9700\u8981\u5b9a\u7fa9 <code>inputs</code>\uff08\u9700\u8981\u54ea\u4e9b\u539f\u59cb\u6578\u64da\uff09\u548c <code>window_length</code>\uff08\u9700\u8981\u591a\u9577\u7684\u6642\u9593\u7a97\u53e3\uff09\uff0c\u4e26\u5be6\u73fe <code>compute</code> \u65b9\u6cd5\u4f86\u63cf\u8ff0\u60a8\u7684\u8a08\u7b97\u908f\u8f2f\u3002</p> <pre><code>from zipline.pipeline import CustomFactor\nimport numpy as np\n\nclass MyMomentum(CustomFactor):\n    inputs = [TWEquityPricing.close]\n    window_length = 10\n\n    def compute(self, today, assets, out, close_prices):\n        # close_prices \u662f\u4e00\u500b 10xN \u7684 NumPy array\n        # (window_length x number of assets)\n\n        # \u8a08\u7b97 10 \u65e5\u52d5\u91cf\uff1a(\u4eca\u65e5\u50f9\u683c / 10\u5929\u524d\u50f9\u683c) - 1\n        out[:] = (close_prices[-1] / close_prices[0]) - 1\n</code></pre> <p>\u8a73\u898b\uff1a\u81ea\u8a02\u56e0\u5b50</p>"},{"location":"concepts/pipeline-overview/#6-pipeline","title":"6. Pipeline \u5728\u7b56\u7565\u4e2d\u7684\u4f7f\u7528","text":"<p>Pipeline \u7684\u8a2d\u8a08\u65e8\u5728\u8207 Zipline \u7684\u4e8b\u4ef6\u9a45\u52d5\u56de\u6e2c\u6846\u67b6\u7121\u7e2b\u5354\u4f5c\uff0c\u70ba\u7b56\u7565\u63d0\u4f9b\u6bcf\u65e5\u66f4\u65b0\u7684\u4ea4\u6613\u8a0a\u865f\u3002</p>"},{"location":"concepts/pipeline-overview/#handle_data-pipeline","title":"\u5728 handle_data \u4e2d\u7372\u53d6 Pipeline \u7d50\u679c","text":"<p>\u5982\u524d\u6240\u8ff0\uff0c\u5728 <code>handle_data(context, data)</code> \u51fd\u6578\u4e2d\uff0c\u60a8\u53ef\u4ee5\u900f\u904e <code>pipeline_output('\u60a8\u7684 Pipeline \u540d\u7a31')</code> \u4f86\u7372\u53d6 Pipeline \u5728\u7576\u65e5\u8a08\u7b97\u51fa\u7684\u7d50\u679c\u3002\u9019\u500b\u7d50\u679c\u662f\u4e00\u500b Pandas DataFrame\uff0c\u5176\u7d22\u5f15\u70ba\u8cc7\u7522 (Asset)\uff0c\u6b04\u4f4d\u70ba\u60a8\u5728 Pipeline \u4e2d\u5b9a\u7fa9\u7684 Factors\u3001Filters \u6216 Classifiers \u7684\u8f38\u51fa\u3002</p> <pre><code>def handle_data(context, data):\n    # \u7372\u53d6 Pipeline \u5728\u7576\u65e5\u8a08\u7b97\u51fa\u7684\u7d50\u679c\n    current_signals = pipeline_output('my_pipeline_name')\n\n    if current_signals is not None and not current_signals.empty:\n        for asset_id, row in current_signals.iterrows():\n            # \u6839\u64da Pipeline \u7522\u751f\u7684\u8a0a\u865f\u57f7\u884c\u4ea4\u6613\u908f\u8f2f\n            # \u4f8b\u5982\uff1a\u5982\u679c\u67d0\u500b\u56e0\u5b50\u503c\u9054\u5230\u95be\u503c\uff0c\u5247\u4e0b\u55ae\n            pass\n</code></pre>"},{"location":"concepts/pipeline-overview/#_1","title":"\u57f7\u884c\u6642\u6a5f\u8207\u6027\u80fd\u8003\u91cf","text":"<p>Pipeline \u7684\u8a08\u7b97\u901a\u5e38\u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u7684 <code>before_trading_start()</code> \u51fd\u6578\u4e2d\u57f7\u884c\uff0c\u9019\u78ba\u4fdd\u4e86\u5728 <code>handle_data()</code> \u57f7\u884c\u6642\uff0c\u6240\u6709\u57fa\u65bc Pipeline \u7684\u8a0a\u865f\u90fd\u5df2\u6e96\u5099\u5c31\u7dd2\u3002\u9019\u7a2e\u8a2d\u8a08\u5c07\u8017\u6642\u7684\u6578\u64da\u8655\u7406\u8207\u4ea4\u6613\u6c7a\u7b56\u5206\u96e2\uff0c\u6709\u52a9\u65bc\u63d0\u5347\u56de\u6e2c\u6548\u7387\u3002</p> <ul> <li>\u7f3a\u5931\u8cc7\u6599\u8655\u7406\uff1a     Pipeline \u5728\u8655\u7406\u6578\u64da\u6642\u6703\u81ea\u52d5\u8655\u7406\u7f3a\u5931\u503c (NaN)\u3002\u60a8\u53ef\u4ee5\u900f\u904e\u5728 Pipeline \u4e2d\u4f7f\u7528 <code>Factor().fillna()</code> \u6216\u5728 <code>handle_data</code> \u4e2d\u6aa2\u67e5 <code>current_signals</code> \u662f\u5426\u70ba\u7a7a\u6216\u5305\u542b NaN \u503c\u4f86\u9032\u4e00\u6b65\u7ba1\u7406\u9019\u4e9b\u60c5\u6cc1\u3002</li> </ul>"},{"location":"concepts/pipeline-overview/#7","title":"7. \u5e38\u898b\u9677\u9631\u8207\u6700\u4f73\u5be6\u8e10","text":"<p>\u70ba\u4e86\u5145\u5206\u5229\u7528 Pipeline \u7684\u5f37\u5927\u529f\u80fd\u4e26\u907f\u514d\u5e38\u898b\u554f\u984c\uff0c\u8acb\u8003\u616e\u4ee5\u4e0b\u5e7e\u9ede\uff1a</p> <ul> <li> <p>\u907f\u514d\u5728 <code>handle_data</code> \u4e2d\u91cd\u8907\u8a08\u7b97\u56e0\u5b50\uff1a     Pipeline \u7684\u4e3b\u8981\u76ee\u7684\u5c31\u662f\u5c07\u56e0\u5b50\u8a08\u7b97\u5f9e <code>handle_data</code> \u4e2d\u5206\u96e2\u51fa\u4f86\u4e26\u9032\u884c\u512a\u5316\u3002\u5728 <code>handle_data</code> \u4e2d\u76f4\u63a5\u9032\u884c\u8907\u96dc\u7684\u6b77\u53f2\u6578\u64da\u8a08\u7b97\u6703\u5c0e\u81f4\u56b4\u91cd\u7684\u6027\u80fd\u554f\u984c\u548c\u6f5b\u5728\u7684\u5411\u524d\u770b\u504f\u8aa4\u3002</p> </li> <li> <p>\u7406\u89e3 <code>window_length</code> \u7684\u542b\u7fa9\uff1a     <code>window_length</code> \u53c3\u6578\u5b9a\u7fa9\u4e86\u56e0\u5b50\u8a08\u7b97\u6240\u9700\u7684\u6b77\u53f2\u6578\u64da\u7a97\u53e3\u3002\u8acb\u78ba\u4fdd\u60a8\u7406\u89e3\u5176\u8a08\u7b97\u65b9\u5f0f\uff08\u901a\u5e38\u662f\u5305\u542b\u7576\u524d\u65e5\u4e4b\u524d\u7684 N \u500b\u4ea4\u6613\u65e5\uff09\uff0c\u4ee5\u907f\u514d\u5f15\u5165\u5411\u524d\u770b\u504f\u8aa4\u3002</p> </li> <li> <p>\u5584\u7528 <code>mask</code> \u53c3\u6578\u9032\u884c\u7be9\u9078\uff1a     \u5728 Pipeline \u4e2d\u4f7f\u7528 <code>mask</code> \u53c3\u6578\u53ef\u4ee5\u6709\u6548\u5730\u9650\u5236\u8a08\u7b97\u7bc4\u570d\uff0c\u53ea\u5c0d\u60a8\u611f\u8208\u8da3\u7684\u8cc7\u7522\u9032\u884c\u56e0\u5b50\u8a08\u7b97\uff0c\u9032\u4e00\u6b65\u63d0\u5347\u6548\u7387\u3002</p> </li> <li> <p>\u9010\u6b65\u69cb\u5efa\u8907\u96dc Pipeline\uff1a     \u5c0d\u65bc\u8907\u96dc\u7684\u7b56\u7565\uff0c\u5efa\u8b70\u5f9e\u7c21\u55ae\u7684 Pipeline \u958b\u59cb\uff0c\u9010\u6b65\u6dfb\u52a0 Factors\u3001Filters \u548c Classifiers\uff0c\u4e26\u5728\u6bcf\u500b\u968e\u6bb5\u9a57\u8b49\u8f38\u51fa\uff0c\u4ee5\u78ba\u4fdd\u908f\u8f2f\u6b63\u78ba\u3002</p> </li> </ul>"},{"location":"concepts/pipeline-overview/#_2","title":"\u7e3d\u7d50","text":"<p>Zipline Pipeline \u662f TQuant Lab \u4e2d\u7528\u65bc\u9ad8\u6548\u751f\u6210\u6295\u8cc7\u8a0a\u865f\u7684\u57fa\u77f3\u3002\u900f\u904e\u7406\u89e3\u5176\u6838\u5fc3\u7d44\u4ef6\u3001\u8cc7\u6599\u96c6\u548c\u904b\u4f5c\u6d41\u7a0b\uff0c\u4e26\u9075\u5faa\u6700\u4f73\u5be6\u8e10\uff0c\u60a8\u53ef\u4ee5\u69cb\u5efa\u51fa\u5f37\u5927\u3001\u9ad8\u6548\u4e14\u53ef\u64f4\u5c55\u7684\u91cf\u5316\u4ea4\u6613\u7b56\u7565\u3002\u719f\u7df4\u638c\u63e1 Pipeline \u7684\u4f7f\u7528\uff0c\u5c07\u6975\u5927\u5730\u63d0\u5347\u60a8\u7684\u7b56\u7565\u7814\u7a76\u80fd\u529b\u3002</p> <p>\u8a73\u898b\uff1a\u5167\u5efa\u56e0\u5b50/\u6ffe\u7db2/\u5206\u985e\u5668</p>"},{"location":"concepts/pyfolio-overview/","title":"Pyfolio \u7e3e\u6548\u5206\u6790\u6982\u8ad6","text":"<p>Info</p> <p>\u672c\u9801\u4ecb\u7d39 TQuant Lab \u4e2d\u6574\u5408\u7684\u5f37\u5927\u7e3e\u6548\u5206\u6790\u5de5\u5177 Pyfolio\uff0c\u5167\u5bb9\u6db5\u84cb\u5176\u6838\u5fc3\u529f\u80fd\u3001\u5982\u4f55\u5f9e Zipline \u56de\u6e2c\u7d50\u679c\u751f\u6210\u8996\u89ba\u5316\u7684\u7e3e\u6548\u5831\u544a (Tear Sheet)\uff0c\u4ee5\u53ca\u5982\u4f55\u89e3\u8b80\u5831\u544a\u4e2d\u7684\u95dc\u9375\u6307\u6a19\u8207\u5716\u8868\uff0c\u5e6b\u52a9\u60a8\u6df1\u5165\u8a55\u4f30\u7b56\u7565\u7684\u8868\u73fe\u3002</p> <p>\u5728\u91cf\u5316\u7814\u7a76\u6d41\u7a0b\u4e2d\uff0c\u50c5\u6709\u56de\u6e2c\u7d50\u679c\u7684\u539f\u59cb\u6578\u64da\u662f\u4e0d\u5920\u7684\u3002\u4e00\u500b\u5c08\u696d\u7684\u91cf\u5316\u7814\u7a76\u8005\u9700\u8981\u4e00\u5957\u6a19\u6e96\u5316\u3001\u7cfb\u7d71\u5316\u7684\u5de5\u5177\u4f86\u8a55\u4f30\u7b56\u7565\u7684\u98a8\u96aa\u8207\u5831\u916c\u3002Pyfolio \u6b63\u662f\u70ba\u6b64\u800c\u751f\u7684 Python \u5957\u4ef6\uff0c\u5b83\u80fd\u5c07 Zipline \u7684\u56de\u6e2c\u7d50\u679c\u8f49\u63db\u70ba\u4e00\u4efd\u5305\u542b\u6578\u5341\u7a2e\u95dc\u9375\u6307\u6a19\u548c\u8996\u89ba\u5316\u5716\u8868\u7684\u5c08\u696d\u5831\u544a\uff0c\u7a31\u70ba\u300cTear Sheet\u300d\u3002</p>"},{"location":"concepts/pyfolio-overview/#1-pyfolio","title":"1. Pyfolio \u7684\u6838\u5fc3\u4f5c\u7528","text":"<p>Pyfolio \u662f TQuant Lab \u5206\u6790\u6d41\u7a0b\u4e2d\u7684\u95dc\u9375\u4e00\u74b0\uff0c\u5b83\u626e\u6f14\u8457\u300c\u7b56\u7565\u5065\u6aa2\u5831\u544a\u300d\u7684\u89d2\u8272\uff0c\u4e3b\u8981\u63d0\u4f9b\u4ee5\u4e0b\u529f\u80fd\uff1a</p> <ul> <li>\u6a19\u6e96\u5316\u7e3e\u6548\u6307\u6a19\uff1a\u81ea\u52d5\u8a08\u7b97\u590f\u666e\u6bd4\u7387 (Sharpe Ratio)\u3001\u6700\u5927\u56de\u64a4 (Max Drawdown)\u3001Alpha\u3001Beta \u7b49\u696d\u754c\u901a\u7528\u7684\u98a8\u96aa\u8207\u5831\u916c\u6307\u6a19\u3002</li> <li>\u8996\u89ba\u5316\u5206\u6790\uff1a\u63d0\u4f9b\u8c50\u5bcc\u7684\u5716\u8868\uff0c\u5982\u7d2f\u7a4d\u5831\u916c\u5716\u3001\u6c34\u4e0b\u5716\u3001\u6708\u5ea6\u5831\u916c\u5206\u4f48\u7b49\uff0c\u8b93\u60a8\u80fd\u76f4\u89c0\u5730\u8a55\u4f30\u7b56\u7565\u7684\u8868\u73fe\u7279\u5fb5\u3002</li> <li>\u8207 Zipline \u7121\u7e2b\u6574\u5408\uff1a\u63d0\u4f9b\u5de5\u5177\u51fd\u5f0f\uff0c\u53ef\u4ee5\u8f15\u9b06\u5730\u5c07 Zipline \u7684\u56de\u6e2c\u8f38\u51fa\u8f49\u63db\u70ba Pyfolio \u6240\u9700\u7684\u683c\u5f0f\u3002</li> </ul>"},{"location":"concepts/pyfolio-overview/#2-zipline-pyfolio","title":"2. \u5f9e Zipline \u5230 Pyfolio\uff1a\u6a19\u6e96\u5de5\u4f5c\u6d41\u7a0b","text":"<p>\u5728 TQuant Lab \u4e2d\uff0c\u4f7f\u7528 Pyfolio \u5206\u6790 Zipline \u56de\u6e2c\u7d50\u679c\u7684\u6d41\u7a0b\u975e\u5e38\u56fa\u5b9a\uff0c\u4e3b\u8981\u5206\u70ba\u4ee5\u4e0b\u4e09\u500b\u6b65\u9a5f\uff1a</p>"},{"location":"concepts/pyfolio-overview/#1-zipline","title":"\u6b65\u9a5f 1\uff1a\u57f7\u884c Zipline \u56de\u6e2c","text":"<p>\u9996\u5148\uff0c\u60a8\u9700\u8981\u50cf\u5f80\u5e38\u4e00\u6a23\u57f7\u884c\u60a8\u7684 Zipline \u7b56\u7565\uff0c\u4e26\u5c07\u7d50\u679c\u5132\u5b58\u5728\u4e00\u500b\u8b8a\u6578\u4e2d (\u901a\u5e38\u547d\u540d\u70ba <code>results</code>)\u3002</p> <pre><code>from zipline import run_algorithm\n\n# ... (\u60a8\u7684 initialize \u548c handle_data \u51fd\u6578\u5b9a\u7fa9) ...\n\nresults = run_algorithm(\n    # ... \u60a8\u7684 run_algorithm \u53c3\u6578 ...\n)\n</code></pre>"},{"location":"concepts/pyfolio-overview/#2-pyfolio","title":"\u6b65\u9a5f 2\uff1a\u63d0\u53d6 Pyfolio \u6240\u9700\u7684\u6578\u64da","text":"<p>Zipline \u7684 <code>results</code> DataFrame \u683c\u5f0f\u7121\u6cd5\u76f4\u63a5\u88ab Pyfolio \u4f7f\u7528\u3002\u60a8\u9700\u8981\u4f7f\u7528 <code>pyfolio.utils.extract_rets_pos_txn_from_zipline()</code> \u9019\u500b\u8f14\u52a9\u51fd\u5f0f\uff0c\u5c07 <code>results</code> \u8f49\u63db\u70ba Pyfolio \u6240\u9700\u7684\u4e09\u4e2a\u6838\u5fc3\u7269\u4ef6\uff1a</p> <ul> <li><code>returns</code> (pandas.Series)\uff1a\u6bcf\u65e5\u7684\u7b56\u7565\u5831\u916c\u7387\u3002</li> <li><code>positions</code> (pandas.DataFrame)\uff1a\u6bcf\u65e5\u7684\u6301\u5009\u72c0\u614b\u3002</li> <li><code>transactions</code> (pandas.DataFrame)\uff1a\u6240\u6709\u7684\u4ea4\u6613\u7d00\u9304\u3002</li> </ul> <pre><code>import pyfolio as pf\n\n# \u5f9e Zipline results \u4e2d\u63d0\u53d6 Pyfolio \u6240\u9700\u7684\u6578\u64da\nreturns, positions, transactions = pf.utils.extract_rets_pos_txn_from_zipline(results)\n</code></pre>"},{"location":"concepts/pyfolio-overview/#3","title":"\u6b65\u9a5f 3\uff1a\u751f\u6210\u7e3e\u6548\u5831\u544a","text":"<p>\u5b8c\u6210\u6578\u64da\u63d0\u53d6\u5f8c\uff0c\u60a8\u53ef\u4ee5\u6839\u64da\u9700\u6c42\u9078\u64c7\u751f\u6210\u5b8c\u6574\u7684\u8996\u89ba\u5316\u5831\u544a\uff0c\u6216\u50c5\u5feb\u901f\u67e5\u770b\u7d71\u8a08\u6578\u64da\u3002</p>"},{"location":"concepts/pyfolio-overview/#a-tear-sheet","title":"\u9078\u9805 A\uff1a\u751f\u6210\u5b8c\u6574 Tear Sheet (\u5efa\u8b70)","text":"<p>\u8abf\u7528 <code>pyfolio.tears.create_full_tear_sheet()</code> \u51fd\u6578\uff0c\u53ef\u4ee5\u751f\u6210\u4e00\u4efd\u5305\u542b\u6240\u6709\u5716\u8868\u548c\u7d71\u8a08\u6578\u64da\u7684\u5b8c\u6574\u5831\u544a\u3002</p> <pre><code># \u7372\u53d6\u56de\u6e2c\u671f\u9593\u7684\u57fa\u6e96\u6307\u6578\u5831\u916c\nbenchmark_rets = results.benchmark_return\n\n# \u7522\u751f\u5b8c\u6574\u7684\u7e3e\u6548\u5206\u6790\u5831\u544a\npf.create_full_tear_sheet(\n    returns,\n    positions=positions,\n    transactions=transactions,\n    benchmark_rets=benchmark_rets, # \u50b3\u5165\u57fa\u6e96\u6307\u6578\u5831\u916c\u4ee5\u9032\u884c\u6bd4\u8f03\n    round_trips=False # \u5efa\u8b70\u8a2d\u70ba False \u4ee5\u52a0\u901f\u904b\u7b97\n)\n</code></pre>"},{"location":"concepts/pyfolio-overview/#b","title":"\u9078\u9805 B\uff1a\u50c5\u986f\u793a\u95dc\u9375\u7e3e\u6548\u7d71\u8a08","text":"<p>\u5982\u679c\u60a8\u53ea\u60f3\u5feb\u901f\u9810\u89bd\u6838\u5fc3\u7684\u7e3e\u6548\u6307\u6a19\uff0c\u800c\u4e0d\u9700\u8981\u751f\u6210\u6240\u6709\u5716\u8868\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>pyfolio.plotting.show_perf_stats()</code>\u3002\u9019\u500b\u65b9\u6cd5\u66f4\u8f15\u91cf\uff0c\u57f7\u884c\u901f\u5ea6\u66f4\u5feb\u3002</p> <pre><code># \u50c5\u986f\u793a\u95dc\u9375\u7e3e\u6548\u6307\u6a19\u8868\u683c\npf.show_perf_stats(returns, positions=positions, transactions=transactions)\n</code></pre>"},{"location":"concepts/pyfolio-overview/#3-tear-sheet","title":"3. \u89e3\u8b80 Tear Sheet \u95dc\u9375\u6307\u6a19","text":"<p>\u7121\u8ad6\u662f\u4f7f\u7528 <code>create_full_tear_sheet</code> \u9084\u662f <code>show_perf_stats</code>\uff0c\u60a8\u90fd\u6703\u770b\u5230\u4e00\u500b\u5305\u542b\u591a\u9805\u95dc\u9375\u7e3e\u6548\u6307\u6a19 (KPIs) \u7684\u8868\u683c\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u6700\u91cd\u8981\u7684\u6307\u6a19\uff1a</p> \u6307\u6a19 (Metric) \u8aaa\u660e Annual return \u5e74\u5316\u5831\u916c\u7387\uff1a\u7b56\u7565\u5728\u4e00\u5e74\u671f\u9593\u7684\u5e73\u5747\u5831\u916c\u7387\u3002 Cumulative returns \u7d2f\u7a4d\u5831\u916c\u7387\uff1a\u7b56\u7565\u5728\u6574\u500b\u56de\u6e2c\u671f\u9593\u7684\u7e3d\u5831\u916c\u7387\u3002 Annual volatility \u5e74\u5316\u6ce2\u52d5\u7387\uff1a\u7b56\u7565\u5831\u916c\u7387\u7684\u5e74\u5316\u6a19\u6e96\u5dee\uff0c\u8861\u91cf\u98a8\u96aa\u7684\u5e38\u7528\u6307\u6a19\u3002 Sharpe ratio \u590f\u666e\u6bd4\u7387\uff1a\u8861\u91cf\u6bcf\u55ae\u4f4d\u98a8\u96aa\u6240\u80fd\u63db\u53d6\u7684\u8d85\u984d\u5831\u916c\u3002\u6578\u503c\u8d8a\u9ad8\uff0c\u4ee3\u8868\u7b56\u7565\u7684\u98a8\u96aa\u8abf\u6574\u5f8c\u5831\u916c\u8d8a\u597d\u3002 Calmar ratio \u5361\u746a\u6bd4\u7387\uff1a\u5e74\u5316\u5831\u916c\u7387\u8207\u6700\u5927\u56de\u64a4\u7684\u6bd4\u503c\uff0c\u8861\u91cf\u7b56\u7565\u627f\u53d7\u6700\u5927\u98a8\u96aa\u6642\u7684\u56de\u5831\u80fd\u529b\u3002 Max drawdown \u6700\u5927\u56de\u64a4\uff1a\u7b56\u7565\u5728\u56de\u6e2c\u671f\u9593\u5167\uff0c\u6de8\u503c\u5f9e\u6700\u9ad8\u9ede\u56de\u843d\u5230\u6700\u4f4e\u9ede\u7684\u6700\u5927\u5e45\u5ea6\u3002\u9019\u662f\u8861\u91cf\u7b56\u7565\u98a8\u96aa\u7684\u91cd\u8981\u6307\u6a19\u3002 Alpha Alpha (\u03b1)\uff1a\u76f8\u5c0d\u65bc\u57fa\u6e96\u6307\u6578\u7684\u8d85\u984d\u5831\u916c\u3002\u6b63\u7684 Alpha \u4ee3\u8868\u7b56\u7565\u8868\u73fe\u512a\u65bc\u5e02\u5834\u3002 Beta Beta (\u03b2)\uff1a\u7b56\u7565\u76f8\u5c0d\u65bc\u57fa\u6e96\u6307\u6578\u7684\u7cfb\u7d71\u6027\u98a8\u96aa\u3002Beta \u70ba 1 \u8868\u793a\u7b56\u7565\u8207\u5e02\u5834\u540c\u6b65\u6ce2\u52d5\u3002"},{"location":"concepts/pyfolio-overview/#4-tear-sheet","title":"4. \u89e3\u8b80 Tear Sheet \u95dc\u9375\u5716\u8868","text":"<p><code>create_full_tear_sheet</code> \u7522\u751f\u7684\u8996\u89ba\u5316\u5716\u8868\u63d0\u4f9b\u4e86\u66f4\u76f4\u89c0\u7684\u6d1e\u5bdf\u3002</p> <ul> <li> <p>\u7d2f\u7a4d\u5831\u916c\u5716 (Cumulative returns)     \u9019\u662f\u6700\u91cd\u8981\u7684\u5716\u8868\u4e4b\u4e00\uff0c\u5b83\u5c07\u7b56\u7565\u7684\u7d2f\u7a4d\u5831\u916c\u8207\u57fa\u6e96\u6307\u6578\u7684\u7d2f\u7a4d\u5831\u916c\u7e6a\u88fd\u5728\u4e00\u8d77\uff0c\u8b93\u60a8\u80fd\u4e00\u76ee\u4e86\u7136\u5730\u770b\u51fa\u7b56\u7565\u5728\u4e0d\u540c\u6642\u9593\u6bb5\u7684\u8868\u73fe\u662f\u512a\u65bc\u9084\u662f\u52a3\u65bc\u5e02\u5834\u3002</p> </li> <li> <p>\u6c34\u4e0b\u5716 (Underwater plot / Drawdown plot)     \u6b64\u5716\u986f\u793a\u4e86\u7b56\u7565\u6de8\u503c\u5f9e\u6b77\u53f2\u9ad8\u9ede\u56de\u64a4\u7684\u767e\u5206\u6bd4\u3002\u5716\u4e2d\u66f2\u7dda\u5728 0 \u8ef8\u4ee5\u4e0b\u7684\u5340\u57df\u4ee3\u8868\u7b56\u7565\u8655\u65bc\u8667\u640d\u72c0\u614b\u3002\u6b64\u5716\u80fd\u5e6b\u52a9\u60a8\u76f4\u89c0\u5730\u611f\u53d7\u7b56\u7565\u53ef\u80fd\u9762\u81e8\u7684\u6700\u5927\u8667\u640d\u5e45\u5ea6\u548c\u6301\u7e8c\u6642\u9593\u3002</p> </li> <li> <p>\u6efe\u52d5 Beta / Alpha (Rolling Beta / Alpha)     \u9019\u4e9b\u5716\u8868\u986f\u793a\u4e86\u7b56\u7565\u7684 Alpha \u548c Beta \u5728\u4e0d\u540c\u6642\u9593\u7a97\u53e3\uff08\u4f8b\u5982 6 \u500b\u6708\uff09\u5167\u7684\u8b8a\u5316\u60c5\u6cc1\uff0c\u6709\u52a9\u65bc\u5224\u65b7\u7b56\u7565\u7684\u98a8\u683c\u662f\u5426\u7a69\u5b9a\u3002</p> </li> <li> <p>\u6708\u5ea6\u5831\u916c\u7387\u5206\u4f48\u5716 (Monthly returns distribution)     \u6b64\u5716\u901a\u5e38\u4ee5 \u71b1\u529b\u5716 (Heatmap) \u7684\u5f62\u5f0f\u5448\u73fe\uff0c\u5c07\u6bcf\u500b\u6708\u4efd\u7684\u5831\u916c\u7387\u7528\u984f\u8272\u6df1\u6dfa\u8868\u793a\uff08\u7da0\u8272\u70ba\u6b63\uff0c\u7d05\u8272\u70ba\u8ca0\uff09\uff0c\u8b93\u60a8\u53ef\u4ee5\u5feb\u901f\u8b58\u5225\u7b56\u7565\u5728\u54ea\u500b\u6708\u4efd\u6216\u5e74\u4efd\u8868\u73fe\u8f03\u597d\u6216\u8f03\u5dee\uff0c\u5f9e\u800c\u767c\u73fe\u6f5b\u5728\u7684\u5b63\u7bc0\u6027\u6548\u61c9\u3002</p> </li> </ul>"},{"location":"concepts/pyfolio-overview/#5","title":"5. \u5e38\u898b\u554f\u984c\u8207\u89e3\u6c7a\u65b9\u6848","text":""},{"location":"concepts/pyfolio-overview/#extract_rets_pos_txn_from_zipline","title":"extract_rets_pos_txn_from_zipline \u57f7\u884c\u5931\u6557","text":"<p>\u5728\u6975\u5c11\u6578\u60c5\u6cc1\u4e0b\uff08\u4f8b\u5982\u56de\u6e2c\u6642\u9593\u904e\u77ed\u6216\u6c92\u6709\u4efb\u4f55\u4ea4\u6613\uff09\uff0c<code>extract_rets_pos_txn_from_zipline</code> \u53ef\u80fd\u6703\u56e0\u70ba\u7121\u6cd5\u63d0\u53d6\u6709\u6548\u7684\u4ea4\u6613\u6578\u64da\u800c\u57f7\u884c\u5931\u6557\u3002\u70ba\u4e86\u589e\u5f37\u7a0b\u5f0f\u78bc\u7684\u7a69\u5065\u6027\uff0c\u5efa\u8b70\u4f7f\u7528 <code>try-except</code> \u5340\u584a\u4f86\u8655\u7406\u9019\u7a2e\u7570\u5e38\u60c5\u6cc1\u3002</p> <p>\u5099\u7528\u65b9\u6848\uff1a\u5982\u679c\u63d0\u53d6\u5931\u6557\uff0c\u60a8\u53ef\u4ee5\u9000\u800c\u6c42\u5176\u6b21\uff0c\u50c5\u5206\u6790\u7b56\u7565\u7684\u7e3d\u5831\u916c\u7387 (<code>algorithm_period_return</code>)\u3002</p> <pre><code>import pyfolio as pf\n\ntry:\n    # \u5617\u8a66\u6b63\u5e38\u63d0\u53d6\u6578\u64da\n    returns, positions, transactions = pf.utils.extract_rets_pos_txn_from_zipline(results)\nexcept Exception as e:\n    print(f\"\u5f9e Zipline \u7d50\u679c\u4e2d\u63d0\u53d6\u6578\u64da\u6642\u767c\u751f\u932f\u8aa4: {e}\")\n    # \u5982\u679c\u5931\u6557\uff0c\u5247\u4f7f\u7528\u5099\u7528\u65b9\u6848\uff0c\u50c5\u7372\u53d6\u7e3d\u5831\u916c\u7387\n    returns = results.get('algorithm_period_return', None)\n    positions = None\n    transactions = None\n\n# \u5373\u4f7f\u63d0\u53d6\u5931\u6557\uff0c\u4ecd\u7136\u53ef\u4ee5\u5206\u6790\u7e3d\u5831\u916c\u7387\nif returns is not None:\n    pf.create_returns_tear_sheet(returns, benchmark_rets=results.benchmark_return)\nelse:\n    print(\"\u7121\u6cd5\u7372\u53d6\u4efb\u4f55\u6709\u6548\u7684\u5831\u916c\u6578\u64da\u9032\u884c\u5206\u6790\u3002\")\n</code></pre>"},{"location":"concepts/pyfolio-overview/#_1","title":"\u7e3d\u7d50","text":"<p>Pyfolio \u662f\u91cf\u5316\u7814\u7a76\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u7e3e\u6548\u5206\u6790\u5de5\u5177\u3002\u5b83\u5c07\u8907\u96dc\u7684\u98a8\u96aa\u5831\u916c\u6307\u6a19\u548c\u7b56\u7565\u8868\u73fe\u7279\u5fb5\uff0c\u4ee5\u6a19\u6e96\u5316\u3001\u8996\u89ba\u5316\u7684\u65b9\u5f0f\u5448\u73fe\u51fa\u4f86\uff0c\u5e6b\u52a9\u7814\u7a76\u8005\u5feb\u901f\u3001\u6e96\u78ba\u5730\u8a55\u4f30\u7b56\u7565\u7684\u512a\u52a3\u3002\u5728 TQuant Lab \u4e2d\uff0c\u719f\u7df4\u904b\u7528 <code>create_full_tear_sheet</code> \u548c <code>show_perf_stats</code>\uff0c\u4e26\u4e86\u89e3\u5982\u4f55\u8655\u7406\u6f5b\u5728\u7684\u6578\u64da\u63d0\u53d6\u554f\u984c\uff0c\u662f\u5f9e\u7b56\u7565\u958b\u767c\u9081\u5411\u7b56\u7565\u512a\u5316\u7684\u95dc\u9375\u4e00\u6b65\u3002</p>"},{"location":"concepts/workflow/","title":"TQuant Lab \u5206\u6790\u6d41\u7a0b","text":"<p>Info</p> <p>\u672c\u9801\u5b8f\u89c0\u5730\u4ecb\u7d39 TQuant Lab \u7684\u6838\u5fc3\u5206\u6790\u6d41\u7a0b\uff0c\u5f9e\u8cc7\u6599\u7372\u53d6\u3001\u7b56\u7565\u767c\u60f3\u3001\u56de\u6e2c\u57f7\u884c\u5230\u7e3e- \u6548\u5206\u6790\uff0c\u70ba\u4f7f\u7528\u8005\u5efa\u7acb\u4e00\u500b\u6574\u9ad4\u7684\u6982\u5ff5\u6846\u67b6\u3002</p> <p>TQuant Lab \u627f\u8972\u4e86 Quantopian \u7684\u6838\u5fc3\u67b6\u69cb\uff0c\u63d0\u4f9b\u4e00\u500b\u5f9e\u7b56\u7565\u7814\u7a76\u3001\u56de\u6e2c\u5230\u7e3e\u6548\u5206\u6790\u7684\u5b8c\u6574\u91cf\u5316\u4ea4\u6613\u6d41\u7a0b\u3002\u6574\u500b\u5de5\u4f5c\u6d41\u7a0b\u53ef\u4ee5\u88ab\u62c6\u89e3\u70ba\u56db\u5927\u6838\u5fc3\u6b65\u9a5f\uff0c\u6bcf\u500b\u6b65\u9a5f\u74b0\u74b0\u76f8\u6263\uff0c\u69cb\u6210\u4e00\u500b\u9ad8\u6548\u7684\u7814\u7a76\u5faa\u74b0\u3002</p>"},{"location":"concepts/workflow/#1","title":"1. \u6838\u5fc3\u56db\u5927\u6d41\u7a0b","text":"<pre><code>graph TD\n    A[1. \u8cc7\u6599\u6e96\u5099\u8207\u8f09\u5165] --&gt; B[2. \u7b56\u7565\u5efa\u69cb\u8207\u56de\u6e2c];\n    B --&gt; C[3. \u7e3e\u6548\u8207\u98a8\u96aa\u5206\u6790];\n    C --&gt; D{4. \u7b56\u7565\u512a\u5316\u8207\u8fed\u4ee3};\n    D --&gt; B;\n\n    subgraph \"Zipline \u5f15\u64ce\"\n        B\n    end\n\n    subgraph \"Pyfolio &amp; Alphalens\"\n        C\n    end</code></pre>"},{"location":"concepts/workflow/#1-data-preparation","title":"1. \u8cc7\u6599\u6e96\u5099\u8207\u8f09\u5165 (Data Preparation)","text":"<p>\u5728\u4efb\u4f55\u91cf\u5316\u5206\u6790\u958b\u59cb\u4e4b\u524d\uff0c\u9996\u8981\u4efb\u52d9\u662f\u6e96\u5099\u4e7e\u6de8\u4e14\u6e96\u78ba\u7684\u8cc7\u6599\u3002TQuant Lab \u900f\u904e <code>zipline ingest</code> \u6307\u4ee4\u5c07\u8cc7\u6599\u8f09\u5165\u5230 Zipline Bundle \u4e2d\uff0c\u4f9b\u56de\u6e2c\u5f15\u64ce\u4f7f\u7528\u3002</p> <ul> <li> <p>\u5b9a\u7fa9\u80a1\u7968\u6c60 (<code>get_universe</code>) \uff1a     \u9996\u5148\uff0c\u60a8\u9700\u8981\u5b9a\u7fa9\u56de\u6e2c\u7684\u6a19\u7684\u7bc4\u570d\uff0c\u4f8b\u5982\u53f0\u7063 50 \u6307\u6578\u6210\u5206\u80a1\u3001\u7279\u5b9a\u7522\u696d\u985e\u80a1\uff0c\u6216\u662f\u60a8\u81ea\u8a02\u7684\u80a1\u7968\u5217\u8868\u3002</p> </li> <li> <p>\u8cc7\u6599\u64f7\u53d6 (<code>zipline ingest</code>) \uff1a     \u4f7f\u7528 <code>zipline ingest</code> \u6307\u4ee4\uff0cTQuant Lab \u6703\u81ea\u52d5\u5f9e TEJ API \u4e0b\u8f09\u60a8\u6240\u9700\u7684\u50f9\u91cf\u3001\u57fa\u672c\u9762\u3001\u6216\u53e6\u985e\u8cc7\u6599\uff0c\u4e26\u5c07\u5176\u8f49\u63db\u70ba Zipline \u9ad8\u6548\u80fd\u7684 bcolz \u683c\u5f0f\u3002\u9019\u500b\u904e\u7a0b\u78ba\u4fdd\u4e86\u56de\u6e2c\u6642\u80fd\u5feb\u901f\u8b80\u53d6\u6578\u64da\u3002</p> </li> <li> <p>\u591a\u8cc7\u6599\u985e\u578b\u652f\u63f4 \uff1a     \u9664\u80a1\u7968\u50f9\u91cf\u5916\uff0cTQuant Lab \u652f\u63f4\u57fa\u672c\u9762\u8cc7\u6599\u3001\u671f\u8ca8\u3001ETF \u7b49\u3002\u6839\u64da\u60a8\u7684\u7b56\u7565\u9700\u6c42\u9078\u64c7\u5c0d\u61c9\u7684\u8cc7\u6599 bundle\u3002</p> </li> </ul> <p>\u8a73\u898b\uff1a\u5982\u4f55 Ingest \u80a1\u7968\u50f9\u91cf\u8cc7\u6599</p>"},{"location":"concepts/workflow/#2-strategy-backtest","title":"2. \u7b56\u7565\u5efa\u69cb\u8207\u56de\u6e2c (Strategy &amp; Backtest)","text":"<p>\u9019\u662f\u91cf\u5316\u7814\u7a76\u7684\u6838\u5fc3\u3002\u60a8\u5c07\u5728\u9019\u88e1\u628a\u4ea4\u6613\u601d\u60f3\u8f49\u5316\u70ba\u5177\u9ad4\u7684\u7a0b\u5f0f\u78bc\uff0c\u4e26\u5728\u6b77\u53f2\u8cc7\u6599\u4e0a\u9a57\u8b49\u5176\u6709\u6548\u6027\u3002\u6b64\u968e\u6bb5\u4e3b\u8981\u5728 Zipline \u5f15\u64ce\u4e2d\u5b8c\u6210\u3002</p> <ul> <li> <p>Pipeline API - \u8a0a\u865f\u751f\u6210 \uff1a     Pipeline \u662f\u4e00\u500b\u5f37\u5927\u7684 API\uff0c\u7528\u65bc\u9ad8\u6548\u5730\u8a08\u7b97\u3001\u904e\u6ffe\u548c\u7be9\u9078\u5927\u91cf\u7684\u8b49\u5238\u8cc7\u6599\u3002\u60a8\u53ef\u4ee5\u900f\u904e\u7d44\u5408\u5167\u5efa\u6216\u81ea\u8a02\u7684\u56e0\u5b50 (Factors)\u3001\u6ffe\u7db2 (Filters) \u548c\u5206\u985e\u5668 (Classifiers) \u4f86\u7522\u751f\u6bcf\u65e5\u7684\u4ea4\u6613\u8a0a\u865f\u3002</p> </li> <li> <p>\u6838\u5fc3\u56de\u6e2c\u51fd\u6578 (<code>initialize</code> &amp; <code>handle_data</code>) \uff1a</p> <ul> <li><code>initialize(context)</code>\uff1a\u6b64\u51fd\u6578\u5728\u56de\u6e2c\u958b\u59cb\u6642 \u50c5\u57f7\u884c\u4e00\u6b21 \uff0c\u7528\u65bc\u8a2d\u5b9a\u521d\u59cb\u53c3\u6578\uff0c\u4f8b\u5982\u521d\u59cb\u8cc7\u91d1\u3001\u624b\u7e8c\u8cbb/\u6ed1\u50f9\u6a21\u578b\u3001\u4ee5\u53ca\u8a3b\u518a Pipeline\u3002</li> <li><code>handle_data(context, data)</code>\uff1a\u6b64\u51fd\u6578\u662f\u7b56\u7565\u7684\u5fc3\u81df\uff0c\u5b83\u6703\u5728\u6bcf\u500b\u4ea4\u6613\u65e5 \u76e4\u4e2d \u88ab\u8abf\u7528\u3002\u60a8\u5c07\u5728\u6b64\u8655\u7372\u53d6 Pipeline \u7684\u8a08\u7b97\u7d50\u679c\uff0c\u4e26\u6839\u64da\u4ea4\u6613\u908f\u8f2f\u57f7\u884c\u4e0b\u55ae\u6307\u4ee4 (<code>order_target_percent</code>, <code>order</code>, etc.)\u3002</li> </ul> </li> <li> <p>\u57f7\u884c\u56de\u6e2c (<code>run_algorithm</code>) \uff1a     \u8a2d\u5b9a\u597d\u56de\u6e2c\u7684\u8d77\u59cb/\u7d50\u675f\u65e5\u671f\u3001\u521d\u59cb\u8cc7\u91d1\u7b49\u53c3\u6578\u5f8c\uff0c<code>run_algorithm</code> \u51fd\u6578\u5c07\u6703\u555f\u52d5 Zipline \u5f15\u64ce\uff0c\u9010\u65e5\u6a21\u64ec\u60a8\u7684\u4ea4\u6613\u7b56\u7565\uff0c\u4e26\u8a18\u9304\u4e0b\u6bcf\u65e5\u7684\u6295\u8cc7\u7d44\u5408\u72c0\u614b\u3001\u4ea4\u6613\u7d00\u9304\u7b49\u8a73\u7d30\u8cc7\u8a0a\u3002</p> </li> </ul>"},{"location":"concepts/workflow/#_1","title":"\u9032\u968e\u6982\u5ff5\uff1a\u624b\u7e8c\u8cbb\u8207\u6ed1\u50f9\u6a21\u578b","text":"<p>\u5728\u5be6\u969b\u4ea4\u6613\u4e2d\uff0c\u624b\u7e8c\u8cbb\u548c\u6ed1\u50f9\u662f\u91cd\u8981\u7684\u6210\u672c\u56e0\u5b50\u3002\u900f\u904e <code>set_commission()</code> \u548c <code>set_slippage()</code> \u51fd\u6578\uff0c\u60a8\u53ef\u4ee5\u7cbe\u78ba\u6a21\u64ec\u4ea4\u6613\u6210\u672c\uff0c\u4f7f\u56de\u6e2c\u7d50\u679c\u66f4\u8cbc\u8fd1\u73fe\u5be6\u3002</p>"},{"location":"concepts/workflow/#_2","title":"\u9032\u968e\u6982\u5ff5\uff1a\u671f\u8ca8\u8207\u9023\u7e8c\u5408\u7d04","text":"<p>\u5c0d\u65bc\u671f\u8ca8\u4ea4\u6613\uff0cTQuant Lab \u63d0\u4f9b\u4e86 <code>continuous_future()</code> API \u4f86\u7372\u53d6\u9023\u7e8c\u5408\u7d04\u7269\u4ef6\uff0c\u89e3\u6c7a\u4e86\u671f\u8ca8\u5408\u7d04\u5230\u671f\u63db\u6708\u7684\u8907\u96dc\u554f\u984c\uff0c\u8b93\u60a8\u53ef\u4ee5\u5c08\u6ce8\u65bc\u7b56\u7565\u908f\u8f2f\u672c\u8eab\u3002</p> <p>\u8a73\u898b\uff1aZipline \u5f15\u64ce\u6838\u5fc3\u6a5f\u5236</p>"},{"location":"concepts/workflow/#3-performance-risk-analysis","title":"3. \u7e3e\u6548\u8207\u98a8\u96aa\u5206\u6790 (Performance &amp; Risk Analysis)","text":"<p>\u56de\u6e2c\u5b8c\u6210\u5f8c\uff0c\u6703\u7522\u51fa\u4e00\u500b\u5305\u542b\u8a73\u7d30\u4ea4\u6613\u6b77\u53f2\u7684 <code>results</code> DataFrame\u3002\u63a5\u4e0b\u4f86\uff0c\u60a8\u9700\u8981\u4f7f\u7528\u5c08\u696d\u7684\u5de5\u5177\u4f86\u8a55\u4f30\u7b56\u7565\u7684\u8868\u73fe\u3002</p> <ul> <li> <p>Pyfolio \u8996\u89ba\u5316\u5831\u8868 \uff1a     Pyfolio \u662f Quantopian \u958b\u767c\u7684\u5c08\u696d\u7e3e\u6548\u5206\u6790\u5957\u4ef6\u3002\u53ea\u9700\u5c07 <code>results</code> \u50b3\u5165 <code>pyfolio.create_full_tear_sheet</code> \u51fd\u6578\uff0c\u5373\u53ef\u81ea\u52d5\u751f\u6210\u5305\u542b\u7d2f\u8a08\u5831\u916c\u3001\u590f\u666e\u6bd4\u7387 (Sharpe Ratio)\u3001\u6700\u5927\u56de\u64a4 (Max Drawdown)\u3001\u98a8\u96aa\u56e0\u5b50\u5206\u6790 (Alpha, Beta) \u7b49\u6578\u5341\u7a2e\u95dc\u9375\u6307\u6a19\u7684\u8996\u89ba\u5316\u5831\u544a\u3002</p> </li> <li> <p>Alphalens \u56e0\u5b50\u5206\u6790 \uff1a     \u5982\u679c\u60a8\u60f3\u6df1\u5165\u8a55\u4f30 Pipeline \u4e2d\u7279\u5b9a\u56e0\u5b50\u7684\u6709\u6548\u6027\uff0cAlphalens \u53ef\u4ee5\u5e6b\u52a9\u60a8\u5206\u6790\u56e0\u5b50\u7684\u9810\u6e2c\u80fd\u529b (Information Coefficient)\u3001\u5831\u916c\u5206\u4f48\u3001\u4ee5\u53ca\u63db\u624b\u7387\u7b49\uff0c\u5f9e\u800c\u5224\u65b7\u60a8\u7684 Alpha \u4f86\u6e90\u662f\u5426\u7a69\u5065\u3002</p> </li> </ul> <p>\u8a73\u898b\uff1aPyfolio \u7e3e\u6548\u5206\u6790\u6982\u8ad6 \u8a73\u898b\uff1aAlphalens \u56e0\u5b50\u5206\u6790\u6982\u8ad6</p>"},{"location":"concepts/workflow/#4-optimization-iteration","title":"4. \u7b56\u7565\u512a\u5316\u8207\u8fed\u4ee3 (Optimization &amp; Iteration)","text":"<p>\u91cf\u5316\u7814\u7a76\u662f\u4e00\u500b\u4e0d\u65b7\u8fed\u4ee3\u7684\u904e\u7a0b\u3002\u6839\u64da\u7e3e\u6548\u5206\u6790\u5831\u544a\u7684\u7d50\u679c\uff0c\u60a8\u53ef\u80fd\u6703\u767c\u73fe\u7b56\u7565\u7684\u4e0d\u8db3\u4e4b\u8655\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u4ea4\u6613\u6210\u672c\u904e\u9ad8\uff0c\u9700\u8981\u8abf\u6574\u63db\u624b\u7387\u3002</li> <li>\u5728\u7279\u5b9a\u5e02\u5834\u98a8\u683c\u4e0b\u8868\u73fe\u4e0d\u4f73\uff0c\u9700\u8981\u52a0\u5165\u65b0\u7684\u56e0\u5b50\u3002</li> <li>\u6700\u5927\u56de\u64a4\u904e\u5927\uff0c\u9700\u8981\u6539\u9032\u98a8\u96aa\u63a7\u5236\u6a5f\u5236\u3002</li> </ul> <p>\u57fa\u65bc\u9019\u4e9b\u6d1e\u898b\uff0c\u60a8\u53ef\u4ee5\u56de\u5230 \u6b65\u9a5f 2 \uff0c\u8abf\u6574\u60a8\u7684 Pipeline \u56e0\u5b50\u6216 <code>handle_data</code> \u4e2d\u7684\u4ea4\u6613\u908f\u8f2f\uff0c\u7136\u5f8c\u91cd\u65b0\u57f7\u884c\u56de\u6e2c\u8207\u5206\u6790\uff0c\u5f62\u6210\u4e00\u500b\u5b8c\u6574\u7684\u7814\u7a76\u9589\u74b0\u3002</p>"},{"location":"concepts/workflow/#5","title":"5. \u5e38\u898b\u9677\u9631\u8207\u6700\u4f73\u5be6\u8e10","text":"<ul> <li> <p>\u5411\u524d\u770b\u504f\u8aa4 (Look-ahead Bias) \uff1a     \u78ba\u4fdd\u60a8\u7684 Pipeline \u56e0\u5b50\u6216\u7b56\u7565\u908f\u8f2f\u5728\u505a\u6c7a\u7b56\u6642\uff0c\u53ea\u4f7f\u7528\u4e86\u8a72\u6642\u9593\u9ede \u4e4b\u524d \u7684\u6b77\u53f2\u8cc7\u6599\uff0c\u907f\u514d\u610f\u5916\u4f7f\u7528\u5230\u672a\u4f86\u7684\u8cc7\u8a0a\u3002</p> </li> <li> <p>\u904e\u5ea6\u512a\u5316 (Overfitting) \uff1a     \u907f\u514d\u5728\u540c\u4e00\u6bb5\u6b77\u53f2\u8cc7\u6599\u4e0a\u53cd\u8986\u6e2c\u8a66\u4e26\u8abf\u6574\u53c3\u6578\u3002\u4e00\u500b\u7a69\u5065\u7684\u7b56\u7565\u61c9\u8a72\u5728\u6a23\u672c\u5167 (In-Sample) \u8a13\u7df4\u5f8c\uff0c\u5728\u5f9e\u672a\u898b\u904e\u7684\u6a23\u672c\u5916 (Out-of-Sample) \u8cc7\u6599\u4e0a\u4f9d\u7136\u8868\u73fe\u826f\u597d\u3002</p> </li> <li> <p>\u6ed1\u50f9\u8207\u6210\u672c\u5ffd\u8996 \uff1a     \u5728\u56de\u6e2c\u4e2d\u4e0d\u8a2d\u5b9a\u6216\u4f4e\u4f30\u624b\u7e8c\u8cbb\u8207\u6ed1\u50f9\uff0c\u53ef\u80fd\u6703\u5c0e\u81f4\u904e\u65bc\u6a02\u89c0\u7684\u7e3e\u6548\u3002\u4e00\u500b\u8cbc\u8fd1\u73fe\u5be6\u7684\u6210\u672c\u6a21\u578b\u662f\u7b56\u7565\u80fd\u5426\u5728\u5be6\u76e4\u4e2d\u7372\u5229\u7684\u95dc\u9375\u3002</p> </li> </ul>"},{"location":"concepts/zipline-engine/","title":"Zipline \u5f15\u64ce\u6838\u5fc3\u6a5f\u5236","text":"<p>Info</p> <p>\u672c\u9801\u6df1\u5165\u89e3\u91cb Zipline \u5f15\u64ce\u7684\u904b\u4f5c\u539f\u7406\uff0c\u5305\u62ec\u5176\u6838\u5fc3\u7d44\u4ef6\uff08\u5982 <code>initialize</code>, <code>handle_data</code>, <code>before_trading_start</code>\uff09\u3001\u4e8b\u4ef6\u9a45\u52d5\u6a21\u578b\u3001\u4ee5\u53ca\u8cc7\u6599\u8655\u7406\u6a5f\u5236\uff0c\u70ba\u4f7f\u7528\u8005\u5efa\u7acb\u5c0d Zipline \u5f15\u64ce\u7684\u5168\u9762\u7406\u89e3\u3002</p> <p>Zipline \u662f TQuant Lab \u7684\u6838\u5fc3\u56de\u6e2c\u5f15\u64ce\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u500b\u5f37\u5927\u4e14\u9748\u6d3b\u7684\u6846\u67b6\uff0c\u7528\u65bc\u6a21\u64ec\u80a1\u7968\u3001\u671f\u8ca8\u7b49\u91d1\u878d\u8cc7\u7522\u7684\u4ea4\u6613\u7b56\u7565\u3002Zipline \u7684\u8a2d\u8a08\u7406\u5ff5\u662f \u4e8b\u4ef6\u9a45\u52d5 (Event-Driven) \uff0c\u9019\u610f\u5473\u8457\u5b83\u6703\u6309\u7167\u6642\u9593\u9806\u5e8f\u8655\u7406\u5e02\u5834\u4e8b\u4ef6\uff08\u5982\u958b\u76e4\u3001\u6536\u76e4\u3001\u4ea4\u6613\u6578\u64da\u66f4\u65b0\uff09\uff0c\u4e26\u6839\u64da\u7b56\u7565\u908f\u8f2f\u57f7\u884c\u76f8\u61c9\u7684\u64cd\u4f5c\u3002</p>"},{"location":"concepts/zipline-engine/#1-zipline","title":"1. Zipline \u7c21\u4ecb","text":"<p>Zipline \u662f\u4e00\u500b\u7531 Quantopian \u958b\u6e90\u7684 Python \u51fd\u5f0f\u5eab\uff0c\u5c08\u70ba\u91cf\u5316\u4ea4\u6613\u7b56\u7565\u7684\u56de\u6e2c\u800c\u8a2d\u8a08\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u5957\u5b8c\u6574\u7684\u5de5\u5177\uff0c\u8b93\u7814\u7a76\u8005\u80fd\u5920\uff1a</p> <ul> <li>\u6a21\u64ec\u771f\u5be6\u5e02\u5834\u74b0\u5883 \uff1a\u7cbe\u78ba\u91cd\u73fe\u6b77\u53f2\u5e02\u5834\u6578\u64da\uff0c\u5305\u62ec\u50f9\u683c\u3001\u6210\u4ea4\u91cf\u3001\u4ea4\u6613\u6210\u672c\u7b49\u3002</li> <li>\u5feb\u901f\u958b\u767c\u7b56\u7565 \uff1a\u900f\u904e\u7c21\u6f54\u7684 API \u64b0\u5beb\u4ea4\u6613\u908f\u8f2f\u3002</li> <li>\u9ad8\u6548\u57f7\u884c\u56de\u6e2c \uff1a\u512a\u5316\u5f8c\u7684\u6578\u64da\u7d50\u69cb\u548c\u4e8b\u4ef6\u8655\u7406\u6a5f\u5236\uff0c\u78ba\u4fdd\u56de\u6e2c\u6548\u7387\u3002</li> <li>\u6574\u5408\u5206\u6790\u5de5\u5177 \uff1a\u8207 Pyfolio \u7b49\u5de5\u5177\u7121\u7e2b\u6574\u5408\uff0c\u63d0\u4f9b\u8c50\u5bcc\u7684\u7e3e\u6548\u5206\u6790\u5831\u544a\u3002</li> </ul> <p>\u5728 TQuant Lab \u4e2d\uff0cZipline \u5f15\u64ce\u662f\u6240\u6709\u7b56\u7565\u56de\u6e2c\u7684\u57fa\u77f3\uff0c\u8ca0\u8cac\u8655\u7406\u8cc7\u6599\u6d41\u3001\u57f7\u884c\u4ea4\u6613\u6307\u4ee4\u3001\u7ba1\u7406\u6295\u8cc7\u7d44\u5408\u72c0\u614b\uff0c\u4e26\u6700\u7d42\u7522\u51fa\u8a73\u7d30\u7684\u56de\u6e2c\u7d50\u679c\u3002</p>"},{"location":"concepts/zipline-engine/#2","title":"2. \u4e8b\u4ef6\u9a45\u52d5\u6a21\u578b","text":"<p>Zipline \u7684\u4e8b\u4ef6\u9a45\u52d5\u6a21\u578b\u662f\u5176\u6838\u5fc3\u7279\u8272\u3002\u5b83\u4e0d\u662f\u7c21\u55ae\u5730\u904d\u6b77\u6642\u9593\u5e8f\u5217\u6578\u64da\uff0c\u800c\u662f\u6a21\u64ec\u5e02\u5834\u4e2d\u767c\u751f\u7684\u5404\u7a2e\u4e8b\u4ef6\uff0c\u4e26\u5728\u9019\u4e9b\u4e8b\u4ef6\u767c\u751f\u6642\u89f8\u767c\u7b56\u7565\u4e2d\u5b9a\u7fa9\u7684\u51fd\u6578\u3002\u9019\u4f7f\u5f97\u7b56\u7565\u80fd\u5920\u5c0d\u5e02\u5834\u8b8a\u5316\u505a\u51fa\u5373\u6642\u53cd\u61c9\uff0c\u66f4\u8cbc\u8fd1\u771f\u5be6\u4ea4\u6613\u3002</p> <pre><code>graph TD\n    Start[\u56de\u6e2c\u958b\u59cb] --&gt; Initialize(initialize\u51fd\u6578); \n    Initialize --&gt; LoopDay{\u6bcf\u65e5\u5faa\u74b0}; \n    LoopDay -- \u6bcf\u500b\u4ea4\u6613\u65e5\u958b\u59cb --&gt; BeforeTradingStart(before_trading_start\u51fd\u6578); \n    BeforeTradingStart --&gt; HandleData(handle_data\u51fd\u6578); \n    HandleData --&gt; EndDay{\u6bcf\u65e5\u7d50\u675f}; \n    EndDay -- \u9084\u6709\u4ea4\u6613\u65e5? --&gt; LoopDay; \n    LoopDay -- \u7121\u4ea4\u6613\u65e5 --&gt; Analyze(analyze\u51fd\u6578); \n    Analyze --&gt; End[\u56de\u6e2c\u7d50\u675f];\n\n    style Start fill:#f9f,stroke:#333,stroke-width:2px\n    style End fill:#f9f,stroke:#333,stroke-width:2px\n    style Initialize fill:#bbf,stroke:#333,stroke-width:2px\n    style BeforeTradingStart fill:#bbf,stroke:#333,stroke-width:2px\n    style HandleData fill:#bbf,stroke:#333,stroke-width:2px\n    style Analyze fill:#bbf,stroke:#333,stroke-width:2px</code></pre>"},{"location":"concepts/zipline-engine/#3","title":"3. \u6838\u5fc3\u751f\u547d\u9031\u671f\u51fd\u6578","text":"<p>Zipline \u7b56\u7565\u4e3b\u8981\u7531\u4ee5\u4e0b\u5e7e\u500b\u751f\u547d\u9031\u671f\u51fd\u6578\u69cb\u6210\uff0c\u5b83\u5011\u5728\u56de\u6e2c\u7684\u4e0d\u540c\u968e\u6bb5\u88ab\u8abf\u7528\uff1a</p>"},{"location":"concepts/zipline-engine/#31-initializecontext","title":"3.1. initialize(context)","text":"<ul> <li>\u57f7\u884c\u6642\u6a5f \uff1a\u5728\u56de\u6e2c\u958b\u59cb\u6642 \u50c5\u57f7\u884c\u4e00\u6b21 \u3002</li> <li>\u4f5c\u7528 \uff1a\u7528\u65bc\u8a2d\u5b9a\u7b56\u7565\u7684\u521d\u59cb\u72c0\u614b\u548c\u53c3\u6578\uff0c\u4f8b\u5982\uff1a<ul> <li>\u5b9a\u7fa9\u521d\u59cb\u8cc7\u91d1 (<code>context.capital_base</code>)\u3002</li> <li>\u8a2d\u5b9a\u624b\u7e8c\u8cbb (<code>set_commission</code>) \u548c\u6ed1\u50f9 (<code>set_slippage</code>) \u6a21\u578b\u3002</li> <li>\u8a3b\u518a Pipeline (<code>attach_pipeline</code>)\u3002</li> <li>\u8a2d\u5b9a\u57fa\u6e96\u6307\u6578 (<code>set_benchmark</code>)\u3002</li> <li>\u521d\u59cb\u5316\u7b56\u7565\u6240\u9700\u7684\u8b8a\u6578 (<code>context.my_variable = ...</code>)\u3002</li> </ul> </li> </ul>"},{"location":"concepts/zipline-engine/#32-handle_datacontext-data","title":"3.2. handle_data(context, data)","text":"<ul> <li>\u57f7\u884c\u6642\u6a5f \uff1a\u5728\u6bcf\u500b\u4ea4\u6613\u65e5 \u76e4\u4e2d \u88ab\u8abf\u7528\u4e00\u6b21\u3002\u5c0d\u65bc\u65e5\u983b\u56de\u6e2c\uff0c\u901a\u5e38\u5728\u958b\u76e4\u5f8c\u57f7\u884c\uff0c\u4e26\u53ef\u7372\u53d6\u7576\u65e5\u958b\u76e4\u5f8c\u7684\u6700\u65b0\u6578\u64da\u3002</li> <li>\u4f5c\u7528 \uff1a\u9019\u662f\u7b56\u7565\u7684\u6838\u5fc3\u908f\u8f2f\u6240\u5728\u3002\u60a8\u5c07\u5728\u6b64\u8655\uff1a<ul> <li>\u7372\u53d6\u6700\u65b0\u7684\u5e02\u5834\u6578\u64da (<code>data.current()</code>, <code>data.history()</code>)\u3002</li> <li>\u7372\u53d6 Pipeline \u8a08\u7b97\u51fa\u7684\u4ea4\u6613\u8a0a\u865f (<code>pipeline_output()</code>)\u3002</li> <li>\u6839\u64da\u4ea4\u6613\u908f\u8f2f\u5224\u65b7\u8cb7\u8ce3\u6642\u6a5f\u3002</li> <li>\u57f7\u884c\u4e0b\u55ae\u64cd\u4f5c (<code>order</code>, <code>order_target_percent</code>)\u3002</li> <li>\u8a18\u9304\u81ea\u8a02\u6307\u6a19 (<code>record</code>)\u3002</li> </ul> </li> </ul>"},{"location":"concepts/zipline-engine/#33-before_trading_startcontext-data","title":"3.3. before_trading_start(context, data) (\u53ef\u9078)","text":"<ul> <li>\u57f7\u884c\u6642\u6a5f \uff1a\u5728\u6bcf\u500b\u4ea4\u6613\u65e5 \u958b\u76e4\u524d \u88ab\u8abf\u7528\u4e00\u6b21\u3002</li> <li>\u4f5c\u7528 \uff1a\u9069\u7528\u65bc\u9700\u8981\u5728\u76e4\u524d\u9032\u884c\u8cc7\u6599\u9810\u8655\u7406\u3001\u8a08\u7b97\u6216\u8abf\u6574\u7b56\u7565\u72c0\u614b\u7684\u5834\u666f\uff0c\u4f8b\u5982\uff1a<ul> <li>\u66f4\u65b0\u6bcf\u65e5\u7684\u80a1\u7968\u6c60\u3002</li> <li>\u8a08\u7b97\u76e4\u524d\u56e0\u5b50\u3002</li> <li>\u8abf\u6574\u7b56\u7565\u7684\u98a8\u96aa\u53c3\u6578\u3002</li> </ul> </li> </ul>"},{"location":"concepts/zipline-engine/#34-analyzecontext-perf","title":"3.4. analyze(context, perf) (\u53ef\u9078)","text":"<ul> <li>\u57f7\u884c\u6642\u6a5f \uff1a\u5728\u6574\u500b\u56de\u6e2c\u7d50\u675f\u6642 \u50c5\u57f7\u884c\u4e00\u6b21 \u3002</li> <li>\u4f5c\u7528 \uff1a\u7528\u65bc\u5c0d\u56de\u6e2c\u7d50\u679c\u9032\u884c\u6700\u7d42\u5206\u6790\u548c\u8996\u89ba\u5316\uff0c\u4f8b\u5982\uff1a<ul> <li>\u4f7f\u7528 Pyfolio \u751f\u6210\u7e3e\u6548\u5831\u544a\u3002</li> <li>\u7e6a\u88fd\u81ea\u8a02\u7684\u7b56\u7565\u8868\u73fe\u5716\u8868\u3002</li> <li>\u8f38\u51fa\u6700\u7d42\u7684\u7d71\u8a08\u6578\u64da\u3002</li> </ul> </li> </ul> <p>\u8a73\u898b\uff1a\u751f\u547d\u9031\u671f\u51fd\u6578</p>"},{"location":"concepts/zipline-engine/#4-context","title":"4. context \u7269\u4ef6\uff1a\u7b56\u7565\u7684\u8a18\u61b6\u9ad4","text":"<p><code>context</code> \u7269\u4ef6\u662f Zipline \u7b56\u7565\u4e2d\u4e00\u500b\u81f3\u95dc\u91cd\u8981\u7684\u6982\u5ff5\uff0c\u5b83\u5728\u6574\u500b\u56de\u6e2c\u904e\u7a0b\u4e2d\u6301\u7e8c\u5b58\u5728\uff0c\u4e26\u5728\u4e0d\u540c\u7684\u751f\u547d\u9031\u671f\u51fd\u6578\u4e4b\u9593\u50b3\u905e\u7b56\u7565\u7684\u72c0\u614b\u548c\u8cc7\u8a0a\u3002\u60a8\u53ef\u4ee5\u5c07\u5176\u8996\u70ba\u7b56\u7565\u7684\u300c\u8a18\u61b6\u9ad4\u300d\u6216\u300c\u5168\u5c40\u8b8a\u6578\u5132\u5b58\u5eab\u300d\u3002</p> <p><code>context</code> \u5305\u542b\u4e86\u591a\u500b\u91cd\u8981\u7684\u5c6c\u6027\uff0c\u8b93\u60a8\u53ef\u4ee5\u5b58\u53d6\u6295\u8cc7\u7d44\u5408\u3001\u5e33\u6236\u3001\u8a02\u55ae\u7b49\u5373\u6642\u8cc7\u8a0a\uff1a</p> <ul> <li><code>context.portfolio</code>\uff1a\u5305\u542b\u6295\u8cc7\u7d44\u5408\u7684\u8a73\u7d30\u8cc7\u8a0a\uff0c\u5982\u7e3d\u8cc7\u7522\u50f9\u503c (<code>portfolio_value</code>)\u3001\u73fe\u91d1\u9918\u984d (<code>cash</code>)\u3001\u7576\u524d\u6301\u5009 (<code>positions</code>) \u7b49\u3002</li> <li><code>context.account</code>\uff1a\u63d0\u4f9b\u5e33\u6236\u5c64\u7d1a\u7684\u8cc7\u8a0a\uff0c\u5982\u69d3\u687f\u7387 (<code>leverage</code>)\u3001\u53ef\u7528\u8cc7\u91d1 (<code>buying_power</code>) \u7b49\u3002</li> <li><code>context.blotter</code>\uff1a\u8a18\u9304\u6240\u6709\u8a02\u55ae\u548c\u4ea4\u6613\u7684\u8cc7\u8a0a\uff0c\u5305\u62ec\u672a\u6210\u4ea4\u8a02\u55ae (<code>open_orders</code>)\u3001\u5df2\u6210\u4ea4\u8a02\u55ae (<code>orders</code>) \u7b49\u3002</li> <li><code>context.sim_params</code>\uff1a\u5305\u542b\u56de\u6e2c\u7684\u6a21\u64ec\u53c3\u6578\uff0c\u5982\u8d77\u59cb/\u7d50\u675f\u65e5\u671f\u3001\u521d\u59cb\u8cc7\u91d1 (<code>capital_base</code>)\u3001\u8cc7\u6599\u983b\u7387 (<code>data_frequency</code>) \u7b49\u3002</li> <li>\u81ea\u8a02\u5c6c\u6027 \uff1a\u60a8\u53ef\u4ee5\u5728 <code>initialize</code> \u51fd\u6578\u4e2d\u70ba <code>context</code> \u6dfb\u52a0\u4efb\u4f55\u81ea\u8a02\u5c6c\u6027\uff0c\u4ee5\u4fbf\u5728 <code>handle_data</code> \u6216\u5176\u4ed6\u51fd\u6578\u4e2d\u4f7f\u7528\u548c\u66f4\u65b0\uff0c\u4f8b\u5982 <code>context.my_indicator = []</code>\u3002</li> </ul> <p>\u8a73\u898b\uff1acontext \u8b8a\u6578</p>"},{"location":"concepts/zipline-engine/#5","title":"5. \u8cc7\u6599\u8655\u7406\u6a5f\u5236","text":"<p>Zipline \u63d0\u4f9b\u4e86\u5169\u7a2e\u4e3b\u8981\u65b9\u5f0f\u4f86\u7372\u53d6\u5e02\u5834\u6578\u64da\uff1a</p> <ul> <li> <p><code>data.history(asset, field, bar_count, frequency)</code> \uff1a     \u7528\u65bc\u7372\u53d6\u6307\u5b9a\u8cc7\u7522\u5728\u904e\u53bb\u4e00\u6bb5\u6642\u9593\u5167\u7684\u6b77\u53f2\u6578\u64da\u3002\u4f8b\u5982\uff0c\u7372\u53d6\u67d0\u80a1\u7968\u904e\u53bb 100 \u5929\u7684\u6536\u76e4\u50f9\u3002</p> </li> <li> <p><code>data.current(asset, field)</code> \uff1a     \u7528\u65bc\u7372\u53d6\u6307\u5b9a\u8cc7\u7522\u5728\u7576\u524d\u4ea4\u6613\u65e5\uff08\u6216\u7576\u524d\u6a21\u64ec\u6642\u9593\u9ede\uff09\u7684\u6700\u65b0\u6578\u64da\u3002\u4f8b\u5982\uff0c\u7372\u53d6\u7576\u524d\u80a1\u7968\u7684\u6700\u65b0\u50f9\u683c\u6216\u6210\u4ea4\u91cf\u3002</p> </li> <li> <p>Pipeline \u8207\u8cc7\u6599\u6574\u5408 \uff1a     Pipeline API \u80fd\u5920\u9ad8\u6548\u5730\u8655\u7406\u5927\u91cf\u6b77\u53f2\u6578\u64da\uff0c\u8a08\u7b97\u51fa\u8907\u96dc\u7684\u56e0\u5b50\u548c\u4ea4\u6613\u8a0a\u865f\u3002\u9019\u4e9b\u8a0a\u865f\u5728 <code>handle_data</code> \u4e2d\u900f\u904e <code>pipeline_output()</code> \u51fd\u6578\u88ab\u7372\u53d6\uff0c\u4e26\u7528\u65bc\u9a45\u52d5\u4ea4\u6613\u6c7a\u7b56\u3002</p> </li> </ul>"},{"location":"concepts/zipline-engine/#edge-case-handling","title":"\u908a\u754c\u60c5\u6cc1\u8655\u7406 (Edge Case Handling)","text":"<p>\u5728\u5be6\u969b\u56de\u6e2c\u4e2d\uff0c\u9700\u8981\u6ce8\u610f\u8cc7\u6599\u7684\u5b8c\u6574\u6027\u548c\u5404\u7a2e\u53ef\u80fd\u767c\u751f\u7684\u908a\u754c\u60c5\u6cc1\uff1a</p> <ul> <li>\u7f3a\u5931\u8cc7\u6599 (NaN) \uff1a\u7576 <code>data.history()</code> \u6216 <code>pipeline_output()</code> \u8fd4\u56de NaN \u6642\uff0c\u7b56\u7565\u61c9\u6709\u76f8\u61c9\u7684\u8655\u7406\u908f\u8f2f\uff0c\u4f8b\u5982\u8df3\u904e\u8a72\u8cc7\u7522\u6216\u4f7f\u7528\u524d\u4e00\u5929\u7684\u6578\u64da\u3002</li> <li>\u505c\u724c\u6216\u5df2\u4e0b\u5e02\u8cc7\u7522 \uff1aZipline \u6703\u81ea\u52d5\u8655\u7406\u505c\u724c\u6216\u5df2\u4e0b\u5e02\u7684\u8cc7\u7522\uff0c\u907f\u514d\u5728\u9019\u4e9b\u8cc7\u7522\u4e0a\u57f7\u884c\u4ea4\u6613\u3002\u60a8\u4e5f\u53ef\u4ee5\u5728\u7b56\u7565\u4e2d\u6aa2\u67e5 <code>data.is_lively()</code> \u4f86\u78ba\u8a8d\u8cc7\u7522\u662f\u5426\u53ef\u4ea4\u6613\u3002</li> <li>\u73fe\u91d1\u4e0d\u8db3 \uff1a\u7576\u5617\u8a66\u4e0b\u55ae\u7684\u8cc7\u91d1\u8d85\u904e\u53ef\u7528\u73fe\u91d1\u6642\uff0cZipline \u6703\u81ea\u52d5\u8abf\u6574\u8a02\u55ae\u6578\u91cf\u6216\u62d2\u7d55\u8a02\u55ae\u3002\u7b56\u7565\u8a2d\u8a08\u6642\u61c9\u8003\u616e\u8cc7\u91d1\u7ba1\u7406\uff0c\u907f\u514d\u904e\u5ea6\u4e0b\u55ae\u3002</li> </ul> <p>\u8a73\u898b\uff1aZipline \u8cc7\u6599\u7269\u4ef6 \u8a73\u898b\uff1aPipeline API (\u6982\u8ad6)</p>"},{"location":"concepts/zipline-engine/#6","title":"6. \u4ea4\u6613\u57f7\u884c\u8207\u90e8\u4f4d\u7ba1\u7406","text":"<p>Zipline \u63d0\u4f9b\u4e86\u76f4\u89c0\u7684 API \u4f86\u57f7\u884c\u4ea4\u6613\u548c\u7ba1\u7406\u6295\u8cc7\u7d44\u5408\uff1a</p> <ul> <li> <p>\u4e0b\u55ae\u51fd\u6578 \uff1a</p> <ul> <li><code>order(asset, amount)</code>\uff1a\u4ee5\u5e02\u50f9\u55ae\u5f62\u5f0f\u8cb7\u5165\u6216\u8ce3\u51fa\u6307\u5b9a\u6578\u91cf\u7684\u8cc7\u7522\u3002</li> <li><code>order_target_percent(asset, percent)</code>\uff1a\u8abf\u6574\u6307\u5b9a\u8cc7\u7522\u7684\u6301\u5009\u6bd4\u4f8b\u81f3\u76ee\u6a19\u767e\u5206\u6bd4\u3002Zipline \u6703\u81ea\u52d5\u8a08\u7b97\u9700\u8981\u8cb7\u8ce3\u7684\u6578\u91cf\u3002</li> <li><code>order_target_value(asset, value)</code>\uff1a\u8abf\u6574\u6307\u5b9a\u8cc7\u7522\u7684\u6301\u5009\u50f9\u503c\u81f3\u76ee\u6a19\u91d1\u984d\u3002</li> </ul> </li> <li> <p>\u624b\u7e8c\u8cbb\u8207\u6ed1\u50f9\u6a21\u578b \uff1a     Zipline \u5141\u8a31\u60a8\u8a2d\u5b9a\u8a73\u7d30\u7684\u624b\u7e8c\u8cbb (<code>set_commission</code>) \u548c\u6ed1\u50f9 (<code>set_slippage</code>) \u6a21\u578b\uff0c\u4ee5\u66f4\u771f\u5be6\u5730\u6a21\u64ec\u4ea4\u6613\u6210\u672c\u5c0d\u7b56\u7565\u7e3e\u6548\u7684\u5f71\u97ff\u3002</p> </li> <li> <p>\u90e8\u4f4d\u67e5\u8a62 \uff1a     \u60a8\u53ef\u4ee5\u96a8\u6642\u900f\u904e <code>context.portfolio.positions</code> \u67e5\u8a62\u7576\u524d\u6301\u6709\u7684\u6240\u6709\u8cc7\u7522\u53ca\u5176\u8a73\u7d30\u8cc7\u8a0a\uff08\u5982\u6578\u91cf\u3001\u6210\u672c\u50f9\u3001\u6700\u65b0\u5e02\u50f9\uff09\u3002</p> </li> </ul> <p>\u8a73\u898b\uff1a\u4e0b\u55ae\u51fd\u6578</p>"},{"location":"concepts/zipline-engine/#7","title":"7. \u4ea4\u6613\u57f7\u884c\u6a21\u5f0f\u8207\u8a02\u55ae\u7ba1\u7406","text":"<p>Zipline \u4e0d\u50c5\u6a21\u64ec\u4ea4\u6613\u884c\u70ba\uff0c\u4e5f\u8655\u7406\u8a02\u55ae\u7684\u751f\u547d\u9031\u671f\uff0c\u7406\u89e3\u9019\u4e9b\u6709\u52a9\u65bc\u7b56\u7565\u7684\u7cbe\u78ba\u63a7\u5236\u3002</p>"},{"location":"concepts/zipline-engine/#market-order-limit-order","title":"\u5e02\u50f9\u55ae (Market Order) \u8207\u9650\u50f9\u55ae (Limit Order)","text":"<p>Zipline \u9810\u8a2d\u4ee5\u4e0b\u55ae\u51fd\u6578\u5982 <code>order()</code> \u767c\u51fa \u5e02\u50f9\u55ae \uff0c\u6839\u64da\u56de\u6e2c\u983b\u7387\uff08\u65e5\u983b\u6216\u5206\u9418\u983b\uff09\u5728\u4e0b\u4e00\u500b\u53ef\u7528\u7684\u689d\u5f62\u6578\u64da\u9ede\u9032\u884c\u6210\u4ea4\u3002\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>order_target_value()</code> \u6216 <code>order_target_percent()</code> \u4f86\u7ba1\u7406\u60a8\u7684\u6301\u5009\u6bd4\u91cd\u3002</p>"},{"location":"concepts/zipline-engine/#_1","title":"\u8a02\u55ae\u57f7\u884c\u9806\u5e8f\u8207\u512a\u5148\u7d1a","text":"<p>\u5728\u65e5\u983b\u56de\u6e2c\u4e2d\uff0c\u6240\u6709 <code>handle_data</code> \u4e2d\u767c\u51fa\u7684\u8a02\u55ae\u6703\u88ab\u6536\u96c6\uff0c\u4e26\u5728\u7576\u65e5\u6536\u76e4\u6642\u4ee5\u6536\u76e4\u50f9\u57f7\u884c\uff0c\u8003\u616e\u6ed1\u50f9\u548c\u624b\u7e8c\u8cbb\u3002Zipline \u5167\u90e8\u6703\u76e1\u53ef\u80fd\u6a21\u64ec\u771f\u5be6\u5e02\u5834\u4e2d\u7684\u8a02\u55ae\u64ae\u5408\u908f\u8f2f\u3002</p>"},{"location":"concepts/zipline-engine/#_2","title":"\u672a\u6210\u4ea4\u8a02\u55ae\u7684\u904e\u591c\u8655\u7406","text":"<p>\u5982\u679c\u8a02\u55ae\u5728\u7576\u5929\u672a\u80fd\u5b8c\u5168\u6210\u4ea4\uff08\u4f8b\u5982\uff0c\u56e0\u70ba\u6d41\u52d5\u6027\u4e0d\u8db3\u6216\u8a2d\u5b9a\u4e86\u9650\u50f9\uff09\uff0c\u672a\u6210\u4ea4\u7684\u90e8\u5206\u5c07\u6703\u300c\u904e\u591c\u300d\u4e26\u5728\u4e0b\u4e00\u500b\u4ea4\u6613\u65e5\u7e7c\u7e8c\u5617\u8a66\u6210\u4ea4\uff0c\u76f4\u5230\u8a02\u55ae\u88ab\u5b8c\u5168\u6210\u4ea4\u3001\u53d6\u6d88\u6216\u9054\u5230\u9810\u8a2d\u7684\u8d85\u6642\u671f\u9650\u3002\u5728 <code>initialize</code> \u6216 <code>before_trading_start</code> \u4e2d\uff0c\u60a8\u53ef\u4ee5\u900f\u904e <code>context.blotter.open_orders</code> \u6aa2\u67e5\u672a\u6210\u4ea4\u8a02\u55ae\u3002</p>"},{"location":"concepts/zipline-engine/#8","title":"8. \u6548\u80fd\u8207\u6700\u4f73\u5be6\u8e10","text":"<p>\u70ba\u4e86\u9ad8\u6548\u5730\u904b\u884c\u56de\u6e2c\u4e26\u7372\u5f97\u53ef\u9760\u7684\u7d50\u679c\uff0c\u9075\u5faa\u4e00\u4e9b\u6700\u4f73\u5be6\u8e10\u81f3\u95dc\u91cd\u8981\u3002</p> <ul> <li> <p>\u5728 <code>handle_data()</code> \u4e2d\u907f\u514d\u8907\u96dc\u8a08\u7b97 \uff1a     <code>handle_data()</code> \u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u90fd\u6703\u88ab\u547c\u53eb\uff0c\u61c9\u76e1\u91cf\u4fdd\u6301\u5176\u8f15\u91cf\u5316\u3002\u5c07\u5927\u898f\u6a21\u7684\u6578\u64da\u8655\u7406\u548c\u56e0\u5b50\u8a08\u7b97\u79fb\u81f3 Pipeline \u4e2d\uff0c\u6216\u4f7f\u7528 <code>before_trading_start()</code> \u9032\u884c\u76e4\u524d\u4e00\u6b21\u6027\u8a08\u7b97\uff0c\u53ef\u4ee5\u986f\u8457\u63d0\u5347\u56de\u6e2c\u901f\u5ea6\u3002</p> </li> <li> <p>\u4f7f\u7528 Pipeline \u800c\u975e for-loop \u9032\u884c\u5927\u898f\u6a21\u56e0\u5b50\u8a08\u7b97 \uff1a     Pipeline \u5c08\u70ba\u8655\u7406\u591a\u8cc7\u7522\u6642\u9593\u5e8f\u5217\u6578\u64da\u800c\u512a\u5316\uff0c\u4f7f\u7528 C \u8a9e\u8a00\u5e95\u5c64\u5be6\u73fe\uff0c\u6bd4 Python \u7684 for-loop \u6548\u7387\u9ad8\u51fa\u6578\u500b\u91cf\u7d1a\u3002\u5c0d\u65bc\u6d89\u53ca\u5927\u91cf\u80a1\u7968\u6216\u8907\u96dc\u56e0\u5b50\u7684\u8a08\u7b97\uff0c\u52d9\u5fc5\u4f7f\u7528 Pipeline\u3002</p> </li> <li> <p>\u5408\u7406\u8a2d\u5b9a\u56de\u6e2c\u983b\u7387\u8207\u8cc7\u6599\u91cf \uff1a     \u904e\u9ad8\u7684\u56de\u6e2c\u983b\u7387\uff08\u4f8b\u5982\u5206\u9418\u983b\u6578\u64da\uff09\u548c\u904e\u9577\u7684\u6b77\u53f2\u5340\u9593\u6703\u5927\u5e45\u589e\u52a0\u56de\u6e2c\u6642\u9593\u548c\u8a18\u61b6\u9ad4\u6d88\u8017\u3002\u6839\u64da\u7b56\u7565\u7684\u7279\u6027\u9078\u64c7\u6700\u5408\u9069\u7684\u6578\u64da\u983b\u7387\uff0c\u4e26\u53ea\u8f09\u5165\u5fc5\u8981\u7684\u6b77\u53f2\u8cc7\u6599\u3002</p> </li> </ul>"},{"location":"concepts/zipline-engine/#_3","title":"\u7e3d\u7d50","text":"<p>Zipline \u5f15\u64ce\u662f TQuant Lab \u91cf\u5316\u4ea4\u6613\u7b56\u7565\u7684\u57fa\u77f3\u3002\u900f\u904e\u5176 \u4e8b\u4ef6\u9a45\u52d5\u6a21\u578b \u3001\u6e05\u6670\u7684\u751f\u547d\u9031\u671f\u51fd\u6578\u3001\u5f37\u5927\u7684 <code>context</code> \u7269\u4ef6\u4ee5\u53ca\u9748\u6d3b\u7684\u8cc7\u6599\u8207\u4ea4\u6613 API\uff0c\u7814\u7a76\u8005\u53ef\u4ee5\u9ad8\u6548\u5730\u958b\u767c\u3001\u6e2c\u8a66\u548c\u512a\u5316\u8907\u96dc\u7684\u4ea4\u6613\u7b56\u7565\uff0c\u5f9e\u800c\u5c07\u91cf\u5316\u601d\u60f3\u8f49\u5316\u70ba\u5be6\u969b\u7684\u6295\u8cc7\u6210\u679c\u3002</p>"},{"location":"futures/","title":"\u671f\u8ca8\u5c08\u5340","text":"<p>Info</p> <p>\u672c\u5c08\u5340\u6db5\u84cb TQuant Lab \u671f\u8ca8\u56de\u6e2c\u76f8\u95dc\u7684\u6240\u6709\u5167\u5bb9\uff0c\u5f9e\u8cc7\u6599\u6e96\u5099\u5230\u7b56\u7565\u5be6\u4f5c\uff0c\u5e6b\u52a9\u60a8\u5feb\u901f\u4e0a\u624b\u671f\u8ca8\u91cf\u5316\u4ea4\u6613\u3002</p>"},{"location":"futures/#1","title":"1. \u5c08\u5340\u5c0e\u89bd","text":"<ul> <li> <p> \u5feb\u901f\u5165\u9580</p> <p>\u5efa\u7acb\u60a8\u7684\u7b2c\u4e00\u500b\u671f\u8ca8\u7b56\u7565\uff0c\u5f9e\u96f6\u958b\u59cb\u5b78\u7fd2\u671f\u8ca8\u56de\u6e2c\u7684\u5b8c\u6574\u6d41\u7a0b\u3002</p> <p> \u958b\u59cb\u5b78\u7fd2</p> </li> <li> <p> \u8cc7\u6599\u6e96\u5099</p> <p>\u5b78\u7fd2\u5982\u4f55 Ingest \u671f\u8ca8\u50f9\u91cf\u8cc7\u6599\u5230 TQuant Lab \u672c\u5730\u8cc7\u6599\u5eab\u3002</p> <p> \u8cc7\u6599\u6307\u5357</p> </li> <li> <p> \u624b\u7e8c\u8cbb\u8207\u6ed1\u50f9</p> <p>\u4e86\u89e3\u671f\u8ca8\u5c08\u7528\u7684\u624b\u7e8c\u8cbb\u8207\u6ed1\u50f9\u6a21\u578b\u8a2d\u5b9a\u65b9\u5f0f\u3002</p> <p> \u6210\u672c\u8a2d\u5b9a</p> </li> <li> <p> \u8f49\u5009\u6a5f\u5236</p> <p>\u6df1\u5165\u7406\u89e3\u671f\u8ca8\u5408\u7d04\u5230\u671f\u8207\u8f49\u5009\u7684\u8655\u7406\u908f\u8f2f\u3002</p> <p> \u8f49\u5009\u8aaa\u660e</p> </li> </ul>"},{"location":"futures/#2-vs","title":"2. \u671f\u8ca8 vs \u73fe\u8ca8\uff1a\u4e3b\u8981\u5dee\u7570","text":"\u7279\u6027 \u73fe\u8ca8 (Equity) \u671f\u8ca8 (Futures) \u8cc7\u6599\u5305 (Bundle) tquant tquant_future \u8cc7\u7522\u7269\u4ef6 symbol('2330') continuous_future('TX', ...) \u5408\u7d04\u5230\u671f \u7121 \u6709\uff0c\u9700\u8655\u7406\u8f49\u5009 \u4fdd\u8b49\u91d1 \u7121 \u6709\uff0c\u5f71\u97ff\u69d3\u687f \u624b\u7e8c\u8cbb\u985e\u578b PerShare / PerDollar PerContract"},{"location":"futures/#3","title":"3. \u652f\u63f4\u7684\u671f\u8ca8\u5546\u54c1","text":"<p>TQuant Lab \u76ee\u524d\u652f\u63f4\u4ee5\u4e0b\u53f0\u7063\u671f\u8ca8\u5546\u54c1\uff1a</p> \u4ee3\u78bc \u540d\u7a31 \u8aaa\u660e TX \u53f0\u6307\u671f \u53f0\u7063\u52a0\u6b0a\u6307\u6578\u671f\u8ca8 MTX \u5c0f\u53f0\u6307 \u5c0f\u578b\u53f0\u6307\u671f\u8ca8 CDF \u53f0\u7a4d\u96fb\u671f \u53f0\u7a4d\u96fb\u500b\u80a1\u671f\u8ca8 DVF \u806f\u767c\u79d1\u671f \u806f\u767c\u79d1\u500b\u80a1\u671f\u8ca8 <p>\u6ce8\u610f\uff1a\u500b\u80a1\u671f\u8ca8\u4ee3\u78bc\u9700\u52a0\u4e0a F \u5f8c\u7db4\uff0c\u4f8b\u5982\u53f0\u7a4d\u96fb\u500b\u80a1\u671f\u70ba CDF\u3002</p>"},{"location":"futures/#4","title":"4. \u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>Zipline \u5f15\u64ce\u6838\u5fc3\u6a5f\u5236</li> <li>\u5982\u4f55\u57f7\u884c\u4e00\u500b\u57fa\u672c\u7684\u56de\u6e2c</li> <li>\u5982\u4f55\u8a2d\u5b9a\u624b\u7e8c\u8cbb\u6a21\u578b</li> </ul>"},{"location":"futures/first-futures-strategy/","title":"\u5efa\u7acb\u4f60\u7684\u7b2c\u4e00\u500b\u671f\u8ca8\u7b56\u7565","text":"<p>Info</p> <p>\u672c\u6559\u5b78\u6587\u4ef6\u5f15\u5c0e\u60a8\u4f7f\u7528 TQuant Lab\uff0c\u5f9e\u96f6\u958b\u59cb\u5efa\u7acb\u4e00\u500b\u5b8c\u6574\u4e14\u53ef\u57f7\u884c\u7684\u671f\u8ca8\u56de\u6e2c\u7b56\u7565\u3002\u6211\u5011\u5c07\u4ee5\u4e00\u500b\u7c21\u55ae\u7684\u300c\u5747\u7dda\u4ea4\u53c9\u7b56\u7565\u300d\u70ba\u7bc4\u4f8b\uff0c\u8aaa\u660e\u4e00\u500b\u671f\u8ca8\u7b56\u7565\u7684\u5b8c\u6574\u751f\u547d\u9031\u671f\u3002</p>"},{"location":"futures/first-futures-strategy/#1","title":"1. \u8cc7\u6599\u6e96\u5099","text":"<p>\u8a2d\u5b9a TEJ API \u91d1\u9470\uff0c\u4e0b\u8f09\u671f\u8ca8\u5546\u54c1\u8cc7\u6599\u81f3\u672c\u5730\u74b0\u5883\u3002</p>"},{"location":"futures/first-futures-strategy/#2","title":"2. \u7b56\u7565\u521d\u59cb\u5316","text":"<p>\u8a2d\u5b9a\u9023\u7e8c\u5408\u7d04\u3001\u4ea4\u6613\u6210\u672c\u3001\u7e3e\u6548\u57fa\u6e96\u8207\u6392\u7a0b\u51fd\u6578\u3002</p>"},{"location":"futures/first-futures-strategy/#3","title":"3. \u4ea4\u6613\u908f\u8f2f","text":"<p>\u5be6\u4f5c\u5747\u7dda\u4ea4\u53c9\u7b56\u7565\u7684\u8cb7\u8ce3\u4fe1\u865f\u8207\u4e0b\u55ae\u908f\u8f2f\u3002</p>"},{"location":"futures/first-futures-strategy/#4","title":"4. \u8f49\u5009\u8655\u7406","text":"<p>\u8655\u7406\u671f\u8ca8\u5408\u7d04\u5230\u671f\u524d\u7684\u81ea\u52d5\u8f49\u5009\u6a5f\u5236\u3002</p>"},{"location":"futures/first-futures-strategy/#1-data-preparation","title":"1. \u8cc7\u6599\u6e96\u5099 (Data Preparation)","text":"<p>\u5728\u9032\u884c\u4efb\u4f55\u56de\u6e2c\u4e4b\u524d\uff0c\u6211\u5011\u9700\u8981\u5148\u5c07\u5e02\u5834\u8cc7\u6599\u4e0b\u8f09\u5230\u672c\u5730\u74b0\u5883\u3002Zipline \u4f7f\u7528 <code>ingest</code> \u547d\u4ee4\u4f86\u5b8c\u6210\u9019\u500b\u6b65\u9a5f\u3002</p> <p>\u4ee5\u4e0b\u7a0b\u5f0f\u78bc\u6703\u8a2d\u5b9a\u60a8\u7684 TEJ API \u91d1\u9470\uff0c\u4e26\u6307\u5b9a\u8981\u4e0b\u8f09\u7684\u671f\u8ca8\u5546\u54c1\uff08\u6b64\u8655\u70ba\u53f0\u6307\u671f <code>TX</code>\uff09\u8207\u5c0d\u61c9\u7684\u6307\u6578\uff08<code>IR0001</code> \u4f5c\u70ba\u5927\u76e4\u6307\u6a19\uff09\uff0c\u7136\u5f8c\u57f7\u884c <code>ingest</code>\u3002</p> <pre><code>import os\n\n# \u586b\u5165\u60a8\u7684 TEJ API Key\nos.environ['TEJAPI_KEY'] = 'YOUR_KEY'\nos.environ['TEJAPI_BASE'] = 'https://api.tej.com.tw'\n\n# \u8a2d\u5b9a\u8981\u4e0b\u8f09\u7684\u671f\u8ca8\u8207\u5c0d\u61c9\u7684\u6307\u6578/\u80a1\u7968\nos.environ['future'] = 'TX'\nos.environ['ticker'] = 'IR0001'\n\n# \u8a2d\u5b9a\u4e0b\u8f09\u7684\u8d77\u8a16\u65e5\u671f\nos.environ['mdate'] = '20100101 20250930'\n\n# \u57f7\u884c ingest \u547d\u4ee4 (\u9996\u6b21\u57f7\u884c\u6216\u9700\u66f4\u65b0\u6578\u64da\u6642\u53d6\u6d88\u8a3b\u89e3)\n# !zipline ingest -b tquant_future\n</code></pre> <p>Note</p> <p><code>ingest</code> \u547d\u4ee4\u53ea\u9700\u8981\u5728\u7b2c\u4e00\u6b21\u57f7\u884c\uff0c\u6216\u7576\u60a8\u9700\u8981\u66f4\u65b0\u672c\u5730\u8cc7\u6599\u6642\u57f7\u884c\u3002\u5728\u5e73\u5e38\u7684\u7b56\u7565\u958b\u767c\u4e2d\uff0c\u53ef\u4ee5\u5c07\u5176\u8a3b\u89e3\u6389\u4ee5\u7bc0\u7701\u6642\u9593\u3002</p>"},{"location":"futures/first-futures-strategy/#2-","title":"2. \u7b56\u7565\u67b6\u69cb - \u521d\u59cb\u5316\u8207\u6392\u7a0b","text":"<p><code>initialize</code> \u51fd\u6578\u662f Zipline \u7b56\u7565\u7684\u8d77\u9ede\uff0c\u5b83\u5728\u6574\u500b\u56de\u6e2c\u958b\u59cb\u6642\u53ea\u6703\u88ab\u547c\u53eb\u4e00\u6b21\u3002\u6240\u6709\u95dc\u65bc\u7b56\u7565\u7684\u57fa\u790e\u8a2d\u5b9a\u90fd\u5728\u9019\u88e1\u5b8c\u6210\u3002</p> <ul> <li><code>continuous_future(...)</code>: \u5efa\u7acb\u4e00\u500b\u9023\u7e8c\u5408\u7d04\u7269\u4ef6\uff0c\u8b93 Zipline \u81ea\u52d5\u8655\u7406\u63db\u6708\uff0c\u65b9\u4fbf\u6211\u5011\u5c0d\u4e00\u500b\u9023\u7e8c\u7684\u50f9\u683c\u5e8f\u5217\u9032\u884c\u5206\u6790\u3002</li> <li><code>set_commission()</code> / <code>set_slippage()</code>: \u8a2d\u5b9a\u4ea4\u6613\u6210\u672c\uff0c\u5305\u542b\u624b\u7e8c\u8cbb\u8207\u6ed1\u50f9\u3002</li> <li><code>set_benchmark()</code>: \u8a2d\u5b9a\u7e3e\u6548\u6bd4\u8f03\u7684\u57fa\u6e96\uff0c\u901a\u5e38\u70ba\u5927\u76e4\u6307\u6578\u3002</li> <li><code>schedule_function(...)</code>: Zipline \u7684\u6392\u7a0b\u5668\uff0c\u7528\u4f86\u5b89\u6392\u5728\u56de\u6e2c\u7684\u7279\u5b9a\u6642\u9593\u9ede\uff08\u5982\u6bcf\u65e5\u958b\u76e4\u3001\u6536\u76e4\uff09\u57f7\u884c\u6307\u5b9a\u7684\u51fd\u6578\u3002</li> </ul> <pre><code>from zipline.api import (\n    continuous_future, schedule_function, date_rules, time_rules,\n    set_commission, set_slippage, set_benchmark, symbol\n)\nfrom zipline.finance import commission, slippage\n\ndef initialize(context):\n    # --- 1. \u8a2d\u5b9a\u8981\u4ea4\u6613\u7684\u8cc7\u7522 ---\n    # \u5efa\u7acb\u53f0\u6307\u671f\u7684\u9023\u7e8c\u8fd1\u6708\u5408\u7d04\n    context.future = continuous_future('TX', offset=0, roll='calendar', adjustment='add')\n\n    # --- 2. \u8a2d\u5b9a\u4ea4\u6613\u6210\u672c ---\n    set_commission(futures=commission.PerContract(cost=200, exchange_fee=0))\n    set_slippage(futures=slippage.FixedSlippage(spread=6))\n\n    # --- 3. \u8a2d\u5b9a\u7b56\u7565\u53c3\u6578\u8207\u7e3e\u6548\u57fa\u6e96 ---\n    context.ma_period = 20  # \u8a2d\u5b9a\u5747\u7dda\u8a08\u7b97\u9031\u671f\n    set_benchmark(symbol('IR0001'))\n\n    # --- 4. \u8a2d\u5b9a\u6392\u7a0b ---\n    # \u6bcf\u65e5\u958b\u76e4\u5f8c 30 \u5206\u9418\uff0c\u57f7\u884c\u4e3b\u8981\u7684\u4ea4\u6613\u908f\u8f2f\n    schedule_function(daily_trade, date_rules.every_day(), time_rules.market_open(minutes=30))\n    # \u6bcf\u65e5\u6536\u76e4\u6642\uff0c\u6aa2\u67e5\u662f\u5426\u9700\u8981\u8f49\u5009\n    schedule_function(roll_futures, date_rules.every_day(), time_rules.market_close())\n</code></pre>"},{"location":"futures/first-futures-strategy/#3_1","title":"3. \u64b0\u5beb\u4ea4\u6613\u908f\u8f2f","text":"<p><code>daily_trade</code> \u51fd\u6578\u662f\u6211\u5011\u7b56\u7565\u7684\u6838\u5fc3\uff0c\u5b83\u6703\u6839\u64da\u6211\u5011\u5728 <code>initialize</code> \u4e2d\u8a2d\u5b9a\u7684\u6392\u7a0b\u88ab\u6bcf\u65e5\u547c\u53eb\u3002</p> <p>\u9019\u500b\u7bc4\u4f8b\u7b56\u7565\u7684\u908f\u8f2f\u5f88\u7c21\u55ae\uff1a</p> <ol> <li>\u4f7f\u7528 <code>data.history()</code> \u7372\u53d6\u904e\u53bb\u4e00\u6bb5\u6642\u9593\u7684\u6b77\u53f2\u50f9\u683c\u3002</li> <li>\u8a08\u7b97\u77ed\u671f\uff0810\u65e5\uff09\u8207\u9577\u671f\uff0820\u65e5\uff09\u7684\u79fb\u52d5\u5e73\u5747\u7dda (MA)\u3002</li> <li>\u7576\u77ed\u671f\u5747\u7dda\u7531\u4e0b\u5f80\u4e0a\u7a7f\u8d8a\u9577\u671f\u5747\u7dda\u6642\uff08\u9ec3\u91d1\u4ea4\u53c9\uff09\uff0c\u5efa\u7acb\u591a\u55ae\u3002</li> <li>\u7576\u77ed\u671f\u5747\u7dda\u7531\u4e0a\u5f80\u4e0b\u7a7f\u8d8a\u9577\u671f\u5747\u7dda\u6642\uff08\u6b7b\u4ea1\u4ea4\u53c9\uff09\uff0c\u5e73\u5009\u3002</li> <li>\u4f7f\u7528 <code>order_target()</code> \u51fd\u6578\u4f86\u4e0b\u55ae\uff0c\u5b83\u6703\u81ea\u52d5\u8a08\u7b97\u9700\u8981\u8cb7\u8ce3\u7684\u53e3\u6578\u4ee5\u9054\u5230\u6211\u5011\u7684\u76ee\u6a19\u90e8\u4f4d\u3002</li> <li>\u4f7f\u7528 <code>record()</code> \u8a18\u9304\u6211\u5011\u60f3\u8981\u5728\u5716\u8868\u4e0a\u89c0\u5bdf\u7684\u6578\u503c\u3002</li> </ol> <pre><code>from zipline.api import order_target, record\n\ndef daily_trade(context, data):\n    # --- 1. \u7372\u53d6\u6b77\u53f2\u6578\u64da ---\n    hist = data.history(context.future, 'price', bar_count=context.ma_period + 5, frequency='1d')\n\n    # --- 2. \u8a08\u7b97\u6307\u6a19 ---\n    short_ma = hist.rolling(window=10).mean().iloc[-1]\n    long_ma = hist.rolling(window=context.ma_period).mean().iloc[-1]\n\n    # --- 3. \u7522\u751f\u4ea4\u6613\u4fe1\u865f ---\n    buy_signal = short_ma &gt; long_ma\n    sell_signal = short_ma &lt; long_ma\n\n    # --- 4. \u53d6\u5f97\u7576\u524d\u5408\u7d04\u8207\u90e8\u4f4d ---\n    # \u5fc5\u9808\u5148\u5f9e\u9023\u7e8c\u5408\u7d04\u7269\u4ef6\u4e2d\uff0c\u53d6\u5f97\u7576\u524d\u61c9\u8a72\u4ea4\u6613\u7684\u300c\u5177\u9ad4\u300d\u5408\u7d04\n    current_contract = data.current(context.future, 'contract')\n    # \u6aa2\u67e5\u76ee\u524d\u53f0\u6307\u671f\u7522\u54c1\u7684\u7e3d\u6301\u5009\u53e3\u6578\n    current_position = context.portfolio.positions.get(current_contract, None)\n    root_qty = current_position.amount if current_position else 0\n\n    # --- 5. \u57f7\u884c\u4e0b\u55ae\u908f\u8f2f ---\n    if buy_signal and root_qty == 0:\n        order_target(current_contract, 1)  # \u76ee\u6a19\u6301\u6709 1 \u53e3\u591a\u55ae\n    elif sell_signal and root_qty != 0:\n        order_target(current_contract, 0)  # \u5e73\u5009\n\n    # --- 6. \u8a18\u9304\u6578\u64da ---\n    record(price=hist.iloc[-1], short_ma=short_ma, long_ma=long_ma)\n</code></pre>"},{"location":"futures/first-futures-strategy/#4_1","title":"4. \u8655\u7406\u671f\u8ca8\u8f49\u5009","text":"<p>\u671f\u8ca8\u5408\u7d04\u6709\u5230\u671f\u65e5\u3002\u70ba\u4e86\u8b93\u7b56\u7565\u53ef\u4ee5\u9577\u671f\u904b\u884c\uff0c\u6211\u5011\u5fc5\u9808\u5728\u820a\u5408\u7d04\u5230\u671f\u524d\uff0c\u5c07\u90e8\u4f4d\u300c\u8f49\u79fb\u300d\u5230\u65b0\u7684\u5408\u7d04\u4e0a\uff0c\u9019\u500b\u904e\u7a0b\u7a31\u70ba\u300c\u8f49\u5009\u300d\u3002<code>roll_futures</code> \u51fd\u6578\u5c31\u662f\u5c08\u9580\u7528\u4f86\u8655\u7406\u9019\u4ef6\u4e8b\u3002</p> <p>\u5b83\u7684\u908f\u8f2f\u5982\u4e0b\uff1a</p> <ol> <li>\u6bcf\u65e5\u6536\u76e4\u6642\u6aa2\u67e5\u76ee\u524d\u6301\u6709\u7684\u6240\u6709\u671f\u8ca8\u90e8\u4f4d\u3002</li> <li>\u8a08\u7b97\u8a72\u5408\u7d04\u8ddd\u96e2\u81ea\u52d5\u5e73\u5009\u65e5 (<code>auto_close_date</code>) \u9084\u6709\u5e7e\u5929\u3002</li> <li>\u5982\u679c\u5373\u5c07\u5230\u671f\uff08\u4f8b\u5982\uff0c5\u5929\u5167\uff09\uff0c\u5c31\u57f7\u884c\u8f49\u5009\uff1a<ul> <li>\u53d6\u6d88\u6240\u6709\u639b\u5728\u820a\u5408\u7d04\u4e0a\u7684\u8a02\u55ae\u3002</li> <li>\u5c07\u820a\u5408\u7d04\u7684\u90e8\u4f4d\u5e73\u5009 (<code>order_target(old_contract, 0)</code>)\u3002</li> <li>\u5728 <code>continuous_future</code> \u6307\u5411\u7684\u65b0\u5408\u7d04\u4e0a\uff0c\u5efa\u7acb\u76f8\u540c\u6578\u91cf\u7684\u90e8\u4f4d (<code>order_target(new_contract, amount)</code>)\u3002</li> </ul> </li> </ol> <pre><code>from zipline.api import get_open_orders, cancel_order\n\ndef roll_futures(context, data):\n    for asset, pos in context.portfolio.positions.items():\n        # \u5ffd\u7565\u975e\u671f\u8ca8\u8cc7\u7522\u6216\u7a7a\u90e8\u4f4d\n        if pos.amount == 0 or getattr(asset, 'auto_close_date', None) is None:\n            continue\n\n        # \u8a08\u7b97\u8ddd\u96e2\u5230\u671f\u65e5\u5929\u6578\n        days_to_auto_close = (asset.auto_close_date.date() - data.current_session.date()).days\n        if days_to_auto_close &gt; 5:\n            continue\n\n        # \u53d6\u5f97\u65b0\u7684\u76ee\u6a19\u5408\u7d04\n        new_contract = data.current(context.future, \"contract\")\n        if new_contract == asset:\n            continue\n\n        # \u57f7\u884c\u8f49\u5009\n        # 1. \u53d6\u6d88\u820a\u5408\u7d04\u7684\u6240\u6709\u639b\u55ae\n        for o in get_open_orders(asset):\n            cancel_order(o.id)\n\n        print(f\"\u57f7\u884c\u8f49\u5009: \u5f9e {asset.symbol} \u5230 {new_contract.symbol}\")\n        # 2. \u5e73\u6389\u820a\u5009\u4f4d\n        order_target(asset, 0)\n        # 3. \u5efa\u7acb\u65b0\u5009\u4f4d\n        order_target(new_contract, pos.amount)\n</code></pre>"},{"location":"futures/first-futures-strategy/#5","title":"5. \u57f7\u884c\u56de\u6e2c","text":"<p>\u7576\u6240\u6709\u51fd\u6578\u90fd\u5b9a\u7fa9\u597d\u4e4b\u5f8c\uff0c\u6700\u5f8c\u4e00\u6b65\u5c31\u662f\u547c\u53eb <code>run_algorithm()</code> \u4f86\u555f\u52d5\u6574\u500b\u56de\u6e2c\u6d41\u7a0b\u3002</p> <p>\u60a8\u9700\u8981\u63d0\u4f9b\u56de\u6e2c\u7684\u8d77\u8a16\u65e5\u671f\u3001<code>initialize</code> \u51fd\u6578\u7684\u540d\u7a31\u3001\u521d\u59cb\u8cc7\u91d1\u3001\u8cc7\u6599\u96c6\u540d\u7a31 (<code>bundle</code>) \u7b49\u53c3\u6578\u3002\u56de\u6e2c\u7d50\u675f\u5f8c\uff0c\u5b83\u6703\u56de\u50b3\u4e00\u500b\u5305\u542b\u6240\u6709\u7e3e\u6548\u8207\u81ea\u5b9a\u7fa9\u8a18\u9304\u6578\u64da\u7684 <code>results</code> DataFrame\u3002</p> <pre><code>import pandas as pd\nfrom zipline import run_algorithm\nfrom zipline.utils.calendar_utils import get_calendar\n\nresults = run_algorithm(\n    start=pd.Timestamp('2020-01-01', tz='utc'),\n    end=pd.Timestamp('2024-09-30', tz='utc'),\n    initialize=initialize,\n    capital_base=1000000,\n    data_frequency='daily',\n    bundle='tquant_future',\n    trading_calendar=get_calendar('TEJ')\n)\n\n# \u60a8\u53ef\u4ee5\u63a5\u8457\u5206\u6790 results DataFrame\n# print(results.head())\n</code></pre>"},{"location":"futures/first-futures-strategy/#6","title":"6. \u4e0b\u4e00\u6b65","text":"<p>\u606d\u559c\uff01\u60a8\u5df2\u7d93\u5b8c\u6210\u4e86\u4e00\u500b\u5b8c\u6574\u7684\u671f\u8ca8\u7b56\u7565\u3002\u60a8\u53ef\u4ee5\uff1a</p> <ul> <li>\u8a66\u8457\u8abf\u6574\u5747\u7dda\u7684\u9031\u671f</li> <li>\u4fee\u6539\u4ea4\u6613\u4fe1\u865f\u7684\u908f\u8f2f</li> <li>\u66f4\u63db\u4e0d\u540c\u7684\u671f\u8ca8\u5546\u54c1</li> <li>\u4f7f\u7528 Pyfolio \u5206\u6790\u7b56\u7565\u7e3e\u6548</li> </ul>"},{"location":"futures/futures-cheat-sheet/","title":"Zipline \u671f\u8ca8\u7b56\u7565\u5099\u5fd8\u9304 (API Cheat Sheet)","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b TQuant Lab \u671f\u8ca8\u7b56\u7565\u958b\u767c\u7684 API \u5feb\u901f\u53c3\u8003\uff0c\u5305\u542b\u521d\u59cb\u5316\u3001\u6578\u64da\u7372\u53d6\u3001\u4ea4\u6613\u4e0b\u55ae\u3001\u90e8\u4f4d\u7ba1\u7406\u53ca\u56de\u6e2c\u57f7\u884c\u7b49\u5e38\u7528\u51fd\u6578\u3002</p> <p>\u9019\u662f\u4e00\u4efd\u5c08\u70ba TQuant Lab \u4e2d\u9032\u884c \u671f\u8ca8 \u7b56\u7565\u56de\u6e2c\u8a2d\u8a08\u7684 API \u5feb\u901f\u53c3\u8003\u5099\u5fd8\u9304\u3002</p>"},{"location":"futures/futures-cheat-sheet/#1-initialize","title":"1. \u521d\u59cb\u5316 (<code>initialize</code>)","text":"API \u51fd\u6578/\u5c6c\u6027 \u8aaa\u660e \u7bc4\u4f8b <code>continuous_future(...)</code> (\u6700\u91cd\u8981) \u5efa\u7acb\u4e00\u500b\u9023\u7e8c\u5408\u7d04\u7269\u4ef6\uff0c\u7528\u4ee5\u9032\u884c\u5206\u6790\u8207\u4ea4\u6613\u3002 <code>context.future = continuous_future('TX', offset=0)</code> <code>set_benchmark(asset)</code> \u8a2d\u5b9a\u56de\u6e2c\u7684\u7e3e\u6548\u6bd4\u8f03\u57fa\u6e96\u3002 <code>set_benchmark(symbol('IR0001'))</code> <code>set_commission(...)</code> \u8a2d\u5b9a\u4ea4\u6613\u624b\u7e8c\u8cbb\u6a21\u578b\uff0c\u671f\u8ca8\u901a\u5e38\u6309\u53e3\u8a08\u8cbb\u3002 <code>set_commission(futures=commission.PerContract(cost=200))</code> <code>set_slippage(...)</code> \u8a2d\u5b9a\u6ed1\u50f9\u6a21\u578b\uff0c\u671f\u8ca8\u5e38\u7528\u56fa\u5b9a\u9ede\u6578\u6ed1\u50f9\u3002 <code>set_slippage(futures=slippage.FixedSlippage(spread=6.0))</code> <code>schedule_function(...)</code> \u8a3b\u518a\u4e00\u500b\u6392\u7a0b\u51fd\u6578\u3002\u671f\u8ca8\u7b56\u7565\u901a\u5e38\u9700\u8981\u6392\u7a0b \u4ea4\u6613 \u8207 \u8f49\u5009 \u5169\u500b\u51fd\u6578\u3002 <code>schedule_function(daily_trade, date_rules.every_day())</code>"},{"location":"futures/futures-cheat-sheet/#2-data-access","title":"2. \u6578\u64da\u7372\u53d6 (Data Access)","text":"API \u51fd\u6578/\u5c6c\u6027 \u8aaa\u660e \u7bc4\u4f8b <code>data.current(cf, 'contract')</code> (\u6700\u91cd\u8981) \u5f9e\u9023\u7e8c\u5408\u7d04(<code>cf</code>)\u4e2d\uff0c\u53d6\u5f97\u7576\u524d\u53ef\u4ea4\u6613\u7684 \u5177\u9ad4\u5408\u7d04 \u7269\u4ef6\u3002 <code>contract = data.current(context.future, 'contract')</code> <code>data.history(cf, ...)</code> \u7372\u53d6\u9023\u7e8c\u5408\u7d04\u7684\u6b77\u53f2\u6578\u64da\u3002 <code>hist = data.history(context.future, 'price', 50, '1d')</code> <code>data.can_trade(contract)</code> \u6aa2\u67e5 \u5177\u9ad4\u5408\u7d04 \u5728\u7576\u524d\u6642\u9593\u9ede\u662f\u5426\u53ef\u4ea4\u6613\u3002 <code>if data.can_trade(contract): ...</code> <code>get_datetime()</code> \u53d6\u5f97\u76ee\u524d\u56de\u6e2c\u7684\u6642\u9593\u9ede (UTC)\u3002 <code>current_time = get_datetime()</code>"},{"location":"futures/futures-cheat-sheet/#3-trading-orders","title":"3. \u4ea4\u6613\u8207\u8a02\u55ae (Trading &amp; Orders)","text":"<p>\u6838\u5fc3\u89c0\u5ff5\uff1a\u6240\u6709\u4e0b\u55ae\u51fd\u6578\u7684 <code>asset</code> \u53c3\u6578\u90fd\u5fc5\u9808\u662f <code>data.current()</code> \u56de\u50b3\u7684**\u5177\u9ad4\u5408\u7d04**\uff0c\u800c\u975e <code>continuous_future</code> \u7269\u4ef6\u3002</p> API \u51fd\u6578/\u5c6c\u6027 \u8aaa\u660e \u7bc4\u4f8b <code>order_target(contract, amount)</code> \u4e0b\u55ae\u5c07 \u5177\u9ad4\u5408\u7d04 \u7684\u90e8\u4f4d\u8abf\u6574\u81f3\u76ee\u6a19 <code>amount</code> \u53e3\u6578\u3002 <code>order_target(contract, 1)</code> <code>order(contract, amount)</code> \u4e0b\u4e00\u5f35\u5e02\u50f9\u55ae\uff0c\u8cb7\u5165/\u8ce3\u51fa\u6307\u5b9a <code>amount</code> \u7684\u53e3\u6578\u3002 <code>order(contract, -1)</code> <code>get_order(order_id)</code> \u900f\u904e\u8a02\u55ae ID \u67e5\u8a62\u8a02\u55ae\u7269\u4ef6\u3002 <code>my_order = get_order(order_id)</code> <code>get_open_orders(contract)</code> \u53d6\u5f97\u6307\u5b9a \u5177\u9ad4\u5408\u7d04 \u4e0a\u6240\u6709\u672a\u6210\u4ea4\u7684\u639b\u55ae\u3002 <code>open_orders = get_open_orders(my_contract)</code> <code>cancel_order(order_id)</code> \u6839\u64da\u8a02\u55ae ID \u53d6\u6d88\u4e00\u7b46\u672a\u6210\u4ea4\u7684\u639b\u55ae\u3002 <code>cancel_order(my_order_id)</code>"},{"location":"futures/futures-cheat-sheet/#4-position-contract-attributes","title":"4. \u90e8\u4f4d\u8207\u5408\u7d04\u5c6c\u6027 (Position &amp; Contract Attributes)","text":"API \u51fd\u6578/\u5c6c\u6027 \u8aaa\u660e \u7bc4\u4f8b <code>context.portfolio.positions</code> (\u5c6c\u6027) \u4e00\u500b\u5b57\u5178\uff0c\u5305\u542b\u6240\u6709\u7576\u524d\u6301\u6709\u7684\u90e8\u4f4d\u3002 <code>for asset, pos in context.portfolio.positions.items(): ...</code> <code>position.amount</code> (\u5c6c\u6027) \u6301\u6709\u7684\u53e3\u6578\u3002\u591a\u55ae\u70ba\u6b63\uff0c\u7a7a\u55ae\u70ba\u8ca0\u3002 <code>contracts_held = position.amount</code> <code>asset.auto_close_date</code> (\u5c6c\u6027) (\u8f49\u5009\u95dc\u9375) \u5177\u9ad4\u5408\u7d04\u7684\u5230\u671f\u7d50\u7b97\u65e5\u3002 <code>days_left = (asset.auto_close_date - today).days</code> <code>asset.root_symbol</code> (\u5c6c\u6027) \u5177\u9ad4\u5408\u7d04\u7684\u6839\u4ee3\u78bc\u3002 <code>if asset.root_symbol == 'TX': ...</code> <code>asset.symbol</code> (\u5c6c\u6027) \u5177\u9ad4\u5408\u7d04\u7684\u5b8c\u6574\u4ee3\u78bc\u3002 <code>print(asset.symbol) # e.g., 'TXF2410'</code>"},{"location":"futures/futures-cheat-sheet/#5-execution-analysis","title":"5. \u57f7\u884c\u8207\u5206\u6790 (Execution &amp; Analysis)","text":"API \u51fd\u6578/\u5c6c\u6027 \u8aaa\u660e \u7bc4\u4f8b <code>run_algorithm(...)</code> \u6838\u5fc3\u57f7\u884c\u51fd\u6578 \uff0c\u555f\u52d5\u6574\u500b\u56de\u6e2c\u3002 <code>results = run_algorithm(...)</code> <code>record(**kwargs)</code> \u5728\u6bcf\u500b\u6642\u9593\u9ede\u8a18\u9304\u4e00\u500b\u6216\u591a\u500b\u8b8a\u6578\uff0c\u4ee5\u4fbf\u5f8c\u7e8c\u5206\u6790\u3002 <code>record(my_ma=ma_value, price=current_price)</code> <code>get_calendar(name)</code> \u53d6\u5f97\u4e00\u500b\u4ea4\u6613\u65e5\u66c6\u7269\u4ef6\u3002\u671f\u8ca8\u8207\u80a1\u7968\u5171\u7528 <code>TEJ</code> \u65e5\u66c6\u3002 <code>trading_calendar=get_calendar('TEJ')</code>"},{"location":"futures/futures-commission-slippage/","title":"\u671f\u8ca8\u624b\u7e8c\u8cbb\u8207\u6ed1\u50f9\u8a2d\u5b9a","text":"<p>Info</p> <p>\u672c\u6307\u5357\u8aaa\u660e\u5982\u4f55\u5728 TQuant Lab \u4e2d\u70ba\u671f\u8ca8\u7b56\u7565\u8a2d\u5b9a\u5408\u7406\u7684\u4ea4\u6613\u6210\u672c\uff0c\u5305\u542b\u624b\u7e8c\u8cbb (Commission) \u8207\u6ed1\u50f9 (Slippage) \u6a21\u578b\u3002</p>"},{"location":"futures/futures-commission-slippage/#1","title":"1. \u6982\u8ff0","text":"<p>\u5728\u9032\u884c\u671f\u8ca8\u56de\u6e2c\u6642\uff0c\u6b63\u78ba\u8a2d\u5b9a\u4ea4\u6613\u6210\u672c\u662f\u78ba\u4fdd\u56de\u6e2c\u7d50\u679c\u8cbc\u8fd1\u771f\u5be6\u4ea4\u6613\u7684\u95dc\u9375\u3002TQuant Lab \u63d0\u4f9b\u4e86\u5c08\u70ba\u671f\u8ca8\u8a2d\u8a08\u7684\u6210\u672c\u6a21\u578b\uff1a</p> <ul> <li>\u624b\u7e8c\u8cbb (Commission)\uff1a\u6bcf\u6b21\u4ea4\u6613\u6642\u652f\u4ed8\u7d66\u5238\u5546\u7684\u8cbb\u7528</li> <li>\u6ed1\u50f9 (Slippage)\uff1a\u5be6\u969b\u6210\u4ea4\u50f9\u683c\u8207\u9810\u671f\u50f9\u683c\u4e4b\u9593\u7684\u5dee\u7570</li> </ul>"},{"location":"futures/futures-commission-slippage/#2","title":"2. \u624b\u7e8c\u8cbb\u8a2d\u5b9a","text":""},{"location":"futures/futures-commission-slippage/#21-percontract","title":"2.1 PerContract \u6a21\u578b","text":"<p>\u671f\u8ca8\u624b\u7e8c\u8cbb\u901a\u5e38\u4ee5\u300c\u6bcf\u53e3\u300d\u8a08\u7b97\uff0c\u4f7f\u7528 PerContract \u6a21\u578b\uff1a</p> <pre><code>from zipline.api import set_commission\nfrom zipline.finance import commission\n\ndef initialize(context):\n    # \u8a2d\u5b9a\u671f\u8ca8\u624b\u7e8c\u8cbb\uff1a\u6bcf\u53e3 200 \u5143\n    set_commission(futures=commission.PerContract(cost=200, exchange_fee=0))\n</code></pre> <p>\u53c3\u6578\u8aaa\u660e\uff1a</p> \u53c3\u6578 \u8aaa\u660e \u7bc4\u4f8b cost \u6bcf\u53e3\u624b\u7e8c\u8cbb (\u65b0\u53f0\u5e63) 200 exchange_fee \u4ea4\u6613\u6240\u8cbb\u7528 0 <p>\u5be6\u52d9\u5efa\u8b70</p> <p>\u53f0\u6307\u671f\u4e00\u822c\u5238\u5546\u624b\u7e8c\u8cbb\u7d04\u70ba\u6bcf\u53e3 50~200 \u5143\uff0c\u5efa\u8b70\u6839\u64da\u60a8\u7684\u5be6\u969b\u8cbb\u7387\u8a2d\u5b9a\u3002</p>"},{"location":"futures/futures-commission-slippage/#3","title":"3. \u6ed1\u50f9\u8a2d\u5b9a","text":""},{"location":"futures/futures-commission-slippage/#31-fixedslippage","title":"3.1 FixedSlippage \u6a21\u578b","text":"<p>\u671f\u8ca8\u6ed1\u50f9\u4f7f\u7528 FixedSlippage \u6a21\u578b\uff0c\u4ee5\u56fa\u5b9a\u9ede\u6578\u8a08\u7b97\uff1a</p> <pre><code>from zipline.api import set_slippage\nfrom zipline.finance import slippage\n\ndef initialize(context):\n    # \u8a2d\u5b9a\u671f\u8ca8\u6ed1\u50f9\uff1a\u6bcf\u6b21\u6210\u4ea4\u6ed1\u50f9 6 \u9ede\n    set_slippage(futures=slippage.FixedSlippage(spread=6))\n</code></pre> <p>\u53c3\u6578\u8aaa\u660e\uff1a</p> \u53c3\u6578 \u8aaa\u660e \u7bc4\u4f8b spread \u8cb7\u8ce3\u50f9\u5dee (\u9ede\u6578) 6 <p>\u6ed1\u50f9\u5f71\u97ff</p> <p>\u4ee5\u53f0\u6307\u671f\u70ba\u4f8b\uff0c\u6bcf\u9ede\u50f9\u503c\u7d04 200 \u5143\u3002\u82e5\u8a2d\u5b9a <code>spread=6</code>\uff0c\u5247\u6bcf\u6b21\u6210\u4ea4\u6703\u7522\u751f\u7d04 6 \u00d7 200 = 1,200 \u5143\u7684\u6ed1\u50f9\u6210\u672c\u3002</p>"},{"location":"futures/futures-commission-slippage/#4","title":"4. \u5b8c\u6574\u7bc4\u4f8b","text":"<pre><code>from zipline.api import (\n    continuous_future, set_commission, set_slippage, set_benchmark, symbol\n)\nfrom zipline.finance import commission, slippage\n\ndef initialize(context):\n    # \u8a2d\u5b9a\u8981\u4ea4\u6613\u7684\u671f\u8ca8\n    context.future = continuous_future('TX', offset=0, roll='calendar', adjustment='add')\n\n    # \u8a2d\u5b9a\u624b\u7e8c\u8cbb\uff1a\u6bcf\u53e3 200 \u5143\n    set_commission(futures=commission.PerContract(cost=200, exchange_fee=0))\n\n    # \u8a2d\u5b9a\u6ed1\u50f9\uff1a\u6bcf\u6b21\u6210\u4ea4\u6ed1\u50f9 6 \u9ede\n    set_slippage(futures=slippage.FixedSlippage(spread=6))\n\n    # \u8a2d\u5b9a\u7e3e\u6548\u57fa\u6e96\n    set_benchmark(symbol('IR0001'))\n</code></pre>"},{"location":"futures/futures-commission-slippage/#5-vs","title":"5. \u73fe\u8ca8 vs \u671f\u8ca8\u6210\u672c\u6a21\u578b\u6bd4\u8f03","text":"\u7279\u6027 \u73fe\u8ca8 \u671f\u8ca8 \u624b\u7e8c\u8cbb\u6a21\u578b PerShare / PerDollar PerContract \u6ed1\u50f9\u6a21\u578b VolumeShareSlippage FixedSlippage \u8a08\u7b97\u57fa\u790e \u80a1\u6578/\u91d1\u984d \u53e3\u6578/\u9ede\u6578"},{"location":"futures/futures-commission-slippage/#6","title":"6. \u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>\u5efa\u7acb\u4f60\u7684\u7b2c\u4e00\u500b\u671f\u8ca8\u7b56\u7565</li> <li>\u5982\u4f55\u8a2d\u5b9a\u624b\u7e8c\u8cbb\u6a21\u578b</li> <li>\u5982\u4f55\u8a2d\u5b9a\u6ed1\u50f9\u6a21\u578b</li> </ul>"},{"location":"futures/futures-rollover/","title":"\u671f\u8ca8\u8f49\u5009\u6a5f\u5236","text":"<p>Info</p> <p>\u672c\u6307\u5357\u6df1\u5165\u8aaa\u660e\u671f\u8ca8\u5408\u7d04\u5230\u671f\u8207\u8f49\u5009\u7684\u8655\u7406\u908f\u8f2f\uff0c\u5e6b\u52a9\u60a8\u7406\u89e3\u5982\u4f55\u5728 TQuant Lab \u4e2d\u6b63\u78ba\u8655\u7406\u671f\u8ca8\u63db\u6708\u3002</p>"},{"location":"futures/futures-rollover/#1","title":"1. \u4ec0\u9ebc\u662f\u8f49\u5009\uff1f","text":"<p>\u671f\u8ca8\u5408\u7d04\u6709\u5230\u671f\u65e5\uff0c\u4e0d\u50cf\u80a1\u7968\u53ef\u4ee5\u7121\u9650\u671f\u6301\u6709\u3002\u7576\u5408\u7d04\u5373\u5c07\u5230\u671f\u6642\uff0c\u5982\u679c\u60a8\u60f3\u7e7c\u7e8c\u6301\u6709\u90e8\u4f4d\uff0c\u5c31\u5fc5\u9808\uff1a</p> <ol> <li>\u5e73\u5009\uff1a\u5c07\u5373\u5c07\u5230\u671f\u7684\u820a\u5408\u7d04\u5e73\u5009</li> <li>\u958b\u65b0\u5009\uff1a\u5728\u65b0\u7684\u5408\u7d04\u4e0a\u5efa\u7acb\u76f8\u540c\u7684\u90e8\u4f4d</li> </ol> <p>\u9019\u500b\u904e\u7a0b\u7a31\u70ba\u300c\u8f49\u5009\u300d(Roll Over) \u6216\u300c\u63db\u6708\u300d\u3002</p>"},{"location":"futures/futures-rollover/#2-continuous-future","title":"2. \u9023\u7e8c\u5408\u7d04 (Continuous Future)","text":"<p>TQuant Lab \u4f7f\u7528 <code>continuous_future</code> \u7269\u4ef6\u4f86\u7c21\u5316\u671f\u8ca8\u7684\u8655\u7406\uff1a</p> <pre><code>from zipline.api import continuous_future\n\ndef initialize(context):\n    # \u5efa\u7acb\u53f0\u6307\u671f\u7684\u9023\u7e8c\u8fd1\u6708\u5408\u7d04\n    context.future = continuous_future(\n        'TX',           # \u671f\u8ca8\u6839\u4ee3\u78bc\n        offset=0,       # 0 = \u8fd1\u6708\u5408\u7d04\n        roll='calendar', # \u63db\u6708\u898f\u5247\n        adjustment='add' # \u50f9\u683c\u8abf\u6574\u65b9\u5f0f\n    )\n</code></pre>"},{"location":"futures/futures-rollover/#21","title":"2.1 \u53c3\u6578\u8aaa\u660e","text":"\u53c3\u6578 \u8aaa\u660e \u53ef\u9078\u503c root_symbol \u671f\u8ca8\u6839\u4ee3\u78bc TX, MTX, CDF \u7b49 offset \u5408\u7d04\u6708\u4efd\u504f\u79fb 0 (\u8fd1\u6708), 1 (\u6b21\u6708), 2 (\u5b63\u6708)... roll \u63db\u6708\u6642\u6a5f calendar (\u5230\u671f\u524d), volume (\u6210\u4ea4\u91cf) adjustment \u50f9\u683c\u8abf\u6574 add (\u52a0\u6cd5), mul (\u4e58\u6cd5), None"},{"location":"futures/futures-rollover/#3","title":"3. \u8f49\u5009\u908f\u8f2f\u5be6\u4f5c","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u500b\u5b8c\u6574\u7684\u8f49\u5009\u51fd\u6578\u5be6\u4f5c\uff1a</p> <pre><code>from zipline.api import order_target, get_open_orders, cancel_order\n\ndef roll_futures(context, data):\n    \"\"\"\n    \u6bcf\u65e5\u6536\u76e4\u6642\u6aa2\u67e5\u662f\u5426\u9700\u8981\u8f49\u5009\n    \"\"\"\n    for asset, pos in context.portfolio.positions.items():\n        # \u5ffd\u7565\u975e\u671f\u8ca8\u8cc7\u7522\u6216\u7a7a\u90e8\u4f4d\n        if pos.amount == 0:\n            continue\n\n        # \u6aa2\u67e5\u662f\u5426\u70ba\u671f\u8ca8\u5408\u7d04\n        if not hasattr(asset, 'auto_close_date') or asset.auto_close_date is None:\n            continue\n\n        # \u8a08\u7b97\u8ddd\u96e2\u5230\u671f\u65e5\u5929\u6578\n        days_to_auto_close = (asset.auto_close_date.date() - data.current_session.date()).days\n\n        # \u5982\u679c\u9084\u6709\u8d85\u904e 5 \u5929\uff0c\u4e0d\u9700\u8981\u8f49\u5009\n        if days_to_auto_close &gt; 5:\n            continue\n\n        # \u53d6\u5f97\u65b0\u7684\u76ee\u6a19\u5408\u7d04\n        new_contract = data.current(context.future, \"contract\")\n\n        # \u5982\u679c\u65b0\u820a\u5408\u7d04\u76f8\u540c\uff0c\u4e0d\u9700\u8981\u8f49\u5009\n        if new_contract == asset:\n            continue\n\n        # === \u57f7\u884c\u8f49\u5009 ===\n        print(f\"\u57f7\u884c\u8f49\u5009: {asset.symbol} \u2192 {new_contract.symbol}\")\n\n        # 1. \u53d6\u6d88\u820a\u5408\u7d04\u7684\u6240\u6709\u639b\u55ae\n        for order in get_open_orders(asset):\n            cancel_order(order.id)\n\n        # 2. \u5e73\u6389\u820a\u5009\u4f4d\n        order_target(asset, 0)\n\n        # 3. \u5efa\u7acb\u65b0\u5009\u4f4d (\u4fdd\u6301\u76f8\u540c\u53e3\u6578)\n        order_target(new_contract, pos.amount)\n</code></pre>"},{"location":"futures/futures-rollover/#4","title":"4. \u6392\u7a0b\u8f49\u5009\u6aa2\u67e5","text":"<p>\u5728 <code>initialize</code> \u4e2d\u8a2d\u5b9a\u6392\u7a0b\uff0c\u6bcf\u65e5\u6536\u76e4\u6642\u57f7\u884c\u8f49\u5009\u6aa2\u67e5\uff1a</p> <pre><code>from zipline.api import schedule_function, date_rules, time_rules\n\ndef initialize(context):\n    context.future = continuous_future('TX', offset=0, roll='calendar', adjustment='add')\n\n    # \u6bcf\u65e5\u6536\u76e4\u6642\u6aa2\u67e5\u662f\u5426\u9700\u8981\u8f49\u5009\n    schedule_function(\n        roll_futures,\n        date_rules.every_day(),\n        time_rules.market_close()\n    )\n</code></pre>"},{"location":"futures/futures-rollover/#5","title":"5. \u8f49\u5009\u6642\u6a5f\u9078\u64c7","text":"\u7b56\u7565 \u8aaa\u660e \u512a\u9ede \u7f3a\u9ede \u63d0\u524d 5 \u5929 \u5230\u671f\u524d 5 \u5929\u8f49\u5009 \u907f\u514d\u6d41\u52d5\u6027\u554f\u984c \u53ef\u80fd\u6709\u50f9\u5dee\u640d\u5931 \u5230\u671f\u524d 1 \u5929 \u6700\u5f8c\u4e00\u523b\u8f49\u5009 \u6700\u5927\u5316\u6301\u5009\u6642\u9593 \u6d41\u52d5\u6027\u98a8\u96aa \u4f9d\u6210\u4ea4\u91cf \u65b0\u5408\u7d04\u6210\u4ea4\u91cf\u8d85\u904e\u820a\u5408\u7d04\u6642\u8f49\u5009 \u6d41\u52d5\u6027\u6700\u4f73 \u5be6\u4f5c\u8f03\u8907\u96dc <p>\u5efa\u8b70</p> <p>\u5c0d\u65bc\u5927\u591a\u6578\u7b56\u7565\uff0c\u5efa\u8b70\u5728\u5230\u671f\u524d 3~5 \u5929\u57f7\u884c\u8f49\u5009\uff0c\u4ee5\u78ba\u4fdd\u8db3\u5920\u7684\u6d41\u52d5\u6027\u3002</p>"},{"location":"futures/futures-rollover/#6","title":"6. \u5e38\u898b\u554f\u984c","text":""},{"location":"futures/futures-rollover/#q","title":"Q: \u70ba\u4ec0\u9ebc\u8981\u53d6\u6d88\u820a\u5408\u7d04\u7684\u639b\u55ae\uff1f","text":"<p>A: \u56e0\u70ba\u820a\u5408\u7d04\u5373\u5c07\u5230\u671f\uff0c\u4efb\u4f55\u672a\u6210\u4ea4\u7684\u639b\u55ae\u90fd\u6703\u5931\u6548\u3002\u5982\u679c\u4e0d\u53d6\u6d88\uff0c\u53ef\u80fd\u9020\u6210\u7b56\u7565\u908f\u8f2f\u6df7\u4e82\u3002</p>"},{"location":"futures/futures-rollover/#q_1","title":"Q: \u8f49\u5009\u6703\u7522\u751f\u984d\u5916\u6210\u672c\u55ce\uff1f","text":"<p>A: \u662f\u7684\uff0c\u8f49\u5009\u7b49\u65bc\u57f7\u884c\u4e00\u6b21\u5e73\u5009\u548c\u4e00\u6b21\u958b\u5009\uff0c\u6703\u7522\u751f\u5169\u6b21\u624b\u7e8c\u8cbb\u548c\u6ed1\u50f9\u6210\u672c\u3002</p>"},{"location":"futures/futures-rollover/#q_2","title":"Q: \u5982\u4f55\u8655\u7406\u591a\u500b\u671f\u8ca8\u5546\u54c1\u7684\u8f49\u5009\uff1f","text":"<p>A: \u4e0a\u8ff0 <code>roll_futures</code> \u51fd\u6578\u6703\u904d\u6b77\u6240\u6709\u6301\u5009\uff0c\u81ea\u52d5\u8655\u7406\u6240\u6709\u671f\u8ca8\u5546\u54c1\u7684\u8f49\u5009\u3002</p>"},{"location":"futures/futures-rollover/#7","title":"7. \u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>\u5efa\u7acb\u4f60\u7684\u7b2c\u4e00\u500b\u671f\u8ca8\u7b56\u7565</li> <li>\u671f\u8ca8\u624b\u7e8c\u8cbb\u8207\u6ed1\u50f9\u8a2d\u5b9a</li> <li>Zipline \u5f15\u64ce\u6838\u5fc3\u6a5f\u5236</li> </ul>"},{"location":"futures/ingest-futures-pricing/","title":"\u5982\u4f55 Ingest \u671f\u8ca8\u50f9\u91cf\u8cc7\u6599","text":"<p>Info</p> <p>\u672c\u6307\u5357\u5c07\u5f15\u5c0e\u60a8\u5b8c\u6210\u5c07 TEJ \u671f\u8ca8\u8cc7\u6599\u4e0b\u8f09\u4e26\u6574\u5408\u81f3 TQuant Lab \u672c\u5730\u8cc7\u6599\u5eab\u7684\u5b8c\u6574\u6b65\u9a5f\u3002\u9019\u500b\u904e\u7a0b\u7a31\u70ba \"ingest\"\uff0c\u5b83\u662f\u9032\u884c\u4efb\u4f55\u56de\u6e2c\u524d\u6700\u57fa\u790e\u4e14\u5fc5\u8981\u7684\u7b2c\u4e00\u6b65\u3002</p>"},{"location":"futures/ingest-futures-pricing/#1-tej-api","title":"1. \u8a2d\u5b9a TEJ API \u91d1\u9470","text":"<p>\u9996\u5148\uff0c\u60a8\u5fc5\u9808\u63d0\u4f9b\u60a8\u7684 TEJ API \u91d1\u9470\uff0c\u4ee5\u4fbf TQuant Lab \u80fd\u5920\u5b58\u53d6 TEJ \u7684\u8cc7\u6599\u5eab\u3002\u6211\u5011\u900f\u904e\u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578\u4f86\u5b8c\u6210\u6b64\u64cd\u4f5c\u3002</p> <p>\u8acb\u5c07 <code>'YOUR_KEY'</code> \u66ff\u63db\u6210\u60a8\u81ea\u5df1\u7684\u91d1\u9470\u3002</p> <pre><code>import os\n\n# \u586b\u5165\u60a8\u7684 TEJ API Key\nos.environ['TEJAPI_KEY'] = 'YOUR_KEY'\nos.environ['TEJAPI_BASE'] = 'https://api.tej.com.tw'\n</code></pre>"},{"location":"futures/ingest-futures-pricing/#2","title":"2. \u8a2d\u5b9a\u8981\u4e0b\u8f09\u7684\u5546\u54c1\u8207\u671f\u9593","text":"<p>\u63a5\u8457\uff0c\u60a8\u9700\u8981\u8a2d\u5b9a\u8981\u4e0b\u8f09\u7684\u671f\u8ca8\u5546\u54c1\u4ee3\u78bc (<code>future</code>)\u3001\u76f8\u95dc\u7684\u73fe\u8ca8/\u6307\u6578\u4ee3\u78bc (<code>ticker</code>)\uff0c\u4ee5\u53ca\u8cc7\u6599\u7684\u8d77\u8a16\u65e5\u671f (<code>mdate</code>)\u3002</p> <ul> <li><code>future</code>: \u6307\u5b9a\u4e00\u500b\u6216\u591a\u500b\u671f\u8ca8\u6839\u4ee3\u78bc (root symbol)\uff0c\u4ee5\u7a7a\u683c\u5206\u9694\u3002\u4f8b\u5982\uff1a<code>'TX'</code> (\u53f0\u6307\u671f), <code>'MTX'</code> (\u5c0f\u53f0\u6307)\u3002</li> <li><code>ticker</code>: \u6307\u5b9a\u76f8\u95dc\u7684\u73fe\u8ca8\u6a19\u7684\uff0c\u901a\u5e38\u7528\u65bc\u8a2d\u5b9a\u56de\u6e2c\u7684\u6bd4\u8f03\u57fa\u6e96 (benchmark)\u3002\u4f8b\u5982\uff1a<code>'IR0001'</code> (\u767c\u884c\u91cf\u52a0\u6b0a\u80a1\u50f9\u5831\u916c\u6307\u6578)\u3002</li> <li><code>mdate</code>: \u8a2d\u5b9a\u8cc7\u6599\u7684\u8d77\u8a16\u65e5\u671f\uff0c\u683c\u5f0f\u70ba <code>'YYYYMMDD YYYYMMDD'</code>\u3002</li> </ul> <p>\u500b\u80a1\u671f\u8ca8\u4ee3\u78bc</p> <p>\u5047\u5982\u60f3\u8981\u4e0b\u8f09\u500b\u80a1\u671f\u8ca8\u9700\u8981\u52a0 <code>F</code>\uff0c\u5982\u53f0\u7a4d\u96fb\u500b\u80a1\u671f\u70ba <code>CDF</code>\uff0c\u806f\u767c\u79d1\u70ba <code>DVF</code>\u3002</p> <pre><code># \u8a2d\u5b9a\u8981\u4e0b\u8f09\u7684\u671f\u8ca8\u5546\u54c1\nos.environ['future'] = 'TX MTX'\n\n# \u8a2d\u5b9a\u76f8\u95dc\u7684\u6307\u6578/\u80a1\u7968 (\u7528\u65bc benchmark)\nos.environ['ticker'] = 'IR0001'\n\n# \u8a2d\u5b9a\u4e0b\u8f09\u7684\u8d77\u8a16\u65e5\u671f\nos.environ['mdate'] = '20100101 20250930'\n</code></pre>"},{"location":"futures/ingest-futures-pricing/#3-ingest","title":"3. \u57f7\u884c Ingest \u547d\u4ee4","text":"<p>\u8a2d\u5b9a\u597d\u6240\u6709\u74b0\u5883\u8b8a\u6578\u5f8c\uff0c\u6700\u5f8c\u4e00\u6b65\u5c31\u662f\u57f7\u884c <code>zipline ingest</code> \u547d\u4ee4\u3002\u9019\u500b\u547d\u4ee4\u6703\u8b80\u53d6\u60a8\u525b\u624d\u8a2d\u5b9a\u7684\u74b0\u5883\u8b8a\u6578\uff0c\u5f9e TEJ \u8cc7\u6599\u5eab\u4e0b\u8f09\u6307\u5b9a\u7684\u8cc7\u6599\uff0c\u4e26\u5c07\u5176\u8f49\u63db\u3001\u5132\u5b58\u81f3 Zipline \u7684\u672c\u5730\u8cc7\u6599\u5eab\u4e2d\u3002</p> <ul> <li><code>-b tquant_future</code>: \u9019\u500b\u53c3\u6578\u6307\u5b9a\u4e86\u8981\u5beb\u5165\u7684\u8cc7\u6599\u5305 (bundle) \u540d\u7a31\u3002\u5728 TQuant Lab \u4e2d\uff0c\u671f\u8ca8\u8cc7\u6599\u56fa\u5b9a\u4f7f\u7528 <code>tquant_future</code> \u9019\u500b bundle\u3002</li> </ul> <pre><code>!zipline ingest -b tquant_future\n</code></pre> <p>\u57f7\u884c\u5f8c\uff0c\u60a8\u6703\u770b\u5230\u7cfb\u7d71\u958b\u59cb\u4e0b\u8f09\u4e26\u8655\u7406\u8cc7\u6599\u3002\u9019\u500b\u904e\u7a0b\u53ef\u80fd\u9700\u8981\u6578\u5206\u9418\uff0c\u5177\u9ad4\u6642\u9593\u53d6\u6c7a\u65bc\u60a8\u8acb\u6c42\u7684\u8cc7\u6599\u91cf\u5927\u5c0f\u3002</p>"},{"location":"futures/ingest-futures-pricing/#4","title":"4. \u5b8c\u6574\u7bc4\u4f8b","text":"<p>\u60a8\u53ef\u4ee5\u76f4\u63a5\u8907\u88fd\u4e0b\u65b9\u7684\u5b8c\u6574\u7a0b\u5f0f\u78bc\u5340\u584a\uff0c\u8cbc\u5230\u60a8\u7684 Notebook \u4e2d\u57f7\u884c\uff0c\u5373\u53ef\u4e00\u6b21\u6027\u5b8c\u6210\u671f\u8ca8\u8cc7\u6599\u7684 Ingest\u3002</p> <pre><code>import os\n\n# 1. \u8a2d\u5b9a\u91d1\u9470\nos.environ['TEJAPI_KEY'] = 'YOUR_KEY'\nos.environ['TEJAPI_BASE'] = 'https://api.tej.com.tw'\n\n# 2. \u8a2d\u5b9a\u5546\u54c1\u8207\u671f\u9593\nos.environ['future'] = 'TX MTX'  # \u4e0b\u8f09\u53f0\u6307\u671f\u8207\u5c0f\u53f0\u6307\nos.environ['ticker'] = 'IR0001'  # \u4e0b\u8f09\u52a0\u6b0a\u6307\u6578\u4f5c\u70ba benchmark\nos.environ['mdate'] = '20100101 20250930'\n\n# 3. \u57f7\u884c Ingest\n# \u6ce8\u610f\uff1a\u6b64\u547d\u4ee4\u50c5\u5728\u9996\u6b21\u4f7f\u7528\u6216\u9700\u8981\u66f4\u65b0\u8cc7\u6599\u6642\u57f7\u884c\n!zipline ingest -b tquant_future\n</code></pre>"},{"location":"futures/ingest-futures-pricing/#5","title":"5. \u4f55\u6642\u9700\u8981\u91cd\u65b0\u57f7\u884c\uff1f","text":"\u60c5\u5883 \u8aaa\u660e \u9996\u6b21\u8a2d\u5b9a\u74b0\u5883 \u5fc5\u9808\u57f7\u884c\u4e00\u6b21\u4ee5\u5efa\u7acb\u672c\u5730\u8cc7\u6599\u5eab \u589e\u52a0\u65b0\u7684\u671f\u8ca8\u5546\u54c1 \u4fee\u6539 os.environ['future'] \u5f8c\uff0c\u9700\u91cd\u65b0\u57f7\u884c \u5ef6\u9577\u8cc7\u6599\u671f\u9593 \u4fee\u6539 os.environ['mdate'] \u5f8c\uff0c\u9700\u91cd\u65b0\u57f7\u884c \u66f4\u65b0\u81f3\u6700\u65b0\u8cc7\u6599 \u5c07\u7d50\u675f\u65e5\u671f\u8a2d\u70ba\u7576\u524d\u65e5\u671f\u4e26\u91cd\u65b0\u57f7\u884c"},{"location":"futures/ingest-futures-pricing/#6","title":"6. \u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>\u5efa\u7acb\u4f60\u7684\u7b2c\u4e00\u500b\u671f\u8ca8\u7b56\u7565</li> <li>\u5982\u4f55 Ingest \u80a1\u7968\u50f9\u91cf\u8cc7\u6599</li> </ul>"},{"location":"how-to/installation/","title":"TQuant Lab \u5b89\u88dd\u6559\u5b78","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b TQuant Lab \u7684\u8a73\u7d30\u5b89\u88dd\u8207\u74b0\u5883\u8a2d\u5b9a\u6307\u5357\uff0c\u5305\u62ec\u7cfb\u7d71\u8981\u6c42\u3001\u591a\u7a2e\u5b89\u88dd\u65b9\u5f0f\uff08Docker\u3001Anaconda\u3001pip\uff09\u4ee5\u53ca\u9a57\u8b49\u548c\u66f4\u65b0\u65b9\u6cd5\u3002</p>"},{"location":"how-to/installation/#1","title":"1. \u4f7f\u7528\u7684\u5957\u4ef6\u8207\u74b0\u5883","text":"<ul> <li>Main package \uff1aZipline</li> <li>\u652f\u63f4 Python \u7248\u672c \uff1aPython 3.8 ~ 3.11\uff08 \u5efa\u8b70\u4f7f\u7528 Python 3.11 \uff09</li> <li>\u652f\u63f4\u4f5c\u696d\u7cfb\u7d71 \uff1aWindows OS \u6216 macOS</li> <li>\u5efa\u8b70 Pandas \u7248\u672c \uff1a1.5.3 \u6216 2.0.0\uff08\u9ad8\u65bc 2.0.0 \u53ef\u80fd\u6703\u6709\u672a\u9810\u671f\u932f\u8aa4\uff09</li> <li>\u5efa\u8b70 Numpy \u7248\u672c \uff1a1.23.5\uff08\u9ad8\u65bc 1.23.5 \u53ef\u80fd\u6703\u6709\u672a\u9810\u671f\u932f\u8aa4\uff09</li> </ul>"},{"location":"how-to/installation/#2-a-b","title":"2. \u5b89\u88dd\u65b9\u5f0f\uff08\u64c7\u4e00\u5373\u53ef\uff0c \u63a8\u85a6\u4f7f\u7528\u65b9\u6cd5 A \u6216 B \uff09","text":""},{"location":"how-to/installation/#21-docker-zipline-tej","title":"2.1. \u900f\u904e Docker \u5b89\u88dd zipline-tej\uff08 \u63a8\u85a6 \uff09","text":""},{"location":"how-to/installation/#211","title":"2.1.1. \u5148\u6c7a\u689d\u4ef6","text":"<ul> <li>\u5df2\u5b89\u88dd Docker Desktop</li> </ul>"},{"location":"how-to/installation/#212-dockerfile","title":"2.1.2. \u65b9\u6cd5\u4e00\uff1a\u4f7f\u7528\u672c\u5730 Dockerfile \u5efa\u69cb","text":"<pre><code># \u4e0b\u8f09 tquant_jupyter\uff08\u9069\u7528 Jupyter \u4f7f\u7528\uff09\n# \u4e0b\u8f09 tquant_bash\uff08\u9069\u7528\u6392\u7a0b\u4f7f\u7528\uff09\n\n# \u9032\u5165 Dockerfile \u6240\u5728\u76ee\u9304\ncd &lt;path_to_dockerfile&gt;\n\n# \u5efa\u7acb\u6620\u50cf\u6a94\ndocker build -f tquant_jupyter . -t \"tquant:latest\"\n</code></pre>"},{"location":"how-to/installation/#213-docker-hub","title":"2.1.3. \u65b9\u6cd5\u4e8c\uff1a\u76f4\u63a5\u5f9e Docker Hub \u4e0b\u8f09\uff08 \u63a8\u85a6 \uff09","text":""},{"location":"how-to/installation/#2131-docker-hub","title":"2.1.3.1. \u5f9e Docker Hub \u4e0b\u8f09\u6620\u50cf\u6a94","text":"<p>\u65bc\u7d42\u7aef\u6a5f\u8f38\u5165\u4ee5\u4e0b\u6307\u4ee4\uff1a <pre><code>docker pull tej87681088/tquant:latest\n</code></pre></p>"},{"location":"how-to/installation/#2132-volume","title":"2.1.3.2. \u5efa\u7acb\u4e00\u500b volume \u4ee5\u50b3\u8f38\u8cc7\u6599","text":"<p>\u65bc\u7d42\u7aef\u6a5f\u8f38\u5165\u4ee5\u4e0b\u6307\u4ee4\uff1a <pre><code>docker volume create data\n</code></pre></p>"},{"location":"how-to/installation/#2133-image-container","title":"2.1.3.3. \u900f\u904e Image \u5efa\u7acb Container \u4e26\u555f\u52d5","text":"<p>\u82e5\u900f\u904e\u65b9\u6cd5\u4e00\uff08Dockerfile\uff09\u4e0b\u8f09\uff1a <pre><code>docker run -v data:/app -p 8888:8888 --name tquant tquant\n</code></pre> \u82e5\u900f\u904e\u65b9\u6cd5\u4e8c\uff08Docker Hub\uff09\u4e0b\u8f09\uff1a <pre><code>docker run -v data:/app -p 8888:8888 --name tquant tej87681088/tquant\n</code></pre> \u6b64\u547d\u4ee4\u5c07\uff1a</p> <ul> <li>\u555f\u52d5\u4e00\u500b container</li> <li>\u5c07 container \u5167\u7684 8888 \u57e0 \u6620\u5c04\u81f3\u672c\u6a5f\u7684 8888 \u57e0</li> <li>\u5229\u7528 volume data \u8207\u672c\u6a5f\u9032\u884c\u8cc7\u6599\u4ea4\u63db</li> </ul> <p>\u82e5\u4e0d\u5e0c\u671b\u4fdd\u7559 container\uff0c\u8acb\u52a0\u4e0a <code>--rm</code> \u53c3\u6578\uff1a <pre><code>docker run --rm -v data:/app -p 8888:8888 --name tquant tej87681088/tquant\n</code></pre></p>"},{"location":"how-to/installation/#2134-jupyter","title":"2.1.3.4. \u958b\u59cb\u4f7f\u7528 Jupyter","text":"<p>\u555f\u52d5\u5f8c\uff0c\u7d42\u7aef\u6a5f\u6703\u986f\u793a\u985e\u4f3c\u4e0b\u5217\u7db2\u5740\uff1a</p> <p><pre><code>http://127.0.0.1:8888/tree?token=XXXXXXXXXXXXXXXX\n</code></pre> \u8907\u88fd\u4e26\u8cbc\u4e0a\u81f3\u700f\u89bd\u5668\uff0c\u5373\u53ef\u958b\u555f Jupyter Notebook \u4f7f\u7528\u4ecb\u9762\u3002</p>"},{"location":"how-to/installation/#2135-appendix","title":"2.1.3.5. \u9644\u9304 (Appendix)","text":"<p>\u82e5\u60f3\u4f7f\u7528\u4e4b\u524d\u5df2\u5275\u5efa\u904e\u7684\u4f46\u95dc\u9589\u7684container\u64cd\u4f5c\uff0c\u53ef\u900f\u904e\u4ee5\u4e0b\u6307\u4ee4\u53d6\u5f97\u7db2\u5740 <pre><code># \u67e5\u770b\u6240\u6709 Container\uff08\u5305\u542b\u95dc\u9589\u7684\uff09\ndocker ps -a\n\n# \u555f\u52d5\u6307\u5b9a Container\ndocker start &lt;CONTAINER_ID&gt;\n\n# \u67e5\u770b Container \u7d42\u7aef\u6a5f\u6700\u8fd1\u7684\u8f38\u51fa\uff08\u542b Jupyter token\uff09\ndocker logs --tail 3 &lt;CONTAINER_ID&gt;\n</code></pre></p>"},{"location":"how-to/installation/#22-anaconda-prompt-zipline-tej","title":"2.2. \u900f\u904e Anaconda Prompt \u4e00\u9375\u5b89\u88dd zipline-tej\uff08 \u63a8\u85a6 \uff09","text":""},{"location":"how-to/installation/#221","title":"2.2.1. \u4e0b\u8f09\u5957\u4ef6\u8a2d\u5b9a\u6a94","text":"<p>\u8acb\u5148\u4e0b\u8f09\u4ee5\u4e0b\u5c0d\u61c9\u4f5c\u696d\u7cfb\u7d71\u7684\u5b89\u88dd\u8a2d\u5b9a\u6a94\uff08<code>.yml</code> \u6a94\u6848\uff09\uff1a</p> <ul> <li>Windows \u7248\u672c\uff1azipline-tej.yml</li> <li>Mac \u7248\u672c\uff1azipline-tej_mac.yml</li> </ul> <p>\u5efa\u8b70\u4f7f\u7528\u865b\u64ec\u74b0\u5883</p> <p>\u6211\u5011\u5f37\u70c8\u63a8\u85a6\u4f7f\u7528\u865b\u64ec\u74b0\u5883\uff0c\u4ee5\u4fdd\u6301\u6bcf\u500b\u5c08\u6848\u7684\u7368\u7acb\u6027\u4e26\u907f\u514d\u5957\u4ef6\u7248\u672c\u885d\u7a81\u3002</p>"},{"location":"how-to/installation/#222","title":"2.2.2. \u4f7f\u7528\u8005\u64cd\u4f5c\u8aaa\u660e","text":""},{"location":"how-to/installation/#windows","title":"Windows \u4f7f\u7528\u8005","text":"<pre><code># \u5c07\u4e0b\u8f09\u597d\u7684 zipline-tej.yml \u6a94\u6848\u653e\u5230\u4e0b\u8f09\u8cc7\u6599\u593e\u5f8c\uff0c\u958b\u555f Anaconda Prompt \u4e26\u57f7\u884c\uff1a\n\ncd C:\\Users\\&lt;your_username&gt;\\Downloads\n\n# \u900f\u904e yml \u6a94\u5275\u5efa\u865b\u64ec\u74b0\u5883\u4e26\u5b89\u88dd\u5957\u4ef6\nconda env create -f zipline-tej.yml\n\n# \u555f\u7528\u865b\u64ec\u74b0\u5883\nconda activate zipline-tej\n</code></pre>"},{"location":"how-to/installation/#macos","title":"macOS \u4f7f\u7528\u8005","text":"<p><pre><code># \u5c07\u4e0b\u8f09\u597d\u7684 zipline-tej_mac.yml \u6a94\u6848\u653e\u5230\u4e0b\u8f09\u8cc7\u6599\u593e\u5f8c\uff0c\u958b\u555f\u7d42\u7aef\u6a5f\u4e26\u57f7\u884c\uff1a\n\ncd /Users/&lt;your_username&gt;\\Downloads\n\n# \u900f\u904e yml \u6a94\u5275\u5efa\u865b\u64ec\u74b0\u5883\nconda env create -f zipline-tej_mac.yml\n\n# \u555f\u7528\u865b\u64ec\u74b0\u5883\nconda activate zipline-tej\n</code></pre> \u81f3\u6b64\uff0c\u4fbf\u53ef\u958b\u59cb\u4f7f\u7528zipline-tej\u3002</p>"},{"location":"how-to/installation/#23-pip-install-zipline-tej","title":"2.3. \u76f4\u63a5\u900f\u904e pip install \u5b89\u88dd zipline-tej","text":"<p>\u6b64\u65b9\u5f0f\u5b89\u88dd zipline-tej \u53ef\u80fd\u6703\u51fa\u73fe\u672a\u9810\u671f\u932f\u8aa4</p> <p>\u5efa\u8b70\u9032\u968e\u4f7f\u7528\u8005\u63a1\u7528\u3002</p>"},{"location":"how-to/installation/#3-virtual-environment","title":"3. \u5efa\u8b70\u4f7f\u7528\u865b\u64ec\u74b0\u5883 (Virtual Environment)","text":"<p>\u70ba\u907f\u514d\u5957\u4ef6\u7248\u672c\u885d\u7a81\uff0c\u5efa\u8b70\u5148\u5efa\u7acb\u865b\u64ec\u74b0\u5883\u5f8c\u518d\u5b89\u88dd zipline-tej\u3002\u4ee5\u4e0b\u63d0\u4f9b\u5169\u7a2e\u5efa\u7acb\u65b9\u5f0f\uff08\u64c7\u4e00\u5373\u53ef\uff09\uff1a</p>"},{"location":"how-to/installation/#31-anaconda","title":"3.1. \u65b9\u6cd5\u4e00\uff1a\u4f7f\u7528 Anaconda \u6307\u4ee4\uff08 \u63a8\u85a6 \uff09","text":"<p>\u65bc Anaconda Prompt \u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\uff1a</p> <pre><code># \u5efa\u7acb\u865b\u64ec\u74b0\u5883\uff08Python 3.11\uff09\n$ conda create -n &lt;env_name&gt; python=3.11\n\n# activate virtual env\n$ conda activate &lt;env_name&gt;\n\n# download packages\n$ pip install zipline-tej\n$ pip install notebook\n$ conda install -c conda-forge nb_conda_kernels\n</code></pre>"},{"location":"how-to/installation/#32-python","title":"3.2. \u65b9\u6cd5\u4e8c\uff1a\u900f\u904e Python \u539f\u751f\u6307\u4ee4","text":"<p>\u65bc CMD \u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\uff1a</p> <pre><code># create virtual env\n$ python -m venv venv\n\n# activate virtual env\n$ venv\\Scripts\\activate.bat\n# download packages\n$ pip install zipline-tej\n$ pip install notebook\n</code></pre>"},{"location":"how-to/installation/#4-google-colab-zipline-tej","title":"4. \u65bc Google Colab \u4f7f\u7528 zipline-tej","text":"<p>\u82e5\u60a8\u4f7f\u7528 google colab\uff0c\u53ef\u4ee5\u76f4\u63a5\u57f7\u884c\u4ee5\u4e0b\u7a0b\u5f0f\u78bc\uff0c\u4e0b\u8f09 zipline-tej <pre><code>!pip install zipline-tej\n</code></pre> \u82e5\u6709\u4f7f\u7528Pyfolio\uff0c\u53ef\u4ee5\u4e00\u4f75\u57f7\u884c\u4e0b\u5217\u6307\u4ee4\u907f\u514d\u51fa\u73fe Warning <pre><code>import matplotlib\nimport matplotlib.font_manager as fm\n!wget -O MicrosoftJhengHei.ttf https://github.com/a7532ariel/ms-web/raw/master/Microsoft-JhengHei.ttf\n!wget -O ArialUnicodeMS.ttf https://github.com/texttechnologylab/DHd2019BoA/raw/master/fonts/Arial%20Unicode%20MS.TTF\n\nfm.fontManager.addfont('MicrosoftJhengHei.ttf')\nmatplotlib.rc('font', family='Microsoft Jheng Hei')\n\nmatplotlib.font_manager.fontManager.addfont('ArialUnicodeMS.ttf')\nmatplotlib.rc('font', family='Arial Unicode MS')\n</code></pre></p>"},{"location":"how-to/installation/#5-tquant-lab","title":"5. \u6aa2\u67e5\u8207\u66f4\u65b0 TQuant Lab","text":""},{"location":"how-to/installation/#51","title":"5.1. \u6aa2\u67e5\u7248\u672c","text":"<p>\u5b89\u88dd\u5b8c\u6210\u5f8c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u6307\u4ee4\u6aa2\u67e5 <code>zipline-tej</code> \u7684\u7576\u524d\u7248\u672c\uff1a</p> <pre><code>!pip show zipline-tej\n</code></pre>"},{"location":"how-to/installation/#52","title":"5.2. \u66f4\u65b0\u81f3\u6700\u65b0\u7248\u672c","text":"<p>\u70ba\u78ba\u4fdd\u60a8\u4f7f\u7528\u7684\u662f\u6700\u65b0\u529f\u80fd\u8207\u4fee\u5fa9\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\u66f4\u65b0 <code>zipline-tej</code>\uff1a</p> <pre><code>!pip install --upgrade zipline-tej\n</code></pre> <ul> <li>\u5b98\u65b9\u7248\u672c\u8cc7\u8a0a \uff1a\u60a8\u53ef\u4ee5\u5728 PyPI - zipline-tej \u9801\u9762\u67e5\u770b\u6700\u65b0\u7684\u7248\u672c\u8cc7\u8a0a\u3002</li> </ul>"},{"location":"how-to/backtest/run-algorithm/","title":"\u5982\u4f55\u57f7\u884c\u4e00\u500b\u57fa\u672c\u7684\u56de\u6e2c","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b\u5982\u4f55\u4f7f\u7528 <code>zipline.run_algorithm()</code> \u51fd\u6578\u57f7\u884c\u57fa\u672c\u7b56\u7565\u56de\u6e2c\u7684\u6307\u5357\uff0c\u5305\u62ec Zipline \u56de\u6e2c\u51fd\u6578\u67b6\u69cb\u3001\u4e3b\u8981\u53c3\u6578\u8aaa\u660e\u548c\u5b8c\u6574\u7684\u7bc4\u4f8b\u3002</p> <p>\u5728 TQuant Lab \u4e2d\uff0c\u57f7\u884c\u7b56\u7565\u56de\u6e2c\u7684\u6838\u5fc3\u662f <code>zipline.run_algorithm()</code> \u51fd\u6578\u3002\u9019\u500b\u51fd\u6578\u6574\u5408\u4e86\u6578\u64da\u52a0\u8f09\u3001\u7b56\u7565\u908f\u8f2f\u57f7\u884c\u4ee5\u53ca\u7e3e\u6548\u8a08\u7b97\u7b49\u6240\u6709\u6b65\u9a5f\uff0c\u662f\u60a8\u5c07\u7b56\u7565\u60f3\u6cd5\u8f49\u5316\u70ba\u56de\u6e2c\u7d50\u679c\u7684\u4e3b\u8981\u5165\u53e3\u3002</p>"},{"location":"how-to/backtest/run-algorithm/#1-zipline","title":"1. Zipline \u7684\u56de\u6e2c\u51fd\u6578\u67b6\u69cb","text":"<p>\u4e00\u500b\u6a19\u6e96\u7684 Zipline/TQuant Lab \u7b56\u7565\u8173\u672c\u4e3b\u8981\u7531\u4e09\u500b\u51fd\u6578\u69cb\u6210\uff0c\u5b83\u5011\u5b9a\u7fa9\u4e86\u56de\u6e2c\u7684\u5b8c\u6574\u751f\u547d\u9031\u671f\uff1a</p> <ol> <li> <p><code>initialize(context)</code></p> <ul> <li>\u57f7\u884c\u6642\u6a5f\uff1a\u5728\u56de\u6e2c\u958b\u59cb\u6642\u50c5\u57f7\u884c \u4e00\u6b21\u3002</li> <li>\u4e3b\u8981\u7528\u9014\uff1a\u9032\u884c\u6240\u6709\u521d\u59cb\u8a2d\u5b9a\u3002\u9019\u5305\u62ec\u8a2d\u5b9a Benchmark\u3001\u8a2d\u5b9a\u624b\u7e8c\u8cbb/\u6ed1\u50f9\u6a21\u578b\u3001\u5b9a\u7fa9\u8981\u4ea4\u6613\u7684\u8cc7\u7522\uff0c\u4ee5\u53ca\u521d\u59cb\u5316\u60a8\u60f3\u5728\u6574\u500b\u7b56\u7565\u4e2d\u8ffd\u8e64\u7684\u8b8a\u6578\u3002</li> </ul> </li> <li> <p><code>handle_data(context, data)</code></p> <ul> <li>\u57f7\u884c\u6642\u6a5f\uff1a\u5728\u56de\u6e2c\u7684\u6bcf\u500b\u6642\u9593\u55ae\u4f4d\uff08\u4f8b\u5982\uff0c\u6bcf\u65e5\u6216\u6bcf\u5206\u9418\uff09\u90fd\u6703\u88ab\u547c\u53eb\u3002</li> <li>\u4e3b\u8981\u7528\u9014\uff1a\u9019\u662f\u7b56\u7565\u7684\u6838\u5fc3\u908f\u8f2f\u6240\u5728\u3002\u60a8\u6703\u5728\u9019\u500b\u51fd\u6578\u4e2d\u6aa2\u67e5\u5e02\u5834\u6578\u64da (<code>data</code>)\u3001\u5224\u65b7\u4ea4\u6613\u4fe1\u865f\u3001\u4e26\u4e0b\u9054\u8cb7\u8ce3\u8a02\u55ae\u3002<code>context</code> \u7269\u4ef6\u5247\u7528\u65bc\u5728\u4e0d\u540c\u6642\u9593\u9ede\u4e4b\u9593\u50b3\u905e\u72c0\u614b\u3002</li> </ul> </li> <li> <p><code>analyze(context, results)</code></p> <ul> <li>\u57f7\u884c\u6642\u6a5f\uff1a\u5728\u56de\u6e2c\u7d50\u675f\u5f8c\u50c5\u57f7\u884c \u4e00\u6b21\u3002</li> <li>\u4e3b\u8981\u7528\u9014\uff1a\u5c0d\u56de\u6e2c\u7d50\u679c\u9032\u884c\u5206\u6790\u8207\u8996\u89ba\u5316\u3002<code>results</code> \u53c3\u6578\u662f\u4e00\u500b\u5305\u542b\u4e86\u6bcf\u65e5\u7e3e\u6548\u6307\u6a19\u7684 <code>pandas.DataFrame</code>\uff0c\u60a8\u53ef\u4ee5\u5229\u7528\u5b83\u4f86\u7e6a\u88fd\u5716\u8868\u6216\u8a08\u7b97\u81ea\u5b9a\u7fa9\u7684\u7d71\u8a08\u6578\u64da\u3002</li> </ul> </li> </ol>"},{"location":"how-to/backtest/run-algorithm/#2-run_algorithm","title":"2. run_algorithm() \u51fd\u6578","text":"<p>\u7576\u60a8\u5b9a\u7fa9\u597d\u4e0a\u8ff0\u4e09\u500b\u51fd\u6578\u5f8c\uff0c\u5c31\u53ef\u4ee5\u5c07\u5b83\u5011\u50b3\u905e\u7d66 <code>run_algorithm()</code> \u4f86\u555f\u52d5\u56de\u6e2c\u3002</p>"},{"location":"how-to/backtest/run-algorithm/#_2","title":"\u4e3b\u8981\u53c3\u6578\uff1a","text":"<ul> <li><code>start</code>: (<code>pd.Timestamp</code>) \u56de\u6e2c\u7684\u8d77\u59cb\u65e5\u671f\u3002</li> <li><code>end</code>: (<code>pd.Timestamp</code>) \u56de\u6e2c\u7684\u7d50\u675f\u65e5\u671f\u3002</li> <li><code>initialize</code>: (\u51fd\u6578) \u4e0a\u8ff0\u7684 <code>initialize</code> \u51fd\u6578\u3002</li> <li><code>handle_data</code>: (\u51fd\u6578) \u4e0a\u8ff0\u7684 <code>handle_data</code> \u51fd\u6578\u3002</li> <li><code>analyze</code>: (\u51fd\u6578, \u53ef\u9078) \u4e0a\u8ff0\u7684 <code>analyze</code> \u51fd\u6578\u3002</li> <li><code>capital_base</code>: (<code>float</code>) \u521d\u59cb\u8cc7\u91d1\u3002</li> <li><code>bundle</code>: (<code>str</code>) \u8981\u4f7f\u7528\u7684\u8cc7\u6599\u5305\u540d\u7a31\uff0c\u4f8b\u5982 <code>'tquant'</code>\u3002</li> </ul>"},{"location":"how-to/backtest/run-algorithm/#3","title":"3. \u57fa\u672c\u56de\u6e2c\u7bc4\u4f8b\uff1a\u8cb7\u5165\u4e26\u6301\u6709","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u500b\u5b8c\u6574\u7684\u300c\u8cb7\u5165\u4e26\u6301\u6709\u53f0\u7a4d\u96fb (2330)\u300d\u7b56\u7565\uff0c\u5b83\u6f14\u793a\u4e86\u5982\u4f55\u7d44\u7e54\u4e26\u57f7\u884c\u4e00\u500b\u57fa\u672c\u7684\u56de\u6e2c\u3002</p> <p>Tip</p> <p>\u5728\u57f7\u884c\u6b64\u7bc4\u4f8b\u524d\uff0c\u8acb\u78ba\u4fdd\u60a8\u5df2\u7d93\u4f7f\u7528 <code>zipline ingest -b tquant</code> \u532f\u5165\u4e86\u50f9\u91cf\u8cc7\u6599\uff0c\u4e26\u4e14\u8cc7\u6599\u7bc4\u570d\u6db5\u84cb\u4e86\u56de\u6e2c\u671f\u9593\u3002\u8a73\u898b\uff1a\u532f\u5165\u50f9\u91cf\u8cc7\u6599\u6307\u5357</p> <pre><code>import pandas as pd\nfrom zipline import run_algorithm\nfrom zipline.api import (\n    set_benchmark,\n    symbol,\n    order_target_percent,\n    record\n)\nimport matplotlib.pyplot as plt\n\n# 1. \u521d\u59cb\u5316\u51fd\u6578\ndef initialize(context):\n    \"\"\"\n    \u56de\u6e2c\u958b\u59cb\u524d\u50c5\u57f7\u884c\u4e00\u6b21\u3002\n    \"\"\"\n    # \u8a2d\u5b9a\u8981\u4ea4\u6613\u7684\u80a1\u7968\n    context.asset = symbol('2330')\n\n    # \u8a2d\u5b9a Benchmark\n    set_benchmark(symbol('IR0001'))\n\n    # \u7528\u65bc\u5224\u65b7\u662f\u5426\u5df2\u4e0b\u55ae\u7684\u65d7\u6a19\n    context.has_ordered = False\n\n# 2. \u6838\u5fc3\u4ea4\u6613\u908f\u8f2f\u51fd\u6578\ndef handle_data(context, data):\n    \"\"\"\n    \u6bcf\u500b\u4ea4\u6613\u65e5\u90fd\u6703\u88ab\u547c\u53eb\u3002\n    \"\"\"\n    # \u5982\u679c\u5c1a\u672a\u4e0b\u55ae\uff0c\u5247\u4e0b\u55ae\u4e00\u6b21\n    if not context.has_ordered:\n        # \u5c07 100% \u7684\u8cc7\u91d1\u8cb7\u5165 context.asset (2330)\n        order_target_percent(context.asset, 1.0)\n\n        # \u5c07\u65d7\u6a19\u8a2d\u70ba True\uff0c\u78ba\u4fdd\u4e4b\u5f8c\u4e0d\u518d\u91cd\u8907\u4e0b\u55ae\n        context.has_ordered = True\n\n    # \u8a18\u9304\u6bcf\u65e5\u7684\u80a1\u50f9\uff0c\u65b9\u4fbf\u5f8c\u7e8c\u7e6a\u5716\n    record(price=data.current(context.asset, 'price'))\n\n# 3. \u56de\u6e2c\u7d50\u675f\u5f8c\u7684\u5206\u6790\u51fd\u6578\ndef analyze(context, results):\n    \"\"\"\n    \u56de\u6e2c\u7d50\u675f\u5f8c\u57f7\u884c\u4e00\u6b21\u3002\n    \"\"\"\n    fig, axes = plt.subplots(2, 1, figsize=(12, 10), sharex=True)\n\n    # \u7e6a\u88fd\u6295\u8cc7\u7d44\u5408\u50f9\u503c\n    results['portfolio_value'].plot(ax=axes[0])\n    axes[0].set_title('Portfolio Value')\n\n    # \u7e6a\u88fd\u80a1\u50f9\n    results['price'].plot(ax=axes[1])\n    axes[1].set_title(f'{context.asset.symbol} Price')\n\n    plt.tight_layout()\n    plt.show()\n\n# 4. \u57f7\u884c\u56de\u6e2c\nresults = run_algorithm(\n    start=pd.Timestamp('2022-01-01', tz='UTC'),\n    end=pd.Timestamp('2023-01-01', tz='UTC'),\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=1_000_000,\n    bundle='tquant'\n)\n</code></pre>"},{"location":"how-to/backtest/set-commission/","title":"\u64cd\u4f5c\u6307\u5357\uff1a\u5982\u4f55\u8a2d\u5b9a\u624b\u7e8c\u8cbb (How-to: Set Commission)","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b\u5982\u4f55\u4f7f\u7528 <code>set_commission()</code> \u51fd\u6578\u5728 Zipline \u56de\u6e2c\u4e2d\u8a2d\u5b9a\u4ea4\u6613\u624b\u7e8c\u8cbb\u7684\u8a73\u7d30\u6307\u5357\uff0c\u5305\u62ec\u671f\u8ca8\u3001\u80a1\u7968\u7684\u57fa\u790e\u8a08\u8cbb\u6a21\u578b\uff0c\u4ee5\u53ca\u91dd\u5c0d\u53f0\u80a1\u7279\u6b8a\u7a05\u5236\u7684\u81ea\u5b9a\u7fa9\u6a21\u578b\u5be6\u4f5c\u3002</p>"},{"location":"how-to/backtest/set-commission/#_1","title":"\u76ee\u6a19","text":"<p>\u5728\u9032\u884c\u4efb\u4f55\u5be6\u969b\u7684\u56de\u6e2c\u6642\uff0c\u7d0d\u5165\u4ea4\u6613\u6210\u672c\uff08\u5982\u624b\u7e8c\u8cbb\u3001\u8b49\u4ea4\u7a05\uff09\u662f\u8a55\u4f30\u7b56\u7565\u771f\u5be6\u8868\u73fe\u7684\u95dc\u9375\u4e00\u6b65\u3002\u82e5\u5ffd\u7565\u4ea4\u6613\u6210\u672c\uff0c\u6703\u5c0e\u81f4\u56de\u6e2c\u7e3e\u6548\u904e\u65bc\u6a02\u89c0\uff0c\u5f9e\u800c\u7522\u751f\u8aa4\u5224\u3002</p> <p>\u672c\u6307\u5357\u5c07\u8aaa\u660e\u5982\u4f55\u5728 TQuant Lab (Zipline) \u4e2d\u4f7f\u7528 <code>set_commission</code> \u51fd\u6578\uff0c\u5305\u542b\u57fa\u790e\u8a2d\u5b9a\u4ee5\u53ca\u91dd\u5c0d\u53f0\u80a1\u7279\u6b8a\u7a05\u5236\uff08\u8ce3\u51fa\u624d\u6536\u7a05\u3001\u6709\u4f4e\u6d88\uff09\u7684\u9032\u968e\u81ea\u5b9a\u7fa9\u6a21\u578b\u3002</p>"},{"location":"how-to/backtest/set-commission/#set_commission","title":"\u6838\u5fc3\u51fd\u6578\uff1a<code>set_commission()</code>","text":"<p><code>set_commission()</code> \u662f Zipline \u4e2d\u7528\u4f86\u5b9a\u7fa9\u4ea4\u6613\u8cbb\u7528\u7684\u6838\u5fc3\u51fd\u6578\uff0c\u5b83\u5fc5\u9808\u5728 <code>initialize</code> \u51fd\u6578\u4e2d\u88ab\u547c\u53eb\u3002</p> <p>\u9019\u500b\u51fd\u6578\u7684\u4e3b\u8981\u53c3\u6578\u662f <code>futures</code> \u548c <code>equities</code>\uff0c\u60a8\u53ef\u4ee5\u5206\u5225\u70ba\u9019\u5169\u985e\u8cc7\u7522\u50b3\u5165\u4e0d\u540c\u7684\u8cbb\u7528\u6a21\u578b\u7269\u4ef6\u3002</p> <pre><code>from zipline.api import set_commission\nfrom zipline.finance import commission\n\ndef initialize(context):\n    # \u5728\u6b64\u8655\u547c\u53eb set_commission \u51fd\u6578\n    # ...\n</code></pre>"},{"location":"how-to/backtest/set-commission/#_2","title":"\u60c5\u5883\u4e00\uff1a\u8a2d\u5b9a\u671f\u8ca8\u624b\u7e8c\u8cbb (\u57fa\u790e)","text":"<p>\u5c0d\u65bc\u671f\u8ca8\u4ea4\u6613\uff0c\u6700\u5e38\u898b\u7684\u8a08\u8cbb\u65b9\u5f0f\u662f \u6309\u53e3\u6578 (Per Contract)  \u6536\u53d6\u56fa\u5b9a\u8cbb\u7528\u3002</p> <ul> <li>\u6a21\u578b : <code>commission.PerContract()</code></li> <li>\u4e3b\u8981\u53c3\u6578 :<ul> <li><code>cost</code>: \u6bcf\u53e3\u55ae\u908a\u4ea4\u6613\u7684\u624b\u7e8c\u8cbb\u91d1\u984d\u3002</li> <li><code>exchange_fee</code>: \u4ea4\u6613\u6240\u8cbb\u7528\uff0c\u53ef\u9078\u586b\u3002</li> </ul> </li> </ul>"},{"location":"how-to/backtest/set-commission/#_3","title":"\u7bc4\u4f8b\uff1a","text":"<p>\u5047\u8a2d\u53f0\u6307\u671f\u8ca8\u6bcf\u53e3\u55ae\u908a\u624b\u7e8c\u8cbb\u70ba 200 \u5143\uff1a</p> <pre><code># \u5728 initialize \u51fd\u6578\u4e2d\nfrom zipline.finance import commission\n\nset_commission(futures=commission.PerContract(cost=200, exchange_fee=0))\n</code></pre> <p>\u9019\u884c\u7a0b\u5f0f\u78bc\u6703\u544a\u8a34\u56de\u6e2c\u5f15\u64ce\uff0c\u6bcf\u4e00\u6b21\u8cb7\u5165\u6216\u8ce3\u51fa\u4e00\u53e3\u671f\u8ca8\uff0c\u90fd\u8981\u5f9e\u5e33\u6236\u4e2d\u6263\u9664 200 \u5143\u7684\u8cbb\u7528\u3002</p>"},{"location":"how-to/backtest/set-commission/#_4","title":"\u60c5\u5883\u4e8c\uff1a\u8a2d\u5b9a\u80a1\u7968\u624b\u7e8c\u8cbb (\u57fa\u790e)","text":"<p>\u5c0d\u65bc\u80a1\u7968\u4ea4\u6613\uff0c\u82e5\u4e0d\u8003\u616e\u7a05\u5236\u5dee\u7570\uff0c\u57fa\u790e\u8a08\u8cbb\u65b9\u5f0f\u662f \u6309\u6210\u4ea4\u91d1\u984d\u7684\u767e\u5206\u6bd4 (Per Dollar) \u6536\u53d6\u3002</p> <ul> <li>\u6a21\u578b : <code>commission.PerDollar()</code></li> <li>\u4e3b\u8981\u53c3\u6578 :<ul> <li><code>cost</code>: \u624b\u7e8c\u8cbb\u4f54\u6210\u4ea4\u91d1\u984d\u7684\u6bd4\u4f8b\u3002\u4f8b\u5982\uff0c\u5238\u5546\u624b\u7e8c\u8cbb\u70ba 0.1425%\uff0c\u5247 <code>cost</code> \u61c9\u8a2d\u70ba <code>0.001425</code>\u3002</li> </ul> </li> </ul>"},{"location":"how-to/backtest/set-commission/#_5","title":"\u7bc4\u4f8b\uff1a","text":"<p>\u5047\u8a2d\u80a1\u7968\u4ea4\u6613\u624b\u7e8c\u8cbb\u70ba\u6210\u4ea4\u91d1\u984d\u7684 0.1425%\uff1a</p> <pre><code># \u5728 initialize \u51fd\u6578\u4e2d\nfrom zipline.finance import commission\n\nset_commission(equities=commission.PerDollar(cost=0.001425))\n</code></pre>"},{"location":"how-to/backtest/set-commission/#custom-commission-model","title":"\u9032\u968e\u7528\u6cd5\uff1a\u81ea\u5b9a\u7fa9\u624b\u7e8c\u8cbb\u6a21\u578b (Custom Commission Model)","text":""},{"location":"how-to/backtest/set-commission/#_6","title":"\u70ba\u4f55\u9700\u8981\u81ea\u5b9a\u7fa9\uff1f","text":"<p>Zipline \u5167\u5efa\u7684 <code>PerDollar</code> \u6a21\u578b\u5047\u8a2d\u8cb7\u9032\u8207\u8ce3\u51fa\u7684\u8cbb\u7387\u662f\u76f8\u540c\u7684\u3002\u7136\u800c\uff0c\u5728 \u53f0\u80a1\u73fe\u8ca8 \u4ea4\u6613\u4e2d\uff0c\u898f\u5247\u901a\u5e38\u8f03\u70ba\u8907\u96dc\uff1a 1.   \u8b49\u4ea4\u7a05 : \u53ea\u6709\u5728 \u8ce3\u51fa \u6642\u624d\u6536\u53d6\uff08\u901a\u5e38\u70ba 0.3%\uff09\u3002 2.   \u6700\u4f4e\u624b\u7e8c\u8cbb : \u5238\u5546\u901a\u5e38\u8a2d\u6709\u55ae\u7b46\u6700\u4f4e\u624b\u7e8c\u8cbb\uff08\u4f8b\u5982 20 \u5143\uff09\u3002</p> <p>\u70ba\u4e86\u7cbe\u78ba\u6a21\u64ec\u9019\u4e9b\u898f\u5247\uff0c\u6211\u5011\u9700\u8981\u900f\u904e\u7e7c\u627f <code>CommissionModel</code> \u4f86\u64b0\u5beb\u81ea\u5df1\u7684\u8cbb\u7528\u908f\u8f2f\u3002</p>"},{"location":"how-to/backtest/set-commission/#_7","title":"\u5be6\u4f5c\u6b65\u9a5f","text":"<ol> <li>\u5b9a\u7fa9\u985e\u5225 : \u5efa\u7acb\u4e00\u500b\u65b0\u985e\u5225\u4e26\u7e7c\u627f <code>zipline.finance.commission.CommissionModel</code>\u3002</li> <li>\u5be6\u4f5c <code>calculate</code> \u65b9\u6cd5 : \u9019\u662f\u8a08\u7b97\u8cbb\u7528\u7684\u6838\u5fc3\uff0cZipline \u6703\u5728\u6bcf\u7b46\u6210\u4ea4\u6642\u547c\u53eb\u6b64\u65b9\u6cd5\uff0c\u4e26\u50b3\u5165\u8a02\u55ae (<code>order</code>) \u8207\u6210\u4ea4\u8cc7\u8a0a (<code>transaction</code>)\u3002</li> </ol>"},{"location":"how-to/backtest/set-commission/#_8","title":"\u7bc4\u4f8b\u7a0b\u5f0f\u78bc\uff1a\u53f0\u80a1\u5c08\u7528\u6a21\u578b","text":"<p>\u4ee5\u4e0b\u7bc4\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u5efa\u7acb\u4e00\u500b\u7b26\u5408\u53f0\u80a1\u898f\u5247\uff08\u542b\u8b49\u4ea4\u7a05\u8207\u4f4e\u6d88\uff09\u7684\u6a21\u578b\u3002</p> <pre><code>from zipline.api import set_commission\nfrom zipline.finance.commission import CommissionModel\n\n# 1. \u5b9a\u7fa9\u81ea\u5b9a\u7fa9\u6a21\u578b\u985e\u5225\nclass TaiwanStockCommission(CommissionModel):\n    \"\"\"\n    \u5ba2\u88fd\u5316\u53f0\u80a1\u624b\u7e8c\u8cbb\u6a21\u578b\uff1a\n    - \u8cb7\u9032: \u50c5\u6536\u624b\u7e8c\u8cbb (\u9810\u8a2d 0.1425%)\n    - \u8ce3\u51fa: \u624b\u7e8c\u8cbb + \u8b49\u4ea4\u7a05 (\u9810\u8a2d 0.3%)\n    - \u6700\u4f4e\u624b\u7e8c\u8cbb: \u9810\u8a2d 20 \u5143 (\u91dd\u5c0d\u624b\u7e8c\u8cbb\u90e8\u5206)\n    \"\"\"\n    def __init__(self, cost=0.001425, tax=0.003, min_cost=20):\n        self.cost = cost\n        self.tax = tax\n        self.min_cost = min_cost\n\n    def calculate(self, order, transaction):\n        \"\"\"\n        \u8a08\u7b97\u55ae\u7b46\u6210\u4ea4\u7684\u8cbb\u7528\n        :param order: \u8a02\u55ae\u7269\u4ef6\n        :param transaction: \u6210\u4ea4\u8cc7\u8a0a\u7269\u4ef6 (\u5305\u542b amount, price)\n        \"\"\"\n        # \u8a08\u7b97\u6210\u4ea4\u91d1\u984d (\u53d6\u7d55\u5c0d\u503c\uff0c\u56e0\u70ba\u8ce3\u51fa\u7684 amount \u70ba\u8ca0\u6578)\n        trade_value = abs(transaction.amount * transaction.price)\n\n        # A. \u8a08\u7b97\u57fa\u790e\u624b\u7e8c\u8cbb\n        execution_cost = trade_value * self.cost\n\n        # B. \u8655\u7406\u6700\u4f4e\u624b\u7e8c\u8cbb (\u4f4e\u6d88)\n        if execution_cost &lt; self.min_cost:\n            execution_cost = self.min_cost\n\n        # C. \u5224\u65b7\u662f\u5426\u70ba\u8ce3\u51fa (amount &lt; 0 \u4ee3\u8868\u8ce3\u51fa)\n        # \u82e5\u662f\u8ce3\u51fa\uff0c\u9700\u984d\u5916\u52a0\u4e0a\u8b49\u4ea4\u7a05 (\u8b49\u4ea4\u7a05\u6c92\u6709\u4f4e\u6d88\u9650\u5236)\n        if transaction.amount &lt; 0:\n            execution_cost += trade_value * self.tax\n\n        return execution_cost\n\n# 2. \u5728 initialize \u4e2d\u4f7f\u7528\ndef initialize(context):\n    # \u5c07\u80a1\u7968\u7684\u624b\u7e8c\u8cbb\u6a21\u578b\u8a2d\u5b9a\u70ba\u6211\u5011\u81ea\u5b9a\u7fa9\u7684\u985e\u5225\n    set_commission(equities=TaiwanStockCommission(cost=0.001425, tax=0.003))\n\n    # \u671f\u8ca8\u4ecd\u53ef\u7dad\u6301\u5167\u5efa\u7684\u56fa\u5b9a\u8cbb\u7528\u6a21\u578b\n    # set_commission(futures=commission.PerContract(cost=200))\n</code></pre>"},{"location":"how-to/backtest/set-commission/#transaction","title":"\u53c3\u6578\u89e3\u8aaa (<code>transaction</code> \u7269\u4ef6)","text":"<p>\u5728 <code>calculate</code> \u65b9\u6cd5\u4e2d\uff0c<code>transaction</code> \u7269\u4ef6\u5305\u542b\u4e86\u8a72\u7b46\u6210\u4ea4\u7684\u95dc\u9375\u8cc7\u8a0a\uff1a -   <code>transaction.amount</code>: \u6210\u4ea4\u80a1\u6578\u3002 \u6b63\u6578\u70ba\u8cb7\u5165\uff0c\u8ca0\u6578\u70ba\u8ce3\u51fa \u3002 -   <code>transaction.price</code>: \u6210\u4ea4\u50f9\u683c\u3002</p> <p>\u900f\u904e\u5224\u65b7 <code>transaction.amount</code> \u7684\u6b63\u8ca0\u865f\uff0c\u6211\u5011\u5c31\u80fd\u8f15\u6613\u5340\u5206\u8cb7\u8ce3\u65b9\u5411\uff0c\u4e26\u9069\u7528\u4e0d\u540c\u7684\u7a05\u7387\u3002</p>"},{"location":"how-to/backtest/set-commission/#initialize","title":"\u5b8c\u6574 <code>initialize</code> \u6574\u5408\u7bc4\u4f8b","text":"<p>\u5728\u4e00\u500b\u540c\u6642\u4ea4\u6613\u80a1\u7968\u548c\u671f\u8ca8\u7684\u7b56\u7565\u4e2d\uff0c\u60a8\u53ef\u4ee5\u540c\u6642\u8a2d\u5b9a\u5169\u8005\u7684\u624b\u7e8c\u8cbb\u6a21\u578b\u3002</p> <pre><code>from zipline.api import set_commission, set_slippage\nfrom zipline.finance import commission, slippage\n\n# (\u5047\u8a2d TaiwanStockCommission \u985e\u5225\u5df2\u5b9a\u7fa9\u5728\u4e0a\u65b9)\n\ndef initialize(context):\n    # ... \u5176\u4ed6\u8a2d\u5b9a ...\n\n    # 1. \u8a2d\u5b9a\u671f\u8ca8\u4ea4\u6613\u6210\u672c\uff1a\u6bcf\u53e3\u56fa\u5b9a 200 \u5143\n    set_commission(futures=commission.PerContract(cost=200))\n\n    # 2. \u8a2d\u5b9a\u80a1\u7968\u4ea4\u6613\u6210\u672c\uff1a\u4f7f\u7528\u81ea\u5b9a\u7fa9\u53f0\u80a1\u6a21\u578b (\u8cb7\u9032\u624b\u7e8c\u8cbb\uff0c\u8ce3\u51fa\u542b\u7a05)\n    set_commission(equities=TaiwanStockCommission(cost=0.001425, tax=0.003))\n\n    # 3. \u8a2d\u5b9a\u6ed1\u50f9\u6a21\u578b (\u9078\u7528)\n    # VolumeShareSlippage: \u9650\u5236\u6210\u4ea4\u91cf\u4e0d\u8d85\u904e\u7576\u65e5\u7684 2.5%\n    set_slippage(slippage.VolumeShareSlippage(volume_limit=0.025, price_impact=0.1))\n\n    # ... \u5176\u4ed6\u8a2d\u5b9a ...\n</code></pre>"},{"location":"how-to/backtest/set-commission/#_9","title":"\u7e3d\u7d50","text":"<ul> <li>\u5728 <code>initialize</code> \u51fd\u6578\u4e2d\u4f7f\u7528 <code>set_commission</code> \u4f86\u5b9a\u7fa9\u4ea4\u6613\u6210\u672c\u3002</li> <li>\u671f\u8ca8\u901a\u5e38\u4f7f\u7528 <code>commission.PerContract</code> \u6309\u53e3\u8a08\u8cbb\u3002</li> <li>\u80a1\u7968\u82e5\u9700\u7cbe\u78ba\u6a21\u64ec\u53f0\u80a1\u7a05\u5236\uff08\u8ce3\u51fa\u6536\u7a05\u3001\u8cb7\u9032\u4e0d\u6536\uff09\uff0c\u5efa\u8b70\u4f7f\u7528 \u7e7c\u627f <code>CommissionModel</code> \u7684\u81ea\u5b9a\u7fa9\u985e\u5225 \u3002</li> </ul> <p>\u6e96\u78ba\u5730\u6a21\u64ec\u4ea4\u6613\u6210\u672c\uff0c\u662f\u8b93\u60a8\u7684\u56de\u6e2c\u7d50\u679c\u66f4\u8cbc\u8fd1\u771f\u5be6\u5e02\u5834\u8868\u73fe\u7684\u5fc5\u8981\u6b65\u9a5f\u3002</p>"},{"location":"how-to/backtest/set-slippage/","title":"\u64cd\u4f5c\u6307\u5357\uff1a\u5982\u4f55\u8a2d\u5b9a\u6ed1\u50f9 (How-to: Set Slippage)","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b\u5982\u4f55\u4f7f\u7528 <code>set_slippage()</code> \u51fd\u6578\u5728 Zipline \u56de\u6e2c\u4e2d\u8a2d\u5b9a\u6ed1\u50f9\u6a21\u578b\u7684\u8a73\u7d30\u6307\u5357\uff0c\u5305\u62ec\u671f\u8ca8\u3001\u80a1\u7968\u7684\u5e38\u898b\u6ed1\u50f9\u6a21\u578b\u8a2d\u5b9a\u65b9\u6cd5\u3002</p>"},{"location":"how-to/backtest/set-slippage/#_1","title":"\u76ee\u6a19","text":"<p>\u6ed1\u50f9\uff08Slippage\uff09\u662f\u6307\u5728\u91d1\u878d\u5e02\u5834\u4e2d\uff0c\u6700\u7d42\u6210\u4ea4\u50f9\u683c\u8207\u4e0b\u55ae\u6642\u9810\u671f\u50f9\u683c\u4e4b\u9593\u7684\u5dee\u7570\u3002\u9019\u7a2e\u5dee\u7570\u53ef\u80fd\u7531\u5e02\u5834\u6ce2\u52d5\u3001\u6d41\u52d5\u6027\u4e0d\u8db3\u6216\u8a02\u55ae\u5927\u5c0f\u9020\u6210\u3002\u5728\u56de\u6e2c\u4e2d\u6a21\u64ec\u6ed1\u50f9\uff0c\u662f\u8b93\u7b56\u7565\u7e3e\u6548\u66f4\u8cbc\u8fd1\u771f\u5be6\u5e02\u5834\u72c0\u6cc1\u7684\u95dc\u9375\u6b65\u9a5f\u3002</p> <p>\u672c\u6307\u5357\u5c07\u8aaa\u660e\u5982\u4f55\u5728 TQuant Lab \u4e2d\u4f7f\u7528 <code>set_slippage</code> \u51fd\u6578\u4f86\u70ba\u60a8\u7684\u7b56\u7565\u8a2d\u5b9a\u4e0d\u540c\u7684\u6ed1\u50f9\u6a21\u578b\u3002</p>"},{"location":"how-to/backtest/set-slippage/#set_slippage","title":"\u6838\u5fc3\u51fd\u6578\uff1a<code>set_slippage()</code>","text":"<p>\u8207 <code>set_commission</code> \u985e\u4f3c\uff0c<code>set_slippage()</code> \u51fd\u6578\u4e5f\u61c9\u8a72\u5728 <code>initialize</code> \u51fd\u6578\u4e2d\u88ab\u547c\u53eb\u3002\u5b83\u540c\u6a23\u53ef\u4ee5\u91dd\u5c0d <code>futures</code> \u548c <code>equities</code> \u8a2d\u5b9a\u4e0d\u540c\u7684\u6ed1\u50f9\u6a21\u578b\u3002</p> <pre><code>from zipline.api import set_slippage\nfrom zipline.finance import slippage\n\ndef initialize(context):\n    # \u5728\u6b64\u8655\u547c\u53eb set_slippage \u51fd\u6578\n    # ...\n</code></pre>"},{"location":"how-to/backtest/set-slippage/#1-fixed-slippage","title":"1. \u8a2d\u5b9a\u671f\u8ca8\u7684\u56fa\u5b9a\u6ed1\u50f9 (Fixed Slippage)","text":"<p>\u5c0d\u65bc\u6d41\u52d5\u6027\u8f03\u597d\u7684\u671f\u8ca8\u5e02\u5834\uff0c\u4e00\u500b\u5e38\u898b\u7684\u7c21\u5316\u6a21\u578b\u662f\u5047\u8a2d\u6bcf\u6b21\u4ea4\u6613\u90fd\u6709\u4e00\u500b\u56fa\u5b9a\u7684\u6ed1\u50f9\u6210\u672c\u3002<code>FixedSlippage</code> \u6a21\u578b\u5c31\u662f\u70ba\u6b64\u8a2d\u8a08\u7684\u3002</p> <ul> <li>** \u6a21\u578b ** : <code>slippage.FixedSlippage()</code></li> <li>** \u4e3b\u8981\u53c3\u6578 ** :<ul> <li><code>spread</code>: \u8a2d\u5b9a\u4e00\u500b\u56fa\u5b9a\u7684\u50f9\u5dee\u3002Zipline \u6703\u5c07\u9019\u500b\u50f9\u5dee\u7684\u4e00\u534a\u61c9\u7528\u65bc\u8cb7\u55ae\uff08\u6210\u4ea4\u50f9\u66f4\u9ad8\uff09\uff0c\u53e6\u4e00\u534a\u61c9\u7528\u65bc\u8ce3\u55ae\uff08\u6210\u4ea4\u50f9\u66f4\u4f4e\uff09\u3002</li> </ul> </li> </ul>"},{"location":"how-to/backtest/set-slippage/#11","title":"1.1 \u7bc4\u4f8b\uff1a","text":"<p>\u5047\u8a2d\u6211\u5011\u9810\u671f\u6bcf\u6b21\u4ea4\u6613\u7684\u7e3d\u6ed1\u50f9\u6210\u672c\u70ba 6 \u9ede\uff08tick\uff09\u3002\u9019\u610f\u5473\u8457\u8cb7\u9032\u6642\u6703\u6bd4\u5e02\u50f9\u591a\u4ed8 3 \u9ede\uff0c\u8ce3\u51fa\u6642\u6703\u6bd4\u5e02\u50f9\u5c11\u6536 3 \u9ede\u3002</p> <pre><code># \u5728 initialize \u51fd\u6578\u4e2d\n\nfrom zipline.finance import slippage\n\n# \u8a2d\u5b9a\u7e3d\u50f9\u5dee\u70ba 6 \u9ede\nset_slippage(futures=slippage.FixedSlippage(spread=6.0))\n</code></pre>"},{"location":"how-to/backtest/set-slippage/#2-volume-share-slippage","title":"2. \u8a2d\u5b9a\u80a1\u7968\u7684\u6210\u4ea4\u91cf\u6ed1\u50f9 (Volume Share Slippage)","text":"<p>\u5c0d\u65bc\u80a1\u7968\uff0c\u7279\u5225\u662f\u7576\u4ea4\u6613\u91cf\u53ef\u80fd\u5f71\u97ff\u5e02\u5834\u50f9\u683c\u6642\uff0c\u4f7f\u7528\u8207\u6210\u4ea4\u91cf\u76f8\u95dc\u7684\u6ed1\u50f9\u6a21\u578b\u6703\u66f4\u8cbc\u8fd1\u771f\u5be6\u3002<code>VolumeShareSlippage</code> \u6703\u6839\u64da\u60a8\u7684\u8a02\u55ae\u4f54\u7576\u524d K \u68d2\u6210\u4ea4\u91cf\u7684\u6bd4\u4f8b\u4f86\u6a21\u64ec\u50f9\u683c\u885d\u64ca\u3002</p> <ul> <li>** \u6a21\u578b ** : <code>slippage.VolumeShareSlippage()</code></li> <li>** \u4e3b\u8981\u53c3\u6578 ** :<ul> <li><code>volume_limit</code>: \u60a8\u7684\u8a02\u55ae\u6210\u4ea4\u91cf\u4f54 K \u68d2\u7e3d\u6210\u4ea4\u91cf\u7684\u6700\u5927\u6bd4\u4f8b\uff0c\u9810\u8a2d\u70ba 0.1 (10%)\u3002</li> <li><code>price_impact</code>: \u50f9\u683c\u885d\u64ca\u4fc2\u6578\uff0c\u9810\u8a2d\u70ba 0.1\u3002\u60a8\u7684\u8a02\u55ae\u91cf\u8d8a\u5927\uff0c\u5c0d\u50f9\u683c\u7684\u5f71\u97ff\u5c31\u8d8a\u5927\u3002</li> </ul> </li> </ul>"},{"location":"how-to/backtest/set-slippage/#21","title":"2.1 \u7bc4\u4f8b\uff1a","text":"<pre><code># \u5728 initialize \u51fd\u6578\u4e2d\n\nfrom zipline.finance import slippage\n\n# \u4f7f\u7528\u9810\u8a2d\u53c3\u6578\u8a2d\u5b9a\u6210\u4ea4\u91cf\u6ed1\u50f9\u6a21\u578b\nset_slippage(equities=slippage.VolumeShareSlippage())\n</code></pre>"},{"location":"how-to/backtest/set-slippage/#3","title":"3. \u7121\u6ed1\u50f9","text":"<p>\u5728\u7b56\u7565\u958b\u767c\u7684\u521d\u671f\u968e\u6bb5\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u5728\u4e00\u500b\u7406\u60f3\u5316\u7684\u74b0\u5883\u4e2d\u6e2c\u8a66\u6838\u5fc3\u908f\u8f2f\uff0c\u6b64\u6642\u53ef\u4ee5\u8a2d\u5b9a\u7121\u6ed1\u50f9\u3002</p> <ul> <li>** \u6a21\u578b ** : <code>slippage.NoSlippage()</code></li> </ul>"},{"location":"how-to/backtest/set-slippage/#31","title":"3.1 \u7bc4\u4f8b\uff1a","text":"<pre><code># \u5728 initialize \u51fd\u6578\u4e2d\n\nfrom zipline.finance import slippage\n\nset_slippage(futures=slippage.NoSlippage())\n</code></pre>"},{"location":"how-to/backtest/set-slippage/#_2","title":"\u7e3d\u7d50","text":"<ul> <li>\u5728 <code>initialize</code> \u51fd\u6578\u4e2d\u4f7f\u7528 <code>set_slippage</code> \u4f86\u5b9a\u7fa9\u6ed1\u50f9\u6a21\u578b\u3002</li> <li>\u671f\u8ca8 \u5e38\u7528 <code>slippage.FixedSlippage</code> \u4f86\u6a21\u64ec\u56fa\u5b9a\u7684\u4ea4\u6613\u6210\u672c\u3002</li> <li>\u80a1\u7968 \u53ef\u4f7f\u7528 <code>slippage.VolumeShareSlippage</code> \u4f86\u6a21\u64ec\u66f4\u771f\u5be6\u7684\u5e02\u5834\u885d\u64ca\u3002</li> <li>\u70ba\u4e86\u9032\u884c\u6700\u56b4\u8b39\u7684\u56de\u6e2c\uff0c\u8acb\u52d9\u5fc5\u70ba\u60a8\u7684\u7b56\u7565\u8a2d\u5b9a\u4e00\u500b\u5408\u7406\u7684\u6ed1\u50f9\u6a21\u578b\u3002</li> </ul>"},{"location":"how-to/backtest/set-trading-controls/","title":"\u5982\u4f55\u8a2d\u5b9a\u4ea4\u6613\u9650\u5236","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b\u5982\u4f55\u5728 Zipline \u56de\u6e2c\u4e2d\u8a2d\u5b9a\u4ea4\u6613\u9650\u5236\u7684\u8a73\u7d30\u6307\u5357\uff0c\u5305\u62ec <code>set_max_leverage()</code>\u3001<code>set_max_position_size()</code> \u548c <code>set_max_order_size()</code> \u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u5e6b\u52a9\u60a8\u6a21\u64ec\u771f\u5be6\u4e16\u754c\u7684\u5e02\u5834\u7d04\u675f\u3002</p> <p>\u5728\u91cf\u5316\u56de\u6e2c\u4e2d\u8a2d\u5b9a\u4ea4\u6613\u9650\u5236\u662f\u81f3\u95dc\u91cd\u8981\u7684\u4e00\u74b0\u3002\u9019\u4e9b\u9650\u5236\u6709\u52a9\u65bc\u6a21\u64ec\u771f\u5be6\u4e16\u754c\u7684\u5e02\u5834\u7d04\u675f\u3001\u7ba1\u7406\u7b56\u7565\u98a8\u96aa\uff0c\u4e26\u78ba\u4fdd\u56de\u6e2c\u7d50\u679c\u66f4\u5177\u53ef\u4fe1\u5ea6\u3002Zipline \u63d0\u4f9b\u4e86\u591a\u500b API \u51fd\u6578\u4f86\u5be6\u65bd\u9019\u4e9b\u4ea4\u6613\u63a7\u5236\u3002</p>"},{"location":"how-to/backtest/set-trading-controls/#1-set_max_leverage","title":"1. set_max_leverage()\uff1a\u8a2d\u5b9a\u6700\u5927\u69d3\u687f\u500d\u6578","text":"<p>\u6b64\u51fd\u6578\u7528\u65bc\u9650\u5236\u60a8\u7684\u6295\u8cc7\u7d44\u5408\u5728\u56de\u6e2c\u671f\u9593\u7684\u6700\u5927\u69d3\u687f\u500d\u6578\u3002\u5982\u679c\u6295\u8cc7\u7d44\u5408\u7684\u69d3\u687f\u8d85\u904e\u6b64\u8a2d\u5b9a\uff0cZipline \u5c07\u6703\u7d42\u6b62\u56de\u6e2c\u4e26\u5831\u932f\u3002</p> <p>\u53c3\u6578 :</p> <ul> <li><code>max_leverage</code> (float)<ul> <li><code>max_leverage</code> \u61c9\u70ba\u4e00\u500b\u5927\u65bc 0 \u7684\u6d6e\u9ede\u6578\uff0c\u8868\u793a\u5141\u8a31\u7684\u6700\u5927\u69d3\u687f\u500d\u6578\u3002</li> </ul> </li> </ul> <pre><code>from zipline.api import set_max_leverage\n\ndef initialize(context):\n    # \u8a2d\u5b9a\u6700\u5927\u69d3\u687f\u500d\u6578\u70ba 3.0\n    set_max_leverage(3.0)\n</code></pre> <p>Warning</p> <p>\u904e\u9ad8\u7684\u69d3\u687f\u53ef\u80fd\u6703\u5c0e\u81f4\u5728\u5e02\u5834\u6ce2\u52d5\u6642\uff0c\u6295\u8cc7\u7d44\u5408\u50f9\u503c\u8fc5\u901f\u6b78\u96f6\u3002\u8acb\u6839\u64da\u60a8\u7684\u98a8\u96aa\u627f\u53d7\u80fd\u529b\u5be9\u614e\u8a2d\u5b9a\u3002</p>"},{"location":"how-to/backtest/set-trading-controls/#2-set_max_position_size","title":"2. set_max_position_size()\uff1a\u8a2d\u5b9a\u55ae\u4e00\u8cc7\u7522\u6700\u5927\u90e8\u4f4d\u9650\u5236","text":"<p>\u6b64\u51fd\u6578\u7528\u65bc\u9650\u5236\u55ae\u4e00\u8cc7\u7522\u5728\u6295\u8cc7\u7d44\u5408\u4e2d\u7684\u6700\u5927\u6301\u6709\u90e8\u4f4d\u3002\u9019\u6709\u52a9\u65bc\u5206\u6563\u98a8\u96aa\uff0c\u907f\u514d\u55ae\u4e00\u8cc7\u7522\u5c0d\u6574\u500b\u6295\u8cc7\u7d44\u5408\u7522\u751f\u904e\u5927\u7684\u5f71\u97ff\u3002</p> <p>\u53c3\u6578 :</p> <ul> <li><code>asset</code>: (Asset, \u53ef\u9078) \u6b32\u8a2d\u5b9a\u9650\u5236\u7684\u8cc7\u7522\u7269\u4ef6\u3002\u82e5\u70ba <code>None</code>\uff0c\u5247\u9650\u5236\u9069\u7528\u65bc\u6240\u6709\u8cc7\u7522\u3002</li> <li><code>max_shares</code>: (int, \u53ef\u9078) \u5141\u8a31\u6301\u6709\u7684\u6700\u5927\u80a1\u6578\u3002</li> <li><code>max_notional</code>: (float, \u53ef\u9078) \u5141\u8a31\u6301\u6709\u7684\u6700\u5927\u5e02\u503c (\u7f8e\u5143)\u3002</li> <li><code>on_error</code>: (str, \u53ef\u9078) \u7576\u9650\u5236\u88ab\u9055\u53cd\u6642\u7684\u8655\u7406\u65b9\u5f0f\u3002\u9078\u9805\u5305\u62ec <code>'fail'</code> (\u7d42\u6b62\u56de\u6e2c)\u3001<code>'log'</code> (\u8a18\u9304\u8b66\u544a\u4e26\u7e7c\u7e8c)\u3001<code>'warn'</code> (\u767c\u51fa\u8b66\u544a\u4e26\u7e7c\u7e8c)\u3001<code>'ignore'</code> (\u5ffd\u7565)\u3002\u9810\u8a2d\u70ba <code>'fail'</code>\u3002</li> </ul> <p><code>max_shares</code> \u548c <code>max_notional</code> \u81f3\u5c11\u5fc5\u9808\u8a2d\u5b9a\u5176\u4e2d\u4e00\u500b\u3002</p> <pre><code>from zipline.api import set_max_position_size, symbol\n\ndef initialize(context):\n    # \u8a2d\u5b9a\u53f0\u6ce5 (1101) \u7684\u6700\u5927\u6301\u6709\u80a1\u6578\u70ba 1050 \u80a1\uff0c\u9055\u53cd\u6642\u8a18\u9304\u8b66\u544a\n    set_max_position_size(asset=symbol('1101'), max_shares=1050, on_error='log')\n\n    # \u8a2d\u5b9a\u53f0\u7a4d\u96fb (2330) \u7684\u6700\u5927\u6301\u6709\u80a1\u6578\u70ba 2000 \u80a1\uff0c\u4e14\u6700\u5927\u5e02\u503c\u4e0d\u8d85\u904e 600,000 \u5143\uff0c\u9055\u53cd\u6642\u8a18\u9304\u8b66\u544a\n    set_max_position_size(asset=symbol('2330'), max_shares=2000, max_notional=600000, on_error='log')\n</code></pre>"},{"location":"how-to/backtest/set-trading-controls/#3-set_max_order_size","title":"3. set_max_order_size()\uff1a\u8a2d\u5b9a \u55ae\u7b46\u8a02\u55ae\u6700\u5927\u6578\u91cf\u9650\u5236","text":"<p>\u6b64\u51fd\u6578\u7528\u65bc\u9650\u5236\u55ae\u6b21\u4e0b\u55ae\u7684\u6700\u5927\u6578\u91cf\u3002\u9019\u53ef\u4ee5\u9632\u6b62\u56e0\u610f\u5916\u6216\u908f\u8f2f\u932f\u8aa4\u800c\u4e0b\u9054\u904e\u5927\u7684\u8a02\u55ae\uff0c\u540c\u6642\u4e5f\u80fd\u6a21\u64ec\u5e02\u5834\u6df1\u5ea6\u4e0d\u8db3\u7684\u72c0\u6cc1\u3002</p> <p>\u53c3\u6578 : \u540c <code>set_max_position_size()</code> \u7684\u53c3\u6578\u3002</p> <pre><code>from zipline.api import set_max_order_size, symbol\n\ndef initialize(context):\n    # \u8a2d\u5b9a\u53f0\u6ce5 (1101) \u7684\u55ae\u7b46\u6700\u5927\u4e0b\u55ae\u80a1\u6578\u70ba 1000 \u80a1\n    set_max_order_size(asset=symbol('1101'), max_shares=1000, on_error='log')\n\n    # \u8a2d\u5b9a\u53f0\u7a4d\u96fb (2330) \u7684\u55ae\u7b46\u6700\u5927\u4e0b\u55ae\u80a1\u6578\u70ba 2000 \u80a1\uff0c\u4e14\u6700\u5927\u5e02\u503c\u4e0d\u8d85\u904e 481,000 \u5143\n    set_max_order_size(asset=symbol('2330'), max_shares=2000, max_notional=481000, on_error='log')\n</code></pre> <p><code>max_notional</code> \u662f\u6839\u64da\u4e0b\u55ae\u6642\u7684\u6536\u76e4\u50f9\u8a08\u7b97\u3002\u56e0\u6b64\uff0c\u7531\u65bc\u5be6\u969b\u6210\u4ea4\u50f9\u8207\u6536\u76e4\u50f9\u53ef\u80fd\u5b58\u5728\u5dee\u7570\uff0c\u6700\u7d42\u6210\u4ea4\u7684\u80a1\u6578\u548c\u91d1\u984d\u4ecd\u53ef\u80fd\u5fae\u5e45\u8d85\u51fa <code>max_notional</code> \u7684\u9650\u5236\u3002</p>"},{"location":"how-to/backtest/set-trading-controls/#4-set_min_order_size","title":"4. set_min_order_size()\uff1a\u8a2d\u5b9a \u55ae\u7b46\u8a02\u55ae\u6700\u5c0f\u6578\u91cf\u9650\u5236","text":"<p>[TODO: \u5167\u5bb9\u7f3a\u5931]</p> <p>\u64b0\u5beb\u8005\u8a3b\uff1a \u5728 <code>TQuant-Lab</code> \u5c08\u6848\u7684\u7bc4\u4f8b\u4e2d\uff0c\u4e26\u672a\u627e\u5230 <code>set_min_order_size</code> \u51fd\u6578\u7684\u660e\u78ba\u4f7f\u7528\u7bc4\u4f8b\u3002 \u6839\u64da [RULE-T1] (\u7d55\u5c0d\u771f\u5be6\u6027)\uff0c\u5728\u6c92\u6709\u53ef\u9a57\u8b49\u7684\u53c3\u8003\u8cc7\u6599\u524d\uff0c\u7121\u6cd5\u64b0\u5beb\u6b64\u6587\u4ef6\u7684\u6280\u8853\u5167\u5bb9\u3002 \u6b64\u554f\u984c\u5df2\u8a18\u9304\u5728 <code>_CURRENT_TASK.md</code> \u4e2d\uff0c\u7b49\u5f85\u5be9\u67e5\u8005\u63d0\u4f9b\u9032\u4e00\u6b65\u7684\u6307\u5f15\u3002</p>"},{"location":"how-to/backtest/simulation-params/","title":"Zipline \u56de\u6e2c\u6a21\u64ec\u53c3\u6578 (Simulation Parameters)","text":"<p>Info</p> <p>\u672c\u9801\u8a73\u7d30\u8aaa\u660e Zipline \u56de\u6e2c\u4e2d\u7684\u6a21\u64ec\u53c3\u6578\uff0c\u5305\u62ec <code>run_algorithm()</code> \u51fd\u6578\u7684\u6838\u5fc3\u53c3\u6578\u3001\u5982\u4f55\u8a2d\u5b9a\u56de\u6e2c\u671f\u9593\u3001\u521d\u59cb\u8cc7\u91d1\u3001\u6578\u64da\u983b\u7387\u3001\u4ee5\u53ca\u5176\u4ed6\u5f71\u97ff\u56de\u6e2c\u884c\u70ba\u7684\u91cd\u8981\u8a2d\u5b9a\u3002</p> <p>\u5728 Zipline \u4e2d\uff0c\u6a21\u64ec\u53c3\u6578 (Simulation Parameters) \u6c7a\u5b9a\u4e86\u56de\u6e2c\u5f15\u64ce\u5982\u4f55\u904b\u884c\u60a8\u7684\u4ea4\u6613\u7b56\u7565\u3002\u9019\u4e9b\u53c3\u6578\u63a7\u5236\u8457\u56de\u6e2c\u7684\u6642\u9593\u7bc4\u570d\u3001\u53ef\u7528\u7684\u8cc7\u91d1\u3001\u6578\u64da\u7684\u7c92\u5ea6\u4ee5\u53ca\u5176\u4ed6\u74b0\u5883\u56e0\u7d20\u3002\u7cbe\u78ba\u5730\u8a2d\u5b9a\u9019\u4e9b\u53c3\u6578\u5c0d\u65bc\u78ba\u4fdd\u56de\u6e2c\u7d50\u679c\u7684\u6709\u6548\u6027\u548c\u53ef\u9760\u6027\u81f3\u95dc\u91cd\u8981\u3002</p> <p>\u672c\u6587\u4ef6\u5c07\u4e3b\u8981\u4ecb\u7d39 <code>zipline.run_algorithm()</code> \u51fd\u6578\u4e2d\u7684\u95dc\u9375\u53c3\u6578\uff0c\u56e0\u70ba\u5b83\u662f\u63a7\u5236 Zipline \u56de\u6e2c\u884c\u70ba\u7684\u4e3b\u8981\u5165\u53e3\u3002</p>"},{"location":"how-to/backtest/simulation-params/#1-run_algorithm","title":"1. <code>run_algorithm()</code> \u51fd\u6578\u7684\u6838\u5fc3\u53c3\u6578","text":"<p><code>zipline.run_algorithm()</code> \u51fd\u6578\u662f\u555f\u52d5 Zipline \u56de\u6e2c\u7684\u6838\u5fc3\u3002\u4ee5\u4e0b\u662f\u5176\u4e00\u4e9b\u6700\u5e38\u7528\u7684\u53c3\u6578\uff1a</p> <ul> <li> <p><code>start</code> (<code>pd.Timestamp</code>)</p> <ul> <li>\u7528\u9014\uff1a\u5b9a\u7fa9\u56de\u6e2c\u7684\u8d77\u59cb\u65e5\u671f\u3002\u5fc5\u9808\u662f UTC \u6642\u5340\u7684 <code>pandas.Timestamp</code> \u7269\u4ef6\u3002</li> <li>\u7bc4\u4f8b\uff1a<code>pd.Timestamp('2020-01-01', tz='utc')</code></li> </ul> </li> <li> <p><code>end</code> (<code>pd.Timestamp</code>)</p> <ul> <li>\u7528\u9014\uff1a\u5b9a\u7fa9\u56de\u6e2c\u7684\u7d50\u675f\u65e5\u671f\u3002\u5fc5\u9808\u662f UTC \u6642\u5340\u7684 <code>pandas.Timestamp</code> \u7269\u4ef6\u3002</li> <li>\u7bc4\u4f8b\uff1a<code>pd.Timestamp('2023-12-31', tz='utc')</code></li> </ul> </li> <li> <p><code>initialize</code> (<code>function</code>)</p> <ul> <li>\u7528\u9014\uff1a\u5728\u56de\u6e2c\u958b\u59cb\u6642\u50c5\u57f7\u884c\u4e00\u6b21\u7684\u51fd\u6578\uff0c\u7528\u65bc\u8a2d\u5b9a\u7b56\u7565\u7684\u521d\u59cb\u72c0\u614b\u3002</li> <li>\u8a73\u898b\uff1a\u751f\u547d\u9031\u671f\u51fd\u6578</li> </ul> </li> <li> <p><code>handle_data</code> (<code>function</code>)</p> <ul> <li>\u7528\u9014\uff1a\u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u88ab\u8abf\u7528\u4e00\u6b21\u7684\u6838\u5fc3\u4ea4\u6613\u908f\u8f2f\u51fd\u6578\u3002</li> <li>\u8a73\u898b\uff1a\u751f\u547d\u9031\u671f\u51fd\u6578</li> </ul> </li> <li> <p><code>analyze</code> (<code>function</code>, optional)</p> <ul> <li>\u7528\u9014\uff1a\u5728\u6574\u500b\u56de\u6e2c\u7d50\u675f\u5f8c\u57f7\u884c\u4e00\u6b21\u7684\u51fd\u6578\uff0c\u7528\u65bc\u7e3e\u6548\u5206\u6790\u548c\u8996\u89ba\u5316\u3002</li> <li>\u8a73\u898b\uff1a\u751f\u547d\u9031\u671f\u51fd\u6578</li> </ul> </li> <li> <p><code>capital_base</code> (<code>float</code>)</p> <ul> <li>\u7528\u9014\uff1a\u8a2d\u5b9a\u56de\u6e2c\u958b\u59cb\u6642\u7684\u521d\u59cb\u8cc7\u91d1\u91d1\u984d\u3002</li> <li>\u7bc4\u4f8b\uff1a<code>1_000_000</code> (100 \u842c)</li> </ul> </li> <li> <p><code>data_frequency</code> (<code>str</code>, optional)</p> <ul> <li>\u7528\u9014\uff1a\u6307\u5b9a\u6578\u64da\u7684\u983b\u7387\u3002\u53ef\u9078 <code>'daily'</code> (\u65e5\u983b) \u6216 <code>'minute'</code> (\u5206\u9418\u983b)\u3002</li> <li>\u9810\u8a2d\uff1a<code>'daily'</code></li> </ul> </li> <li> <p><code>bundle</code> (<code>str</code>, optional)</p> <ul> <li>\u7528\u9014\uff1a\u6307\u5b9a\u8981\u4f7f\u7528\u7684 Zipline \u8cc7\u6599\u5305\u540d\u7a31\u3002</li> <li>\u9810\u8a2d\uff1a<code>'tquant'</code> (TQuant Lab \u9810\u8a2d\u7684\u8cc7\u6599\u5305)</li> </ul> </li> <li> <p><code>trading_calendar</code> (<code>zipline.utils.calendars.TradingCalendar</code>, optional)</p> <ul> <li>\u7528\u9014\uff1a\u6307\u5b9a\u56de\u6e2c\u8981\u4f7f\u7528\u7684\u4ea4\u6613\u65e5\u66c6\u3002\u4f8b\u5982 <code>'TEJ_XTAI'</code> (\u53f0\u7063\u80a1\u7968) \u6216 <code>'TEJ'</code> (\u53f0\u7063\u671f\u8ca8)\u3002</li> <li>\u8a73\u898b\uff1a\u4ea4\u6613\u65e5\u66c6</li> </ul> </li> <li> <p><code>benchmark_sid</code> (<code>int</code>, optional) \u6216 <code>benchmark_symbol</code> (<code>str</code>, optional)</p> <ul> <li>\u7528\u9014\uff1a\u8a2d\u5b9a\u7528\u65bc\u6bd4\u8f03\u7684\u57fa\u6e96\u6307\u6578\u7684 Zipline ID \u6216\u80a1\u7968\u4ee3\u78bc\u3002</li> <li>\u8a73\u898b\uff1a\u5982\u4f55\u8a2d\u5b9a\u8207\u53d6\u5f97 Benchmark \u5831\u916c\u7387</li> </ul> </li> <li> <p><code>treasury_returns</code> (<code>pd.Series</code>, optional)</p> <ul> <li>\u7528\u9014\uff1a\u63d0\u4f9b\u81ea\u5b9a\u7fa9\u7684\u7121\u98a8\u96aa\u5229\u7387\u5e8f\u5217\u3002</li> <li>\u8a73\u898b\uff1a\u5982\u4f55\u8a2d\u5b9a\u7121\u98a8\u96aa\u5229\u7387</li> </ul> </li> <li> <p><code>before_trading_start</code> (<code>function</code>, optional)</p> <ul> <li>\u7528\u9014\uff1a\u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u958b\u76e4\u524d\u57f7\u884c\u4e00\u6b21\u7684\u51fd\u6578\uff0c\u901a\u5e38\u7528\u65bc\u76e4\u524d\u6578\u64da\u6e96\u5099\u3002</li> <li>\u8a73\u898b\uff1a\u751f\u547d\u9031\u671f\u51fd\u6578</li> </ul> </li> <li> <p><code>warm_up_days</code> (<code>int</code>, optional)</p> <ul> <li>\u7528\u9014\uff1a\u8a2d\u5b9a\u5728\u56de\u6e2c\u958b\u59cb\u524d\uff0c\u7b56\u7565\u9700\u8981\u300c\u9810\u71b1\u300d\u7684\u4ea4\u6613\u65e5\u6578\u3002\u9019\u4e9b\u5929\u6578\u7684\u6578\u64da\u6703\u88ab\u52a0\u8f09\uff0c\u4f46\u4e0d\u6703\u57f7\u884c\u4ea4\u6613\u6216\u8a18\u9304\u7e3e\u6548\uff0c\u4ee5\u78ba\u4fdd\u56e0\u5b50\u8a08\u7b97\u6709\u8db3\u5920\u7684\u6b77\u53f2\u6578\u64da\u3002</li> <li>\u9810\u8a2d\uff1a0</li> </ul> </li> <li> <p><code>metrics_set</code> (<code>zipline.finance.metrics.MetricsSet</code>, optional)</p> <ul> <li>\u7528\u9014\uff1a\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u7e3e\u6548\u6307\u6a19\u96c6\u3002\u901a\u5e38\u4f7f\u7528\u9810\u8a2d\u503c\u3002</li> </ul> </li> </ul>"},{"location":"how-to/backtest/simulation-params/#2-simulationparameters","title":"2. <code>SimulationParameters</code> \u7269\u4ef6 (\u9032\u968e)","text":"<p>\u5728 Zipline \u7684\u5167\u90e8\uff0c\u9019\u4e9b <code>run_algorithm()</code> \u7684\u53c3\u6578\u6700\u7d42\u6703\u88ab\u5c01\u88dd\u6210\u4e00\u500b <code>SimulationParameters</code> \u7269\u4ef6\u3002\u5c0d\u65bc\u5927\u591a\u6578\u4f7f\u7528\u8005\u800c\u8a00\uff0c\u76f4\u63a5\u900f\u904e <code>run_algorithm()</code> \u50b3\u5165\u53c3\u6578\u5df2\u7d93\u8db3\u5920\u3002</p> <p>\u7136\u800c\uff0c\u5982\u679c\u60a8\u9700\u8981\u66f4\u7d30\u7c92\u5ea6\u7684\u63a7\u5236\uff0c\u4f8b\u5982\u81ea\u5b9a\u7fa9 Zipline \u7684\u884c\u70ba\uff0c\u53ef\u4ee5\u624b\u52d5\u69cb\u5efa <code>SimulationParameters</code> \u7269\u4ef6\u3002\u4f46\u9019\u901a\u5e38\u5c6c\u65bc\u9032\u968e\u7528\u6cd5\uff0c\u4e14\u5728 TQuant Lab \u4e2d\u8f03\u5c11\u76f4\u63a5\u64cd\u4f5c\u3002</p>"},{"location":"how-to/backtest/simulation-params/#3","title":"3. \u7bc4\u4f8b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u500b\u7d50\u5408\u591a\u500b\u6a21\u64ec\u53c3\u6578\u7684 <code>run_algorithm()</code> \u7bc4\u4f8b\uff1a</p> <pre><code>import pandas as pd\nfrom zipline import run_algorithm\nfrom zipline.api import (\n    set_benchmark,\n    symbol,\n    order_target_percent\n)\nfrom zipline.utils.calendar_utils import get_calendar\n\n# \u5047\u8a2d\u9019\u662f\u60a8\u7684\u7b56\u7565\u908f\u8f2f\ndef initialize(context):\n    set_benchmark(symbol('IR0001'))\n    context.asset = symbol('2330')\n    context.ordered = False\n\ndef handle_data(context, data):\n    if not context.ordered:\n        order_target_percent(context.asset, 1.0)\n        context.ordered = True\n\ndef analyze(context, results):\n    print(\"\u56de\u6e2c\u5206\u6790\u5b8c\u6210\u3002\")\n\n# \u8a2d\u5b9a\u7121\u98a8\u96aa\u5229\u7387 (\u4f8b\u5982\uff1a\u4f7f\u7528\u56fa\u5b9a\u7684\u5e74\u5316 1% \u7121\u98a8\u96aa\u5229\u7387)\nstart_date = pd.Timestamp('2020-01-01', tz='utc')\nend_date = pd.Timestamp('2022-01-01', tz='utc')\ndate_range = pd.date_range(start=start_date, end=end_date, freq='D', tz='utc')\nfixed_treasury_returns = pd.Series(data=(0.01 / 252), index=date_range) # \u5047\u8a2d 252 \u500b\u4ea4\u6613\u65e5\n\n# \u57f7\u884c\u56de\u6e2c\nresults = run_algorithm(\n    start=start_date,\n    end=end_date,\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=500_000,              # \u521d\u59cb\u8cc7\u91d1 50 \u842c\n    data_frequency='daily',           # \u65e5\u983b\u6578\u64da\n    bundle='tquant',                  # \u4f7f\u7528 'tquant' \u8cc7\u6599\u5305\n    trading_calendar=get_calendar('TEJ_XTAI'), # \u6307\u5b9a\u53f0\u7063\u80a1\u7968\u4ea4\u6613\u65e5\u66c6\n    benchmark_symbol='IR0001',        # \u8a2d\u5b9a Benchmark \u70ba IR0001\n    treasury_returns=fixed_treasury_returns, # \u81ea\u5b9a\u7fa9\u7121\u98a8\u96aa\u5229\u7387\n    warm_up_days=50                   # \u9810\u71b1 50 \u500b\u4ea4\u6613\u65e5\n)\n</code></pre>"},{"location":"how-to/data/get-benchmark-roi/","title":"\u5982\u4f55\u8a2d\u5b9a\u8207\u53d6\u5f97 Benchmark \u5831\u916c\u7387","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b\u5982\u4f55\u5728 Zipline \u56de\u6e2c\u4e2d\u8a2d\u5b9a\u8207\u53d6\u5f97 Benchmark \u5831\u916c\u7387\u7684\u8a73\u7d30\u6307\u5357\uff0c\u5305\u62ec <code>set_benchmark()</code> \u7684\u4f7f\u7528\u65b9\u6cd5\u548c Benchmark \u5831\u916c\u7387\u7684\u8a08\u7b97\u65b9\u5f0f\u3002</p> <p>\u5728\u91cf\u5316\u5206\u6790\u4e2d\uff0cBenchmark (\u5927\u76e4/\u5e02\u5834\u57fa\u6e96) \u662f\u4e00\u500b\u8861\u91cf\u60a8\u7684\u6295\u8cc7\u7b56\u7565\u8868\u73fe\u597d\u58de\u7684\u95dc\u9375\u6307\u6a19\u3002\u900f\u904e\u5c07\u7b56\u7565\u7684\u5831\u916c\u7387\u8207 Benchmark \u7684\u5831\u916c\u7387\u9032\u884c\u6bd4\u8f03\uff0c\u60a8\u53ef\u4ee5\u5ba2\u89c0\u5730\u8a55\u4f30\u7b56\u7565\u662f\u5426\u7522\u751f\u4e86\u8d85\u8d8a\u5e02\u5834\u7684\u300c\u8d85\u984d\u5831\u916c (Alpha)\u300d\u3002</p> <p>\u5728 TQuant Lab (Zipline) \u4e2d\uff0c\u8a2d\u5b9a Benchmark \u4e3b\u8981\u900f\u904e <code>set_benchmark()</code> \u51fd\u6578\u5b8c\u6210\uff0c\u5176\u7d50\u679c\u4e3b\u8981\u7528\u65bc Pyfolio \u7e3e\u6548\u5831\u8868 \u7684\u8996\u89ba\u5316\u5206\u6790\u3002</p>"},{"location":"how-to/data/get-benchmark-roi/#1-benchmark","title":"1. \u8a2d\u5b9a Benchmark","text":"<p>\u60a8\u901a\u5e38\u6703\u5728 <code>initialize</code> \u51fd\u6578\u4e2d\u547c\u53eb <code>set_benchmark()</code> \u4f86\u6307\u5b9a\u672c\u6b21\u56de\u6e2c\u8981\u4f7f\u7528\u7684\u5e02\u5834\u57fa\u6e96\u3002</p> <p>Important</p> <p>\u7528\u65bc\u8a2d\u5b9a Benchmark \u7684\u8cc7\u7522 (\u7121\u8ad6\u662f\u6307\u6578\u6216\u500b\u80a1)\uff0c\u90fd\u5fc5\u9808 \u9810\u5148\u900f\u904e <code>ingest</code> \u6307\u4ee4\u532f\u5165 \u81f3 <code>tquant</code> \u8cc7\u6599\u5305\u4e2d\u3002</p>"},{"location":"how-to/data/get-benchmark-roi/#_1","title":"\u65b9\u6cd5\u4e00\uff1a\u4f7f\u7528\u9810\u8a2d\u7684\u5e02\u5834\u6307\u6578","text":"<p>TQuant Lab \u9810\u8a2d\u4f7f\u7528 <code>'IR0001'</code> (\u53f0\u7063\u52a0\u6b0a\u5831\u916c\u6307\u6578) \u4f5c\u70ba\u5e02\u5834\u57fa\u6e96\u3002\u9019\u662f\u6700\u5e38\u7528\u7684\u8a2d\u5b9a\u65b9\u6cd5\u3002</p> <pre><code>from zipline.api import set_benchmark, symbol\n\ndef initialize(context):\n    # \u5c07\u53f0\u7063\u52a0\u6b0a\u5831\u916c\u6307\u6578\u8a2d\u5b9a\u70ba Benchmark\n    set_benchmark(symbol('IR0001'))\n</code></pre>"},{"location":"how-to/data/get-benchmark-roi/#benchmark_1","title":"\u65b9\u6cd5\u4e8c\uff1a\u4f7f\u7528\u81ea\u5b9a\u7fa9\u7684\u80a1\u7968\u4f5c\u70ba Benchmark","text":"<p>\u60a8\u4e5f\u53ef\u4ee5\u6307\u5b9a\u4efb\u610f\u4e00\u652f\u80a1\u7968\u4f5c\u70ba Benchmark\uff0c\u4f8b\u5982\uff0c\u5c07\u53f0\u7a4d\u96fb (<code>'2330'</code>) \u4f5c\u70ba\u6bd4\u8f03\u57fa\u6e96\uff0c\u4ee5\u8a55\u4f30\u60a8\u7684\u7b56\u7565\u76f8\u5c0d\u65bc\u7279\u5b9a\u9f8d\u982d\u80a1\u7684\u8868\u73fe\u3002</p> <pre><code>from zipline.api import set_benchmark, symbol\n\ndef initialize(context):\n    # \u5c07\u53f0\u7a4d\u96fb (2330) \u8a2d\u5b9a\u70ba Benchmark\n    set_benchmark(symbol('2330'))\n</code></pre>"},{"location":"how-to/data/get-benchmark-roi/#2-benchmark","title":"2. \u53d6\u5f97 Benchmark \u5831\u916c\u7387","text":"<p>\u5728 TQuant Lab \u7684\u5de5\u4f5c\u6d41\u7a0b\u4e2d\uff0c\u60a8 \u901a\u5e38\u4e0d\u9700\u8981\u624b\u52d5\u547c\u53eb <code>get_benchmark_returns()</code>\u3002</p> <p>\u7576\u60a8\u57f7\u884c\u56de\u6e2c\u4e26\u7522\u751f Pyfolio \u5831\u8868\u6642\uff0cZipline \u6703\u5728\u5f8c\u53f0\u81ea\u52d5\u6839\u64da\u60a8\u7528 <code>set_benchmark()</code> \u8a2d\u5b9a\u7684\u57fa\u6e96\uff0c\u8a08\u7b97\u6bcf\u65e5\u7684 Benchmark \u5831\u916c\u7387\uff0c\u4e26\u5c07\u5176\u8207\u60a8\u7684\u7b56\u7565\u5831\u916c\u7387\u4e26\u5217\u5448\u73fe\u5728\u5716\u8868\u548c\u6578\u64da\u7d71\u8a08\u4e2d\u3002</p> <p>Benchmark \u7684\u6bcf\u65e5\u5831\u916c\u7387\u8a08\u7b97\u65b9\u5f0f\u70ba\uff1a<code>(\u7576\u65e5\u6536\u76e4\u50f9 / \u524d\u4e00\u65e5\u6536\u76e4\u50f9) - 1</code>\u3002</p> <p>\u5982\u679c\u60a8\u78ba\u5be6\u5728\u7279\u6b8a\u5834\u666f\u4e0b\u9700\u8981\u624b\u52d5\u53d6\u5f97 Benchmark \u7684\u6b77\u53f2\u5831\u916c\u5e8f\u5217\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>get_benchmark_returns()</code> \u51fd\u6578\uff0c\u4f46\u9019\u5728\u591a\u6578\u5206\u6790\u6d41\u7a0b\u4e2d\u4e26\u975e\u5fc5\u8981\u6b65\u9a5f\u3002</p> <pre><code>from zipline.api import get_benchmark_returns, date_rules, time_rules\n\ndef initialize(context):\n    # ... (\u8a2d\u5b9a benchmark)\n\n    # \u7bc4\u4f8b\uff1a\u6bcf\u65e5\u958b\u76e4\u5f8c\u53d6\u5f97 benchmark \u6b77\u53f2\u5831\u916c\n    schedule_function(\n        log_benchmark,\n        date_rules.every_day(),\n        time_rules.market_open()\n    )\n\ndef log_benchmark(context, data):\n    # \u53d6\u5f97\u5f9e\u56de\u6e2c\u958b\u59cb\u5230\u7576\u5929\u7684 benchmark \u5831\u916c\u7387 (\u4e00\u500b Pandas Series)\n    # \u6ce8\u610f\uff1a\u6b64\u51fd\u6578\u5728 TQuant Lab \u7bc4\u4f8b\u4e2d\u8f03\u5c11\u88ab\u76f4\u63a5\u4f7f\u7528\n    benchmark_returns = get_benchmark_returns() \n    print(benchmark_returns.tail())\n</code></pre>"},{"location":"how-to/data/get-risk-free-rate/","title":"\u5982\u4f55\u8a2d\u5b9a\u7121\u98a8\u96aa\u5229\u7387 (Risk-Free Rate)","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b\u5982\u4f55\u5728 Zipline \u56de\u6e2c\u4e2d\u8a2d\u5b9a\u7121\u98a8\u96aa\u5229\u7387\u7684\u8a73\u7d30\u6307\u5357\uff0c\u5305\u62ec <code>run_algorithm()</code> \u7684\u53c3\u6578\u8a2d\u5b9a\u548c <code>TargetPercentPipeAlgo</code> \u7684\u9078\u9805\uff0c\u5e6b\u52a9\u60a8\u7cbe\u78ba\u8a08\u7b97\u7b56\u7565\u7e3e\u6548\u6307\u6a19\u3002</p> <p>\u5728\u91cf\u5316\u5206\u6790\u4e2d\uff0c\u7121\u98a8\u96aa\u5229\u7387 (Risk-Free Rate) \u662f\u8a08\u7b97\u590f\u666e\u6bd4\u7387 (Sharpe Ratio) \u7b49\u95dc\u9375\u7e3e\u6548\u6307\u6a19\u6642\u4e0d\u53ef\u6216\u7f3a\u7684\u57fa\u6e96\u3002\u5b83\u4ee3\u8868\u4e86\u5728\u6c92\u6709\u627f\u64d4\u4efb\u4f55\u98a8\u96aa\u7684\u60c5\u6cc1\u4e0b\uff0c\u7406\u8ad6\u4e0a\u80fd\u5920\u7372\u5f97\u7684\u6295\u8cc7\u5831\u916c\u7387\u3002</p> <p>\u5728 TQuant Lab \u4e2d\uff0c\u8a2d\u5b9a\u7121\u98a8\u96aa\u5229\u7387\u7684\u65b9\u6cd5\u4e26\u975e\u4f7f\u7528 <code>set_risk_free_rate</code>\uff0c\u800c\u662f\u6839\u64da\u60a8\u7684\u4f7f\u7528\u5834\u666f\uff0c\u900f\u904e <code>run_algorithm()</code> \u51fd\u6578\u6216 <code>TargetPercentPipeAlgo</code> \u985e\u5225\u7684\u53c3\u6578\u4f86\u6307\u5b9a\u3002</p>"},{"location":"how-to/data/get-risk-free-rate/#run_algorithm","title":"\u65b9\u6cd5\u4e00\uff1a\u5728 run_algorithm() \u4e2d\u50b3\u5165\u81ea\u5b9a\u7fa9\u5229\u7387","text":"<p>\u7576\u60a8\u547c\u53eb <code>run_algorithm()</code> \u4f86\u57f7\u884c\u56de\u6e2c\u6642\uff0c\u53ef\u4ee5\u900f\u904e <code>treasury_returns</code> \u53c3\u6578\u50b3\u5165\u4e00\u500b\u81ea\u5b9a\u7fa9\u7684\u7121\u98a8\u96aa\u5229\u7387\u6642\u9593\u5e8f\u5217\u3002\u9019\u7d66\u4e86\u60a8\u6700\u9ad8\u7684\u5f48\u6027\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u4f86\u6e90\u7684\u6578\u64da\u4f5c\u70ba\u7121\u98a8\u96aa\u5229\u7387\u3002</p> <ul> <li>\u53c3\u6578: <code>treasury_returns</code></li> <li>\u985e\u578b: <code>pandas.Series</code></li> <li>\u7d22\u5f15 (Index): \u65e5\u671f (datetimes)</li> <li>\u503c (Values): \u6bcf\u65e5\u7684\u7121\u98a8\u96aa\u5831\u916c\u7387 (float)</li> </ul>"},{"location":"how-to/data/get-risk-free-rate/#2","title":"\u7bc4\u4f8b\uff1a\u8a2d\u5b9a\u4e00\u500b\u56fa\u5b9a\u7684 2% \u5e74\u5316\u7121\u98a8\u96aa\u5229\u7387","text":"<p>\u5728\u4ee5\u4e0b\u7bc4\u4f8b\u4e2d\uff0c\u6211\u5011\u5275\u5efa\u4e00\u500b\u8207\u56de\u6e2c\u671f\u9593\u9577\u5ea6\u76f8\u540c\u7684 <code>pd.Series</code>\uff0c\u6bcf\u65e5\u5229\u7387\u70ba <code>0.02 / 252</code> (\u5047\u8a2d\u4e00\u5e74\u6709 252 \u500b\u4ea4\u6613\u65e5)\u3002</p> <pre><code>import pandas as pd\nfrom zipline import run_algorithm\n\n# ... (\u5b9a\u7fa9\u60a8\u7684 initialize, handle_data, analyze \u51fd\u6578)\n\nstart_date = pd.Timestamp('2020-01-01', tz='UTC')\nend_date = pd.Timestamp('2023-01-01', tz='UTC')\n\n# \u5275\u5efa\u4e00\u500b\u56fa\u5b9a\u7684\u6bcf\u65e5\u7121\u98a8\u96aa\u5229\u7387\u5e8f\u5217\ndate_range = pd.date_range(start=start_date, end=end_date, freq='D', tz='UTC')\nfixed_rate_series = pd.Series(data=(0.02 / 252), index=date_range)\n\n# \u57f7\u884c\u56de\u6e2c\u6642\u50b3\u5165 treasury_returns \u53c3\u6578\nresults = run_algorithm(\n    start=start_date,\n    end=end_date,\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=1e7,\n    bundle='tquant',\n    treasury_returns=fixed_rate_series  # &lt;--- \u5728\u6b64\u50b3\u5165\n)\n</code></pre>"},{"location":"how-to/data/get-risk-free-rate/#targetpercentpipealgo","title":"\u65b9\u6cd5\u4e8c\uff1a\u4f7f\u7528 TargetPercentPipeAlgo \u7684\u9810\u8a2d\u9078\u9805","text":"<p><code>TargetPercentPipeAlgo</code> \u662f TQuant Lab \u4e2d\u4e00\u500b\u65b9\u4fbf\u7684 Pipeline \u6f14\u7b97\u6cd5\u985e\u5225\u3002\u5728\u521d\u59cb\u5316\u6b64\u985e\u5225\u6642\uff0c\u60a8\u53ef\u4ee5\u900f\u904e <code>zero_treasury_returns</code> \u53c3\u6578\u4f86\u63a7\u5236\u7121\u98a8\u96aa\u5229\u7387\u7684\u884c\u70ba\u3002</p> <ul> <li>\u53c3\u6578: <code>zero_treasury_returns</code></li> <li>\u985e\u578b: <code>bool</code> (\u5e03\u6797\u503c)</li> </ul>"},{"location":"how-to/data/get-risk-free-rate/#_1","title":"\u7528\u6cd5","text":"<ul> <li> <p><code>zero_treasury_returns=True</code> (\u9810\u8a2d\u503c)</p> <ul> <li>\u9019\u6703\u5c07\u6574\u500b\u56de\u6e2c\u671f\u9593\u7684\u7121\u98a8\u96aa\u5229\u7387 \u8a2d\u5b9a\u70ba 0 \u3002\u9019\u662f\u6700\u7c21\u55ae\u7684\u65b9\u5f0f\uff0c\u9069\u7528\u65bc\u4e0d\u8003\u616e\u7121\u98a8\u96aa\u5229\u7387\u6216\u5e0c\u671b\u7c21\u5316\u8a08\u7b97\u7684\u5834\u666f\u3002</li> </ul> </li> <li> <p><code>zero_treasury_returns=False</code></p> <ul> <li>TQuant Lab \u6703\u81ea\u52d5\u900f\u904e TEJ API \u53d6\u5f97 \u7b2c\u4e00\u9280\u884c\u7684\u5e74\u5b9a\u5b58\u5229\u7387 \u4f5c\u70ba\u6bcf\u65e5\u7684\u7121\u98a8\u96aa\u5229\u7387\u3002</li> <li> <p>Important</p> <pre><code>\u4f7f\u7528\u6b64\u9078\u9805 (`False`) \u5c07\u6703 **\u6d88\u8017\u60a8\u7684 TEJ API \u6d41\u91cf** \u3002\n</code></pre> </li> </ul> </li> </ul>"},{"location":"how-to/data/get-risk-free-rate/#_2","title":"\u7bc4\u4f8b","text":"<pre><code>from zipline.algo.pipeline_algo import TargetPercentPipeAlgo\n\n# ... (\u5b9a\u7fa9\u60a8\u7684 create_pipeline \u51fd\u6578)\n\n# \u521d\u59cb\u5316\u6f14\u7b97\u6cd5\uff0c\u4e26\u8a2d\u5b9a\u4f7f\u7528 TEJ API \u63d0\u4f9b\u7684\u7121\u98a8\u96aa\u5229\u7387\nalgo = TargetPercentPipeAlgo(\n    create_pipeline=create_pipeline,\n    zero_treasury_returns=False  # &lt;--- \u5728\u6b64\u8a2d\u5b9a\n)\n\n# ... (\u4f7f\u7528 run_algorithm \u57f7\u884c algo)\n</code></pre>"},{"location":"how-to/data/ingest-spot-pricing/","title":"\u5982\u4f55 Ingest \u80a1\u7968\u50f9\u91cf\u8cc7\u6599","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b\u5982\u4f55\u5c07\u80a1\u7968\u50f9\u91cf\u8cc7\u6599 Ingest \u5230 TQuant Lab \u7684\u8a73\u7d30\u6307\u5357\uff0c\u4e26\u8aaa\u660e\u76f8\u95dc\u7684\u53c3\u6578\u8a2d\u5b9a\u8207\u6b65\u9a5f\u3002</p> <p>\u672c\u8ab2\u7a0b\u5be6\u4f5c\u5982\u4f55\u5c07\u8cc7\u6599\uff08\u5982\u50f9\u91cf\u3001\u57fa\u672c\u9762\u3001\u7c4c\u78bc\u9762\u7b49\uff09ingest \u5230 zipline \u56de\u6e2c\u5f15\u64ce\u4e2d\u3002\u900f\u904e\u9019\u500b\u52d5\u4f5c\uff0c\u5f8c\u7e8c\u4f7f\u7528 Pipeline API \u6642\uff0c\u5c31\u53ef\u4ee5\u5f88\u6709\u6548\u7387\u5730\u7372\u53d6\u8cc7\u6599\u4e26\u8a08\u7b97\u56e0\u5b50\u3002</p>"},{"location":"how-to/data/ingest-spot-pricing/#1","title":"1. \u8f09\u5165\u6240\u9700\u5957\u4ef6","text":"<pre><code>import os\n</code></pre>"},{"location":"how-to/data/ingest-spot-pricing/#2-bundle","title":"2. Bundle \u8a2d\u7f6e","text":"<p>\u4ecb\u7d39\u74b0\u5883\u8b8a\u6578\u8a2d\u5b9a\uff0c\u4e26\u904b\u7528\u8a2d\u5b9a\u7684\u74b0\u5883\u8b8a\u6578\u505a\u50f9\u91cf\u3001\u975e\u50f9\u91cf\u8cc7\u6599\u7684 bundle\u3002</p> <p>\u5728 import zipline \u524d\uff0c\u5fc5\u9808\u5148\u8a2d\u5b9a\u4ee5\u4e0b\u74b0\u5883\u8b8a\u6578(os.environ)\uff1a</p>"},{"location":"how-to/data/ingest-spot-pricing/#bundletquant-bundle","title":"\u50f9\u91cf\u8cc7\u6599 bundle\uff08tquant bundle\uff09\u8a2d\u5b9a","text":"<ul> <li><code>os.environ['TEJAPI_BASE'] = \"https://api.tej.com.tw\"</code><ul> <li>\u7528\u65bc\u9023\u7d50TEJ\u8cc7\u6599\u5eab</li> </ul> </li> <li><code>os.environ['TEJAPI_KEY'] = \"Your_Key\"</code><ul> <li>\u7528\u65bc\u8b58\u5225\u4f7f\u7528\u8005</li> </ul> </li> <li><code>os.environ['ticker'] = \"xxxx xxxx xxxx\"</code><ul> <li>\u8a2d\u7f6e\u6211\u5011\u6240\u9700\u8981\u7684\u80a1\u7968\u4ee3\u78bc</li> </ul> </li> <li><code>os.environ['mdate'] = \"yyyymmdd yyyymmdd\"</code><ul> <li>\u8a2d\u7f6e\u53d6\u5f97\u8cc7\u6599\u7684\u8d77\u59cb\u6642\u9593\u8207\u7d50\u675f\u6642\u9593</li> </ul> </li> <li><code>!zipline ingest -b tquant</code><ul> <li>\u5c07\u4e0a\u65b9\u8cc7\u6599 ingest \u9032 bundle\u3002</li> </ul> </li> </ul>"},{"location":"how-to/data/ingest-spot-pricing/#bundlefundamentals-bundle","title":"\u975e\u50f9\u91cf\u8cc7\u6599 bundle\uff08fundamentals bundle\uff09\u9700\u8981\u7684\u8cc7\u8a0a\uff1a","text":"<ul> <li><code>os.environ['fields'] = 'field1, field2, field3'</code><ul> <li>\u8a2d\u7f6e\u6488\u53d6\u975e\u50f9\u91cf\u8cc7\u6599\u7684\u6b04\u4f4d\uff0c\u5176\u4e2d field1\u3001field2\u3001field3 \u4ee3\u8868\u8cc7\u6599\u6b04\u4f4d\u540d\u7a31</li> </ul> </li> <li><code>os.environ['include_self_acc'] = 'N'(\u9810\u8a2d)</code><ul> <li>\u8a2d\u7f6e\u662f\u5426\u6db5\u84cb\u516c\u53f8\u81ea\u7d50\u8ca1\u52d9\uff0c\u5176\u4e2d\u8a2d\u5b9a<code>'Y'</code>\u4ee3\u8868\u8ca1\u52d9\u8cc7\u6599\u5305\u542b\u81ea\u7d50\u8ca1\u52d9\uff0c<code>'N'</code>\u5247\u8868\u793a\u4e0d\u5305\u542b</li> </ul> </li> <li><code>!zipline ingest -b fundamentals</code><ul> <li>\u5c07\u975e\u50f9\u91cf\u8cc7\u6599 ingest \u9032 bundle\u3002</li> </ul> </li> </ul>"},{"location":"how-to/data/ingest-spot-pricing/#3-zipline-ingest","title":"3. \u57f7\u884c zipline ingest \u8f09\u5165\u50f9\u91cf\u8cc7\u6599","text":"<p>\u50f9\u91cf\u8cc7\u6599\u6307 OHLCV \u8207\u9664\u6b0a\u606f\u76f8\u95dc\u8cc7\u8a0a\u3002\u4ee5\u4e0b\u7bc4\u4f8b\u8f09\u5165\u6307\u5b9a\u80a1\u7968\u50f9\u91cf\u8cc7\u6599\uff0c\u5176\u4e2d IR0001 \u70ba\u53f0\u7063\u767c\u884c\u91cf\u52a0\u6b0a\u80a1\u50f9\u5831\u916c\u6307\u6578\u3002</p> <pre><code>tickers = 'IR0001 0050 0056 00737 1108 1101 1102 1103 6243 6451 1216 1301 1303 1326 1402 1476 1590 1605 1722 1802 2002 2105 2201 2207 2227 2301 2939 4108 4148 6431 6541 6657 2883 2891 2543 2929 2303 6505 9926 2308 2311 2317 2324 2325 2327 2330 2347 2353 2354 2357 2379 2382 2395 2408 2409 2412 2448 2454 2474 2492 2498 2603 2609 2615 2618 2633 2801 2823 2880 2881 2882 2883 2884 2885 2886 2887 2888 2890 2891 2892 2912 3008 3009 3034 3037 3045 3231 3474 3481 3673 3697 3711 4904 4938 5854 5871 5876 5880 6239 6415 6505 6669 6770 8046 8454 9904 9910'\nprint(\"\u7e3d\u5171\u6709 :\",len(tickers.split()),\"\u7b46\u8cc7\u6599\")\n\n\nos.environ[\"TEJAPI_BASE\"] = 'https://api.tej.com.tw'\nos.environ['TEJAPI_KEY'] = \"Your_Key\"\nos.environ['ticker'] = tickers\nos.environ['mdate'] = '20200103 20230530'\n\n!zipline ingest -b tquant\n</code></pre>"},{"location":"how-to/data/ingest-spot-pricing/#4-simple_ingest","title":"4. \u4f7f\u7528 simple_ingest() \u8f09\u5165\u50f9\u91cf\u8cc7\u6599","text":"<p><code>simple_ingest()</code>\u51fd\u6578\u63d0\u4f9b\u53e6\u4e00\u7a2e\u53d6\u5f97\u6307\u5b9a\u80a1\u7968\u50f9\u91cf\u8cc7\u6599\u7684\u65b9\u6cd5\uff0c\u8cc7\u6599\u540c\u6a23\u6703\u5b58\u5165 bundle \u4e2d\uff1a</p> <p><code>simple_ingest()</code>\u51fd\u6578\u8f09\u5165\u50f9\u91cf\u8cc7\u6599\u6240\u9700\u53c3\u6578\u8cc7\u8a0a\u5982\u4e0b\uff1a</p> <ul> <li><code>name</code> (<code>str</code>) = <code>'tquant'</code><ul> <li>\u5b9a\u7fa9 bundle \u540d\u7a31</li> </ul> </li> <li><code>tickers</code> (<code>list</code> or <code>str</code>) = <code>['xxxx', 'xxxx', 'xxxx']</code> or <code>'xxxx xxxx xxxx'</code><ul> <li>\u8a2d\u7f6e\u6211\u5011\u9700\u8981\u7684\u80a1\u7968\u4ee3\u78bc</li> </ul> </li> <li><code>start_date</code> (<code>str</code>) = <code>'yyyy-mm-dd'</code><ul> <li>\u8a2d\u7f6e\u8d77\u59cb\u65e5\u671f</li> </ul> </li> <li><code>end_date</code> (<code>str</code>) = <code>'yyyy-mm-dd'</code><ul> <li>\u8a2d\u7f6e\u7d50\u675f\u65e5\u671f</li> </ul> </li> </ul> <p>Important</p> <p>\u8acb\u6ce8\u610f\uff0c<code>zipline ingest</code> \u548c <code>zipline add</code> \u6307\u4ee4\u5728\u57f7\u884c\u6642\u6703\u9023\u63a5\u81f3 TEJ \u4f3a\u670d\u5668\u4ee5\u8f09\u5165\u8cc7\u6599\u3002\u9019\u6703 \u6d88\u8017\u60a8\u7684 TEJ API \u6d41\u91cf\u3002</p> <pre><code>from zipline.data.run_ingest import simple_ingest\n\nstart = '2020-01-03'\nend = '2023-05-30'\n\nsimple_ingest(name = 'tquant',\n              tickers = tickers,\n              start_date = start,\n              end_date = end\n              )\n</code></pre>"},{"location":"how-to/data/ingest-spot-pricing/#5","title":"5. \u66f4\u65b0\u50f9\u91cf\u8cc7\u6599","text":"<p>\u900f\u904e\u8f38\u5165 <code>zipline update -b tquant</code> \u6307\u4ee4\uff0c\u53ef\u4ee5\u66f4\u65b0\u7576\u524d\u4f7f\u7528\u7684 tquant bundle\uff0c\u4ee5\u7372\u5f97\u6700\u65b0\u7684\u4ea4\u6613\u50f9\u683c\u548c\u4ea4\u6613\u91cf\u8cc7\u8a0a\u3002</p> <p><pre><code># \u57f7\u884c\u524d\n!zipline bundle-info\n</code></pre> <pre><code>!zipline update -b tquant\n</code></pre> <pre><code># \u57f7\u884c\u5f8c\n!zipline bundle-info\n</code></pre></p>"},{"location":"how-to/data/ingest-spot-pricing/#6","title":"6. \u65b0\u589e\u50f9\u91cf\u8cc7\u6599","text":"<p>\u4f7f\u7528 <code>zipline add -t &lt;tickers_want_to_add&gt;</code> \u6307\u4ee4\uff0c\u53ef\u4ee5\u5411\u73fe\u6709\u7684 tquant bundle \u4e2d\u65b0\u589e\u6240\u9078\u7684\u80a1\u7968\u3002</p> <p><pre><code># \u57f7\u884c\u524d\n!zipline bundle-info\n</code></pre> <pre><code>!zipline add -t \"6523 6208\"\n</code></pre> <pre><code># \u57f7\u884c\u5f8c\n!zipline bundle-info\n</code></pre></p>"},{"location":"how-to/data/ingest-tej-fundamental/","title":"\u5982\u4f55 Ingest TEJ \u8ca1\u52d9/\u975e\u8ca1\u52d9\u8cc7\u6599","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b\u5982\u4f55\u5c07 TEJ \u8ca1\u52d9/\u975e\u8ca1\u52d9\u8cc7\u6599 Ingest \u5230 TQuant Lab \u7684\u8a73\u7d30\u6307\u5357\uff0c\u4e26\u8aaa\u660e\u76f8\u95dc\u7684\u53c3\u6578\u8a2d\u5b9a\u8207\u6b65\u9a5f\u3002</p>"},{"location":"how-to/data/ingest-tej-fundamental/#1-zipline-ingest","title":"1. \u4f7f\u7528 zipline ingest \u8f09\u5165\u975e\u50f9\u91cf\u8cc7\u6599","text":"<ul> <li>\u6b04\u4f4d\u5c0d\u7167\u6e05\u55ae\u53ef\u53c3\u8003TQuant\u5b98\u65b9\u7db2\u7ad9\u6700\u4e0b\u65b9\u7684 TEJ TOOL API \u6b04\u4f4d\u5c0d\u7167\u6e05\u55ae\u3002 \u8a2d\u5b9a\u5b8c <code>os.environ['fields']</code> \u5f8c\uff0c\u4fbf\u53ef\u4f7f\u7528 <code>!zipline ingest -b fundamentals</code> \u8f09\u5165\u6240\u9700\u8981\u7684\u975e\u50f9\u91cf\u8cc7\u6599\u3002</li> </ul> <p><pre><code>columns = ['Sales_Growth_Rate','Operating_Income_Growth_Rate', \n           'Pre_Tax_Income_Growth_Rate','Net_Income_Growth_Rate',\n           'Industry_Eng','Industry', 'roi', 'YoY_Monthly_Sales','mktcap']\n</code></pre> <pre><code>os.environ['fields'] = \" \".join(columns)\n!zipline ingest -b fundamentals\n</code></pre></p>"},{"location":"how-to/data/ingest-tej-fundamental/#2-simple_ingest","title":"2. \u4f7f\u7528 simple_ingest() \u8f09\u5165\u975e\u50f9\u91cf\u8cc7\u6599","text":"<p><code>simple_ingest()</code>\u51fd\u6578\u63d0\u4f9b\u53e6\u4e00\u7a2e\u53d6\u5f97\u6307\u5b9a\u80a1\u7968\u975e\u50f9\u91cf\u8cc7\u6599\u7684\u65b9\u6cd5\uff0c\u8cc7\u6599\u540c\u6a23\u6703\u5b58\u5165 bundle \u4e2d\uff1a</p> <p><code>simple_ingest()</code>\u51fd\u6578\u8f09\u5165\u975e\u50f9\u91cf\u8cc7\u6599\u6240\u9700\u53c3\u6578\u8cc7\u8a0a\u5982\u4e0b\uff1a</p> <ul> <li><code>name</code> (<code>str</code>) = <code>'fundamentals'</code><ul> <li>\u5b9a\u7fa9 bundle \u540d\u7a31</li> </ul> </li> <li><code>tickers</code> (<code>list</code> or <code>str</code>) = <code>['xxxx', 'xxxx', 'xxxx']</code> or <code>'xxxx xxxx xxxx'</code><ul> <li>\u8a2d\u7f6e\u6211\u5011\u9700\u8981\u7684\u80a1\u7968\u4ee3\u78bc</li> </ul> </li> <li><code>fields</code> (<code>list</code> or <code>str</code>) = <code>['field1', 'field2', 'field3']</code> or <code>'field1, field2, field3'</code><ul> <li>\u8a2d\u7f6e\u6488\u53d6\u975e\u50f9\u91cf\u8cc7\u6599\u7684\u6b04\u4f4d\uff0c\u5176\u4e2d field1\u3001field2\u3001field3 \u4ee3\u8868\u8cc7\u6599\u6b04\u4f4d\u540d\u7a31</li> </ul> </li> <li><code>start_date</code> (<code>str</code>) = <code>'yyyy-mm-dd'</code><ul> <li>\u8a2d\u7f6e\u8d77\u59cb\u65e5\u671f</li> </ul> </li> <li><code>end_date</code> (<code>str</code>) = <code>'yyyy-mm-dd'</code><ul> <li>\u8a2d\u7f6e\u7d50\u675f\u65e5\u671f</li> </ul> </li> <li><code>self_acc</code> (<code>str</code>) = <code>'N'</code>(\u9810\u8a2d)<ul> <li>\u8a2d\u7f6e\u662f\u5426\u6db5\u84cb\u516c\u53f8\u81ea\u7d50\u8ca1\u52d9\uff0c\u5176\u4e2d\u8a2d\u5b9a<code>'Y'</code>\u4ee3\u8868\u8ca1\u52d9\u8cc7\u6599\u5305\u542b\u81ea\u7d50\u8ca1\u52d9\uff0c<code>'N'</code>\u5247\u8868\u793a\u4e0d\u5305\u542b</li> </ul> </li> </ul> <p>Note</p> <p>\u9810\u8a2d <code>self_acc</code> \u70ba <code>'N'</code>\uff0c\u5373\u4e0d\u5305\u542b\u516c\u53f8\u81ea\u7d50\u8ca1\u52d9\u3002\u82e5\u8981\u5305\u542b\uff0c\u8acb\u8a2d\u5b9a\u70ba <code>'Y'</code>\u3002</p> <pre><code>simple_ingest(name = 'fundamentals',\n              tickers = tickers,\n              fields = columns,\n              start_date = start,\n              end_date = end,\n              # self_acc = 'Y'\n              )\n</code></pre>"},{"location":"how-to/data/ingest-tej-fundamental/#3","title":"3. \u66f4\u65b0\u975e\u50f9\u91cf\u8cc7\u6599","text":"<p>\u900f\u904e\u8f38\u5165 <code>!zipline update -b tquant</code> \u6307\u4ee4\uff0c\u53ef\u4ee5\u66f4\u65b0\u7576\u524d\u4f7f\u7528\u7684 fundamentals bundle\uff0c\u4ee5\u7372\u5f97\u6700\u65b0\u7684\u8cc7\u8a0a\u3002</p> <p><pre><code>## update \u524d\nfrom zipline.data.data_portal import get_fundamentals\ndf = get_fundamentals()\nprint('\u80a1\u7968\u6c60\u70ba:',df['symbol'].unique())\nprint('\u8d77\u59cb\u65e5:',df['date'].min())\nprint('\u7d50\u675f\u65e5:',df['date'].max())\nprint('\u6b04\u4f4d:',df.columns)\n</code></pre> <pre><code>!zipline update -b fundamentals\n</code></pre> <pre><code># update \u5f8c\ndf = get_fundamentals()\nprint('\u80a1\u7968\u6c60\u70ba:',df['symbol'].unique())\nprint('\u8d77\u59cb\u65e5:',df['date'].min())\nprint('\u7d50\u675f\u65e5:',df['date'].max())\nprint('\u6b04\u4f4d:',df.columns)\n</code></pre></p>"},{"location":"how-to/data/ingest-tej-fundamental/#4","title":"4. \u65b0\u589e\u975e\u50f9\u91cf\u8cc7\u6599","text":"<ul> <li> <p>\u57f7\u884c\u6307\u4ee4 <code>zipline add -b fundamentals -t &lt;tickers_want_to_add&gt;</code> \u53ef\u4ee5\u6839\u64da\u7576\u524d fundamentls bundle \u7684\u6b04\u4f4d\uff0c\u65b0\u589e\u6240\u9078\u64c7\u7684\u516c\u53f8\u5230 bundle \u4e2d\u3002</p> </li> <li> <p>\uff08fundamentls bundle \u9650\u5b9a\uff09\u900f\u904e\u6307\u4ee4 <code>!zipline add -b fundamentals -f &lt;columns_want_to_add&gt;</code>\uff08\u5176\u4e2d -f \u4ee3\u8868 field\uff09\u4f86\u65b0\u589e\u7576\u524d\u5df2\u6709\u516c\u53f8\u7684\u6307\u5b9a\u8cc7\u6599\u6b04\u4f4d\u3002</p> </li> <li> <p>\u8acb\u6ce8\u610f\uff0c\u76ee\u524d\u7cfb\u7d71\u4e0d\u652f\u63f4\u540c\u6642\u65b0\u589e\u516c\u53f8\u548c\u8cc7\u6599\u6b04\u4f4d\uff0c\u56e0\u6b64\u9700\u8981\u5206\u5225\u9032\u884c\u9019\u4e9b\u64cd\u4f5c\u3002</p> </li> </ul> <p><pre><code># add \u516c\u53f8\n!zipline add -b fundamentals -t \"6523 6208\"\n</code></pre> <pre><code># add \u516c\u53f8\u5f8c\ndf = get_fundamentals()\nprint('\u80a1\u7968\u6c60\u70ba:',df['symbol'].unique())\nprint('\u8d77\u59cb\u65e5:',df['date'].min())\nprint('\u7d50\u675f\u65e5:',df['date'].max())\nprint('\u6b04\u4f4d:',df.columns)\n</code></pre> <pre><code># add \u6b04\u4f4d\n!zipline add -b fundamentals -f Gross_Margin_Growth_Rate\n</code></pre> <pre><code># add \u6b04\u4f4d\u5f8c\ndf = get_fundamentals()\nprint('\u80a1\u7968\u6c60\u70ba:',df['symbol'].unique())\nprint('\u8d77\u59cb\u65e5:',df['date'].min())\nprint('\u7d50\u675f\u65e5:',df['date'].max())\nprint('\u6b04\u4f4d:',df.columns)\n</code></pre></p>"},{"location":"how-to/data/use-dataframeloader/","title":"\u5982\u4f55\u4f7f\u7528 Pipeline DataFrameLoader \u5efa\u7acb Custom Data","text":"<p>Info</p> <p>\u672c\u9801\u4ecb\u7d39\u5982\u4f55\u4f7f\u7528 <code>DataFrameLoader</code> \u5c07\u5ba2\u88fd\u5316\u6578\u64da\u5c0e\u5165 Zipline Pipeline\uff0c\u4e26\u6f14\u793a\u5176\u5728\u6578\u64da\u6574\u5408\u8207\u8655\u7406\u4e0a\u7684\u61c9\u7528\uff0c\u64f4\u5c55 Pipeline \u7684\u6578\u64da\u4f86\u6e90\u3002</p> <p><code>DataFrameLoader</code> \u5141\u8a31\u5c07\u5ba2\u88fd\u5316\u7684\u6578\u64da\u900f\u904e DataFrame \u5c0e\u5165\u81f3 pipeline \u4e2d\uff0c\u672c\u7bc4\u4f8b\u5c07\u6f14\u793a <code>DataFrameLoader</code> \u7684\u7528\u6cd5\u3002</p>"},{"location":"how-to/data/use-dataframeloader/#imports-settings","title":"Imports &amp; Settings","text":"<pre><code>import os\nimport pandas as pd\n\nos.environ['TEJAPI_BASE'] = 'https://api.tej.com.tw'\nos.environ['TEJAPI_KEY'] = 'YOUR KEY'\n\n\nfrom zipline.pipeline import Pipeline\nfrom zipline.pipeline.loaders import EquityPricingLoader\nfrom zipline.pipeline.loaders.frame import DataFrameLoader\nfrom zipline.pipeline.data import Column, DataSet, TQAltDataSet, EquityPricing\nfrom zipline.pipeline.engine import SimplePipelineEngine\nfrom zipline.pipeline.domain import TW_EQUITIES\n\nfrom zipline.data.data_portal import bundles\nfrom zipline.data.run_ingest import simple_ingest\n\nfrom zipline.sources.TEJ_Api_Data import get_universe\n\nfrom TejToolAPI.TejToolAPI import get_history_data\n</code></pre>"},{"location":"how-to/data/use-dataframeloader/#1-tquant-bundle","title":"1. \u8f09\u5165\u5148\u524d\u5df2\u5c0e\u5165\u7684 tquant bundle","text":"<ul> <li>\u82e5\u5c1a\u672a\u57f7\u884c tquant bundle ingest \u7684\u6d41\u7a0b\uff0c\u8acb\u5148\u57f7\u884c\u4ee5\u4e0b simple_ingest \u7a0b\u5f0f\u3002</li> <li><code>bundles.load</code> \u51fd\u5f0f\u8ca0\u8cac\u5f9e\u5148\u524d\u5df2\u7d93 ingest \u7684 bundle \u4e2d\u8f09\u5165\u6578\u64da\uff0c\u4f7f\u4f7f\u7528\u8005\u80fd\u5920\u5728 Zipline \u74b0\u5883\u4e2d\u5229\u7528 <code>AssetFinder</code> \u5b58\u53d6\u8b49\u5238 <code>SID</code>\uff08Security Identifier\uff09\u3002</li> </ul> <pre><code>start = '2020-01-03'\nend = '2025-02-07'\n\nstart_dt = pd.Timestamp(start, tz='utc')\nend_dt = pd.Timestamp(end, tz='utc')\n\npool = get_universe(start, end, idx_id=['IX0002'])\n\n#simple_ingest(name = 'tquant', tickers = pool, start_date = start , end_date = end)\n</code></pre> <pre><code>bundle_name = 'tquant'\nbundle = bundles.load(bundle_name)\n</code></pre>"},{"location":"how-to/data/use-dataframeloader/#2-symbols","title":"2. \u53d6\u5f97\u8b49\u5238\u6a19\u7684\uff08Symbols\uff09","text":"<p>\u5728 Zipline \u4e2d\uff0c<code>AssetFinder</code> \u662f\u4e00\u500b\u5c08\u9580\u8ca0\u8cac\u7ba1\u7406\u8cc7\u7522\uff08<code>Asset</code>\uff09\u8cc7\u8a0a\u7684\u5de5\u5177\uff0c\u63d0\u4f9b\u67e5\u627e\u548c\u6aa2\u7d22\u8b49\u5238\u6a19\u7684\u7684\u529f\u80fd\u3002\u4ee5\u4e0b\u56db\u884c\u7a0b\u5f0f\u78bc\u5206\u5225\u57f7\u884c\uff1a</p> <ol> <li>\u53d6\u5f97 bundle \u4e2d\u6240\u6709\u80a1\u7968\u7684 <code>SID</code>\u3002</li> <li>\u900f\u904e SID \u53d6\u5f97\u5c0d\u61c9\u7684 <code>Asset</code> \u7269\u4ef6\u3002</li> <li>\u900f\u904e <code>Asset</code> \u7269\u4ef6\u53d6\u5f97\u4ea4\u6613\u4ee3\u78bc\uff08<code>symbol</code>\uff09\u3002</li> <li>\u5efa\u7acb <code>symbol</code> mapping <code>SID</code> \u7684\u5c0d\u7167\u3002</li> </ol> <pre><code>sids = bundle.asset_finder.equities_sids\nassets = bundle.asset_finder.retrieve_all(sids)\nsymbols = [i.symbol for i in assets]\nsymbol_map = dict(zip(symbols, sids))\n</code></pre>"},{"location":"how-to/data/use-dataframeloader/#3-tej-tool-api","title":"3. \u5229\u7528 TEJ TOOL API \u7372\u53d6\u8cc7\u6599","text":"<p>\u9019\u908a\u53d6\u5f97\u5916\u8cc7\u8cb7\u8ce3\u8d85\u5f35\u6578\uff08<code>Qfii_Diff_Vol</code>\uff09\u8cc7\u6599\u4f5c\u70ba\u793a\u7bc4\u3002</p> <pre><code>custom_data = get_history_data(\n    ticker=symbols,\n    columns=['Qfii_Diff_Vol'],\n    start=start,\n    end=end,\n    transfer_to_chinese=False\n)\n</code></pre> <pre><code>custom_data.head()\n</code></pre>"},{"location":"how-to/data/use-dataframeloader/#4-dataframeloader","title":"4. \u6574\u7406\u5916\u90e8\u8cc7\u6599\u4ee5\u7b26\u5408 DataFrameLoader \u8981\u6c42\u7684\u683c\u5f0f","text":"<ul> <li>\u5c07\u5916\u90e8\u8cc7\u6599\u4f5c\u8f49\u7f6e\uff0c\u4e00\u500b\u6b04\u4f4d\u6574\u7406\u70ba\u4e00\u500b DataFrame\u3002</li> <li>\u63a5\u8457\u5c07\u5916\u90e8\u8cc7\u6599\u7684 coid \u66ff\u63db\u6210 <code>SID</code>\u3002</li> <li>\u6700\u5f8c\u5c07\u5916\u90e8\u8cc7\u6599\u7684 mdate \u8a2d\u5b9a\u70ba UTC \u6642\u5340\u3002</li> </ul> <p>\u8a3b\uff1a\u6b64\u8655\u8cc7\u6599\u63a1\u7528 \u4e0d\u5e73\u79fb \u7684\u65b9\u5f0f\u9032\u884c\u8655\u7406</p> <pre><code>transform_data = (\n    custom_data\n    .set_index(['coid', 'mdate'])['Qfii_Diff_Vol']\n    .unstack('coid')\n    .rename(columns=symbol_map, errors='raise') # errors = 'raise' \u6703\u5728\u9047\u5230\u932f\u8aa4\u6642\u62cb\u51fa\u7570\u5e38\uff0c\u907f\u514d bundle \u8207 custom_data \u8cc7\u7522\u4e0d\u4e00\u81f4\n    .tz_localize('UTC')\n)\n</code></pre> <pre><code>transform_data.head()\n</code></pre>"},{"location":"how-to/factor-analysis/alphalens-tearsheet/","title":"\u5982\u4f55\u57f7\u884c Alphalens \u56e0\u5b50\u5206\u6790","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b\u5982\u4f55\u5728 TQuant Lab \u4e2d\u4f7f\u7528 Alphalens \u9032\u884c\u56e0\u5b50\u5206\u6790\u7684\u8a73\u7d30\u6307\u5357\uff0c\u5305\u62ec\u56e0\u5b50\u6578\u64da\u6e96\u5099\u3001\u6e05\u6d17\u3001\u5c0d\u9f4a\uff0c\u4ee5\u53ca\u751f\u6210\u5b8c\u6574\u7684\u56e0\u5b50\u5206\u6790\u5831\u8868 (Tear Sheet)\u3002</p> <p>Alphalens \u662f\u4e00\u500b\u5f37\u5927\u7684 Python \u5eab\uff0c\u5c08\u70ba\u91cf\u5316\u6295\u8cc7\u4e2d\u7684\u56e0\u5b50\uff08Alpha\uff09\u5206\u6790\u800c\u8a2d\u8a08\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u5de5\u5177\uff0c\u7528\u65bc\u8a55\u4f30\u56e0\u5b50\uff08\u5982\u50f9\u503c\u3001\u52d5\u91cf\u3001\u6210\u9577\u7b49\uff09\u7684\u9810\u6e2c\u80fd\u529b\u3001\u6536\u76ca\u8ca2\u737b\u3001\u7a69\u5b9a\u6027\u4ee5\u53ca\u4ea4\u6613\u6210\u672c\u5f71\u97ff\u3002\u900f\u904e Alphalens\uff0c\u60a8\u53ef\u4ee5\u6df1\u5165\u4e86\u89e3\u56e0\u5b50\u7684\u8cea\u91cf\uff0c\u70ba\u7b56\u7565\u958b\u767c\u548c\u512a\u5316\u63d0\u4f9b\u95dc\u9375\u6d1e\u5bdf\u3002</p> <p>\u672c\u6307\u5357\u5c07\u8aaa\u660e\u5982\u4f55\u5c07 Zipline <code>Pipeline</code> \u7522\u751f\u7684\u56e0\u5b50\u6578\u64da\u5c0e\u5165 Alphalens\uff0c\u4e26\u751f\u6210\u5b8c\u6574\u7684\u56e0\u5b50\u5206\u6790\u5831\u8868 (tearsheet)\u3002</p>"},{"location":"how-to/factor-analysis/alphalens-tearsheet/#1","title":"1. \u56e0\u5b50\u6578\u64da\u6e96\u5099","text":"<p>\u5728\u5c07\u56e0\u5b50\u6578\u64da\u50b3\u905e\u7d66 Alphalens \u4e4b\u524d\uff0c\u60a8\u9700\u8981\u5f9e Zipline <code>Pipeline</code> \u7684\u8f38\u51fa\u4e2d\u63d0\u53d6\u56e0\u5b50\u503c\u548c\u76f8\u61c9\u7684\u80a1\u7968\u50f9\u683c\uff0c\u4e26\u5c07\u5b83\u5011\u6574\u7406\u6210 Alphalens \u6240\u9700\u7684\u7279\u5b9a\u683c\u5f0f\u3002<code>alphalens.utils.get_clean_factor_and_forward_returns()</code> \u51fd\u6578\u662f\u5b8c\u6210\u6b64\u6b65\u9a5f\u7684\u6838\u5fc3\u5de5\u5177\u3002</p>"},{"location":"how-to/factor-analysis/alphalens-tearsheet/#_1","title":"\u6838\u5fc3\u6578\u64da\u985e\u578b\uff1a","text":"<ul> <li><code>factor</code>: <code>pd.Series</code>\uff0c\u5305\u542b\u56e0\u5b50\u503c\uff0c\u7d22\u5f15\u901a\u5e38\u70ba <code>(\u65e5\u671f, \u8cc7\u7522)</code> \u7684 MultiIndex\u3002</li> <li><code>prices</code>: <code>pd.DataFrame</code> \u6216 <code>pd.Series</code>\uff0c\u5305\u542b\u80a1\u7968\u7684\u6b77\u53f2\u50f9\u683c\u6578\u64da\uff0c\u901a\u5e38\u662f\u6536\u76e4\u50f9\u3002</li> <li><code>groupby</code>: (\u53ef\u9078) <code>pd.Series</code> \u6216 <code>dict</code>\uff0c\u7528\u65bc\u6307\u5b9a\u80a1\u7968\u7684\u6240\u5c6c\u5206\u7d44\uff08\u4f8b\u5982\u884c\u696d\u3001\u677f\u584a\uff09\uff0c\u4ee5\u4fbf\u9032\u884c\u5206\u7d44\u5206\u6790\u3002</li> </ul>"},{"location":"how-to/factor-analysis/alphalens-tearsheet/#get_clean_factor_and_forward_returns","title":"\u6578\u64da\u63d0\u53d6\u8207\u6e05\u6d17\u51fd\u6578\uff1aget_clean_factor_and_forward_returns()","text":"<p>\u6b64\u51fd\u6578\u6703\u6e05\u6d17\u56e0\u5b50\u6578\u64da\uff08\u8655\u7406 NaN \u503c\u3001\u6975\u7aef\u503c\u7b49\uff09\uff0c\u4e26\u6839\u64da\u63d0\u4f9b\u7684\u50f9\u683c\u6578\u64da\u8a08\u7b97\u51fa\u4e0d\u540c\u6301\u6709\u671f\u7684\u9060\u671f\u5831\u916c\u7387 (forward returns)\uff0c\u6700\u7d42\u5c07\u6578\u64da\u8f49\u63db\u70ba Alphalens \u5206\u6790\u6240\u9700\u7684 <code>factor_data</code> \u683c\u5f0f\u3002</p> <ul> <li><code>factor</code>: (\u5fc5\u8981) \u56e0\u5b50\u6578\u64da\u3002</li> <li><code>prices</code>: (\u5fc5\u8981) \u50f9\u683c\u6578\u64da\u3002</li> <li><code>groupby</code>: (\u53ef\u9078) \u5206\u7d44\u6578\u64da\u3002</li> <li><code>periods</code>: (\u53ef\u9078) \u9060\u671f\u5831\u916c\u7387\u7684\u6301\u6709\u671f\u5217\u8868\uff0c\u4f8b\u5982 <code>[1, 5, 10]</code> \u4ee3\u8868\u8a08\u7b97 1 \u5929\u30015 \u5929\u300110 \u5929\u5f8c\u7684\u5831\u916c\u7387\u3002</li> </ul> <pre><code>import pandas as pd\nimport alphalens.utils as alu\n\n# \u5047\u8a2d factor_values \u662f\u60a8\u5f9e Zipline Pipeline \u7372\u5f97\u7684\u56e0\u5b50\u6578\u64da (pd.Series)\n# \u5047\u8a2d pricing_data \u662f\u60a8\u7684\u80a1\u7968\u6b77\u53f2\u50f9\u683c\u6578\u64da (pd.DataFrame)\n\n# \u4f8b\u5982\uff1a\u5f9e Zipline \u56de\u6e2c\u7d50\u679c\u4e2d\u7372\u53d6\u56e0\u5b50\u548c\u50f9\u683c\n# from zipline.pipeline import Pipeline\n# from zipline.pipeline.factors import SimpleMovingAverage\n# from zipline.pipeline.data import EquityPricing\n# from zipline import run_algorithm\n# ... (Zipline \u56de\u6e2c\u8a2d\u7f6e)\n\n# # \u5047\u8a2d\u4f60\u5df2\u7d93\u904b\u884c\u4e86\u5305\u542b Pipeline \u7684 backtest\uff0cresults \u4e2d\u5305\u542b\u4e86 factor_values \u548c pricing_data\n# # \u70ba\u4e86\u7bc4\u4f8b\u4e2d\u7368\u7acb\u6f14\u793a\uff0c\u9019\u88e1\u5275\u5efa\u4e00\u4e9b\u6a21\u64ec\u6578\u64da\n# dates = pd.to_datetime(pd.date_range('2020-01-01', periods=100, freq='D'), tz='UTC')\n# assets = ['2330', '2303', '2454']\n# # factor_index = pd.MultiIndex.from_product([dates, assets], names=['date', 'asset'])\n# factor_values = pd.Series(np.random.rand(len(factor_index)), index=factor_index)\n# # price_index = pd.MultiIndex.from_product([dates, assets], names=['date', 'asset'])\n# price_values = pd.Series(100 + np.random.randn(len(price_index)).cumsum(), index=price_index)\n# pricing_data = price_values.unstack().loc[dates, assets] # \u8f49\u63db\u70ba DataFrame \u683c\u5f0f\n# # # --- \u5be6\u969b\u5f9e Zipline \u7372\u53d6\u6578\u64da\u7684\u7bc4\u4f8b ---\n# # from zipline.pipeline import Pipeline\n# # from zipline.pipeline.factors import SimpleMovingAverage\n# # from zipline.pipeline.data import EquityPricing\n# # from zipline.api import attach_pipeline, pipeline_output, symbol, set_benchmark\n# # from zipline import run_algorithm\n# #\n# # def make_simple_pipeline():\n# #     sma_factor = SimpleMovingAverage(inputs=[EquityPricing.close], window_length=20)\n# #     return Pipeline(columns={'my_factor': sma_factor})\n# #\n# # def initialize(context):\n# #     context.assets = [symbol('2330'), symbol('2303')]\n# #     attach_pipeline(make_simple_pipeline(), 'my_pipeline')\n# #     set_benchmark(symbol('IR0001'))\n# #\n# # def handle_data(context, data):\n# #     pass\n# #\n# # def analyze(context, perf):\n# #     pass\n# #\n# # results = run_algorithm(\n# #     start=pd.Timestamp('2020-01-01', tz='UTC'),\n# #     end=pd.Timestamp('2021-01-01', tz='UTC'),\n# #     initialize=initialize,\n# #     handle_data=handle_data,\n# #     analyze=analyze,\n# #     capital_base=1e6,\n# #     bundle='tquant'\n# # )\n# #\n# # # \u63d0\u53d6 factor\n# # factor_values = results.xs('my_pipeline', level=1, axis=1)['my_factor']\n# #\n# # # \u63d0\u53d6\u50f9\u683c\u6578\u64da (\u901a\u5e38\u662f Zipline results \u4e2d\u7684 'close_price')\n# # pricing_data = results['close_price'] # \u9019\u9700\u8981\u6839\u64da\u5be6\u969b results \u7d50\u69cb\u8abf\u6574\n\n\n# \u7372\u53d6\u6e05\u6d17\u5f8c\u7684\u56e0\u5b50\u6578\u64da\u548c\u9060\u671f\u5831\u916c\n# \u9019\u88e1\u4f7f\u7528\u4e00\u500b\u7c21\u55ae\u7684\u6a21\u64ec factor \u548c pricing_data \u9032\u884c\u6f14\u793a\n# \u5728\u771f\u5be6\u5834\u666f\u4e2d\uff0c\u9019\u4e9b\u6578\u64da\u6703\u4f86\u81ea Zipline Pipeline \u7684\u8f38\u51fa\nfactor_values = pd.Series(\n    data=[0.5, 0.2, -0.1, 0.8, -0.3, 0.1],\n    index=pd.MultiIndex.from_tuples([\n        (pd.Timestamp('2022-01-03', tz='UTC'), '2330'),\n        (pd.Timestamp('2022-01-03', tz='UTC'), '2454'),\n        (pd.Timestamp('2022-01-04', tz='UTC'), '2330'),\n        (pd.Timestamp('2022-01-04', tz='UTC'), '2454'),\n        (pd.Timestamp('2022-01-05', tz='UTC'), '2330'),\n        (pd.Timestamp('2022-01-05', tz='UTC'), '2454'),\n    ], names=['date', 'asset'])\n)\n\npricing_data = pd.DataFrame(\n    data={'2330': [100, 101, 102], '2454': [50, 51, 52]},\n    index=pd.to_datetime(['2022-01-03', '2022-01-04', '2022-01-05'], tz='UTC')\n)\n\n\nfactor_data = alu.get_clean_factor_and_forward_returns(\n    factor=factor_values,\n    prices=pricing_data,\n    periods=[1, 5, 10] # \u8a08\u7b97 1, 5, 10 \u65e5\u7684\u9060\u671f\u5831\u916c\n)\n\nprint(factor_data.head())\n</code></pre>"},{"location":"how-to/factor-analysis/alphalens-tearsheet/#2-create_full_tear_sheet","title":"2. \u751f\u6210\u5b8c\u6574\u7684\u56e0\u5b50\u5206\u6790\u5831\u8868 (create_full_tear_sheet())","text":"<p>\u7576\u60a8\u6e96\u5099\u597d <code>factor_data</code> \u5f8c\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 <code>alphalens.tears.create_full_tear_sheet()</code> \u51fd\u6578\u4f86\u751f\u6210\u5305\u542b\u5404\u9805\u5716\u8868\u548c\u7d71\u8a08\u6578\u64da\u7684\u5b8c\u6574\u56e0\u5b50\u5206\u6790\u5831\u8868\u3002</p>"},{"location":"how-to/factor-analysis/alphalens-tearsheet/#_2","title":"\u4e3b\u8981\u53c3\u6578\uff1a","text":"<ul> <li><code>factor_data</code>: (\u5fc5\u8981) \u7d93\u904e <code>get_clean_factor_and_forward_returns()</code> \u8655\u7406\u5f8c\u7684\u56e0\u5b50\u6578\u64da\u3002</li> <li><code>gross_returns</code>: (\u53ef\u9078) \u7b56\u7565\u7684\u6bcf\u65e5\u7e3d\u5831\u916c\u7387 (<code>pd.Series</code>)\u3002\u5982\u679c\u63d0\u4f9b\uff0c\u4e00\u4e9b\u8207\u7b56\u7565\u7e3d\u5831\u916c\u76f8\u95dc\u7684\u5206\u6790\u4e5f\u6703\u88ab\u5305\u542b\u3002</li> </ul> <pre><code>import alphalens.tears as alt\n\n# ... (\u4e0a\u8ff0\u56e0\u5b50\u6578\u64da\u6e96\u5099\u7684\u7a0b\u5f0f\u78bc)\n\nalt.create_full_tear_sheet(factor_data)\n</code></pre> <p>\u57f7\u884c\u5f8c\uff0cAlphalens \u6703\u751f\u6210\u4e00\u7cfb\u5217\u7684\u5716\u8868\u548c\u8868\u683c\uff0c\u6db5\u84cb\u4e86\u56e0\u5b50\u7684\u5404\u500b\u65b9\u9762\uff0c\u5305\u62ec\uff1a *   \u6536\u76ca\u5206\u6790: \u56e0\u5b50\u5206\u4f4d\u6578\u6536\u76ca\u3001\u56e0\u5b50\u8ff4\u6b78\u5206\u6790\u3002 *   \u4fe1\u606f\u4fc2\u6578 (Information Coefficient, IC) \u5206\u6790: \u6bcf\u65e5\u3001\u6708\u5ea6\u3001\u5e74\u5ea6 IC\u3002 *   \u9031\u8f49\u7387 (Turnover) \u5206\u6790: \u56e0\u5b50\u548c\u5206\u4f4d\u6578\u9031\u8f49\u7387\u3002 *   \u6301\u5009\u5206\u6790: \u56e0\u5b50\u66dd\u5149\u5ea6\u7b49\u3002</p>"},{"location":"how-to/factor-analysis/alphalens-tearsheet/#3","title":"3. \u5b8c\u6574\u7bc4\u4f8b","text":"<p>\u4ee5\u4e0b\u5c07\u6f14\u793a\u5982\u4f55\u7d50\u5408 Zipline <code>Pipeline</code> \u8f38\u51fa\u6578\u64da\uff0c\u900f\u904e Alphalens \u751f\u6210\u5b8c\u6574\u7684\u56e0\u5b50\u5206\u6790\u5831\u8868\u3002</p> <p>Tip</p> <p>\u5728\u57f7\u884c\u6b64\u7bc4\u4f8b\u524d\uff0c\u8acb\u78ba\u4fdd\u60a8\u5df2\u7d93\u4f7f\u7528 <code>zipline ingest -b tquant</code> \u532f\u5165\u4e86\u50f9\u91cf\u8cc7\u6599\uff0c\u4e26\u4e14\u8cc7\u6599\u7bc4\u570d\u6db5\u84cb\u4e86\u56de\u6e2c\u671f\u9593\u3002</p> <pre><code>import pandas as pd\nimport numpy as np\nfrom zipline import run_algorithm\nfrom zipline.api import attach_pipeline, pipeline_output, symbol, set_benchmark\nfrom zipline.pipeline import Pipeline\nfrom zipline.pipeline.factors import SimpleMovingAverage\nfrom zipline.pipeline.data import EquityPricing\nimport alphalens.utils as alu\nimport alphalens.tears as alt\nimport matplotlib.pyplot as plt\n\n# 1. \u5b9a\u7fa9\u4e00\u500b\u7c21\u55ae\u7684 Pipeline \u4f86\u8a08\u7b97\u56e0\u5b50 (\u4f8b\u5982\uff1a\u77ed\u671f\u5747\u7dda\u8207\u9577\u671f\u5747\u7dda\u4e4b\u5dee)\ndef make_simple_pipeline():\n    short_sma = SimpleMovingAverage(inputs=[EquityPricing.close], window_length=10)\n    long_sma = SimpleMovingAverage(inputs=[EquityPricing.close], window_length=30)\n\n    # \u56e0\u5b50\u5b9a\u7fa9\uff1a\u77ed\u671f\u5747\u7dda\u6e1b\u53bb\u9577\u671f\u5747\u7dda\n    my_factor = short_sma - long_sma\n\n    # \u9019\u88e1\u6211\u5011\u9084\u9700\u8981\u50f9\u683c\u6578\u64da\u4f86\u8a08\u7b97\u9060\u671f\u5831\u916c\uff0c\u6240\u4ee5\u4e5f\u4e00\u4f75\u7372\u53d6\n    return Pipeline(columns={\n        'my_factor': my_factor,\n        'close_price': EquityPricing.close.latest\n    })\n\n# 2. Zipline \u56de\u6e2c\u8a2d\u7f6e\ndef initialize(context):\n    context.assets = [symbol('2330'), symbol('2454'), symbol('IR0001')] # \u5305\u542bBenchmark\n    attach_pipeline(make_simple_pipeline(), 'my_pipeline')\n    set_benchmark(symbol('IR0001')) # \u8a2d\u5b9aBenchmark\n\ndef handle_data(context, data):\n    pass # \u9019\u88e1\u53ea\u6536\u96c6\u6578\u64da\uff0c\u4e0d\u57f7\u884c\u4ea4\u6613\n\ndef analyze(context, results):\n    pass # Alphalens \u5c07\u8655\u7406\u5206\u6790\u548c\u8996\u89ba\u5316\n\n# 3. \u57f7\u884c Zipline \u56de\u6e2c\nresults = run_algorithm(\n    start=pd.Timestamp('2020-01-01', tz='UTC'),\n    end=pd.Timestamp('2022-01-01', tz='UTC'),\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=1_000_000,\n    bundle='tquant'\n)\n\n# 4. \u5f9e\u56de\u6e2c\u7d50\u679c\u4e2d\u63d0\u53d6\u56e0\u5b50\u548c\u50f9\u683c\u6578\u64da\n# Pipeline \u7684\u8f38\u51fa\u6703\u5728 results DataFrame \u4e2d\uff0c\u901a\u5e38\u4ee5 MultiIndex \u5f62\u5f0f\u51fa\u73fe\n# \u9019\u88e1\u9700\u8981\u6839\u64da\u5be6\u969b results \u7d50\u69cb\u8abf\u6574\u63d0\u53d6\u65b9\u5f0f\n# \u5047\u8a2d my_factor \u5728 results.xs('my_pipeline', level=1, axis=1)['my_factor']\n# \u5047\u8a2d close_price \u5728 results['close_price']\n# \u6ce8\u610f\uff1a\u9019\u88e1\u9700\u8981\u8655\u7406 results DataFrame \u7684\u5be6\u969b\u7d50\u69cb\u4f86\u7cbe\u78ba\u63d0\u53d6\n# \u56e0\u70ba run_algorithm \u6703\u5c07\u6574\u500b pipeline_output \u653e\u5728 results \u7684 'pipeline_output' \u6b04\u4f4d\u4e0b\n# \u4f8b\u5982\uff1a\nfactor_values = results.xs('my_pipeline', level=1, axis=1)['my_factor'].dropna() # \u63d0\u53d6\u56e0\u5b50\u503c\n# \u9700\u8981\u4e00\u500b\u55ae\u4e00\u7684\u50f9\u683c\u5e8f\u5217 (\u901a\u5e38\u662f close_price)\n# \u7531\u65bc Zipline results \u7684\u7d50\u69cb\u53ef\u80fd\u8f03\u70ba\u8907\u96dc\uff0c\u9019\u88e1\u5047\u8a2d\u4e00\u500b\u7c21\u5316\u7684\u63d0\u53d6\u65b9\u5f0f\n# \u5be6\u969b\u4f7f\u7528\u6642\uff0c\u61c9\u6839\u64da results DataFrame \u7684\u7d50\u69cb\u7cbe\u78ba\u63d0\u53d6\u5404\u8cc7\u7522\u7684\u6536\u76e4\u50f9\nall_prices = results['close_price'] # \u6216\u8005\u5f9e pipeline output \u4e2d\u63d0\u53d6\n# \u78ba\u4fdd factor_values \u548c all_prices \u7684\u7d22\u5f15\u5c0d\u9f4a\n# Alphalens\u8981\u6c42 prices \u7684\u7d22\u5f15\u70ba\u65e5\u671f\uff0ccolumns\u70ba\u8cc7\u7522\npricing_data = all_prices.unstack().reindex(index=factor_values.index.get_level_values('date').unique(),\n                                              columns=factor_values.index.get_level_values('asset').unique())\npricing_data = pricing_data.stack().reindex(factor_values.index).unstack() # \u78ba\u4fdd\u8207factor\u7684\u7d22\u5f15\u5c0d\u9f4a\n\n# 5. \u6e05\u6d17\u56e0\u5b50\u6578\u64da\u4e26\u8a08\u7b97\u9060\u671f\u5831\u916c\nfactor_data = alu.get_clean_factor_and_forward_returns(\n    factor=factor_values,\n    prices=pricing_data,\n    periods=[1, 5, 10] # \u8a08\u7b97 1, 5, 10 \u65e5\u7684\u9060\u671f\u5831\u916c\n)\n\n# 6. \u751f\u6210\u5b8c\u6574\u7684 Alphalens \u7e3e\u6548\u5831\u8868\nalt.create_full_tear_sheet(factor_data)\n\n# \u78ba\u4fdd\u7e6a\u5716\u74b0\u5883\u986f\u793a\nplt.show()\n</code></pre>"},{"location":"how-to/visualization/pyfolio-tearsheet/","title":"\u5982\u4f55\u7522\u751f Pyfolio \u7e3e\u6548\u5831\u8868","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b\u5982\u4f55\u5f9e Zipline \u56de\u6e2c\u7d50\u679c\u751f\u6210 Pyfolio \u7e3e\u6548\u5831\u8868\u7684\u8a73\u7d30\u6307\u5357\uff0c\u5305\u62ec\u6578\u64da\u6e96\u5099\u3001\u6642\u5340\u6a19\u6e96\u5316\u548c <code>create_full_tear_sheet()</code> \u7684\u4f7f\u7528\u65b9\u6cd5\u3002</p> <p>Pyfolio \u662f\u4e00\u500b\u5f37\u5927\u7684 Python \u5eab\uff0c\u5c08\u70ba\u91cf\u5316\u6295\u8cc7\u7b56\u7565\u7684\u7e3e\u6548\u8207\u98a8\u96aa\u5206\u6790\u800c\u8a2d\u8a08\u3002\u5b83\u8207 Zipline \u56de\u6e2c\u5eab\u5b8c\u7f8e\u517c\u5bb9\uff0c\u80fd\u5920\u5c07 Zipline <code>run_algorithm()</code> \u7522\u751f\u7684\u8907\u96dc\u56de\u6e2c\u7d50\u679c\uff0c\u8f49\u63db\u70ba\u4e00\u5957\u6a19\u6e96\u5316\u4e14\u8996\u89ba\u5316\u7684\u7e3e\u6548\u5831\u544a (\u7a31\u70ba \"tearsheet\")\uff0c\u8b93\u60a8\u53ef\u4ee5\u5168\u9762\u8a55\u4f30\u7b56\u7565\u7684\u512a\u52a3\u3002</p> <p>\u672c\u6307\u5357\u5c07\u8aaa\u660e\u5982\u4f55\u5c07 Zipline \u7684\u56de\u6e2c\u7d50\u679c\u5c0e\u5165 Pyfolio \u4e26\u751f\u6210\u5b8c\u6574\u7684\u7e3e\u6548\u5831\u8868\u3002</p>"},{"location":"how-to/visualization/pyfolio-tearsheet/#1","title":"1. \u6e96\u5099\u56de\u6e2c\u6578\u64da","text":"<p>\u9996\u5148\uff0c\u60a8\u9700\u8981\u5f9e Zipline <code>run_algorithm()</code> \u51fd\u6578\u8fd4\u56de\u7684 <code>results</code> DataFrame \u4e2d\uff0c\u63d0\u53d6 Pyfolio \u6240\u9700\u7684\u6838\u5fc3\u6578\u64da\u683c\u5f0f\u3002<code>pyfolio.utils.extract_rets_pos_txn_from_zipline()</code> \u51fd\u6578\u80fd\u6709\u6548\u5730\u5b8c\u6210\u9019\u9805\u4efb\u52d9\u3002</p>"},{"location":"how-to/visualization/pyfolio-tearsheet/#_1","title":"\u6838\u5fc3\u6578\u64da\u985e\u578b\uff1a","text":"<ul> <li><code>returns</code> (\u7b56\u7565\u5831\u916c\u7387): <code>pd.Series</code>\uff0c\u5305\u542b\u6bcf\u500b\u4ea4\u6613\u65e5\u7684\u7b56\u7565\u5831\u916c\u7387\u3002</li> <li><code>positions</code> (\u6301\u6709\u90e8\u4f4d): <code>pd.DataFrame</code>\uff0c\u5305\u542b\u6bcf\u500b\u4ea4\u6613\u65e5\u5404\u8b49\u5238\u8207\u73fe\u91d1\u7684\u6301\u6709\u90e8\u4f4d\u3002</li> <li><code>transactions</code> (\u4ea4\u6613\u7d00\u9304): <code>pd.DataFrame</code>\uff0c\u5305\u542b\u6240\u6709\u4ea4\u6613\u7684\u8a73\u7d30\u8cc7\u8a0a\u3002</li> <li><code>benchmark_rets</code> (\u57fa\u6e96\u5831\u916c\u7387): <code>pd.Series</code>\uff0c\u5305\u542b\u6bcf\u500b\u4ea4\u6613\u65e5\u7684 Benchmark \u5831\u916c\u7387\u3002\u9019\u53ef\u4ee5\u5f9e <code>results.benchmark_return</code> \u76f4\u63a5\u53d6\u5f97\u3002</li> </ul>"},{"location":"how-to/visualization/pyfolio-tearsheet/#_2","title":"\u6578\u64da\u63d0\u53d6\u8207\u6642\u5340\u6a19\u6e96\u5316","text":"<p>Pyfolio \u8981\u6c42\u8f38\u5165\u7684\u6578\u64da\u7d22\u5f15\u5fc5\u9808\u662f UTC \u6642\u5340\u3002\u56e0\u6b64\uff0c\u5728\u63d0\u53d6\u6578\u64da\u5f8c\uff0c\u901a\u5e38\u9700\u8981\u9032\u884c\u6642\u5340\u6a19\u6e96\u5316\u3002</p> <pre><code>import pandas as pd\nimport pyfolio\nfrom pyfolio.utils import extract_rets_pos_txn_from_zipline\n\n# \u5047\u8a2d results \u662f zipline.run_algorithm() \u57f7\u884c\u5f8c\u7684\u7d50\u679c DataFrame\n# results = run_algorithm(...)\n\n# \u63d0\u53d6\u7b56\u7565\u6578\u64da\nreturns, positions, transactions = extract_rets_pos_txn_from_zipline(results)\n\n# \u63d0\u53d6 Benchmark \u5831\u916c\u7387\nbenchmark_rets = results.benchmark_return\n\n# \u6642\u5340\u6a19\u6e96\u5316 (\u78ba\u4fdd Pyfolio \u517c\u5bb9\u6027)\nreturns.index = returns.index.tz_localize(None).tz_localize('UTC')\npositions.index = positions.index.tz_localize(None).tz_localize('UTC')\ntransactions.index = transactions.index.tz_localize(None).tz_localize('UTC')\nbenchmark_rets.index = benchmark_rets.index.tz_localize(None).tz_localize('UTC')\n</code></pre>"},{"location":"how-to/visualization/pyfolio-tearsheet/#2-create_full_tear_sheet","title":"2. \u751f\u6210\u5b8c\u6574\u7e3e\u6548\u5831\u8868 (create_full_tear_sheet())","text":"<p>\u7576\u60a8\u6e96\u5099\u597d\u4e0a\u8ff0\u6578\u64da\u5f8c\uff0c\u5c31\u53ef\u4ee5\u547c\u53eb <code>pyfolio.tears.create_full_tear_sheet()</code> \u51fd\u6578\u4f86\u751f\u6210\u5305\u542b\u5404\u9805\u5716\u8868\u548c\u7d71\u8a08\u6578\u64da\u7684\u5b8c\u6574\u7e3e\u6548\u5831\u8868\u3002</p>"},{"location":"how-to/visualization/pyfolio-tearsheet/#_3","title":"\u4e3b\u8981\u53c3\u6578\uff1a","text":"<ul> <li><code>returns</code>: (\u5fc5\u8981) \u7b56\u7565\u7684\u6bcf\u65e5\u5831\u916c\u7387 (<code>pd.Series</code>)\u3002</li> <li><code>positions</code>: (\u53ef\u9078) \u7b56\u7565\u7684\u6bcf\u65e5\u6301\u6709\u90e8\u4f4d (<code>pd.DataFrame</code>)\u3002</li> <li><code>transactions</code>: (\u53ef\u9078) \u7b56\u7565\u7684\u4ea4\u6613\u7d00\u9304 (<code>pd.DataFrame</code>)\u3002</li> <li><code>benchmark_rets</code>: (\u53ef\u9078) Benchmark \u7684\u6bcf\u65e5\u5831\u916c\u7387 (<code>pd.Series</code>)\u3002\u82e5\u4e0d\u50b3\u5165\uff0c\u5247\u67d0\u4e9b\u8207 Benchmark \u6bd4\u8f03\u7684\u5716\u8868\u5c07\u4e0d\u6703\u751f\u6210\u3002</li> </ul> <pre><code>import pyfolio\n\n# ... (\u4e0a\u8ff0\u6578\u64da\u63d0\u53d6\u8207\u6642\u5340\u6a19\u6e96\u5316\u7684\u7a0b\u5f0f\u78bc)\n\npyfolio.tears.create_full_tear_sheet(\n    returns=returns,\n    positions=positions,\n    transactions=transactions,\n    benchmark_rets=benchmark_rets # \u50b3\u5165 Benchmark \u5831\u916c\u7387\u4ee5\u4f9b\u6bd4\u8f03\n)\n</code></pre> <p>\u57f7\u884c\u5f8c\uff0c\u60a8\u6703\u770b\u5230\u4e00\u7cfb\u5217\u7684\u7e3e\u6548\u5716\u8868\u548c\u7d71\u8a08\u6578\u64da\uff0c\u5305\u62ec\u5831\u916c\u66f2\u7dda\u3001\u56de\u64a4\u3001\u98a8\u96aa\u6307\u6a19\u3001\u5404\u8cc7\u7522\u7684\u6301\u6709\u6bd4\u91cd\u5206\u6790\u3001\u4ea4\u6613\u5206\u6790\u7b49\u3002</p>"},{"location":"how-to/visualization/pyfolio-tearsheet/#3","title":"3. \u5b8c\u6574\u7bc4\u4f8b","text":"<p>\u4ee5\u4e0b\u5c07\u7d50\u5408\u4e00\u500b\u7c21\u55ae\u7684\u300c\u8cb7\u5165\u4e26\u6301\u6709\u53f0\u7a4d\u96fb\u300d\u7b56\u7565\u7684\u56de\u6e2c\u7d50\u679c\uff0c\u6f14\u793a\u5982\u4f55\u751f\u6210 Pyfolio \u7e3e\u6548\u5831\u8868\u3002</p> <p>Tip</p> <p>\u5728\u57f7\u884c\u6b64\u7bc4\u4f8b\u524d\uff0c\u8acb\u78ba\u4fdd\u60a8\u5df2\u7d93\u4f7f\u7528 <code>zipline ingest -b tquant</code> \u532f\u5165\u4e86\u50f9\u91cf\u8cc7\u6599\uff0c\u4e26\u4e14\u8cc7\u6599\u7bc4\u570d\u6db5\u84cb\u4e86\u56de\u6e2c\u671f\u9593\u3002\u8a73\u898b\uff1a\u532f\u5165\u50f9\u91cf\u8cc7\u6599\u6307\u5357</p> <pre><code>import pandas as pd\nfrom zipline import run_algorithm\nfrom zipline.api import (\n    set_benchmark,\n    symbol,\n    order_target_percent,\n    record\n)\nimport pyfolio\nfrom pyfolio.utils import extract_rets_pos_txn_from_zipline\nimport matplotlib.pyplot as plt\n\n\n# --- Zipline \u56de\u6e2c\u90e8\u5206 ---\ndef initialize(context):\n    context.asset = symbol('2330')\n    set_benchmark(symbol('IR0001'))\n    context.has_ordered = False\n\ndef handle_data(context, data):\n    if not context.has_ordered:\n        order_target_percent(context.asset, 1.0)\n        context.has_ordered = True\n    record(price=data.current(context.asset, 'price'))\n\ndef analyze(context, results):\n    pass # Pyfolio \u5c07\u6703\u8655\u7406\u5206\u6790\u548c\u8996\u89ba\u5316\n\nresults = run_algorithm(\n    start=pd.Timestamp('2022-01-01', tz='UTC'),\n    end=pd.Timestamp('2023-01-01', tz='UTC'),\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=1_000_000,\n    bundle='tquant'\n)\n\n# --- Pyfolio \u5206\u6790\u90e8\u5206 ---\n# 1. \u63d0\u53d6 Zipline \u56de\u6e2c\u7d50\u679c\nreturns, positions, transactions = extract_rets_pos_txn_from_zipline(results)\nbenchmark_rets = results.benchmark_return\n\n# 2. \u6642\u5340\u6a19\u6e96\u5316\nreturns.index = returns.index.tz_localize(None).tz_localize('UTC')\npositions.index = positions.index.tz_localize(None).tz_localize('UTC')\ntransactions.index = transactions.index.tz_localize(None).tz_localize('UTC')\nbenchmark_rets.index = benchmark_rets.index.tz_localize(None).tz_localize('UTC')\n\n# 3. \u751f\u6210\u5b8c\u6574\u7684 Pyfolio \u7e3e\u6548\u5831\u8868\npyfolio.tears.create_full_tear_sheet(\n    returns=returns,\n    positions=positions,\n    transactions=transactions,\n    benchmark_rets=benchmark_rets\n)\n\n# \u7531\u65bc create_full_tear_sheet \u5167\u90e8\u6703\u8abf\u7528 plt.show()\uff0c\n# \u5982\u679c\u5728\u975e\u4e92\u52d5\u74b0\u5883\u904b\u884c\uff0c\u53ef\u80fd\u9700\u8981\u624b\u52d5\u5132\u5b58\u5716\u8868\u6216\u78ba\u4fdd\u7e6a\u5716\u74b0\u5883\u662f\u4e92\u52d5\u7684\u3002\n# plt.show() # \u5982\u679c tearsheet \u6c92\u6709\u81ea\u52d5\u986f\u793a\uff0c\u53ef\u4ee5\u5617\u8a66\u624b\u52d5\u547c\u53eb\n</code></pre>"},{"location":"reference/alphalens/api/","title":"Alphalens API \u7e3d\u89bd","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b Alphalens \u76f8\u95dc API \u7684\u8a73\u7d30\u8aaa\u660e\uff0c\u5305\u62ec\u56e0\u5b50\u5206\u6790\u3001\u8cc7\u8a0a\u4fc2\u6578 (IC) \u5206\u6790\u3001\u5468\u8f49\u7387\u5206\u6790\u53ca\u76f8\u95dc\u7e6a\u5716\u51fd\u6578\u7684\u7528\u9014\u548c\u8a08\u7b97\u65b9\u5f0f\u3002</p> <p>Alphalens \u662f\u4e00\u500b\u7528\u65bc\u56e0\u5b50\u7814\u7a76\u8207\u8a55\u4f30\u7684 Python \u5eab\uff0c\u63d0\u4f9b\u56e0\u5b50\u5206\u6790\u3001\u7e3e\u6548\u8a55\u4f30\u548c\u5468\u8f49\u7387\u5206\u6790\u7b49\u5de5\u5177\u3002</p>"},{"location":"reference/alphalens/api/#1","title":"1. \u6838\u5fc3\u6982\u5ff5","text":""},{"location":"reference/alphalens/api/#11-information-coefficient-ic","title":"1.1 \u8cc7\u8a0a\u4fc2\u6578\u5206\u6790 (Information Coefficient, IC)","text":"<p>\u8cc7\u8a0a\u4fc2\u6578\u662f\u4e00\u7a2e\u91cf\u5316\u56e0\u5b50\u9810\u6e2c\u6027\u7684\u65b9\u6cd5\uff0c\u900f\u904e\u8a08\u7b97 \u56e0\u5b50\u503c \u8207 \u6301\u6709\u671f\u5831\u916c \u7684 \u65af\u76ae\u723e\u66fc\u7b49\u7d1a\u76f8\u95dc\u4fc2\u6578 \uff08Spearman rank correlation coefficient\uff09\u800c\u5f97\u3002</p> <p>\u7c21\u800c\u8a00\u4e4b\uff0cIC \u63d0\u4f9b\u4e86\u4e00\u7a2e\u8a55\u4f30\u65b9\u5f0f\uff0c\u4f86\u78ba\u5b9a\u8f03\u9ad8\u7684\u56e0\u5b50\u503c\u662f\u5426\u610f\u5473\u8457\u66f4\u9ad8\u7684\u5831\u916c\u7387\uff0c\u5373\u662f\u5426\u5b58\u5728\u55ae\u8abf\u905e\u589e\u7684\u95dc\u4fc2\u3002\u7406\u60f3\u60c5\u6cc1\u4e0b\uff0c\u6211\u5011\u5e0c\u671b IC \u503c\u8d8a\u9ad8\u8d8a\u597d\u3002\u5728\u4e3b\u52d5\u6295\u8cc7\u7b56\u7565\u4e2d\uff0cIC \u4e5f\u5e38\u88ab\u7528\u4f86\u8a55\u4f30\u57fa\u91d1\u7d93\u7406\u4eba\u7684\u9810\u6e2c\u80fd\u529b\u3002</p> <p>\u7531\u65bc IC \u662f\u7b49\u7d1a\u76f8\u95dc\u4fc2\u6578\uff0c\u5176\u503c\u7684\u7bc4\u570d\u662f\u4ecb\u65bc +1 \u5230 -1 \u4e4b\u9593\uff1a</p> <ul> <li>IC = 1\uff1a\u8a72\u56e0\u5b50\u5b8c\u5168\u6c92\u6709\u96dc\u8a0a\uff0c\u4e26\u53ef\u4ee5\u505a\u51fa\u5b8c\u7f8e\u7684\u9810\u6e2c</li> <li>IC = 0\uff1a\u8a72\u56e0\u5b50\u7121\u9810\u6e2c\u80fd\u529b\uff0c\u5168\u70ba\u96dc\u8a0a</li> <li>IC &lt; 0\uff1a\u9810\u6e2c\u65b9\u5411\u8207\u771f\u5be6\u65b9\u5411\u5b8c\u5168\u76f8\u53cd</li> </ul> <p>\u6839\u64da Grinold and Kahn\uff082000\uff09\u7684\u7814\u7a76\uff1a</p> <ul> <li>\u826f\u597d\u7684\u56e0\u5b50\uff1aIC \u2265 0.05</li> <li>\u51fa\u8272\u7684\u56e0\u5b50\uff1aIC \u2265 0.10</li> <li>\u9802\u5c16\u7684\u56e0\u5b50\uff1aIC \u2265 0.15</li> <li>IC \u2265 0.20\uff1a\u53ef\u80fd\u4ee3\u8868\u5b58\u5728\u56de\u6e2c\u504f\u5dee\u6216\u5167\u7dda\u4ea4\u6613</li> </ul>"},{"location":"reference/alphalens/api/#12-vs","title":"1.2 \u8cc7\u8a0a\u5206\u6790 vs. \u6536\u76ca\u5206\u6790","text":"<p>\u8cc7\u8a0a\u5206\u6790 \u900f\u904e\u8a08\u7b97\u56e0\u5b50\u503c\u8207\u6301\u6709\u671f\u5831\u916c\u7387\u7684\u76f8\u95dc\u4fc2\u6578\u4f86\u8a55\u4f30\u56e0\u5b50\u7684\u6574\u9ad4\u9810\u6e2c\u80fd\u529b\u3002\u9019\u662f\u4e00\u500b\u55ae\u4e00\u7684\u5168\u5c40\u6307\u6a19\uff0c\u53cd\u6620\u56e0\u5b50\u5728\u6574\u500b\u80a1\u7968\u6c60\u4e2d\u7684\u5e73\u5747\u9810\u6e2c\u529b\u3002</p> <p>\u6536\u76ca\u5206\u6790 \u5247\u5c07\u80a1\u7968\u6309\u56e0\u5b50\u503c\u5927\u5c0f\u5206\u6210\u4e0d\u540c\u5206\u7d44\uff08\u901a\u5e38 5 \u5206\u7d44\uff09\uff0c\u7136\u5f8c\u8a08\u7b97\u6bcf\u500b\u5206\u7d44\u7684\u5e73\u5747\u5831\u916c\u7387\u3002\u9019\u7a2e\u65b9\u6cd5\u80fd\u5920\u6e05\u695a\u5c55\u793a\u56e0\u5b50\u5728\u4e0d\u540c\u80a1\u7968\u5b50\u96c6\u4e2d\u7684\u9810\u6e2c\u529b\u5206\u4f48\u3002</p> <p>\u6700\u4f73\u5be6\u8e10 \uff1a\u7d50\u5408\u4f7f\u7528\u5169\u7a2e\u5206\u6790\u5de5\u5177\u3002\u8cc7\u8a0a\u4fc2\u6578\u63d0\u4f9b\u4e86\u8f03\u70ba\u4e00\u822c\u5316\u7684\u8996\u89d2\uff0c\u800c\u5206\u7d44\u6536\u76ca\u5206\u6790\u5247\u63d0\u4f9b\u4e86\u66f4\u6df1\u5165\u7684\u89c0\u9ede\uff0c\u80fd\u5920\u660e\u78ba\u986f\u793a\u56e0\u5b50\u5728\u54ea\u4e9b\u5206\u7d44\u4e2d\u7684\u9810\u6e2c\u80fd\u529b\u6700\u5f37\u3002</p>"},{"location":"reference/alphalens/api/#2-ic","title":"2. \u8cc7\u8a0a\u4fc2\u6578 (IC) \u5206\u6790\u51fd\u6578","text":""},{"location":"reference/alphalens/api/#21-factor_information_coefficient","title":"2.1 factor_information_coefficient","text":"<p>\u5229\u7528 <code>factor_information_coefficient</code> \u51fd\u6578\u8a08\u7b97\u5404\u6301\u6709\u671f\u4e0b\u6bcf\u4e00\u65e5\u7684 IC \u503c\uff0c\u89c0\u5bdf\u56e0\u5b50\u9810\u6e2c\u529b\u96a8\u6642\u9593\u8b8a\u52d5\u7684\u60c5\u6cc1\u3002</p>"},{"location":"reference/alphalens/api/#_1","title":"\u8a08\u7b97\u65b9\u5f0f","text":"\\[IC_{t,n} = Corr(\\text{\u56e0\u5b50\u503c}_{i,t}, \\text{\u6301\u6709\u671f\u5831\u916c\u7387}_{i,t,n})\\] <p>\u5176\u4e2d\uff0c\\(i\\) \u70ba\u80a1\u7968\u4ee3\u865f\u3001\\(n\\) \u70ba\u6301\u6709\u671f\u5929\u6578\u3001\\(Corr\\) \u70ba\u65af\u76ae\u723e\u66fc\u79e9\u76f8\u95dc\u4fc2\u6578\u3002</p>"},{"location":"reference/alphalens/api/#_2","title":"\u7bc4\u4f8b","text":"<pre><code>ic = alphalens.performance.factor_information_coefficient(factor_data)\nic.head()\n</code></pre>"},{"location":"reference/alphalens/api/#22-plot_ic_ts","title":"2.2 plot_ic_ts","text":"<p>\u5229\u7528 <code>plot_ic_ts</code> \u51fd\u6578\u628a\u4e0d\u540c\u6642\u9ede\u7684 IC \u503c\u7e6a\u88fd\u6210\u6298\u7dda\u5716\uff0c\u53ef\u4ee5\u4e86\u89e3\u56e0\u5b50\u9810\u6e2c\u80fd\u529b\u96a8\u8457\u6642\u9593\u7684\u8b8a\u5316\u60c5\u6cc1\u3002</p> <p>\u901a\u5e38\u6703\u5e0c\u671b\u770b\u5230 IC \u5728\u6642\u9593\u5e8f\u5217\u4e0a\u5927\u90e8\u5206\u7684\u6642\u9593\u9ede\u7686 \u7a69\u5b9a\u70ba\u6b63 \uff08\u7406\u60f3\u60c5\u6cc1\u4e0b &gt; 0.05\uff09\uff0c\u4e14 \u64c1\u6709\u8f03\u5927\u7684 IC \u5747\u503c \u4ee5\u53ca \u8f03\u5c0f\u7684 IC \u6a19\u6e96\u5dee \u3002</p> <p>\u5716\u8868\u8aaa\u660e\uff1a</p> <ul> <li>\u85cd\u8272\u7dda\uff1a\u6bcf\u65e5\u7684 IC \u503c</li> <li>\u7da0\u8272\u7dda\uff1a\u8fd1\u4e00\u500b\u6708\uff08\u904e\u53bb 22 \u5929\uff09\u7684 IC \u5747\u503c\uff08\u6efe\u52d5\u5e73\u5747\uff09</li> <li>\u5de6\u4e0a\u89d2\u8cc7\u8a0a\uff1a\u6574\u671f\u9593\u7684 IC \u5747\u503c\u53ca IC \u6a19\u6e96\u5dee</li> </ul>"},{"location":"reference/alphalens/api/#_3","title":"\u7bc4\u4f8b","text":"<pre><code>alphalens.plotting.plot_ic_ts(ic)\n</code></pre>"},{"location":"reference/alphalens/api/#23-plot_ic_hist","title":"2.3 plot_ic_hist","text":"<p>\u5229\u7528 <code>plot_ic_hist</code> \u51fd\u6578\u5c07\u4e0d\u540c\u6301\u6709\u671f\u7684 IC \u5e8f\u5217\u8cc7\u6599\u7e6a\u88fd\u6210\u76f4\u65b9\u5716\uff0c\u89c0\u5bdf IC \u503c\u7684\u5206\u4f48\u60c5\u6cc1\u3002</p> <p>\u901a\u5e38\u6703\u5e0c\u671b\u6709 \u8f03\u9ad8\u7684 IC \u5747\u503c \u4ee5\u53ca \u8f03\u70ba\u96c6\u4e2d\u7684\u5206\u4f48 \uff08\u6a19\u6e96\u5dee\u4f4e\u3001\u5cf0\u5ea6\u9ad8\uff09\uff0c\u8868\u793a\u56e0\u5b50\u9810\u6e2c\u529b\u7a69\u5b9a\u4e00\u81f4\u3002</p>"},{"location":"reference/alphalens/api/#_4","title":"\u7bc4\u4f8b","text":"<pre><code>alphalens.plotting.plot_ic_hist(ic)\n</code></pre>"},{"location":"reference/alphalens/api/#24-plot_ic_qq","title":"2.4 plot_ic_qq","text":"<p>QQ \u5716\uff08\u4f7f\u7528 <code>plot_ic_qq</code> \u51fd\u6578\uff09\u53ef\u4ee5\u89c0\u5bdf IC \u503c\u7684\u6a5f\u7387\u5206\u914d\u662f\u5426\u8fd1\u4f3c\u65bc\u5e38\u614b\u5206\u914d\u3002\u82e5\u85cd\u8272\u9ede\u7684\u5206\u4f48\u5927\u81f4\u8cbc\u5408\u7d05\u8272\u7dda\uff08y=x\uff09\uff0c\u4ee3\u8868 IC \u7684\u5206\u4f48\u63a5\u8fd1\u5e38\u614b\u5206\u914d\u3002</p> <p>\u82e5 IC \u5206\u5e03\u504f\u96e2\u5e38\u614b\uff0c\u53ef\u80fd\u4ee3\u8868\u56e0\u5b50\u5b58\u5728\u6975\u7aef\u4e8b\u4ef6\u6216\u5176\u4ed6\u975e\u7dda\u6027\u7279\u5fb5\u3002</p>"},{"location":"reference/alphalens/api/#_5","title":"\u7bc4\u4f8b","text":"<pre><code>alphalens.plotting.plot_ic_qq(ic)\n</code></pre>"},{"location":"reference/alphalens/api/#25-plot_monthly_ic_heatmap","title":"2.5 plot_monthly_ic_heatmap","text":"<p>\u5c07 IC \u503c\u6309\u6708\u4efd\u53d6\u5e73\u5747\uff0c\u4e26\u5229\u7528\u71b1\u5340\u5716\u89c0\u5bdf\u56e0\u5b50\u662f\u5426\u5b58\u5728\u6708\u4efd\u6548\u61c9\uff08\u5373\u9810\u6e2c\u529b\u5728\u67d0\u4e9b\u6708\u4efd\u7279\u5225\u5f37\u6216\u7279\u5225\u5f31\uff09\u3002</p>"},{"location":"reference/alphalens/api/#_6","title":"\u7bc4\u4f8b","text":"<pre><code>mean_monthly_ic = alphalens.performance.mean_information_coefficient(\n    factor_data, \n    by_time='M'\n)\nalphalens.plotting.plot_monthly_ic_heatmap(mean_monthly_ic)\n</code></pre>"},{"location":"reference/alphalens/api/#26-plot_information_table","title":"2.6 plot_information_table","text":"<p>\u986f\u793a IC \u76f8\u95dc\u7684\u7d71\u8a08\u6307\u6a19\u8868\uff0c\u5305\u62ec\u4ee5\u4e0b\u5404\u9805\uff1a</p> <ul> <li>IC Mean\uff08IC \u5747\u503c\uff09\uff1a\u5404\u6301\u6709\u671f\u4e0b\u7684 IC \u503c\u53d6\u5e73\u5747</li> <li>IC Std.Div\uff08IC \u6a19\u6e96\u5dee\uff09\uff1aIC \u503c\u7684\u6a23\u672c\u6a19\u6e96\u5dee</li> <li>Risk-Adjusted IC\uff1aIC Mean / IC Std.Div\uff0c\u517c\u9867\u56e0\u5b50\u9078\u80a1\u80fd\u529b\u8207\u7a69\u5b9a\u6027</li> <li>IC Skew\uff1aIC \u503c\u7684\u504f\u614b\u4fc2\u6578\uff08\u8861\u91cf\u5206\u5e03\u7684\u975e\u5c0d\u7a31\u6027\uff09</li> <li>IC Kurtosis\uff1aIC \u503c\u7684\u5cf0\u614b\u4fc2\u6578\uff08\u8861\u91cf\u5206\u5e03\u7684\u539a\u5c3e\u7a0b\u5ea6\uff09</li> <li>t-stat(IC) &amp; p-value(IC)\uff1aT \u6aa2\u5b9a\u7d71\u8a08\u91cf\u53ca p \u503c\uff0c\u7528\u65bc\u6aa2\u9a57 IC \u662f\u5426\u986f\u8457\u7570\u65bc 0</li> </ul>"},{"location":"reference/alphalens/api/#_7","title":"\u7bc4\u4f8b","text":"<pre><code>alphalens.plotting.plot_information_table(ic)\n</code></pre>"},{"location":"reference/alphalens/api/#27-create_information_tear_sheet","title":"2.7 create_information_tear_sheet","text":"<p>\u751f\u6210\u5305\u542b\u6240\u6709 IC \u5206\u6790\u5716\u8868\u7684\u5b8c\u6574\u5831\u544a\u3002\u6b64\u51fd\u6578\u6703\u81ea\u52d5\u751f\u6210\u6642\u9593\u5e8f\u5217\u5716\u3001\u76f4\u65b9\u5716\u3001QQ \u5716\u3001\u6708\u5ea6\u71b1\u529b\u5716\u53ca\u7d71\u8a08\u8868\uff0c\u63d0\u4f9b\u56e0\u5b50\u9810\u6e2c\u529b\u7684\u5168\u9762\u8a55\u4f30\u3002</p>"},{"location":"reference/alphalens/api/#_8","title":"\u7bc4\u4f8b","text":"<pre><code>alphalens.tears.create_information_tear_sheet(factor_data)\n</code></pre>"},{"location":"reference/alphalens/api/#3","title":"3. \u5468\u8f49\u7387\u5206\u6790","text":""},{"location":"reference/alphalens/api/#31","title":"3.1 \u5468\u8f49\u7387\u6982\u5ff5","text":"<p>\u56e0\u5b50\u5468\u8f49\u7387\u9593\u63a5\u8861\u91cf \u56e0\u5b50\u7684\u7a69\u5b9a\u6027 \u53ca \u6f5b\u5728\u7684\u4ea4\u6613\u6210\u672c \u3002\u5468\u8f49\u7387\u4f4e\u7684\u56e0\u5b50\u80fd\u4f7f\u6295\u8cc7\u7d44\u5408\u7121\u9700\u983b\u7e41\u8abf\u6574\u6301\u80a1\uff0c\u4e5f\u9593\u63a5\u4ee3\u8868\u56e0\u5b50\u6709\u66f4\u597d\u7684\u6301\u7e8c\u6027\u4e14\u4eab\u6709\u8f03\u4f4e\u7684\u4ea4\u6613\u6210\u672c\u3002</p> <p>Carhart\uff081997\uff09\u548c Champagne, Karoui and Patel\uff082018\uff09\u90fd\u767c\u73fe\uff0c\u5468\u8f49\u7387\u8d8a\u9ad8\u7684\u5171\u540c\u57fa\u91d1\u7e3e\u6548\u5c31\u8d8a\u5dee\u3002</p> <p>\u5468\u8f49\u7387\u4e5f\u6703\u96a8 \u56e0\u5b50\u7684\u8cc7\u8a0a\u6642\u57df \u4e0d\u540c\u800c\u6709\u6240\u5dee\u7570\uff1a</p> <ul> <li>\u77ed\u8cc7\u8a0a\u6642\u57df \uff08\u5982\u77ed\u671f\u53cd\u8f49\u56e0\u5b50\uff09\uff1a\u8a0a\u865f\u8fc5\u901f\u6d88\u5931\uff0c\u5c0e\u81f4\u8f03\u9ad8\u5468\u8f49\u7387</li> <li>\u9577\u8cc7\u8a0a\u6642\u57df \uff08\u5982\u57fa\u672c\u9762\u56e0\u5b50\uff09\uff1a\u8a0a\u865f\u8870\u6e1b\u901f\u5ea6\u8f03\u6162\uff0c\u5468\u8f49\u7387\u76f8\u5c0d\u8f03\u4f4e</li> </ul>"},{"location":"reference/alphalens/api/#32-quantile_turnover","title":"3.2 quantile_turnover","text":"<p>\u7b2c N \u5206\u7d44\uff08quantile\uff09\u5728\u6642\u9ede t \u7684\u5468\u8f49\u7387\u5b9a\u7fa9\u70ba\uff1a</p> \\[\\text{\u5468\u8f49\u7387}_{N,t} = \\frac{\\text{\u672c\u671f\u5728\u7b2c N \u7d44\u4f46\u524d P \u671f\u4e0d\u5728\u6b64\u7d44\u7684\u80a1\u7968\u6578}}{\\text{\u672c\u671f\u5728\u7b2c N \u7d44\u7684\u80a1\u7968\u7e3d\u6578}}\\] <p>\u6b64\u6307\u6a19\u8861\u91cf\u56e0\u5b50\u6392\u5e8f\u8b8a\u5316\u7684\u5e45\u5ea6\uff0c\u503c\u8d8a\u9ad8\u8868\u793a\u56e0\u5b50\u6392\u5e8f\u8b8a\u5316\u8d8a\u5927\uff0c\u4ea4\u6613\u6210\u672c\u53ef\u80fd\u8d8a\u9ad8\u3002</p>"},{"location":"reference/alphalens/api/#_9","title":"\u7bc4\u4f8b","text":"<pre><code>quantile_turnover = {}\nfor holding_period in (1, 5, 10):\n    quantile_turnover[holding_period] = pd.concat([\n        alphalens.performance.quantile_turnover(\n            factor_data['factor_quantile'],\n            quantile=q,\n            period=holding_period\n        ) \n        for q in factor_data.factor_quantile.sort_values().unique().tolist()\n    ], axis=1)\n</code></pre>"},{"location":"reference/alphalens/api/#33-plot_top_bottom_quantile_turnover","title":"3.3 plot_top_bottom_quantile_turnover","text":"<p>\u7e6a\u88fd top quantile\uff08\u6700\u9ad8\u5206\u7d44\uff09\u8207 bottom quantile\uff08\u6700\u4f4e\u5206\u7d44\uff09\u7684\u5468\u8f49\u7387\u6298\u7dda\u5716\u3002\u9019\u5169\u500b\u5206\u7d44\u5728\u56e0\u5b50\u6295\u8cc7\u4e2d\u5c24\u70ba\u91cd\u8981\uff0c\u56e0\u70ba\u591a\u56e0\u5b50\u7b56\u7565\u901a\u5e38\u6703\u505a\u591a top quantile \u4e26\u540c\u6642\u653e\u7a7a bottom quantile \u4f86\u5efa\u69cb\u591a\u7a7a\u5c0d\u6c96\u6295\u7d44\u3002</p>"},{"location":"reference/alphalens/api/#_10","title":"\u7bc4\u4f8b","text":"<pre><code>for holding_period in (1, 5, 10):\n    alphalens.plotting.plot_top_bottom_quantile_turnover(\n        quantile_turnover[holding_period],\n        period=holding_period\n    )\n</code></pre>"},{"location":"reference/alphalens/api/#34-factor_rank_autocorrelation","title":"3.4 factor_rank_autocorrelation","text":"<p>\u56e0\u5b50\u79e9\u81ea\u76f8\u95dc\u4fc2\u6578\u8861\u91cf \u7576\u671f\u56e0\u5b50\u503c\u6392\u5e8f \u8207 \u524d\u4e00\u671f\u56e0\u5b50\u503c\u6392\u5e8f \u7684\u76f8\u95dc\u7a0b\u5ea6\u3002</p> \\[\\text{\u81ea\u76f8\u95dc\u4fc2\u6578}_t = Corr(\\text{\u56e0\u5b50\u503c\u79e9}_{i,t}, \\text{\u56e0\u5b50\u503c\u79e9}_{i,t-p})\\] <p>\u5468\u8f49\u7387\u8207\u81ea\u76f8\u95dc\u4fc2\u6578\u5448\u73fe\u8ca0\u76f8\u95dc \u3002\u56e0\u6b64\uff0c\u56e0\u5b50\u79e9\u81ea\u76f8\u95dc\u4fc2\u6578\u63d0\u4f9b\u4e86\u53e6\u4e00\u7a2e\u8861\u91cf\u56e0\u5b50\u5468\u8f49\u7387\uff08\u5373\u7a69\u5b9a\u6027\uff09\u7684\u65b9\u5f0f\u3002\u81ea\u76f8\u95dc\u4fc2\u6578\u9ad8\u5247\u4ee3\u8868\u56e0\u5b50\u5728\u4e0d\u540c\u6642\u671f\u4e4b\u9593\u5b58\u5728\u8f03\u5927\u7684\u76f8\u95dc\u6027\u548c\u7a69\u5b9a\u6027\uff0c\u540c\u6642\u610f\u5473\u8457\u5468\u8f49\u7387\u8f03\u4f4e\u3002</p>"},{"location":"reference/alphalens/api/#_11","title":"\u7bc4\u4f8b","text":"<pre><code>factor_rank_autocorr = pd.DataFrame()\nfor holding_period in (1, 5, 10):\n    factor_rank_autocorr = pd.concat([\n        factor_rank_autocorr,\n        alphalens.performance.factor_rank_autocorrelation(\n            factor_data,\n            period=holding_period\n        )\n    ], axis=1)\n</code></pre>"},{"location":"reference/alphalens/api/#35-plot_factor_rank_auto_correlation","title":"3.5 plot_factor_rank_auto_correlation","text":"<p>\u5c07\u4e0d\u540c\u6301\u6709\u671f\u7684\u56e0\u5b50\u79e9\u81ea\u76f8\u95dc\u4fc2\u6578\u7e6a\u88fd\u6210\u6298\u7dda\u5716\uff0c\u89c0\u5bdf\u56e0\u5b50\u7a69\u5b9a\u6027\u5728\u6642\u9593\u5e8f\u5217\u4e0a\u7684\u8b8a\u5316\u3002</p>"},{"location":"reference/alphalens/api/#_12","title":"\u7bc4\u4f8b","text":"<pre><code>for holding_period in (1, 5, 10):\n    alphalens.plotting.plot_factor_rank_auto_correlation(\n        factor_rank_autocorr[holding_period],\n        period=holding_period\n    )\n</code></pre>"},{"location":"reference/alphalens/api/#36-plot_turnover_table","title":"3.6 plot_turnover_table","text":"<p>\u7e6a\u88fd\u5468\u8f49\u7387\u8207\u79e9\u81ea\u76f8\u95dc\u4fc2\u6578\u7684\u7d71\u8a08\u8868\u683c\uff0c\u63d0\u4f9b\u56e0\u5b50\u7a69\u5b9a\u6027\u7684\u5168\u9762\u8a55\u4f30\u3002</p>"},{"location":"reference/alphalens/api/#_13","title":"\u7bc4\u4f8b","text":"<pre><code>alphalens.plotting.plot_turnover_table(\n    factor_rank_autocorr,\n    quantile_turnover\n)\n</code></pre>"},{"location":"reference/alphalens/api/#37-create_turnover_tear_sheet","title":"3.7 create_turnover_tear_sheet","text":"<p>\u751f\u6210\u5305\u542b\u6240\u6709\u5468\u8f49\u7387\u5206\u6790\u5716\u8868\u7684\u5b8c\u6574\u5831\u544a\u3002\u6b64\u51fd\u6578\u6574\u5408\u5468\u8f49\u7387\u5206\u6790\u7684\u5404\u500b\u65b9\u9762\uff0c\u63d0\u4f9b\u56e0\u5b50\u7a69\u5b9a\u6027\u7684\u5b8c\u6574\u8a55\u4f30\u3002</p>"},{"location":"reference/alphalens/api/#_14","title":"\u7bc4\u4f8b","text":"<pre><code>alphalens.tears.create_turnover_tear_sheet(factor_data)\n</code></pre>"},{"location":"reference/alphalens/api/#4","title":"4. \u6536\u76ca\u5206\u6790\u51fd\u6578","text":""},{"location":"reference/alphalens/api/#41-mean_return_by_quantile","title":"4.1 mean_return_by_quantile","text":"<p>\u8a08\u7b97\u4e0d\u540c\u56e0\u5b50\u5206\u7d44\u5728\u4e0d\u540c\u6642\u9593\u9ede\u7684\u5e73\u5747\u5831\u916c\u7387\uff0c\u7528\u65bc\u8a55\u4f30\u56e0\u5b50\u7684\u9810\u6e2c\u529b\u5206\u4f48\u3002\u6b64\u51fd\u6578\u5c0d\u61c9\u65bc\u300c\u6536\u76ca\u5206\u6790\u300d\uff0c\u80fd\u6e05\u695a\u5c55\u793a\u4e0d\u540c\u5206\u7d44\u7684\u7e3e\u6548\u5dee\u7570\u3002</p>"},{"location":"reference/alphalens/api/#_15","title":"\u7bc4\u4f8b","text":"<pre><code>mean_return_by_q, std_err_by_q = alphalens.performance.mean_return_by_quantile(\n    factor_data, \n    by_date=True\n)\n</code></pre>"},{"location":"reference/alphalens/api/#5","title":"5. \u5b8c\u6574\u5de5\u4f5c\u6d41\u7a0b\u7bc4\u4f8b","text":"<pre><code>import alphalens\nimport pandas as pd\n\n# 1. \u6e96\u5099\u56e0\u5b50\u8cc7\u6599\u8207\u50f9\u683c\u8cc7\u6599\nfactor_data = alphalens.utils.get_clean_factor_and_forward_returns(\n    factor,\n    prices,\n    quantiles=5,\n    periods=(1, 5, 10),\n    groupby=sector_map\n)\n\n# 2. IC \u8cc7\u8a0a\u4fc2\u6578\u5206\u6790\nic = alphalens.performance.factor_information_coefficient(factor_data)\nalphalens.plotting.plot_ic_ts(ic)\nalphalens.tears.create_information_tear_sheet(factor_data)\n\n# 3. \u5468\u8f49\u7387\u8207\u7a69\u5b9a\u6027\u5206\u6790\nalphalens.tears.create_turnover_tear_sheet(factor_data)\n\n# 4. \u5b8c\u6574\u7e3e\u6548\u5831\u544a\nalphalens.tears.create_full_tear_sheet(factor_data)\n</code></pre>"},{"location":"reference/pipeline/built-ins/","title":"\u5167\u5efa\u56e0\u5b50/\u6ffe\u7db2/\u5206\u985e\u5668","text":"<p>Info</p> <p>\u672c\u9801\u8a73\u7d30\u5217\u51fa TQuant Lab Pipeline \u4e2d\u6240\u6709\u5167\u5efa\u7684\u56e0\u5b50 (Factors)\u3001\u6ffe\u7db2 (Filters) \u548c\u5206\u985e\u5668 (Classifiers)\uff0c\u4e26\u63d0\u4f9b\u5176\u7528\u9014\u3001\u53c3\u6578\u8aaa\u660e\u53ca\u4f7f\u7528\u7bc4\u4f8b\uff0c\u5e6b\u52a9\u4f7f\u7528\u8005\u5feb\u901f\u7406\u89e3\u548c\u61c9\u7528\u9019\u4e9b\u6838\u5fc3\u7d44\u4ef6\u3002</p> <p>Zipline Pipeline \u63d0\u4f9b\u4e86\u8c50\u5bcc\u7684\u5167\u5efa\u7d44\u4ef6\uff0c\u8b93\u60a8\u53ef\u4ee5\u7121\u9700\u5f9e\u982d\u958b\u59cb\u7de8\u5beb\u8907\u96dc\u7684\u8a08\u7b97\u908f\u8f2f\u3002\u9019\u4e9b\u7d44\u4ef6\u7d93\u904e\u512a\u5316\uff0c\u80fd\u5920\u9ad8\u6548\u5730\u8655\u7406\u5927\u91cf\u7684\u6b77\u53f2\u6578\u64da\uff0c\u751f\u6210\u5404\u7a2e\u4ea4\u6613\u8a0a\u865f\u3002</p>"},{"location":"reference/pipeline/built-ins/#1-factors","title":"1. Factors (\u56e0\u5b50)","text":"<p>Factors \u7528\u65bc\u8a08\u7b97\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u6642\u9593\u9ede\u7684\u6578\u503c\u3002\u5b83\u5011\u901a\u5e38\u57fa\u65bc\u6b77\u53f2\u50f9\u683c\u3001\u6210\u4ea4\u91cf\u6216\u5176\u4ed6\u6578\u64da\u4f86\u751f\u6210\u6280\u8853\u6307\u6a19\u6216\u57fa\u672c\u9762\u6307\u6a19\u3002</p>"},{"location":"reference/pipeline/built-ins/#11-simplemovingaverageinputs-window_length","title":"1.1 SimpleMovingAverage(inputs, window_length)","text":"<ul> <li>\u7528\u9014\uff1a\u8a08\u7b97\u6307\u5b9a\u8f38\u5165\u6578\u64da\u7684\u7c21\u55ae\u79fb\u52d5\u5e73\u5747\u3002</li> <li>\u53c3\u6578\uff1a<ul> <li><code>inputs</code> (list of <code>BoundColumn</code>)\uff1a\u8981\u8a08\u7b97\u79fb\u52d5\u5e73\u5747\u7684\u6578\u64da\u4f86\u6e90\uff0c\u4f8b\u5982 <code>[TWEquityPricing.close]</code>\u3002</li> <li><code>window_length</code> (int)\uff1a\u79fb\u52d5\u5e73\u5747\u7684\u8a08\u7b97\u7a97\u53e3\u9577\u5ea6\u3002</li> </ul> </li> <li> <p>\u7bc4\u4f8b\uff1a\u8a08\u7b97 20 \u65e5\u6536\u76e4\u50f9\u79fb\u52d5\u5e73\u5747\u3002</p> <pre><code>from zipline.pipeline.factors import SimpleMovingAverage\nfrom zipline.pipeline.data import TWEquityPricing\n\nmean_close_20 = SimpleMovingAverage(inputs=[TWEquityPricing.close], window_length=20)\n</code></pre> </li> </ul>"},{"location":"reference/pipeline/built-ins/#12-exponentialweightedmovingaverageinputs-window_length-decay_rate","title":"1.2 ExponentialWeightedMovingAverage(inputs, window_length, decay_rate)","text":"<ul> <li>\u7528\u9014\uff1a\u8a08\u7b97\u6307\u5b9a\u8f38\u5165\u6578\u64da\u7684\u6307\u6578\u52a0\u6b0a\u79fb\u52d5\u5e73\u5747\uff0c\u5c0d\u8fd1\u671f\u6578\u64da\u8ce6\u4e88\u66f4\u9ad8\u7684\u6b0a\u91cd\u3002</li> <li>\u53c3\u6578\uff1a<ul> <li><code>inputs</code> (list of <code>BoundColumn</code>)\uff1a\u8981\u8a08\u7b97\u6307\u6578\u52a0\u6b0a\u79fb\u52d5\u5e73\u5747\u7684\u6578\u64da\u4f86\u6e90\u3002</li> <li><code>window_length</code> (int)\uff1a\u6307\u6578\u52a0\u6b0a\u79fb\u52d5\u5e73\u5747\u7684\u8a08\u7b97\u7a97\u53e3\u9577\u5ea6\u3002</li> <li><code>decay_rate</code> (float, optional)\uff1a\u8870\u6e1b\u7387\uff0c\u7528\u65bc\u63a7\u5236\u6b0a\u91cd\u4e0b\u964d\u7684\u901f\u5ea6\u3002\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5247\u6839\u64da <code>window_length</code> \u8a08\u7b97\u3002</li> </ul> </li> <li> <p>\u7bc4\u4f8b\uff1a\u8a08\u7b97 20 \u65e5\u6536\u76e4\u50f9\u6307\u6578\u52a0\u6b0a\u79fb\u52d5\u5e73\u5747\u3002</p> <pre><code>from zipline.pipeline.factors import ExponentialWeightedMovingAverage\nfrom zipline.pipeline.data import TWEquityPricing\n\newma_close_20 = ExponentialWeightedMovingAverage(inputs=[TWEquityPricing.close], window_length=20)\n</code></pre> </li> </ul>"},{"location":"reference/pipeline/built-ins/#13-momentuminputs-window_length","title":"1.3 Momentum(inputs, window_length)","text":"<ul> <li>\u7528\u9014\uff1a\u8a08\u7b97\u6307\u5b9a\u8f38\u5165\u6578\u64da\u7684\u52d5\u91cf\uff0c\u8861\u91cf\u50f9\u683c\u8b8a\u5316\u7684\u901f\u5ea6\u548c\u5e45\u5ea6\u3002</li> <li>\u53c3\u6578\uff1a<ul> <li><code>inputs</code> (list of <code>BoundColumn</code>)\uff1a\u8981\u8a08\u7b97\u52d5\u91cf\u7684\u6578\u64da\u4f86\u6e90\uff0c\u901a\u5e38\u662f\u6536\u76e4\u50f9\u3002</li> <li><code>window_length</code> (int)\uff1a\u52d5\u91cf\u8a08\u7b97\u7684\u7a97\u53e3\u9577\u5ea6\u3002</li> </ul> </li> <li> <p>\u7bc4\u4f8b\uff1a\u8a08\u7b97 10 \u65e5\u6536\u76e4\u50f9\u52d5\u91cf\u3002</p> <pre><code>from zipline.pipeline.factors import Momentum\nfrom zipline.pipeline.data import TWEquityPricing\n\nmomentum_10 = Momentum(inputs=[TWEquityPricing.close], window_length=10)\n</code></pre> </li> </ul>"},{"location":"reference/pipeline/built-ins/#14-faststochasticoscillatorinputs-window_length","title":"1.4 FastStochasticOscillator(inputs, window_length)","text":"<ul> <li>\u7528\u9014\uff1a\u8a08\u7b97\u5feb\u901f\u96a8\u6a5f\u6307\u6a19 (Fast Stochastic Oscillator)\uff0c\u5373 K \u503c\uff0c\u7528\u65bc\u5224\u65b7\u8d85\u8cb7\u8d85\u8ce3\u3002</li> <li>\u53c3\u6578\uff1a<ul> <li><code>inputs</code> (list of <code>BoundColumn</code>)\uff1a\u901a\u5e38\u70ba <code>[TWEquityPricing.close, TWEquityPricing.low, TWEquityPricing.high]</code>\u3002</li> <li><code>window_length</code> (int)\uff1a\u8a08\u7b97 K \u503c\u6240\u9700\u7684\u8996\u7a97\u9577\u5ea6\u3002</li> </ul> </li> <li> <p>\u7bc4\u4f8b\uff1a\u8a08\u7b97 10 \u65e5 K \u503c\u3002</p> <pre><code>from zipline.pipeline.factors import FastStochasticOscillator\nfrom zipline.pipeline.data import TWEquityPricing\n\nfast_k = FastStochasticOscillator(\n    inputs=[TWEquityPricing.close, TWEquityPricing.low, TWEquityPricing.high],\n    window_length=10\n)\n</code></pre> </li> </ul>"},{"location":"reference/pipeline/built-ins/#15-marketcapinputs-window_length","title":"1.5 MarketCap(inputs, window_length)","text":"<ul> <li>\u7528\u9014\uff1a\u8a08\u7b97\u5e02\u503c\u3002\u901a\u5e38\u4e0d\u9700\u8981 <code>inputs</code> \u548c <code>window_length</code>\uff0c\u56e0\u70ba\u5e02\u503c\u662f\u6bcf\u65e5\u66f4\u65b0\u7684\u3002</li> <li>\u53c3\u6578\uff1a\u7121\u7279\u5b9a\u53c3\u6578\uff0c\u4f46\u53ef\u4ee5\u93c8\u63a5 <code>.top()</code> \u6216 <code>.bottom()</code> \u65b9\u6cd5\u9032\u884c\u7be9\u9078\u3002</li> <li> <p>\u7bc4\u4f8b\uff1a\u7372\u53d6\u5e02\u503c\u3002</p> <pre><code>from zipline.pipeline.factors import MarketCap\n\nmarket_cap = MarketCap()\n</code></pre> </li> </ul>"},{"location":"reference/pipeline/built-ins/#2-filters","title":"2. Filters (\u6ffe\u7db2)","text":"<p>Filters \u7528\u65bc\u7be9\u9078\u51fa\u4e00\u7d44\u7b26\u5408\u7279\u5b9a\u689d\u4ef6\u7684\u8cc7\u7522\u3002\u5b83\u5011\u7684\u8f38\u51fa\u662f\u5e03\u6797\u503c (True/False)\u3002</p>"},{"location":"reference/pipeline/built-ins/#21-staticassetsassets","title":"2.1 StaticAssets(assets)","text":"<ul> <li>\u7528\u9014\uff1a\u7be9\u9078\u51fa\u4e00\u500b\u975c\u614b\u7684\u8cc7\u7522\u5217\u8868\u3002\u9019\u4e9b\u8cc7\u7522\u5728\u6574\u500b\u56de\u6e2c\u671f\u9593\u4fdd\u6301\u4e0d\u8b8a\u3002</li> <li>\u53c3\u6578\uff1a<ul> <li><code>assets</code> (list of <code>Asset</code>)\uff1a\u8981\u5305\u542b\u5728\u7be9\u9078\u7d50\u679c\u4e2d\u7684\u8cc7\u7522\u5217\u8868\u3002</li> </ul> </li> <li> <p>\u7bc4\u4f8b\uff1a\u7be9\u9078\u51fa\u53f0\u7a4d\u96fb\u548c\u806f\u767c\u79d1\u3002</p> <pre><code>from zipline.api import symbol\nfrom zipline.pipeline.filters import StaticAssets\n\nmy_assets = StaticAssets([symbol('2330'), symbol('2454')])\n</code></pre> </li> </ul>"},{"location":"reference/pipeline/built-ins/#22-topnfactor-n-bottomnfactor-n","title":"2.2 TopN(factor, N) / BottomN(factor, N)","text":"<ul> <li>\u7528\u9014\uff1a\u6839\u64da\u6307\u5b9a\u56e0\u5b50\u7684\u503c\uff0c\u7be9\u9078\u51fa\u6392\u540d\u524d N \u6216\u5f8c N \u7684\u8cc7\u7522\u3002</li> <li>\u53c3\u6578\uff1a<ul> <li><code>factor</code> (Factor)\uff1a\u7528\u65bc\u6392\u5e8f\u7684\u56e0\u5b50\u3002</li> <li><code>N</code> (int)\uff1a\u8981\u7be9\u9078\u7684\u8cc7\u7522\u6578\u91cf\u3002</li> </ul> </li> <li> <p>\u7bc4\u4f8b\uff1a\u7be9\u9078\u51fa\u5e02\u503c\u6392\u540d\u524d 100 \u7684\u80a1\u7968\u3002</p> <pre><code>from zipline.pipeline.factors import MarketCap\n\ntop_100_by_market_cap = MarketCap().top(100)\n</code></pre> </li> </ul>"},{"location":"reference/pipeline/built-ins/#23-logical-operators","title":"2.3 \u908f\u8f2f\u904b\u7b97\u7b26 (Logical Operators)","text":"<p>Filters \u53ef\u4ee5\u900f\u904e\u908f\u8f2f\u904b\u7b97\u7b26 (<code>&amp;</code> (AND), <code>|</code> (OR), <code>~</code> (NOT)) \u9032\u884c\u7d44\u5408\uff0c\u4ee5\u69cb\u5efa\u66f4\u8907\u96dc\u7684\u7be9\u9078\u689d\u4ef6\u3002</p> <ul> <li> <p>\u7bc4\u4f8b\uff1a\u7be9\u9078\u51fa\u5e02\u503c\u6392\u540d\u524d 100 \u4e14 20 \u65e5\u5747\u7dda\u5927\u65bc 100 \u7684\u80a1\u7968\u3002</p> <pre><code>from zipline.pipeline.factors import MarketCap, SimpleMovingAverage\nfrom zipline.pipeline.data import TWEquityPricing\n\ntop_100 = MarketCap().top(100)\nmean_close_20_gt_100 = SimpleMovingAverage(inputs=[TWEquityPricing.close], window_length=20) &gt; 100\n\ncombined_filter = top_100 &amp; mean_close_20_gt_100\n</code></pre> </li> </ul>"},{"location":"reference/pipeline/built-ins/#3-classifiers","title":"3. Classifiers (\u5206\u985e\u5668)","text":"<p>Classifiers \u7528\u65bc\u70ba\u8cc7\u7522\u9032\u884c\u5206\u985e\uff0c\u5176\u8f38\u51fa\u901a\u5e38\u662f\u5b57\u4e32\u6216\u6574\u6578\uff0c\u4ee3\u8868\u8cc7\u7522\u6240\u5c6c\u7684\u985e\u5225\u3002</p>"},{"location":"reference/pipeline/built-ins/#31-sector","title":"3.1 Sector()","text":"<ul> <li>\u7528\u9014\uff1a\u8fd4\u56de\u6bcf\u500b\u8cc7\u7522\u6240\u5c6c\u7684\u7522\u696d\u985e\u5225\u3002</li> <li>\u53c3\u6578\uff1a\u7121\u3002</li> <li> <p>\u7bc4\u4f8b\uff1a\u7372\u53d6\u80a1\u7968\u7684\u7522\u696d\u985e\u5225\u3002</p> <pre><code>from zipline.pipeline.classifiers import Sector\n\nsector_classifier = Sector()\n</code></pre> </li> </ul>"},{"location":"reference/pipeline/built-ins/#32-quantilesfactor-n","title":"3.2 Quantiles(factor, N)","text":"<ul> <li>\u7528\u9014\uff1a\u5c07\u4e00\u500b\u56e0\u5b50\u7684\u8f38\u51fa\u503c\u6309\u5206\u4f4d\u6578\u9032\u884c\u5206\u7d44\u3002\u4f8b\u5982\uff0c\u5c07\u6240\u6709\u80a1\u7968\u6309\u5e02\u503c\u5206\u70ba 5 \u500b\u5206\u4f4d\u6578\u7d44\u3002</li> <li>\u53c3\u6578\uff1a<ul> <li><code>factor</code> (Factor)\uff1a\u8981\u9032\u884c\u5206\u4f4d\u6578\u5206\u7d44\u7684\u56e0\u5b50\u3002</li> <li><code>N</code> (int)\uff1a\u8981\u5206\u7d44\u7684\u6578\u91cf\u3002</li> </ul> </li> <li> <p>\u7bc4\u4f8b\uff1a\u5c07\u5e02\u503c\u5206\u70ba 5 \u500b\u5206\u4f4d\u6578\u7d44\u3002</p> <pre><code>from zipline.pipeline.factors import MarketCap\nfrom zipline.pipeline.classifiers import Quantiles\n\nmarket_cap_quantiles = Quantiles(inputs=[MarketCap()], N=5)\n</code></pre> </li> </ul>"},{"location":"reference/pipeline/built-ins/#4","title":"4. \u7e3d\u7d50","text":"<p>TQuant Lab Pipeline \u7684\u5167\u5efa\u7d44\u4ef6\u63d0\u4f9b\u4e86\u5f37\u5927\u7684\u57fa\u790e\uff0c\u8b93\u60a8\u53ef\u4ee5\u5feb\u901f\u69cb\u5efa\u548c\u6e2c\u8a66\u5404\u7a2e\u91cf\u5316\u7b56\u7565\u3002\u900f\u904e\u9748\u6d3b\u7d44\u5408 Factors\u3001Filters \u548c Classifiers\uff0c\u60a8\u53ef\u4ee5\u5f9e\u539f\u59cb\u6578\u64da\u4e2d\u63d0\u53d6\u6709\u50f9\u503c\u7684\u6295\u8cc7\u8a0a\u865f\uff0c\u4e26\u6709\u6548\u5730\u7ba1\u7406\u60a8\u7684\u80a1\u7968\u6c60\u3002</p>"},{"location":"reference/pipeline/custom-factor/","title":"Zipline CustomFactor\uff1a\u5275\u5efa\u81ea\u5b9a\u7fa9\u56e0\u5b50","text":"<p>Info</p> <p>\u672c\u9801\u6df1\u5165\u4ecb\u7d39 Zipline Pipeline \u4e2d\u7684 <code>CustomFactor</code>\uff0c\u8aaa\u660e\u5982\u4f55\u900f\u904e\u7e7c\u627f\u6b64\u985e\u5225\u4f86\u5275\u5efa\u81ea\u8a02\u7684\u56e0\u5b50\uff0c\u4ee5\u6eff\u8db3\u7279\u5b9a\u7684\u91cf\u5316\u7b56\u7565\u9700\u6c42\u3002\u5167\u5bb9\u6db5\u84cb <code>CustomFactor</code> \u7684\u6838\u5fc3\u6982\u5ff5\u3001\u53c3\u6578\u3001<code>compute</code> \u65b9\u6cd5\u7684\u5be6\u73fe\u7d30\u7bc0\uff0c\u4e26\u63d0\u4f9b\u5be6\u7528\u7684\u7a0b\u5f0f\u78bc\u7bc4\u4f8b\u3002</p> <p>\u5728 Zipline \u7684 Pipeline API \u4e2d\uff0c<code>Factor</code> \u5141\u8a31\u60a8\u5c0d\u6578\u64da\u9032\u884c\u6578\u503c\u8a08\u7b97\u3002\u96d6\u7136 Zipline \u63d0\u4f9b\u4e86\u8a31\u591a\u5167\u5efa\u56e0\u5b50\uff0c\u4f46\u5be6\u52d9\u4e0a\u60a8\u5e38\u5e38\u9700\u8981\u6839\u64da\u81ea\u5df1\u7684\u7b56\u7565\u9700\u6c42\u5275\u5efa\u7368\u7279\u7684\u5206\u6790\u6307\u6a19\u3002<code>CustomFactor</code> \u5c31\u662f\u70ba\u6b64\u800c\u751f\uff0c\u5b83\u8b93\u60a8\u80fd\u5920\u5b8c\u5168\u81ea\u5b9a\u7fa9\u56e0\u5b50\u7684\u8a08\u7b97\u908f\u8f2f\u3002</p> <p><code>CustomFactor</code> \u985e\u5225\u7e7c\u627f\u81ea <code>Factor</code>\uff0c\u9019\u8868\u793a\u5b83\u64c1\u6709 <code>Factor</code> \u7684\u6240\u6709\u57fa\u672c\u7279\u6027\uff0c\u4e26\u5728\u6b64\u57fa\u790e\u4e0a\u63d0\u4f9b\u4e86\u4e00\u500b <code>compute</code> \u65b9\u6cd5\u4f9b\u60a8\u8986\u5beb\uff0c\u4ee5\u5be6\u73fe\u60a8\u7684\u81ea\u5b9a\u7fa9\u908f\u8f2f\u3002</p>"},{"location":"reference/pipeline/custom-factor/#1-customfactor","title":"1. CustomFactor \u7c21\u4ecb","text":"<ul> <li>\u7528\u9014: \u5141\u8a31\u958b\u767c\u8005\u5b9a\u7fa9\u4efb\u4f55\u57fa\u65bc\u6b77\u53f2\u6578\u64da\u7684\u6a6b\u622a\u9762\u56e0\u5b50\u8a08\u7b97\u908f\u8f2f\u3002</li> <li>\u7e7c\u627f: \u5fc5\u9808\u7e7c\u627f\u81ea <code>zipline.pipeline.CustomFactor</code>\u3002</li> <li>\u6838\u5fc3: \u900f\u904e\u5be6\u4f5c <code>compute()</code> \u65b9\u6cd5\u4f86\u5b9a\u7fa9\u56e0\u5b50\u7684\u8a08\u7b97\u65b9\u5f0f\u3002</li> </ul>"},{"location":"reference/pipeline/custom-factor/#2-customfactor","title":"2. CustomFactor \u7684\u6838\u5fc3\u5c6c\u6027\u8207\u65b9\u6cd5","text":"<p>\u5728\u5b9a\u7fa9 <code>CustomFactor</code> \u6642\uff0c\u60a8\u9700\u8981\u8a2d\u5b9a\u4ee5\u4e0b\u6838\u5fc3\u5c6c\u6027\uff0c\u4e26\u5be6\u4f5c <code>compute()</code> \u65b9\u6cd5\uff1a</p> <ul> <li><code>inputs</code>:<ul> <li>(\u985e\u5225\u5c6c\u6027) \u4e00\u500b\u5217\u8868\uff0c\u5305\u542b <code>BoundColumn</code> \u7269\u4ef6\uff08\u4f8b\u5982 <code>EquityPricing.close</code>\uff09\uff0c\u9019\u4e9b\u662f\u56e0\u5b50\u8a08\u7b97\u6240\u9700\u7684\u6b77\u53f2\u6578\u64da\u8f38\u5165\u3002</li> <li>\u7bc4\u4f8b\uff1a<code>inputs = [EquityPricing.close, EquityPricing.volume]</code></li> </ul> </li> <li><code>window_length</code>:<ul> <li>(\u985e\u5225\u5c6c\u6027) \u4e00\u500b\u6574\u6578\uff0c\u5b9a\u7fa9\u56e0\u5b50\u8a08\u7b97\u6240\u9700\u7684\u6b77\u53f2\u6578\u64da\u7a97\u53e3\u9577\u5ea6\u3002\u4f8b\u5982\uff0c<code>window_length = 20</code> \u8868\u793a\u56e0\u5b50\u6703\u4f7f\u7528\u904e\u53bb 20 \u5929\u7684\u6578\u64da\u9032\u884c\u8a08\u7b97\u3002</li> </ul> </li> <li><code>compute(self, today, assets, out, *arrays)</code>:<ul> <li>(\u65b9\u6cd5) \u9019\u662f\u60a8\u5fc5\u9808\u8986\u5beb\u7684\u6838\u5fc3\u65b9\u6cd5\uff0c\u7528\u65bc\u5be6\u73fe\u81ea\u5b9a\u7fa9\u56e0\u5b50\u7684\u8a08\u7b97\u908f\u8f2f\u3002\u5b83\u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u90fd\u6703\u88ab\u547c\u53eb\u3002</li> <li><code>self</code>: <code>CustomFactor</code> \u5be6\u4f8b\u672c\u8eab\u3002</li> <li><code>today</code>: (<code>pd.Timestamp</code>) \u7576\u524d\u6b63\u5728\u8a08\u7b97\u56e0\u5b50\u7684\u65e5\u671f\u3002</li> <li><code>assets</code>: (<code>np.array</code>) \u4e00\u7dad NumPy \u6578\u7d44\uff0c\u5305\u542b\u7576\u524d Pipeline Universe \u4e2d\u7684\u8cc7\u7522 SID\u3002</li> <li><code>out</code>: (<code>np.array</code>) \u4e00\u7dad NumPy \u6578\u7d44\uff0c\u60a8\u5fc5\u9808\u5c07\u8a08\u7b97\u51fa\u7684\u56e0\u5b50\u503c\u5beb\u5165\u6b64\u6578\u7d44\u4e2d\u3002\u5b83\u7684\u9577\u5ea6\u8207 <code>assets</code> \u76f8\u540c\u3002</li> <li><code>*arrays</code>: \u8b8a\u9577\u53c3\u6578\uff0c\u6bcf\u500b\u53c3\u6578\u5c0d\u61c9\u65bc <code>inputs</code> \u5217\u8868\u4e2d\u7684\u4e00\u500b\u6b77\u53f2\u6578\u64da\u8f38\u5165\u3002\u6bcf\u500b <code>array</code> \u90fd\u662f\u4e00\u500b 2D NumPy \u6578\u7d44\uff0c\u5f62\u72c0\u70ba <code>(window_length, len(assets))</code>\uff0c\u5305\u542b\u904e\u53bb <code>window_length</code> \u5929\u7684\u6578\u64da\u3002</li> </ul> </li> <li><code>dtype</code>:<ul> <li>(\u985e\u5225\u5c6c\u6027) \u5b9a\u7fa9\u56e0\u5b50\u7684\u8f38\u51fa\u6578\u64da\u985e\u578b\uff0c\u4f8b\u5982 <code>np.float64</code>\u3002</li> </ul> </li> <li><code>missing_value</code>:<ul> <li>(\u985e\u5225\u5c6c\u6027) \u7576\u6578\u64da\u7f3a\u5931\u6642\u7528\u65bc\u586b\u5145\u7684\u9810\u8a2d\u503c\u3002</li> </ul> </li> </ul>"},{"location":"reference/pipeline/custom-factor/#3-customfactor","title":"3. \u5982\u4f55\u5275\u5efa CustomFactor","text":"<p>\u4ee5\u4e0b\u5c07\u4ee5\u4e00\u500b\u7c21\u55ae\u7684 <code>StdDev</code> (\u6a19\u6e96\u5dee) \u56e0\u5b50\u70ba\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u7e7c\u627f <code>CustomFactor</code> \u4e26\u5be6\u4f5c <code>compute</code> \u65b9\u6cd5\u4f86\u8a08\u7b97\u904e\u53bb <code>N</code> \u5929\u6536\u76e4\u50f9\u7684\u6efe\u52d5\u6a19\u6e96\u5dee\u3002</p> <pre><code>import numpy as np\nfrom zipline.pipeline import CustomFactor\nfrom zipline.pipeline.data import EquityPricing\n\nclass StdDev(CustomFactor):\n    \"\"\"\n    \u8a08\u7b97\u904e\u53bb N \u5929\u6536\u76e4\u50f9\u7684\u6efe\u52d5\u6a19\u6e96\u5dee\u3002\n    \"\"\"\n    # \u56e0\u5b50\u8a08\u7b97\u6240\u9700\u7684\u8f38\u5165\u6578\u64da (\u9019\u88e1\u53ea\u9700\u8981\u6536\u76e4\u50f9)\n    inputs = [EquityPricing.close]\n\n    # \u56e0\u5b50\u8a08\u7b97\u6240\u9700\u7684\u6b77\u53f2\u6578\u64da\u7a97\u53e3\u9577\u5ea6 (\u5c07\u5728\u521d\u59cb\u5316\u6642\u50b3\u5165)\n    window_length = 0 # \u9019\u88e1\u8a2d\u70ba0\uff0c\u56e0\u70ba\u5be6\u969b\u6703\u5728\u5be6\u4f8b\u5316\u6642\u8a2d\u5b9a\n\n    # \u56e0\u5b50\u8f38\u51fa\u7684\u6578\u64da\u985e\u578b\n    dtype = np.float64\n\n    # \u7576\u6578\u64da\u7f3a\u5931\u6642\u7684\u586b\u5145\u503c\n    missing_value = 0.0\n\n    def compute(self, today, assets, out, close_prices):\n        \"\"\"\n        \u6838\u5fc3\u7684\u56e0\u5b50\u8a08\u7b97\u908f\u8f2f\u3002\n        \"\"\"\n        # close_prices \u662f\u4e00\u500b (window_length, len(assets)) \u7684 NumPy \u6578\u7d44\n        # \u8a08\u7b97\u6bcf\u500b\u8cc7\u7522\u5728\u6307\u5b9a\u7a97\u53e3\u9577\u5ea6\u5167\u7684\u6a19\u6e96\u5dee\n        out[:] = np.nanstd(close_prices, axis=0) # axis=0 \u5c0d\u6642\u9593\u7dad\u5ea6\u6c42\u6a19\u6e96\u5dee\n</code></pre>"},{"location":"reference/pipeline/custom-factor/#4-pipeline-customfactor","title":"4. \u5728 Pipeline \u4e2d\u4f7f\u7528 CustomFactor","text":"<p>\u5275\u5efa <code>CustomFactor</code> \u5f8c\uff0c\u60a8\u5c31\u53ef\u4ee5\u50cf\u4f7f\u7528\u4efb\u4f55\u5167\u5efa\u56e0\u5b50\u4e00\u6a23\uff0c\u5c07\u5176\u61c9\u7528\u5230\u60a8\u7684 Pipeline \u4e2d\u3002</p>"},{"location":"reference/pipeline/custom-factor/#_1","title":"\u7bc4\u4f8b","text":"<pre><code>from zipline.pipeline import Pipeline\n# from zipline.pipeline.factors import SimpleMovingAverage # \u4e5f\u53ef\u4ee5\u540c\u6642\u4f7f\u7528\u5167\u5efa\u56e0\u5b50\n\ndef make_my_pipeline():\n    # \u5be6\u4f8b\u5316 CustomFactor\uff0c\u4e26\u8a2d\u5b9a\u5176 window_length\n    my_std_dev = StdDev(window_length=20) # \u8a08\u7b97 20 \u65e5\u6efe\u52d5\u6a19\u6e96\u5dee\n\n    return Pipeline(\n        columns={\n            'StdDev_20D': my_std_dev,\n            'Close_Price': EquityPricing.close.latest # \u4e5f\u53ef\u4ee5\u7372\u53d6\u6700\u65b0\u6536\u76e4\u50f9\n        }\n    )\n</code></pre>"},{"location":"reference/pipeline/custom-factor/#5","title":"5. \u5b8c\u6574\u7bc4\u4f8b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u500b\u5b8c\u6574\u7684\u7bc4\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u5b9a\u7fa9\u4e00\u500b <code>CustomFactor</code> \u4e26\u5728 Zipline \u56de\u6e2c\u4e2d\u4f7f\u7528\u5b83\u3002</p> <pre><code>import pandas as pd\nimport numpy as np\nfrom zipline import run_algorithm\nfrom zipline.api import (\n    attach_pipeline,\n    pipeline_output,\n    set_benchmark,\n    symbol,\n    order_target_percent\n)\nfrom zipline.pipeline import Pipeline, CustomFactor\nfrom zipline.pipeline.data import EquityPricing\nfrom zipline.pipeline.filters import AverageDollarVolume\n\n# 1. \u5b9a\u7fa9 CustomFactor: \u8a08\u7b97 N \u65e5\u6efe\u52d5\u6a19\u6e96\u5dee\nclass CustomStdDev(CustomFactor):\n    inputs = [EquityPricing.close]\n    window_length = 0 # \u5c07\u5728\u5be6\u4f8b\u5316\u6642\u8986\u84cb\n    dtype = np.float64\n    missing_value = 0.0\n\n    def compute(self, today, assets, out, close_prices):\n        out[:] = np.nanstd(close_prices, axis=0)\n\n# 2. \u5b9a\u7fa9 Pipeline\ndef make_my_pipeline():\n    # \u5be6\u4f8b\u5316\u81ea\u5b9a\u7fa9\u56e0\u5b50\uff0c\u8a08\u7b97 20 \u65e5\u6efe\u52d5\u6a19\u6e96\u5dee\n    my_std_dev_20d = CustomStdDev(window_length=20)\n\n    # \u7be9\u9078\u5668\uff1a\u904e\u53bb 10 \u5929\u5e73\u5747\u65e5\u6210\u4ea4\u91d1\u984d\u524d 20 \u6a94\u80a1\u7968\n    high_volume_filter = AverageDollarVolume(window_length=10).top(20)\n\n    return Pipeline(\n        columns={\n            'Custom_StdDev_20D': my_std_dev_20d,\n            'Close_Price': EquityPricing.close.latest\n        },\n        screen=high_volume_filter # \u900f\u904e screen \u7be9\u9078 Universe\n    )\n\n# 3. Zipline \u56de\u6e2c\u8a2d\u7f6e\ndef initialize(context):\n    set_benchmark(symbol('IR0001'))\n    attach_pipeline(make_my_pipeline(), 'my_strategy_pipeline') \n\ndef before_trading_start(context, data):\n    pipeline_results = pipeline_output('my_strategy_pipeline')\n    context.my_universe = pipeline_results.index.get_level_values(1).tolist()\n    context.pipeline_data = pipeline_results\n\ndef handle_data(context, data):\n    if not context.my_universe:\n        return\n\n    for asset in context.my_universe:\n        if data.can_trade(asset) and asset in context.pipeline_data.index.get_level_values(1):\n            std_dev_value = context.pipeline_data.loc[(data.current_dt.date(), asset), 'Custom_StdDev_20D']\n            current_price = data.current(asset, 'price')\n\n            # \u7c21\u55ae\u7b56\u7565\uff1a\u5982\u679c\u80a1\u50f9\u6ce2\u52d5\u8f03\u5927\uff08\u4f8b\u5982\uff0c\u9ad8\u65bc\u5176 20 \u65e5\u6a19\u6e96\u5dee\u7684 X \u500d\uff09\uff0c\u5247\u9032\u884c\u64cd\u4f5c\n            # \u9019\u88e1\u50c5\u4f5c\u793a\u4f8b\uff0c\u5be6\u969b\u7b56\u7565\u6703\u66f4\u8907\u96dc\n            if current_price &gt; 100 and std_dev_value &gt; 5: # \u5047\u8a2d\u80a1\u50f9\u5927\u65bc100\u4e14\u6ce2\u52d5\u5927\u65bc5\n                if asset not in context.portfolio.positions:\n                    order_target_percent(asset, 1.0 / len(context.my_universe))\n            elif current_price &lt; 90 and asset in context.portfolio.positions:\n                order_target_percent(asset, 0.0)\n\ndef analyze(context, results):\n    print(\"\u56de\u6e2c\u5206\u6790\u5b8c\u6210\u3002\")\n\n# \u57f7\u884c\u56de\u6e2c\nresults = run_algorithm(\n    start=pd.Timestamp('2020-01-01', tz='UTC'),\n    end=pd.Timestamp('2021-01-01', tz='UTC'),\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=1_000_000,\n    bundle='tquant',\n    before_trading_start=before_trading_start\n)\n</code></pre>"},{"location":"reference/pipeline/overview/","title":"Zipline Pipeline API \u6982\u89bd","text":"<p>Info</p> <p>\u672c\u9801\u6df1\u5165\u89e3\u91cb Zipline Pipeline \u7684\u904b\u4f5c\u539f\u7406\uff0c\u5305\u62ec\u5176\u6838\u5fc3\u7d44\u4ef6\uff08Factors, Filters, Classifiers\uff09\u3001\u8cc7\u6599\u96c6 (DataSets) \u7684\u6982\u5ff5\u3001\u4ee5\u53ca\u5982\u4f55\u900f\u904e Pipeline \u9ad8\u6548\u5730\u751f\u6210\u4ea4\u6613\u8a0a\u865f\uff0c\u70ba\u4f7f\u7528\u8005\u5efa\u7acb\u5c0d Pipeline \u7684\u5168\u9762\u7406\u89e3\u3002</p> <p>Zipline \u7684 Pipeline API \u662f\u4e00\u500b\u5f37\u5927\u4e14\u9ad8\u6548\u7684\u5de5\u5177\uff0c\u5c08\u70ba\u5728\u9f90\u5927\u7684\u8cc7\u7522\u6c60\u4e2d\u9032\u884c\u56e0\u5b50\u8a08\u7b97\u548c\u52d5\u614b\u8cc7\u7522\u7be9\u9078\u800c\u8a2d\u8a08\u3002\u5b83\u5141\u8a31\u7b56\u7565\u958b\u767c\u8005\u4ee5\u8072\u660e\u5f0f\u7684\u65b9\u5f0f\u5b9a\u7fa9\u8907\u96dc\u7684\u6578\u64da\u8655\u7406\u6d41\u7a0b\uff0c\u5f9e\u800c\u907f\u514d\u4e86\u50b3\u7d71\u65b9\u6cd5\u4e2d\u5e38\u898b\u7684\u300c\u524d\u8996\u6027\u504f\u5dee (Look-Ahead Bias)\u300d\u548c\u6578\u64da\u8655\u7406\u6548\u7387\u4f4e\u4e0b\u7b49\u554f\u984c\u3002</p>"},{"location":"reference/pipeline/overview/#1-pipeline","title":"1. Pipeline \u7c21\u4ecb","text":"<p>Pipeline \u7684\u6838\u5fc3\u601d\u60f3\u662f\u5c07\u6578\u64da\u63d0\u53d6\u3001\u56e0\u5b50\u8a08\u7b97\u548c\u8cc7\u7522\u7be9\u9078\u7684\u908f\u8f2f\uff0c\u5f9e\u4e3b\u56de\u6e2c\u5faa\u74b0 (<code>handle_data()</code>) \u4e2d\u5206\u96e2\u51fa\u4f86\uff0c\u4e26\u5728 \u6bcf\u500b\u4ea4\u6613\u65e5\u958b\u59cb\u524d \u9032\u884c**\u4e00\u6b21\u6027** \u8a08\u7b97\u3002</p>"},{"location":"reference/pipeline/overview/#_1","title":"\u4e3b\u8981\u512a\u52e2\uff1a","text":"<ul> <li>\u907f\u514d\u524d\u8996\u6027\u504f\u5dee : \u78ba\u4fdd\u6240\u6709\u6578\u64da\u64cd\u4f5c\u90fd\u53ea\u4f7f\u7528\u5230\u56de\u6e2c\u7576\u5929\u4e4b\u524d\u53ef\u7528\u7684\u8cc7\u8a0a\u3002</li> <li>\u9ad8\u6548\u6027 : \u900f\u904e Zipline \u512a\u5316\u7684\u6578\u64da\u5f15\u64ce\u548c\u5411\u91cf\u5316\u64cd\u4f5c\uff0c\u80fd\u5920\u5728\u5927\u578b\u6578\u64da\u96c6\u4e0a\u9ad8\u6548\u57f7\u884c\u8907\u96dc\u7684\u8a08\u7b97\u3002</li> <li>\u53ef\u8b80\u6027\u8207\u6a21\u7d44\u5316 : \u7b56\u7565\u908f\u8f2f\u8207\u6578\u64da\u8655\u7406\u908f\u8f2f\u5206\u96e2\uff0c\u63d0\u9ad8\u4ee3\u78bc\u7684\u53ef\u8b80\u6027\u548c\u53ef\u7dad\u8b77\u6027\u3002</li> </ul>"},{"location":"reference/pipeline/overview/#2","title":"2. \u6838\u5fc3\u6982\u5ff5","text":"<p>\u5728\u4f7f\u7528 Pipeline \u6642\uff0c\u60a8\u6703\u63a5\u89f8\u5230\u4ee5\u4e0b\u5e7e\u500b\u6838\u5fc3\u6982\u5ff5\uff1a</p> <ul> <li><code>Pipeline</code> \u7269\u4ef6:<ul> <li>\u9019\u662f Pipeline API \u7684\u6838\u5fc3\uff0c\u4f5c\u70ba\u4e00\u500b\u5bb9\u5668\uff0c\u7528\u65bc\u5b9a\u7fa9\u8981\u8a08\u7b97\u54ea\u4e9b Factor\u3001\u7be9\u9078\u54ea\u4e9b\u8cc7\u7522\uff0c\u4ee5\u53ca\u8f38\u51fa\u54ea\u4e9b\u6578\u64da\u3002</li> <li>\u60a8\u53ef\u4ee5\u5728 <code>Pipeline</code> \u7269\u4ef6\u4e2d\u6307\u5b9a <code>columns</code> \u4f86\u5b9a\u7fa9\u8f38\u51fa\u6578\u64da\uff0c\u4ee5\u53ca <code>screen</code> \u4f86\u5b9a\u7fa9\u8cc7\u7522\u7be9\u9078\u689d\u4ef6\u3002</li> </ul> </li> <li><code>Factor</code> (\u56e0\u5b50):<ul> <li>\u7528\u65bc\u8a08\u7b97\u6a6b\u622a\u9762\u6578\u64da\uff08\u5373\u5c0d\u6240\u6709\u8cc7\u7522\u5728\u67d0\u500b\u6642\u9593\u9ede\u9032\u884c\u8a08\u7b97\uff09\u7684\u51fd\u6578\u3002\u5b83\u5011\u901a\u5e38\u6703\u8fd4\u56de\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u6642\u9593\u9ede\u7684\u6578\u503c\u3002</li> <li>\u7bc4\u4f8b\uff1a<code>SimpleMovingAverage</code> (\u7c21\u55ae\u79fb\u52d5\u5e73\u5747), <code>AverageDollarVolume</code> (\u5e73\u5747\u6210\u4ea4\u91d1\u984d)\u3002</li> </ul> </li> <li><code>Filter</code> (\u904e\u6ffe\u5668):<ul> <li>\u7528\u65bc\u7be9\u9078\u8cc7\u7522\u7684\u5e03\u6797\u51fd\u6578\u3002\u5b83\u5011\u901a\u5e38\u6703\u8fd4\u56de\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u6642\u9593\u9ede\u7684 <code>True</code> \u6216 <code>False</code>\uff0c\u8868\u793a\u8a72\u8cc7\u7522\u662f\u5426\u7b26\u5408\u689d\u4ef6\u3002</li> <li>\u7bc4\u4f8b\uff1a<code>top(N)</code> (\u5e02\u503c\u524dN\u5927), <code>StaticAssets</code> (\u975c\u614b\u8cc7\u7522\u5217\u8868)\u3002</li> </ul> </li> <li><code>Classifier</code> (\u5206\u985e\u5668):<ul> <li>\u7528\u65bc\u5c07\u8cc7\u7522\u5206\u7d44\u7684\u51fd\u6578\u3002\u5b83\u5011\u901a\u5e38\u8fd4\u56de\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u6642\u9593\u9ede\u7684\u4e00\u500b\u985e\u5225\u6a19\u7c64\uff08\u4f8b\u5982\u884c\u696d\u4ee3\u78bc\uff09\u3002</li> </ul> </li> <li><code>DataSet</code> (\u6578\u64da\u96c6):<ul> <li>Pipeline \u6578\u64da\u7684\u4f86\u6e90\uff0c\u4f8b\u5982 <code>EquityPricing</code> (\u80a1\u7968\u50f9\u683c\u6578\u64da), <code>TQDataSet</code> (TEJ \u81ea\u5b9a\u7fa9\u6578\u64da\u96c6)\u3002</li> </ul> </li> </ul>"},{"location":"reference/pipeline/overview/#3-pipeline","title":"3. Pipeline \u5de5\u4f5c\u6d41\u7a0b","text":"<p>Pipeline \u7684\u4f7f\u7528\u901a\u5e38\u9075\u5faa\u4ee5\u4e0b\u4e09\u500b\u6b65\u9a5f\uff1a</p>"},{"location":"reference/pipeline/overview/#31-pipeline-make_pipeline","title":"3.1. \u5b9a\u7fa9 Pipeline (make_pipeline() \u51fd\u6578)","text":"<p>\u60a8\u6703\u5275\u5efa\u4e00\u500b\u51fd\u6578 (\u901a\u5e38\u547d\u540d\u70ba <code>make_pipeline()</code>)\uff0c\u7528\u65bc\u69cb\u5efa\u548c\u8fd4\u56de\u4e00\u500b <code>Pipeline</code> \u7269\u4ef6\u3002\u5728\u9019\u500b\u51fd\u6578\u5167\u90e8\uff0c\u60a8\u5b9a\u7fa9\u4e86 Pipeline \u7684\u6240\u6709\u8a08\u7b97\u908f\u8f2f\u3002</p> <pre><code>from zipline.pipeline import Pipeline\nfrom zipline.pipeline.factors import SimpleMovingAverage\nfrom zipline.pipeline.filters import AverageDollarVolume\nfrom zipline.pipeline.data import EquityPricing\n\ndef make_my_pipeline():\n    # \u5b9a\u7fa9\u4e00\u500b\u56e0\u5b50\uff1a20 \u65e5\u7c21\u55ae\u79fb\u52d5\u5e73\u5747\u7dda\n    sma_20 = SimpleMovingAverage(inputs=[EquityPricing.close], window_length=20)\n\n    # \u5b9a\u7fa9\u4e00\u500b\u7be9\u9078\u5668\uff1a\u7be9\u9078\u51fa\u904e\u53bb 20 \u5929\u5e73\u5747\u65e5\u6210\u4ea4\u91d1\u984d\u524d 50% \u7684\u80a1\u7968\n    high_dollar_volume = AverageDollarVolume(window_length=20).percentile_between(50, 100)\n\n    return Pipeline(\n        columns={\n            'SMA_20': sma_20,\n            'Close_Price': EquityPricing.close.latest # \u4e5f\u53ef\u4ee5\u7372\u53d6\u6700\u65b0\u6536\u76e4\u50f9\n        },\n        screen=high_dollar_volume # \u5c07\u7be9\u9078\u5668\u61c9\u7528\u65bc Pipeline\uff0c\u6c7a\u5b9a\u6bcf\u5929\u7684 Universe\n    )\n</code></pre>"},{"location":"reference/pipeline/overview/#32-pipeline-attach_pipeline","title":"3.2. \u9644\u639b Pipeline (attach_pipeline() \u51fd\u6578)","text":"<p>\u5728\u56de\u6e2c\u7684 <code>initialize()</code> \u51fd\u6578\u4e2d\uff0c\u60a8\u9700\u8981\u4f7f\u7528 <code>zipline.api.attach_pipeline()</code> \u5c07\u5b9a\u7fa9\u597d\u7684 Pipeline \u9644\u639b\u5230\u56de\u6e2c\u5f15\u64ce\u3002\u9019\u6a23\uff0cZipline \u5c31\u6703\u77e5\u9053\u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u904b\u884c\u8a72 Pipeline\u3002</p> <pre><code>from zipline.api import attach_pipeline, set_benchmark, symbol\n\ndef initialize(context):\n    set_benchmark(symbol('IR0001')) # \u8a2d\u5b9a Benchmark\n    attach_pipeline(make_my_pipeline(), 'my_pipeline_name') # \u9644\u639b Pipeline \u4e26\u547d\u540d\n</code></pre>"},{"location":"reference/pipeline/overview/#33-pipeline-pipeline_output","title":"3.3. \u7372\u53d6 Pipeline \u8f38\u51fa (pipeline_output() \u51fd\u6578)","text":"<p>\u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u9700\u8981 Pipeline \u8f38\u51fa\u7d50\u679c\u6642\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>zipline.api.pipeline_output()</code> \u51fd\u6578\uff0c\u50b3\u5165\u60a8\u5728 <code>attach_pipeline()</code> \u4e2d\u6307\u5b9a\u7684\u540d\u7a31\uff0c\u4f86\u7372\u53d6\u7576\u65e5 Pipeline \u7684\u8a08\u7b97\u7d50\u679c\u3002</p> <p>\u9019\u901a\u5e38\u5728 <code>before_trading_start()</code> \u51fd\u6578\u4e2d\u57f7\u884c\uff0c\u56e0\u70ba Pipeline \u7684\u8a08\u7b97\u6703\u5728\u5e02\u5834\u958b\u76e4\u524d\u5b8c\u6210\uff0c\u60a8\u53ef\u4ee5\u5229\u7528\u5176\u7d50\u679c\u4f86\u6c7a\u5b9a\u7576\u5929\u7684\u4ea4\u6613\u7b56\u7565\u3002</p> <pre><code>from zipline.api import pipeline_output\n\ndef before_trading_start(context, data):\n    # \u7372\u53d6\u540d\u70ba 'my_pipeline_name' \u7684 Pipeline \u5728\u524d\u4e00\u4ea4\u6613\u65e5\u8a08\u7b97\u7684\u7d50\u679c\n    context.pipeline_results = pipeline_output('my_pipeline_name')\n\n    # \u5f9e Pipeline \u8f38\u51fa\u4e2d\u7372\u53d6\u7576\u5929\u7684 Universe (\u7b26\u5408 screen \u689d\u4ef6\u7684\u80a1\u7968)\n    context.my_universe = context.pipeline_results.index.get_level_values(1).tolist()\n\n    # \u7bc4\u4f8b\uff1a\u5f9e\u7d50\u679c\u4e2d\u7372\u53d6 SMA_20 \u503c\n    # if not context.pipeline_results.empty:\n    #     for asset in context.my_universe:\n    #         sma_value = context.pipeline_results.loc[(data.current_dt.date(), asset), 'SMA_20']\n    #         print(f\"{asset.symbol} \u7684 SMA_20: {sma_value}\")\n</code></pre>"},{"location":"reference/pipeline/overview/#4","title":"4. \u5b8c\u6574\u7bc4\u4f8b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u500b\u5b8c\u6574\u7684\u7bc4\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u5b9a\u7fa9\u3001\u9644\u639b Pipeline \u4e26\u7372\u53d6\u5176\u8f38\u51fa\u4ee5\u7be9\u9078\u8cc7\u7522\u3002</p> <pre><code>import pandas as pd\nfrom zipline import run_algorithm\nfrom zipline.api import (\n    attach_pipeline,\n    pipeline_output,\n    set_benchmark,\n    symbol,\n    order_target_percent\n)\nfrom zipline.pipeline import Pipeline\nfrom zipline.pipeline.factors import SimpleMovingAverage, AverageDollarVolume\nfrom zipline.pipeline.data import EquityPricing\nfrom zipline.pipeline.filters import StaticAssets\n\n# 1. \u5b9a\u7fa9 Pipeline\ndef make_my_pipeline():\n    # \u8a08\u7b97 20 \u65e5\u7c21\u55ae\u79fb\u52d5\u5e73\u5747\u7dda\u56e0\u5b50\n    sma_20 = SimpleMovingAverage(inputs=[EquityPricing.close], window_length=20)\n\n    # \u7be9\u9078\u51fa\u904e\u53bb 10 \u5929\u5e73\u5747\u65e5\u6210\u4ea4\u91d1\u984d\u524d 20 \u6a94\u80a1\u7968\u4f5c\u70ba Universe\n    high_volume_filter = AverageDollarVolume(window_length=10).top(20)\n\n    return Pipeline(\n        columns={\n            'SMA_20': sma_20,\n            'Close_Price': EquityPricing.close.latest # \u540c\u6642\u7372\u53d6\u6700\u65b0\u6536\u76e4\u50f9\n        },\n        screen=high_volume_filter # \u5c07\u7be9\u9078\u5668\u61c9\u7528\u65bc Pipeline\uff0c\u5b9a\u7fa9 Universe\n    )\n\n# 2. Zipline \u56de\u6e2c\u8a2d\u7f6e\ndef initialize(context):\n    set_benchmark(symbol('IR0001')) # \u8a2d\u5b9a Benchmark\n    attach_pipeline(make_my_pipeline(), 'my_strategy_pipeline') # \u9644\u639b Pipeline\n\ndef before_trading_start(context, data):\n    # \u7372\u53d6 Pipeline \u7684\u8f38\u51fa\n    pipeline_results = pipeline_output('my_strategy_pipeline')\n\n    # \u5f9e Pipeline \u8f38\u51fa\u4e2d\u7372\u53d6\u7576\u5929\u7684 Universe (\u7b26\u5408 screen \u689d\u4ef6\u7684\u80a1\u7968)\n    context.my_universe = pipeline_results.index.get_level_values(1).tolist()\n\n    # \u5c07 Pipeline \u7d50\u679c\u5132\u5b58\u5230 context\uff0c\u4f9b handle_data \u4f7f\u7528\n    context.pipeline_data = pipeline_results\n\ndef handle_data(context, data):\n    # \u5982\u679c\u4eca\u5929\u6c92\u6709\u7be9\u9078\u51fa\u7684\u80a1\u7968\uff0c\u5247\u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c\n    if not context.my_universe:\n        return\n\n    # \u904d\u6b77\u7be9\u9078\u51fa\u7684\u80a1\u7968\n    for asset in context.my_universe:\n        # \u78ba\u4fdd\u80a1\u7968\u6578\u64da\u53ef\u7528\uff0c\u4e26\u4e14\u6709 SMA_20 \u6578\u64da\n        if data.can_trade(asset) and asset in context.pipeline_data.index.get_level_values(1):\n            sma_value = context.pipeline_data.loc[(data.current_dt.date(), asset), 'SMA_20']\n            current_price = data.current(asset, 'price')\n\n            # \u7c21\u55ae\u7b56\u7565\uff1a\u5982\u679c\u80a1\u50f9\u7a81\u7834 20 \u65e5\u5747\u7dda\uff0c\u5247\u8cb7\u5165\n            if current_price &gt; sma_value:\n                # \u8cb7\u5165\u7b49\u6b0a\u91cd\n                order_target_percent(asset, 1.0 / len(context.my_universe))\n            # \u5982\u679c\u80a1\u50f9\u8dcc\u7834 20 \u65e5\u5747\u7dda\uff0c\u4e14\u6301\u6709\u8a72\u80a1\u7968\uff0c\u5247\u6e05\u5009\n            elif current_price &lt; sma_value and asset in context.portfolio.positions:\n                order_target_percent(asset, 0.0)\n\ndef analyze(context, results):\n    print(\"\u56de\u6e2c\u5206\u6790\u5b8c\u6210\u3002\")\n\n# \u57f7\u884c\u56de\u6e2c\nresults = run_algorithm(\n    start=pd.Timestamp('2020-01-01', tz='UTC'),\n    end=pd.Timestamp('2021-01-01', tz='UTC'),\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=1_000_000,\n    bundle='tquant',\n    before_trading_start=before_trading_start # \u78ba\u4fdd before_trading_start \u88ab\u547c\u53eb\n)\n</code></pre>"},{"location":"reference/pipeline/terms/","title":"Pipeline \u6838\u5fc3\u69cb\u5efa\u6a21\u584a\uff1aFactor, Filter, Classifier","text":"<p>Info</p> <p>\u672c\u9801\u8a73\u7d30\u4ecb\u7d39 Zipline Pipeline \u4e2d\u7684 <code>Factor</code>\u3001<code>Filter</code> \u548c <code>Classifier</code> \u4e09\u7a2e\u6838\u5fc3\u69cb\u5efa\u6a21\u584a\uff0c\u5305\u62ec\u5176\u5b9a\u7fa9\u3001\u7528\u9014\u3001\u8f38\u51fa\u53ca\u4f7f\u7528\u7bc4\u4f8b\uff0c\u5e6b\u52a9\u4f7f\u7528\u8005\u5efa\u7acb\u81ea\u52d5\u5316\u9078\u80a1\u908f\u8f2f\u3002</p> <p>Zipline \u7684 Pipeline API \u900f\u904e <code>Factor</code>\u3001<code>Filter</code> \u548c <code>Classifier</code> \u4e09\u7a2e\u6838\u5fc3\u69cb\u5efa\u6a21\u584a\uff0c\u5be6\u73fe\u4e86\u9748\u6d3b\u9ad8\u6548\u7684\u6578\u64da\u8655\u7406\u548c\u8cc7\u7522\u7be9\u9078\u3002\u7406\u89e3\u9019\u4e9b\u69cb\u5efa\u6a21\u584a\u7684\u7528\u9014\u548c\u76f8\u4e92\u95dc\u4fc2\uff0c\u662f\u69cb\u5efa\u5f37\u5927 Pipeline \u7684\u57fa\u790e\u3002</p>"},{"location":"reference/pipeline/terms/#1","title":"1. \u6982\u5ff5\u7c21\u4ecb","text":"<ul> <li><code>Factor</code> (\u56e0\u5b50):<ul> <li>\u7528\u9014: \u8a08\u7b97\u6a6b\u622a\u9762\uff08cross-sectional\uff09\u6578\u64da\uff0c\u901a\u5e38\u662f\u6578\u503c\u578b\u8f38\u51fa\u3002\u5b83\u5c0d\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u6642\u9593\u9ede\u751f\u6210\u4e00\u500b\u6578\u503c\uff0c\u4f8b\u5982\u79fb\u52d5\u5e73\u5747\u3001\u76f8\u5c0d\u5f37\u5f31\u6307\u6578\u3001\u5e02\u503c\u7b49\u3002</li> <li>\u8f38\u51fa: <code>pd.DataFrame</code>\uff0c\u7d22\u5f15\u70ba <code>(\u65e5\u671f, \u8cc7\u7522)</code> \u7684 MultiIndex\uff0c\u503c\u70ba\u8a08\u7b97\u51fa\u7684\u6578\u503c\u3002</li> </ul> </li> <li><code>Filter</code> (\u904e\u6ffe\u5668):<ul> <li>\u7528\u9014: \u6839\u64da\u5e03\u6797\u689d\u4ef6\u7be9\u9078\u8cc7\u7522\u3002\u5b83\u5c0d\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u6642\u9593\u9ede\u751f\u6210\u4e00\u500b\u5e03\u6797\u503c (<code>True</code>/<code>False</code>)\uff0c\u7528\u65bc\u6c7a\u5b9a\u8a72\u8cc7\u7522\u662f\u5426\u61c9\u5305\u542b\u5728\u56de\u6e2c\u7684 Universe \u6216 Pipeline \u7684\u8f38\u51fa\u4e2d\u3002</li> <li>\u8f38\u51fa: <code>pd.DataFrame</code>\uff0c\u7d22\u5f15\u70ba <code>(\u65e5\u671f, \u8cc7\u7522)</code> \u7684 MultiIndex\uff0c\u503c\u70ba\u5e03\u6797\u503c\u3002</li> </ul> </li> <li><code>Classifier</code> (\u5206\u985e\u5668):<ul> <li>\u7528\u9014: \u5c07\u8cc7\u7522\u5206\u7d44\u3002\u5b83\u5c0d\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u6642\u9593\u9ede\u751f\u6210\u4e00\u500b\u96e2\u6563\u7684\u985e\u5225\u6a19\u7c64\uff0c\u4f8b\u5982\u884c\u696d\u4ee3\u78bc\u3001\u5e02\u503c\u5206\u4f4d\u6578\u7b49\u3002</li> <li>\u8f38\u51fa: <code>pd.DataFrame</code>\uff0c\u7d22\u5f15\u70ba <code>(\u65e5\u671f, \u8cc7\u7522)</code> \u7684 MultiIndex\uff0c\u503c\u70ba\u985e\u5225\u6a19\u7c64\u3002</li> </ul> </li> </ul>"},{"location":"reference/pipeline/terms/#2-factor","title":"2. Factor (\u56e0\u5b50)","text":"<p><code>Factor</code> \u662f Pipeline \u4e2d\u6700\u57fa\u790e\u7684\u6578\u503c\u8a08\u7b97\u55ae\u5143\u3002\u5b83\u901a\u5e38\u63a5\u53d7\u4e00\u500b\u6216\u591a\u500b <code>DataSet</code> \u4e2d\u7684\u6b04\u4f4d\u4f5c\u70ba\u8f38\u5165\uff0c\u4e26\u5728\u6307\u5b9a\u7684 <code>window_length</code> \u4e0a\u57f7\u884c\u8a08\u7b97\u3002</p> <ul> <li>\u7528\u9014: \u5f9e\u539f\u59cb\u6578\u64da\u4e2d\u63d0\u53d6\u6709\u610f\u7fa9\u7684\u6578\u503c\u8cc7\u8a0a\u3002</li> <li>\u5e38\u898b\u53c3\u6578:<ul> <li><code>inputs</code>: (list of <code>BoundColumn</code>) \u56e0\u5b50\u8a08\u7b97\u6240\u9700\u7684\u8f38\u5165\u6578\u64da\u6b04\u4f4d\uff0c\u4f8b\u5982 <code>[EquityPricing.close]</code>\u3002</li> <li><code>window_length</code>: (int) \u56e0\u5b50\u8a08\u7b97\u6240\u4f7f\u7528\u7684\u6b77\u53f2\u6578\u64da\u7a97\u53e3\u9577\u5ea6\uff08\u4f8b\u5982\uff0c20 \u65e5\u79fb\u52d5\u5e73\u5747\uff09\u3002</li> </ul> </li> </ul>"},{"location":"reference/pipeline/terms/#simplemovingaverage","title":"\u7bc4\u4f8b\uff1aSimpleMovingAverage (\u7c21\u55ae\u79fb\u52d5\u5e73\u5747)","text":"<pre><code>from zipline.pipeline.factors import SimpleMovingAverage\nfrom zipline.pipeline.data import EquityPricing\n\n# \u8a08\u7b97 20 \u65e5\u6536\u76e4\u50f9\u7684\u7c21\u55ae\u79fb\u52d5\u5e73\u5747\nsma_20 = SimpleMovingAverage(inputs=[EquityPricing.close], window_length=20)\n\n# \u8a08\u7b97 10 \u65e5\u6210\u4ea4\u91d1\u984d\u7684\u7c21\u55ae\u79fb\u52d5\u5e73\u5747\n# from zipline.pipeline.factors import AverageDollarVolume\n# sma_dollar_volume_10 = SimpleMovingAverage(inputs=[AverageDollarVolume(window_length=1)], window_length=10)\n</code></pre>"},{"location":"reference/pipeline/terms/#3-filter","title":"3. Filter (\u904e\u6ffe\u5668)","text":"<p><code>Filter</code> \u7528\u65bc\u6839\u64da\u689d\u4ef6\u9078\u64c7\u8cc7\u7522\u3002\u5b83\u5011\u901a\u5e38\u662f <code>Factor</code> \u7269\u4ef6\u900f\u904e\u6bd4\u8f03\u904b\u7b97 (\u4f8b\u5982 <code>factor &gt; value</code>) \u6216\u7279\u5b9a\u65b9\u6cd5 (\u4f8b\u5982 <code>top(N)</code>) \u8f49\u63db\u800c\u4f86\u3002</p> <ul> <li>\u7528\u9014: \u5b9a\u7fa9\u6bcf\u65e5\u56de\u6e2c\u6216 Pipeline \u8f38\u51fa\u7684\u8cc7\u7522 Universe\u3002</li> <li>\u5e38\u898b\u7528\u6cd5:<ul> <li>\u57fa\u65bc\u56e0\u5b50\u7684\u6392\u540d\u7be9\u9078: <code>Factor.top(N)</code> (\u524d N \u540d), <code>Factor.bottom(N)</code> (\u5f8c N \u540d)\u3002</li> <li>\u57fa\u65bc\u56e0\u5b50\u5206\u4f4d\u6578\u7be9\u9078: <code>Factor.percentile_between(min_percentile, max_percentile)</code> (\u6307\u5b9a\u5206\u4f4d\u6578\u5340\u9593)\u3002</li> <li>\u5e03\u6797\u904b\u7b97: <code>factor &gt; value</code>, <code>factor == value</code>\u3002</li> <li>\u7d44\u5408\u904e\u6ffe\u5668: \u4f7f\u7528 <code>&amp;</code> (AND), <code>|</code> (OR), <code>~</code> (NOT) \u904b\u7b97\u7b26\u7d44\u5408\u591a\u500b <code>Filter</code>\u3002</li> </ul> </li> </ul>"},{"location":"reference/pipeline/terms/#50","title":"\u7bc4\u4f8b\uff1a\u7be9\u9078\u65e5\u6210\u4ea4\u91d1\u984d\u524d 50 \u6a94\u80a1\u7968","text":"<pre><code>from zipline.pipeline.factors import AverageDollarVolume\n\n# \u8a08\u7b97 20 \u65e5\u5e73\u5747\u65e5\u6210\u4ea4\u91d1\u984d\u56e0\u5b50\ndollar_volume = AverageDollarVolume(window_length=20)\n\n# \u5275\u5efa\u4e00\u500b Filter\uff1a\u7be9\u9078\u51fa\u5e73\u5747\u65e5\u6210\u4ea4\u91d1\u984d\u524d 50 \u540d\u7684\u80a1\u7968\ntop_50_dollar_volume = dollar_volume.top(50)\n\n# \u5275\u5efa\u4e00\u500b Filter\uff1a\u7be9\u9078\u51fa\u5e73\u5747\u65e5\u6210\u4ea4\u91d1\u984d\u5728 50% \u5230 80% \u5206\u4f4d\u6578\u4e4b\u9593\u7684\u80a1\u7968\nmid_range_dollar_volume = dollar_volume.percentile_between(50, 80)\n</code></pre>"},{"location":"reference/pipeline/terms/#4-classifier","title":"4. Classifier (\u5206\u985e\u5668)","text":"<p><code>Classifier</code> \u7528\u65bc\u5c07\u8cc7\u7522\u6b78\u985e\u5230\u4e0d\u540c\u7684\u7d44\u5225\u4e2d\uff0c\u4f8b\u5982\u884c\u696d\u3001\u5e02\u5834\u985e\u578b\u6216\u81ea\u5b9a\u7fa9\u7684\u7d44\u5225\u3002\u9019\u5c0d\u65bc\u9032\u884c\u884c\u696d\u8f2a\u52d5\u3001\u5206\u7d44\u5c0d\u6c96\u6216\u5206\u5c64\u56de\u6e2c\u7b49\u7b56\u7565\u975e\u5e38\u6709\u7528\u3002</p> <ul> <li>\u7528\u9014: \u5c0d\u8cc7\u7522\u9032\u884c\u5206\u7d44\u6216\u6a19\u7c64\u5316\u3002</li> <li>\u5e38\u898b\u7528\u6cd5: \u7372\u53d6\u8cc7\u7522\u7684\u884c\u696d\u6216\u677f\u584a\u4fe1\u606f\u3002</li> </ul>"},{"location":"reference/pipeline/terms/#_1","title":"\u7bc4\u4f8b\uff1a\u7372\u53d6\u8cc7\u7522\u7684\u4e3b\u7522\u696d\u5225","text":"<pre><code>from zipline.pipeline.data import tejquant # \u5047\u8a2d tejquant \u6578\u64da\u96c6\u5df2\u5c0e\u5165\nfrom zipline.pipeline.classifiers import Industry\n\n# \u7372\u53d6\u8cc7\u7522\u7684\u4e3b\u7522\u696d\u5225 (\u4e2d\u6587)\nmain_industry = tejquant.TQDataSet.Industry.latest\n# \u6216\u8005\n# main_industry = Industry() # Zipline \u5167\u5efa\u7684 Industry Classifier\n</code></pre>"},{"location":"reference/pipeline/terms/#5","title":"5. \u5b8c\u6574\u7bc4\u4f8b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u500b\u5b8c\u6574\u7684 Pipeline \u7bc4\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u5728\u4e00\u500b Pipeline \u4e2d\u540c\u6642\u4f7f\u7528 <code>Factor</code>\u3001<code>Filter</code> \u548c <code>Classifier</code>\uff0c\u4e26\u5728\u56de\u6e2c\u4e2d\u7372\u53d6\u5176\u8f38\u51fa\u3002</p> <pre><code>import pandas as pd\nfrom zipline import run_algorithm\nfrom zipline.api import (\n    attach_pipeline,\n    pipeline_output,\n    set_benchmark,\n    symbol,\n    order_target_percent\n)\nfrom zipline.pipeline import Pipeline\nfrom zipline.pipeline.factors import SimpleMovingAverage, AverageDollarVolume\nfrom zipline.pipeline.data import EquityPricing, tejquant # \u5c0e\u5165 tejquant\nfrom zipline.pipeline.filters import StaticAssets # \u5c0e\u5165 StaticAssets\nfrom zipline.pipeline.classifiers import Industry # \u5c0e\u5165 Industry Classifier\n\n# 1. \u5b9a\u7fa9 Pipeline\ndef make_my_pipeline():\n    # Factor: \u8a08\u7b97 20 \u65e5\u7c21\u55ae\u79fb\u52d5\u5e73\u5747\u7dda\n    sma_20 = SimpleMovingAverage(inputs=[EquityPricing.close], window_length=20)\n\n    # Factor: \u8a08\u7b97 10 \u65e5\u5e73\u5747\u6210\u4ea4\u91d1\u984d\n    dollar_volume = AverageDollarVolume(window_length=10)\n\n    # Filter: \u7be9\u9078\u51fa\u5e73\u5747\u6210\u4ea4\u91d1\u984d\u524d 50 \u6a94\u80a1\u7968\n    high_volume_filter = dollar_volume.top(50)\n\n    # Classifier: \u7372\u53d6\u4e3b\u7522\u696d\u5225\n    # Zipline \u5167\u5efa Industry \u6216 tejquant.TQDataSet.Industry\n    sector_classifier = tejquant.TQDataSet.Industry.latest\n\n    return Pipeline(\n        columns={\n            'SMA_20': sma_20,\n            'Dollar_Volume': dollar_volume,\n            'Sector': sector_classifier # \u5c07 Classifier \u52a0\u5165\u8f38\u51fa\n        },\n        screen=high_volume_filter # \u5c07 Filter \u61c9\u7528\u65bc Pipeline\uff0c\u5b9a\u7fa9 Universe\n    )\n\n# 2. Zipline \u56de\u6e2c\u8a2d\u7f6e\ndef initialize(context):\n    set_benchmark(symbol('IR0001')) # \u8a2d\u5b9a Benchmark\n    attach_pipeline(make_my_pipeline(), 'my_strategy_pipeline') # \u9644\u639b Pipeline\n\ndef before_trading_start(context, data):\n    pipeline_results = pipeline_output('my_strategy_pipeline')\n    context.my_universe = pipeline_results.index.get_level_values(1).tolist()\n    context.pipeline_data = pipeline_results\n\ndef handle_data(context, data):\n    if not context.my_universe:\n        return\n\n    for asset in context.my_universe:\n        if data.can_trade(asset) and asset in context.pipeline_data.index.get_level_values(1):\n            sma_value = context.pipeline_data.loc[(data.current_dt.date(), asset), 'SMA_20']\n            current_price = data.current(asset, 'price')\n            sector = context.pipeline_data.loc[(data.current_dt.date(), asset), 'Sector'] # \u7372\u53d6\u7522\u696d\u5225\n\n            # \u7c21\u55ae\u7b56\u7565\uff1a\u5982\u679c\u80a1\u50f9\u7a81\u7834 20 \u65e5\u5747\u7dda\uff0c\u4e14\u5c6c\u65bc\u7279\u5b9a\u7522\u696d\uff0c\u5247\u8cb7\u5165\n            if current_price &gt; sma_value and sector == '\u534a\u5c0e\u9ad4\u696d': # \u5047\u8a2d\u534a\u5c0e\u9ad4\u696d\u70ba\u7bc4\u4f8b\n                order_target_percent(asset, 1.0 / len(context.my_universe))\n            elif current_price &lt; sma_value and asset in context.portfolio.positions:\n                order_target_percent(asset, 0.0)\n\ndef analyze(context, results):\n    print(\"\u56de\u6e2c\u5206\u6790\u5b8c\u6210\u3002\")\n\n# \u57f7\u884c\u56de\u6e2c\nresults = run_algorithm(\n    start=pd.Timestamp('2020-01-01', tz='UTC'),\n    end=pd.Timestamp('2021-01-01', tz='UTC'),\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=1_000_000,\n    bundle='tquant',\n    before_trading_start=before_trading_start # \u78ba\u4fdd before_trading_start \u88ab\u547c\u53eb\n)\n</code></pre>"},{"location":"reference/pipeline/datasets/custom-dataset/","title":"\u81ea\u8a02\u8cc7\u6599\u96c6 (Custom DataSets)","text":"<p>Info</p> <p>\u672c\u9801\u4ecb\u7d39\u5982\u4f55\u5728 TQuant Lab Pipeline \u4e2d\u5275\u5efa\u548c\u4f7f\u7528\u81ea\u8a02\u8cc7\u6599\u96c6 (Custom DataSets)\u3002\u9019\u662f\u4e00\u500b\u9032\u968e\u529f\u80fd\uff0c\u5141\u8a31\u60a8\u5c07\u5916\u90e8\u6578\u64da\u6e90\uff08\u4f8b\u5982\u60a8\u81ea\u5df1\u7684 CSV \u6a94\u6848\u3001\u8cc7\u6599\u5eab\u67e5\u8a62\u7d50\u679c\u7b49\uff09\u6574\u5408\u5230 Pipeline \u4e2d\uff0c\u6975\u5927\u5730\u64f4\u5c55\u4e86 Pipeline \u7684\u6578\u64da\u4f86\u6e90\u548c\u61c9\u7528\u7bc4\u570d\u3002</p> <p>\u96d6\u7136 TQuant Lab \u63d0\u4f9b\u4e86 <code>TWEquityPricing</code> \u548c <code>TQDataSet</code> \u7b49\u5f37\u5927\u7684\u5167\u5efa\u8cc7\u6599\u96c6\uff0c\u4f46\u5728\u67d0\u4e9b\u60c5\u6cc1\u4e0b\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u81ea\u5df1\u7368\u6709\u7684\u6578\u64da\u4f86\u9032\u884c\u7b56\u7565\u7814\u7a76\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u60a8\u900f\u904e\u722c\u87f2\u7372\u53d6\u7684\u7db2\u8def\u8f3f\u60c5\u6578\u64da\u3002</li> <li>\u60a8\u8cfc\u8cb7\u7684\u7b2c\u4e09\u65b9\u53e6\u985e\u6578\u64da\u3002</li> <li>\u60a8\u81ea\u5df1\u8a08\u7b97\u7684\u5c08\u6709\u56e0\u5b50\u6578\u64da\u3002</li> </ul> <p><code>Custom DataSets</code> \u529f\u80fd\u5141\u8a31\u60a8\u5c07\u9019\u4e9b\u5916\u90e8\u6578\u64da\u6253\u5305\u6210 Pipeline \u53ef\u8b58\u5225\u7684\u683c\u5f0f\uff0c\u4e26\u50cf\u4f7f\u7528\u5167\u5efa\u8cc7\u6599\u96c6\u4e00\u6a23\u5728 Pipeline \u4e2d\u7121\u7e2b\u4f7f\u7528\u3002</p>"},{"location":"reference/pipeline/datasets/custom-dataset/#1-custom-datasets","title":"1. Custom DataSets \u6838\u5fc3\u6982\u5ff5","text":"<p>\u5275\u5efa\u4e00\u500b\u81ea\u8a02\u8cc7\u6599\u96c6\u7684\u904e\u7a0b\uff0c\u672c\u8cea\u4e0a\u662f\u5c07\u60a8\u7684\u5916\u90e8\u6578\u64da\u8f49\u63db\u70ba Zipline \u7684 <code>bcolz</code> \u683c\u5f0f\uff0c\u4e26\u63d0\u4f9b\u4e00\u500b\u63cf\u8ff0\u6587\u4ef6 (<code>extension.py</code>) \u8b93 Zipline \u80fd\u5920\u8b58\u5225\u548c\u8f09\u5165\u5b83\u3002</p> <p>\u4e3b\u8981\u6b65\u9a5f\uff1a</p> <ol> <li>\u6e96\u5099\u6578\u64da\uff1a\u5c07\u60a8\u7684\u6578\u64da\u6574\u7406\u6210\u7279\u5b9a\u683c\u5f0f\u7684 CSV \u6a94\u6848\u3002</li> <li>\u7de8\u5beb <code>extension.py</code>\uff1a\u5275\u5efa\u4e00\u500b Python \u8173\u672c\uff0c\u5b9a\u7fa9\u60a8\u7684 <code>Custom DataSet</code> \u985e\u5225\u3001\u6b04\u4f4d\uff0c\u4ee5\u53ca\u6578\u64da\u7684\u8f09\u5165\u908f\u8f2f\u3002</li> <li>\u57f7\u884c <code>zipline ingest</code>\uff1a\u4f7f\u7528 <code>zipline ingest</code> \u6307\u4ee4\uff0cZipline \u6703\u57f7\u884c\u60a8\u7684 <code>extension.py</code>\uff0c\u8b80\u53d6 CSV \u6a94\u6848\uff0c\u4e26\u5c07\u5176\u8f49\u63db\u70ba <code>bcolz</code> \u683c\u5f0f\u5132\u5b58\u3002</li> </ol>"},{"location":"reference/pipeline/datasets/custom-dataset/#2","title":"2. \u5be6\u4f5c\u6b65\u9a5f","text":"<p>\u4ee5\u4e0b\u6211\u5011\u5c07\u900f\u904e\u4e00\u500b\u5b8c\u6574\u7684\u7bc4\u4f8b\uff0c\u5c55\u793a\u5982\u4f55\u5c07\u4e00\u500b\u5305\u542b\u300c\u6bcf\u65e5\u5916\u8cc7\u6301\u80a1\u6bd4\u4f8b\u300d\u7684 CSV \u6a94\u6848\uff0c\u8f49\u63db\u70ba\u4e00\u500b\u53ef\u4ee5\u5728 Pipeline \u4e2d\u4f7f\u7528\u7684\u81ea\u8a02\u8cc7\u6599\u96c6\u3002</p>"},{"location":"reference/pipeline/datasets/custom-dataset/#1-csv","title":"\u6b65\u9a5f 1\uff1a\u6e96\u5099\u6578\u64da (CSV \u6a94\u6848)","text":"<p>\u9996\u5148\uff0c\u60a8\u9700\u8981\u5c07\u60a8\u7684\u6578\u64da\u6574\u7406\u6210\u4e00\u500b\u6216\u591a\u500b CSV \u6a94\u6848\u3002\u6bcf\u500b\u6a94\u6848\u61c9\u5305\u542b\u4ee5\u4e0b\u6b04\u4f4d\uff1a</p> <ul> <li><code>date</code>\uff1a\u65e5\u671f\uff0c\u683c\u5f0f\u70ba <code>YYYY-MM-DD</code>\u3002</li> <li><code>sid</code>\uff1a\u80a1\u7968\u4ee3\u78bc (Zipline \u5167\u90e8 ID)\u3002</li> <li>\u60a8\u7684\u81ea\u8a02\u6578\u64da\u6b04\u4f4d (\u4f8b\u5982 <code>foreign_ownership_ratio</code>)\u3002</li> </ul> <p>\u7bc4\u4f8b <code>my_custom_data.csv</code>\uff1a</p> <pre><code>date,sid,foreign_ownership_ratio\n2022-01-03,0,45.6\n2022-01-03,1,23.4\n2022-01-04,0,45.7\n2022-01-04,1,23.5\n...\n</code></pre> <p>Note</p> <p><code>sid</code> \u662f Zipline \u5167\u90e8\u7684\u6574\u6578 ID\uff0c\u800c\u4e0d\u662f\u80a1\u7968\u4ee3\u78bc\u5b57\u4e32 (\u5982 '2330')\u3002\u60a8\u9700\u8981\u81ea\u884c\u5c07\u80a1\u7968\u4ee3\u78bc\u6620\u5c04\u5230 <code>sid</code>\u3002</p>"},{"location":"reference/pipeline/datasets/custom-dataset/#2-extensionpy","title":"\u6b65\u9a5f 2\uff1a\u7de8\u5beb extension.py","text":"<p>\u63a5\u4e0b\u4f86\uff0c\u5728\u60a8\u7684 Zipline \u8a2d\u5b9a\u76ee\u9304\u4e0b (\u901a\u5e38\u662f <code>~/.zipline/</code>) \u5275\u5efa\u4e00\u500b\u540d\u70ba <code>extension.py</code> \u7684\u6a94\u6848\u3002\u9019\u500b\u6a94\u6848\u662f Zipline \u7528\u65bc\u767c\u73fe\u548c\u8f09\u5165\u81ea\u8a02\u8cc7\u6599\u7684\u5165\u53e3\u3002</p> <p>\u7bc4\u4f8b <code>~/.zipline/extension.py</code>\uff1a</p> <pre><code>from zipline.pipeline.data import DataSet\nfrom zipline.pipeline.loaders import CSVLoader\nfrom zipline.pipeline.loaders.frame import DataFrameLoader\nfrom zipline.pipeline.domain import US_EQUITIES # \u6216\u5176\u4ed6\u9069\u7528\u7684 Domain\nimport pandas as pd\n\n# 1. \u5b9a\u7fa9 Custom DataSet \u985e\u5225\nclass MyCustomDataSet(DataSet):\n    # \u5b9a\u7fa9\u60a8\u7684\u6578\u64da\u6b04\u4f4d\uff0c\u4e26\u6307\u5b9a\u5176\u6578\u64da\u985e\u578b\n    foreign_ownership_ratio = Column(dtype=float)\n\n    # \u6307\u5b9a\u6b64 DataSet \u9069\u7528\u7684 Domain\n    domain = US_EQUITIES # \u6839\u64da\u60a8\u7684\u9700\u6c42\u9078\u64c7\n\n# 2. \u5275\u5efa CSVLoader \u5be6\u4f8b\nmy_csv_loader = CSVLoader(\n    # \u6307\u5b9a CSV \u6a94\u6848\u7684\u8def\u5f91\n    csvdir='/path/to/your/csv/files',\n    # \u5c07 CSV \u6a94\u6848\u8207\u60a8\u7684 DataSet \u985e\u5225\u548c\u6b04\u4f4d\u9032\u884c\u6620\u5c04\n    data_query_path={\n        MyCustomDataSet.foreign_ownership_ratio: 'my_custom_data.csv'\n    }\n)\n\n# 3. \u5275\u5efa DataFrameLoader\nMyCustomDataSetLoader = DataFrameLoader(\n    column=MyCustomDataSet.foreign_ownership_ratio,\n    # \u9019\u88e1\u7684 'my_custom_data.csv' \u61c9\u8207 my_csv_loader \u4e2d\u7684\u9375\u4e00\u81f4\n    baseline=my_csv_loader.load_adjusted_array(['my_custom_data.csv'])\n)\n\n# 4. \u8a3b\u518a\u60a8\u7684 DataSet \u548c Loader\nregister_dataset(MyCustomDataSet, MyCustomDataSetLoader)\n</code></pre> <p>\u7a0b\u5f0f\u78bc\u89e3\u91cb\uff1a</p> <ol> <li><code>MyCustomDataSet(DataSet)</code>\uff1a\u6211\u5011\u5275\u5efa\u4e86\u4e00\u500b\u540d\u70ba <code>MyCustomDataSet</code> \u7684\u985e\u5225\uff0c\u4e26\u7e7c\u627f\u81ea <code>DataSet</code>\u3002\u5728\u5176\u4e2d\uff0c\u6211\u5011\u5b9a\u7fa9\u4e86\u4e00\u500b\u540d\u70ba <code>foreign_ownership_ratio</code> \u7684 <code>Column</code>\uff0c\u4e26\u6307\u5b9a\u5176\u6578\u64da\u985e\u578b\u70ba <code>float</code>\u3002</li> <li><code>CSVLoader</code>\uff1a\u9019\u662f\u4e00\u500b\u8f14\u52a9\u985e\u5225\uff0c\u7528\u65bc\u5f9e CSV \u6a94\u6848\u4e2d\u8b80\u53d6\u6578\u64da\u3002\u60a8\u9700\u8981\u63d0\u4f9b CSV \u6a94\u6848\u6240\u5728\u7684\u76ee\u9304 (<code>csvdir</code>)\uff0c\u4e26\u5efa\u7acb\u4e00\u500b\u5b57\u5178\uff0c\u5c07\u60a8\u7684 <code>DataSet</code> \u6b04\u4f4d\u6620\u5c04\u5230\u5c0d\u61c9\u7684 CSV \u6a94\u6848\u3002</li> <li><code>DataFrameLoader</code>\uff1a\u9019\u662f\u5be6\u969b\u7684\u6578\u64da\u8f09\u5165\u5668\u3002\u5b83\u6703\u4f7f\u7528 <code>CSVLoader</code> \u8f09\u5165\u7684\u6578\u64da\uff0c\u4e26\u5c07\u5176\u8207\u60a8\u7684 <code>DataSet</code> \u6b04\u4f4d\u9032\u884c\u7d81\u5b9a\u3002</li> <li><code>register_dataset</code>\uff1a\u6700\u5f8c\uff0c\u60a8\u9700\u8981\u8abf\u7528 <code>register_dataset</code> \u51fd\u6578\uff0c\u5c07\u60a8\u7684 <code>DataSet</code> \u985e\u5225\u548c <code>DataFrameLoader</code> \u5be6\u4f8b\u8a3b\u518a\u5230 Zipline \u4e2d\u3002</li> </ol>"},{"location":"reference/pipeline/datasets/custom-dataset/#3-zipline-ingest","title":"\u6b65\u9a5f 3\uff1a\u57f7\u884c zipline ingest","text":"<p>\u5b8c\u6210 <code>extension.py</code> \u7684\u7de8\u5beb\u5f8c\uff0c\u6253\u958b\u7d42\u7aef\u6a5f\uff0c\u57f7\u884c <code>zipline ingest</code> \u6307\u4ee4\uff1a</p> <pre><code>zipline ingest -b your_bundle_name\n</code></pre> <p>Zipline \u5728\u57f7\u884c <code>ingest</code> \u6642\uff0c\u6703\u81ea\u52d5\u67e5\u627e\u4e26\u57f7\u884c <code>~/.zipline/extension.py</code> \u8173\u672c\u3002\u5982\u679c\u4e00\u5207\u9806\u5229\uff0c\u5b83\u6703\u8b80\u53d6\u60a8\u7684 CSV \u6a94\u6848\uff0c\u5c07\u5176\u8f49\u63db\u70ba <code>bcolz</code> \u683c\u5f0f\uff0c\u4e26\u5132\u5b58\u5728\u60a8\u7684 bundle \u76ee\u9304\u4e2d\u3002</p>"},{"location":"reference/pipeline/datasets/custom-dataset/#3-pipeline","title":"3. \u5728 Pipeline \u4e2d\u4f7f\u7528\u81ea\u8a02\u8cc7\u6599\u96c6","text":"<p>\u4e00\u65e6\u60a8\u7684\u81ea\u8a02\u8cc7\u6599\u96c6\u6210\u529f <code>ingest</code>\uff0c\u60a8\u5c31\u53ef\u4ee5\u50cf\u4f7f\u7528\u5167\u5efa\u8cc7\u6599\u96c6\u4e00\u6a23\uff0c\u5728 Pipeline \u4e2d\u5c0e\u5165\u548c\u4f7f\u7528\u5b83\u3002</p> <pre><code>from zipline.pipeline import Pipeline\n# \u5f9e extension.py \u4e2d\u5c0e\u5165\u60a8\u7684 Custom DataSet\nfrom .extension import MyCustomDataSet \n\ndef make_my_pipeline():\n    # \u7372\u53d6\u6700\u65b0\u7684\u5916\u8cc7\u6301\u80a1\u6bd4\u4f8b\n    latest_foreign_ownership = MyCustomDataSet.foreign_ownership_ratio.latest\n\n    return Pipeline(\n        columns={\n            'foreign_ownership': latest_foreign_ownership\n        },\n        # \u60a8\u751a\u81f3\u53ef\u4ee5\u57fa\u65bc\u81ea\u8a02\u6578\u64da\u9032\u884c\u7be9\u9078\n        screen=(latest_foreign_ownership &gt; 30.0)\n    )\n</code></pre>"},{"location":"reference/pipeline/datasets/custom-dataset/#_1","title":"\u7e3d\u7d50","text":"<p>\u81ea\u8a02\u8cc7\u6599\u96c6\u662f Zipline Pipeline \u7684\u4e00\u500b\u5f37\u5927\u64f4\u5c55\u529f\u80fd\uff0c\u5b83\u6253\u7834\u4e86\u5167\u5efa\u6578\u64da\u6e90\u7684\u9650\u5236\uff0c\u8b93\u60a8\u53ef\u4ee5\u5c07\u4efb\u4f55\u5916\u90e8\u6578\u64da\u7121\u7e2b\u6574\u5408\u5230\u60a8\u7684\u91cf\u5316\u7814\u7a76\u6d41\u7a0b\u4e2d\u3002\u96d6\u7136\u5275\u5efa\u81ea\u8a02\u8cc7\u6599\u96c6\u7684\u904e\u7a0b\u6bd4\u76f4\u63a5\u4f7f\u7528\u5167\u5efa\u8cc7\u6599\u96c6\u8981\u8907\u96dc\u4e00\u4e9b\uff0c\u4f46\u5b83\u6240\u5e36\u4f86\u7684\u9748\u6d3b\u6027\u548c\u64f4\u5c55\u6027\uff0c\u5c0d\u65bc\u9032\u884c\u6df1\u5165\u3001\u7368\u7279\u7684\u91cf- \u5316\u7b56\u7565\u7814\u7a76\u4f86\u8aaa\uff0c\u662f\u7121\u50f9\u7684\u3002</p>"},{"location":"reference/pipeline/datasets/equity-pricing/","title":"Zipline Pipeline \u8cc7\u6599\u96c6\uff1aEquityPricing","text":"<p>Info</p> <p>\u672c\u9801\u8a73\u7d30\u4ecb\u7d39 Zipline Pipeline \u4e2d\u7684 <code>EquityPricing</code> \u8cc7\u6599\u96c6\uff0c\u5305\u62ec\u5176\u7528\u9014\u3001\u63d0\u4f9b\u7684\u6b04\u4f4d\u3001\u5982\u4f55\u5b58\u53d6\u6578\u64da\u4ee5\u53ca\u5728 Pipeline \u4e2d\u4f7f\u7528\u7684\u7bc4\u4f8b\uff0c\u662f\u69cb\u5efa\u50f9\u91cf\u56e0\u5b50\u7684\u57fa\u790e\u3002</p> <p>\u5728 Zipline Pipeline \u4e2d\uff0c<code>EquityPricing</code> \u662f\u4e00\u500b\u6838\u5fc3\u7684\u5167\u5efa <code>DataSet</code>\uff0c\u5c08\u9580\u7528\u65bc\u63d0\u4f9b\u80a1\u7968\u7684\u50f9\u91cf\u6578\u64da\u3002\u5b83\u662f\u60a8\u69cb\u5efa\u5404\u7a2e\u50f9\u91cf\u56e0\u5b50\u3001\u7be9\u9078\u5668\u4ee5\u53ca\u4ea4\u6613\u7b56\u7565\u7684\u57fa\u790e\u3002</p>"},{"location":"reference/pipeline/datasets/equity-pricing/#1-equitypricing","title":"1. EquityPricing \u7c21\u4ecb","text":"<p><code>EquityPricing</code> \u5305\u542b\u4e86\u80a1\u7968\u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u7684\u958b\u76e4\u50f9\u3001\u6700\u9ad8\u50f9\u3001\u6700\u4f4e\u50f9\u3001\u6536\u76e4\u50f9\u548c\u6210\u4ea4\u91cf\u7b49\u6a19\u6e96\u8cc7\u8a0a\u3002\u7576\u60a8\u5728 Pipeline \u4e2d\u5f15\u7528 <code>EquityPricing</code> \u6642\uff0cZipline \u6703\u81ea\u52d5\u5f9e\u60a8\u9078\u64c7\u7684\u8cc7\u6599\u5305 (<code>bundle</code>) \u4e2d\u8b80\u53d6\u9019\u4e9b\u6578\u64da\uff0c\u4e26\u9032\u884c\u5fc5\u8981\u7684\u6e05\u6d17\u548c\u5c0d\u9f4a\uff0c\u78ba\u4fdd\u6578\u64da\u7684\u53ef\u7528\u6027\u548c\u4e00\u81f4\u6027\u3002</p>"},{"location":"reference/pipeline/datasets/equity-pricing/#2-equitypricing","title":"2. EquityPricing \u63d0\u4f9b\u7684\u6b04\u4f4d","text":"<p><code>EquityPricing</code> \u63d0\u4f9b\u4ee5\u4e0b\u5e38\u7528\u7684\u50f9\u91cf\u6b04\u4f4d\u4f5c\u70ba <code>BoundColumn</code> \u7269\u4ef6\uff1a</p> <ul> <li><code>open</code>: \u6bcf\u65e5\u958b\u76e4\u50f9\u3002</li> <li><code>high</code>: \u6bcf\u65e5\u6700\u9ad8\u50f9\u3002</li> <li><code>low</code>: \u6bcf\u65e5\u6700\u4f4e\u50f9\u3002</li> <li><code>close</code>: \u6bcf\u65e5\u6536\u76e4\u50f9\u3002</li> <li><code>volume</code>: \u6bcf\u65e5\u6210\u4ea4\u91cf\u3002</li> </ul>"},{"location":"reference/pipeline/datasets/equity-pricing/#3-equitypricing","title":"3. \u5982\u4f55\u5b58\u53d6 EquityPricing \u6b04\u4f4d\u6578\u64da","text":"<p>\u60a8\u53ef\u4ee5\u900f\u904e <code>EquityPricing.column_name</code> \u65b9\u5f0f\u7372\u53d6 <code>BoundColumn</code> \u7269\u4ef6\uff0c\u518d\u5229\u7528\u5176 <code>.latest</code> \u6216 <code>.slice()</code> \u65b9\u6cd5\u4f86\u6307\u5b9a\u60a8\u60f3\u8981\u63d0\u53d6\u7684\u6578\u64da\u3002</p>"},{"location":"reference/pipeline/datasets/equity-pricing/#31-latest","title":"3.1. .latest\uff1a\u7372\u53d6\u55ae\u4e00\u6700\u65b0\u503c","text":"<p><code>.latest</code> \u7528\u65bc\u7372\u53d6 Pipeline \u8a08\u7b97\u7576\u5929\uff08\u6216\u524d\u4e00\u500b\u4ea4\u6613\u65e5\uff09\u7684\u6700\u65b0\u6578\u64da\u9ede\u3002</p> <pre><code>from zipline.pipeline.data import EquityPricing\n\n# \u7372\u53d6\u6700\u65b0\u6536\u76e4\u50f9\nlatest_close_price = EquityPricing.close.latest\n\n# \u7372\u53d6\u6700\u65b0\u6210\u4ea4\u91cf\nlatest_volume = EquityPricing.volume.latest\n</code></pre>"},{"location":"reference/pipeline/datasets/equity-pricing/#32-slicewindow_length","title":"3.2. .slice(window_length)\uff1a\u7372\u53d6\u6b77\u53f2\u7a97\u53e3\u6578\u64da","text":"<p><code>.slice(window_length)</code> \u7528\u65bc\u7372\u53d6 Pipeline \u8a08\u7b97\u7576\u5929\u4e4b\u524d\uff0c\u6307\u5b9a <code>window_length</code> \u5929\u6578\u7684\u6b77\u53f2\u6578\u64da\u7a97\u53e3\u3002\u9019\u5728\u8a08\u7b97\u79fb\u52d5\u5e73\u5747\u3001\u6a19\u6e96\u5dee\u7b49\u9700\u8981\u6b77\u53f2\u6578\u64da\u7684\u56e0\u5b50\u6642\u975e\u5e38\u6709\u7528\u3002</p> <pre><code>from zipline.pipeline.data import EquityPricing\n\n# \u7372\u53d6\u904e\u53bb 20 \u5929\u7684\u6536\u76e4\u50f9\u6578\u64da\nhistorical_close_prices = EquityPricing.close.slice(window_length=20)\n\n# \u7372\u53d6\u904e\u53bb 10 \u5929\u7684\u6210\u4ea4\u91cf\u6578\u64da\nhistorical_volume = EquityPricing.volume.slice(window_length=10)\n</code></pre>"},{"location":"reference/pipeline/datasets/equity-pricing/#33-historywindow_length-frequency","title":"3.3. .history(window_length, frequency)\uff1a\u7372\u53d6\u6b77\u53f2\u7a97\u53e3\u6578\u64da (\u9032\u968e\u7528\u6cd5)","text":"<p><code>history()</code> \u65b9\u6cd5\u4e5f\u53ef\u7528\u65bc\u7372\u53d6\u6b77\u53f2\u6578\u64da\uff0c\u5b83\u5728 <code>handle_data</code> \u4e2d\u66f4\u70ba\u5e38\u898b\u3002\u5728 Pipeline \u4e2d\uff0c<code>.slice()</code> \u901a\u5e38\u662f\u66f4\u76f4\u63a5\u548c\u6163\u7528\u7684\u65b9\u5f0f\u3002<code>history</code> \u65b9\u6cd5\u7684 <code>frequency</code> \u53c3\u6578\u53ef\u4ee5\u6307\u5b9a\u6578\u64da\u983b\u7387 (\u4f8b\u5982 <code>'1d'</code> \u4ee3\u8868\u65e5\u983b\u7387)\u3002</p> <pre><code>from zipline.pipeline.data import EquityPricing\n\n# \u7372\u53d6\u904e\u53bb 5 \u5929\u7684\u65e5\u6536\u76e4\u50f9\u6578\u64da (\u5728 Pipeline \u4e2d\uff0c\u901a\u5e38\u6703\u900f\u904e .slice() \u5be6\u73fe\u985e\u4f3c\u529f\u80fd)\nhistorical_close_pipeline = EquityPricing.close.history(5, '1d')\n</code></pre>"},{"location":"reference/pipeline/datasets/equity-pricing/#4","title":"4. \u7bc4\u4f8b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u500b\u5b8c\u6574\u7684 Pipeline \u7bc4\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u5728 Pipeline \u4e2d\u4f7f\u7528 <code>EquityPricing</code> \u7372\u53d6\u6700\u65b0\u6536\u76e4\u50f9\u3001\u8a08\u7b97\u5176 20 \u65e5\u7c21\u55ae\u79fb\u52d5\u5e73\u5747\uff0c\u4e26\u7372\u53d6 10 \u65e5\u6210\u4ea4\u91cf\u3002</p> <pre><code>import pandas as pd\nfrom zipline import run_algorithm\nfrom zipline.api import (\n    attach_pipeline,\n    pipeline_output,\n    set_benchmark,\n    symbol,\n    order_target_percent\n)\nfrom zipline.pipeline import Pipeline\nfrom zipline.pipeline.factors import SimpleMovingAverage, AverageDollarVolume\nfrom zipline.pipeline.data import EquityPricing\nfrom zipline.pipeline.filters import AverageDollarVolume as ADVFilter # \u91cd\u547d\u540d\u4ee5\u907f\u514d\u885d\u7a81\n\n# 1. \u5b9a\u7fa9 Pipeline\ndef make_my_pricing_pipeline():\n    # \u7372\u53d6\u6700\u65b0\u6536\u76e4\u50f9\n    latest_close = EquityPricing.close.latest\n    # \u8a08\u7b97 20 \u65e5\u7c21\u55ae\u79fb\u52d5\u5e73\u5747\u7dda\n    sma_20 = SimpleMovingAverage(inputs=[EquityPricing.close], window_length=20)\n    # \u7372\u53d6\u904e\u53bb 10 \u5929\u7684\u6210\u4ea4\u91cf\u7e3d\u548c\n    volume_10d_sum = EquityPricing.volume.sum(window_length=10) # Sum \u662f\u4e00\u500b Factor\n\n    # \u7be9\u9078\u5668\uff1a\u904e\u53bb 5 \u5929\u5e73\u5747\u65e5\u6210\u4ea4\u91d1\u984d\u524d 30 \u6a94\u80a1\u7968\n    high_volume_filter = AverageDollarVolume(window_length=5).top(30)\n\n    return Pipeline(\n        columns={\n            'Close_Price': latest_close,\n            'SMA_20': sma_20,\n            'Volume_10D_Sum': volume_10d_sum\n        },\n        screen=high_volume_filter # \u7be9\u9078 Universe\n    )\n\n# 2. Zipline \u56de\u6e2c\u8a2d\u7f6e\ndef initialize(context):\n    set_benchmark(symbol('IR0001')) # \u8a2d\u5b9a Benchmark\n    attach_pipeline(make_my_pricing_pipeline(), 'my_pricing_pipeline') # \u9644\u639b Pipeline\n\ndef before_trading_start(context, data):\n    pipeline_results = pipeline_output('my_pricing_pipeline')\n    context.my_universe = pipeline_results.index.get_level_values(1).tolist()\n    context.pipeline_data = pipeline_results\n\ndef handle_data(context, data):\n    if not context.my_universe:\n        return\n\n    for asset in context.my_universe:\n        if data.can_trade(asset) and asset in context.pipeline_data.index.get_level_values(1):\n            close_price = context.pipeline_data.loc[(data.current_dt.date(), asset), 'Close_Price']\n            sma_20 = context.pipeline_data.loc[(data.current_dt.date(), asset), 'SMA_20']\n            volume_sum = context.pipeline_data.loc[(data.current_dt.date(), asset), 'Volume_10D_Sum']\n\n            # \u793a\u4f8b\u908f\u8f2f\uff1a\u5982\u679c\u6536\u76e4\u50f9\u9ad8\u65bc SMA_20 \u4e14\u6210\u4ea4\u91cf\u5145\u8db3\uff0c\u5247\u8cb7\u5165\n            if close_price &gt; sma_20 and volume_sum &gt; 1_000_000: # \u5047\u8a2d\u6210\u4ea4\u91cf\u5927\u65bc 1 \u767e\u842c\n                order_target_percent(asset, 1.0 / len(context.my_universe))\n            elif close_price &lt; sma_20 and asset in context.portfolio.positions:\n                order_target_percent(asset, 0.0)\n\ndef analyze(context, results):\n    print(\"\u56de\u6e2c\u5206\u6790\u5b8c\u6210\u3002\")\n\n# \u57f7\u884c\u56de\u6e2c\nresults = run_algorithm(\n    start=pd.Timestamp('2020-01-01', tz='UTC'),\n    end=pd.Timestamp('2021-01-01', tz='UTC'),\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=1_000_000,\n    bundle='tquant',\n    before_trading_start=before_trading_start\n)\n</code></pre>"},{"location":"reference/pipeline/datasets/overview/","title":"Pipeline \u8cc7\u6599\u96c6 (DataSet) \u6982\u89bd","text":"<p>Info</p> <p>\u672c\u9801\u4ecb\u7d39 Zipline Pipeline \u4e2d\u8cc7\u6599\u96c6 (DataSets) \u7684\u6838\u5fc3\u6982\u5ff5\uff0c\u5305\u62ec\u5176\u4f5c\u7528\u3001TQuant Lab \u63d0\u4f9b\u7684\u5167\u5efa\u8cc7\u6599\u96c6\u985e\u578b\uff0c\u4ee5\u53ca\u5982\u4f55\u5728 Pipeline \u4e2d\u4f7f\u7528\u9019\u4e9b\u8cc7\u6599\u96c6\u4f86\u7372\u53d6\u539f\u59cb\u6578\u64da\u3002</p> <p>\u5728 Zipline Pipeline \u4e2d\uff0c<code>DataSet</code> \u626e\u6f14\u8457\u6578\u64da\u4f86\u6e90\u7684\u89d2\u8272\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u500b\u7d50\u69cb\u5316\u7684\u4ecb\u9762\uff0c\u8b93\u60a8\u53ef\u4ee5\u4fbf\u6377\u3001\u5b89\u5168\u5730\u5b58\u53d6\u6b77\u53f2\u5e02\u5834\u6578\u64da\u3001\u57fa\u672c\u9762\u6578\u64da\u6216\u5176\u4ed6\u81ea\u5b9a\u7fa9\u6578\u64da\u3002<code>DataSet</code> \u7684\u4e3b\u8981\u512a\u52e2\u5728\u65bc\u5b83\u80fd\u78ba\u4fdd\u6578\u64da\u7d93\u904e\u6e05\u6d17\u3001\u5c0d\u9f4a\uff0c\u4e26\u5728 Pipeline \u7684\u8a08\u7b97\u904e\u7a0b\u4e2d\u81ea\u52d5\u8655\u7406\u524d\u8996\u6027\u504f\u5dee\u3002</p>"},{"location":"reference/pipeline/datasets/overview/#1-dataset","title":"1. DataSet \u7c21\u4ecb","text":"<p><code>DataSet</code> \u7269\u4ef6\u4ee3\u8868\u4e86\u4e00\u500b\u7279\u5b9a\u7684\u6578\u64da\u6e90\uff0c\u4f8b\u5982\u80a1\u7968\u7684\u6bcf\u65e5\u50f9\u683c (<code>EquityPricing</code>) \u6216 TEJ \u7684\u8ca1\u52d9\u6578\u64da\u3002\u7576\u60a8\u5728 Pipeline \u4e2d\u4f7f\u7528 <code>Factor</code>\u3001<code>Filter</code> \u6216 <code>Classifier</code> \u6642\uff0c\u5b83\u5011\u901a\u5e38\u6703\u5f9e\u9019\u4e9b <code>DataSet</code> \u4e2d\u7372\u53d6\u539f\u59cb\u8f38\u5165\u3002</p>"},{"location":"reference/pipeline/datasets/overview/#2-boundcolumn","title":"2. BoundColumn \u6982\u5ff5","text":"<p>\u7576\u60a8\u900f\u904e <code>DataSet.column_name</code> \u65b9\u5f0f\uff08\u4f8b\u5982 <code>EquityPricing.close</code>\uff09\u8a2a\u554f <code>DataSet</code> \u4e2d\u7684\u7279\u5b9a\u6b04\u4f4d\u6642\uff0cZipline \u6703\u8fd4\u56de\u4e00\u500b <code>BoundColumn</code> \u7269\u4ef6\u3002\u9019\u500b <code>BoundColumn</code> \u7269\u4ef6\u662f\u5be6\u969b\u6578\u64da\u64cd\u4f5c\u7684\u4ecb\u9762\u3002</p> <p><code>BoundColumn</code> \u63d0\u4f9b\u4e86\u591a\u7a2e\u65b9\u6cd5\u4f86\u6307\u5b9a\u60a8\u60f3\u8981\u5f9e\u8a72\u6b04\u4f4d\u7372\u53d6\u54ea\u4e9b\u6578\u64da\uff1a</p> <ul> <li><code>.latest</code>: \u7372\u53d6\u6bcf\u500b\u8cc7\u7522\u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u7684\u6700\u65b0\u503c\u3002<ul> <li>\u7bc4\u4f8b\uff1a<code>EquityPricing.close.latest</code> (\u7372\u53d6\u6700\u65b0\u6536\u76e4\u50f9)\u3002</li> </ul> </li> <li><code>.slice(window_length)</code>: \u7372\u53d6\u6bcf\u500b\u8cc7\u7522\u5728\u6307\u5b9a <code>window_length</code> \u5167\u7684\u6b77\u53f2\u6578\u64da\u7a97\u53e3\u3002<ul> <li>\u7bc4\u4f8b\uff1a<code>EquityPricing.volume.slice(window_length=20)</code> (\u7372\u53d6\u904e\u53bb 20 \u5929\u7684\u4ea4\u6613\u91cf\u6578\u64da)\u3002</li> </ul> </li> </ul>"},{"location":"reference/pipeline/datasets/overview/#3-dataset","title":"3. \u5e38\u898b DataSet \u7bc4\u4f8b","text":"<p>Zipline (TQuant Lab) \u63d0\u4f9b\u4e86\u591a\u500b\u5167\u5efa\u7684 <code>DataSet</code> \u4ee5\u4f9b\u4f7f\u7528\uff1a</p>"},{"location":"reference/pipeline/datasets/overview/#31-equitypricing","title":"3.1. EquityPricing\uff1a\u80a1\u7968\u50f9\u91cf\u6578\u64da","text":"<p><code>EquityPricing</code> \u662f\u6700\u5e38\u7528\u7684 <code>DataSet</code> \u4e4b\u4e00\uff0c\u5b83\u63d0\u4f9b\u4e86\u80a1\u7968\u7684\u6a19\u6e96\u50f9\u91cf\u6578\u64da\u3002</p> <ul> <li>\u5c0e\u5165: <code>from zipline.pipeline.data import EquityPricing</code></li> <li>\u5e38\u898b\u6b04\u4f4d:<ul> <li><code>open</code>: \u958b\u76e4\u50f9</li> <li><code>high</code>: \u6700\u9ad8\u50f9</li> <li><code>low</code>: \u6700\u4f4e\u50f9</li> <li><code>close</code>: \u6536\u76e4\u50f9</li> <li><code>volume</code>: \u6210\u4ea4\u91cf</li> </ul> </li> </ul>"},{"location":"reference/pipeline/datasets/overview/#20","title":"\u7bc4\u4f8b\uff1a\u7372\u53d6\u6700\u65b0\u6536\u76e4\u50f9\u548c 20 \u65e5\u6210\u4ea4\u91cf","text":"<pre><code>from zipline.pipeline.data import EquityPricing\nfrom zipline.pipeline import Pipeline\nfrom zipline.pipeline.factors import SimpleMovingAverage\n\ndef make_pipeline():\n    return Pipeline(\n        columns={\n            'Latest_Close': EquityPricing.close.latest,\n            'Historical_Volume_20D': EquityPricing.volume.slice(window_length=20),\n            'SMA_20D_Close': SimpleMovingAverage(inputs=[EquityPricing.close], window_length=20)\n        }\n    )\n</code></pre>"},{"location":"reference/pipeline/datasets/overview/#32-tqdataset-tqaltdatasettej","title":"3.2. TQDataSet / TQAltDataSet\uff1aTEJ \u8ca1\u52d9\u8207\u975e\u8ca1\u52d9\u6578\u64da","text":"<p>TQuant Lab \u70ba\u4e86\u6574\u5408 TEJ \u8cc7\u6599\u5eab\u7684\u8c50\u5bcc\u6578\u64da\uff0c\u63d0\u4f9b\u4e86 <code>TQDataSet</code> \u548c <code>TQAltDataSet</code>\u3002</p> <ul> <li><code>TQDataSet</code>: \u4e3b\u8981\u7528\u65bc\u8ca1\u52d9\u76f8\u95dc\u7684\u6578\u64da\u3002</li> <li><code>TQAltDataSet</code>: \u4e3b\u8981\u7528\u65bc\u975e\u8ca1\u52d9\u76f8\u95dc\u7684\u6578\u64da\u3002</li> </ul> <p>Important</p> <p>\u65e9\u671f\u7248\u672c\u7684 <code>zipline.pipeline.data.tejquant.TQDataSet</code> \u5df2\u88ab\u68c4\u7528\u3002\u73fe\u5728\u8acb\u6539\u7528 <code>zipline.pipeline.data.TQFundamentals.TQDataSet</code> \u548c <code>zipline.pipeline.data.TQFundamentals.TQAltDataSet</code>\u3002</p> <ul> <li>\u5c0e\u5165: <code>from zipline.pipeline.data.TQFundamentals import TQDataSet, TQAltDataSet</code></li> <li>\u5e38\u898b\u6b04\u4f4d: \u9019\u4e9b <code>DataSet</code> \u63d0\u4f9b\u4e86 TEJ \u8cc7\u6599\u5eab\u4e2d\u773e\u591a\u7684\u8ca1\u52d9\uff08\u4f8b\u5982 <code>Gross_Margin_Growth_Rate_A</code>\uff09\u548c\u975e\u8ca1\u52d9\uff08\u4f8b\u5982 <code>Industry</code>\uff09\u6578\u64da\u3002\u5177\u9ad4\u53ef\u7528\u6b04\u4f4d\u8acb\u53c3\u8003\u76f8\u95dc\u6587\u4ef6\u6216\u901a\u904e <code>TQDataSet._column_names</code> \u67e5\u8a62\u3002</li> </ul>"},{"location":"reference/pipeline/datasets/overview/#_1","title":"\u7bc4\u4f8b\uff1a\u7372\u53d6\u6700\u65b0\u7522\u696d\u5225\u548c\u6bdb\u5229\u7387\u6210\u9577\u7387","text":"<pre><code>from zipline.pipeline.data.TQFundamentals import TQDataSet, TQAltDataSet\nfrom zipline.pipeline import Pipeline\n\ndef make_pipeline():\n    return Pipeline(\n        columns={\n            'Industry': TQAltDataSet.Industry.latest, # \u7372\u53d6\u6700\u65b0\u7522\u696d\u5225\n            'Gross_Margin_Growth_Rate': TQDataSet.Gross_Margin_Growth_Rate_A.latest # \u7372\u53d6\u6700\u65b0\u6bdb\u5229\u7387\u6210\u9577\u7387\n        }\n    )\n</code></pre>"},{"location":"reference/pipeline/datasets/overview/#4","title":"4. \u5b8c\u6574\u7bc4\u4f8b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u500b\u5b8c\u6574\u7684 Pipeline \u7bc4\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u5728\u4e00\u500b Pipeline \u4e2d\u7d50\u5408 <code>EquityPricing</code> \u548c <code>TQDataSet</code> \u7372\u53d6\u591a\u7a2e\u6578\u64da\u3002</p> <pre><code>import pandas as pd\nfrom zipline import run_algorithm\nfrom zipline.api import (\n    attach_pipeline,\n    pipeline_output,\n    set_benchmark,\n    symbol,\n    order_target_percent\n)\nfrom zipline.pipeline import Pipeline\nfrom zipline.pipeline.factors import SimpleMovingAverage\nfrom zipline.pipeline.data import EquityPricing\nfrom zipline.pipeline.data.TQFundamentals import TQDataSet, TQAltDataSet\nfrom zipline.pipeline.filters import AverageDollarVolume # \u7be9\u9078\u5668\u7bc4\u4f8b\n\n# 1. \u5b9a\u7fa9 Pipeline\ndef make_my_pipeline():\n    # \u7372\u53d6\u6700\u65b0\u6536\u76e4\u50f9\n    latest_close = EquityPricing.close.latest\n    # \u8a08\u7b97 20 \u65e5\u7c21\u55ae\u79fb\u52d5\u5e73\u5747\u7dda\n    sma_20 = SimpleMovingAverage(inputs=[EquityPricing.close], window_length=20)\n    # \u7372\u53d6\u6700\u65b0\u7522\u696d\u5225\n    industry_sector = TQAltDataSet.Industry.latest\n    # \u7372\u53d6\u6700\u65b0\u6bdb\u5229\u7387\u6210\u9577\u7387\n    gross_margin_growth = TQDataSet.Gross_Margin_Growth_Rate_A.latest\n\n    # \u7be9\u9078\u5668\uff1a\u904e\u53bb 10 \u5929\u5e73\u5747\u65e5\u6210\u4ea4\u91d1\u984d\u524d 50 \u6a94\u80a1\u7968\n    high_volume_filter = AverageDollarVolume(window_length=10).top(50)\n\n    return Pipeline(\n        columns={\n            'Close_Price': latest_close,\n            'SMA_20': sma_20,\n            'Industry': industry_sector,\n            'GM_Growth': gross_margin_growth\n        },\n        screen=high_volume_filter # \u7be9\u9078 Universe\n    )\n\n# 2. Zipline \u56de\u6e2c\u8a2d\u7f6e\ndef initialize(context):\n    set_benchmark(symbol('IR0001')) # \u8a2d\u5b9a Benchmark\n    attach_pipeline(make_my_pipeline(), 'my_data_pipeline') # \u9644\u639b Pipeline\n\ndef before_trading_start(context, data):\n    pipeline_results = pipeline_output('my_data_pipeline')\n    context.my_universe = pipeline_results.index.get_level_values(1).tolist()\n    context.pipeline_data = pipeline_results\n\ndef handle_data(context, data):\n    if not context.my_universe:\n        return\n\n    for asset in context.my_universe:\n        if data.can_trade(asset) and asset in context.pipeline_data.index.get_level_values(1):\n            close_price = context.pipeline_data.loc[(data.current_dt.date(), asset), 'Close_Price']\n            sma_20 = context.pipeline_data.loc[(data.current_dt.date(), asset), 'SMA_20']\n            industry = context.pipeline_data.loc[(data.current_dt.date(), asset), 'Industry']\n\n            # \u793a\u4f8b\u908f\u8f2f\uff1a\u5982\u679c\u6536\u76e4\u50f9\u9ad8\u65bc SMA_20 \u4e14\u5c6c\u65bc\u300c\u534a\u5c0e\u9ad4\u696d\u300d\uff0c\u5247\u8cb7\u5165\n            if close_price &gt; sma_20 and industry == '\u534a\u5c0e\u9ad4\u696d':\n                order_target_percent(asset, 1.0 / len(context.my_universe))\n            # \u5426\u5247\uff0c\u5982\u679c\u6301\u6709\u8a72\u80a1\u7968\uff0c\u5247\u6e05\u5009\n            elif close_price &lt; sma_20 and asset in context.portfolio.positions:\n                order_target_percent(asset, 0.0)\n\ndef analyze(context, results):\n    print(\"\u56de\u6e2c\u5206\u6790\u5b8c\u6210\u3002\")\n\n# \u57f7\u884c\u56de\u6e2c\nresults = run_algorithm(\n    start=pd.Timestamp('2020-01-01', tz='UTC'),\n    end=pd.Timestamp('2021-01-01', tz='UTC'),\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=1_000_000,\n    bundle='tquant',\n    before_trading_start=before_trading_start\n)\n</code></pre>"},{"location":"reference/pipeline/datasets/tej-datasets/","title":"Zipline Pipeline \u8cc7\u6599\u96c6\uff1aTQDataSet / TQAltDataSet","text":"<p>Info</p> <p>\u672c\u9801\u8a73\u7d30\u4ecb\u7d39 Zipline Pipeline \u4e2d\u7684 <code>TQDataSet</code> \u548c <code>TQAltDataSet</code> \u8cc7\u6599\u96c6\uff0c\u5305\u62ec\u5176\u7528\u9014\u3001\u6b04\u4f4d\u67e5\u8a62\u3001\u5982\u4f55\u5c0e\u5165\u548c\u4f7f\u7528 TEJ \u8ca1\u52d9\u8207\u975e\u8ca1\u52d9\u6578\u64da\uff0c\u4e26\u63d0\u4f9b\u5b8c\u6574\u7684\u7bc4\u4f8b\u3002</p> <p>TQuant Lab \u70ba\u4e86\u6df1\u5ea6\u6574\u5408 TEJ \u6578\u64da\uff0c\u63d0\u4f9b\u4e86\u5169\u500b\u5c08\u7528\u7684 <code>DataSet</code>\uff1a<code>TQDataSet</code> \u548c <code>TQAltDataSet</code>\u3002\u5b83\u5011\u662f Pipeline \u4e2d\u7372\u53d6 TEJ \u8ca1\u52d9\uff08\u57fa\u672c\u9762\uff09\u548c\u975e\u8ca1\u52d9\u6578\u64da\u7684\u6838\u5fc3\u4f86\u6e90\uff0c\u8b93\u60a8\u53ef\u4ee5\u8f15\u9b06\u5730\u5c07 TEJ \u6578\u64da\u61c9\u7528\u65bc\u56e0\u5b50\u7814\u7a76\u548c\u7b56\u7565\u958b\u767c\u3002</p>"},{"location":"reference/pipeline/datasets/tej-datasets/#1-tqdataset-tqaltdataset","title":"1. TQDataSet \u548c TQAltDataSet \u7c21\u4ecb","text":"<ul> <li><code>TQDataSet</code>: \u4e3b\u8981\u7528\u65bc\u7372\u53d6**\u8ca1\u52d9\u76f8\u95dc\u6578\u64da**\uff0c\u4f8b\u5982\u71df\u6536\u3001\u5229\u6f64\u3001\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387\u7b49\u57fa\u672c\u9762\u6307\u6a19\u3002</li> <li><code>TQAltDataSet</code>: \u4e3b\u8981\u7528\u65bc\u7372\u53d6**\u975e\u8ca1\u52d9\u76f8\u95dc\u6578\u64da**\uff0c\u4f8b\u5982\u7522\u696d\u5225\u3001\u5e02\u5834\u985e\u578b\u7b49\u3002</li> </ul> <p>\u9019\u5169\u500b <code>DataSet</code> \u9075\u5faa Zipline <code>DataSet</code> \u7684\u6a19\u6e96\u884c\u70ba\uff0c\u63d0\u4f9b\u7d93\u904e\u6e05\u6d17\u3001\u5c0d\u9f4a\u4e14\u7121\u524d\u8996\u6027\u504f\u5dee\u7684\u6b77\u53f2\u6578\u64da\uff0c\u4f9b Pipeline \u4e2d\u7684 <code>Factor</code>\u3001<code>Filter</code> \u548c <code>Classifier</code> \u4f7f\u7528\u3002</p>"},{"location":"reference/pipeline/datasets/tej-datasets/#2","title":"2. \u68c4\u7528\u8aaa\u660e\u8207\u65b0\u8def\u5f91","text":"<p>Important</p> <p>\u65e9\u671f\u7248\u672c\u4f7f\u7528 <code>zipline.pipeline.data.tejquant.TQDataSet</code> \u548c <code>zipline.pipeline.data.tejquant.TQAltDataSet</code> \u7684\u8def\u5f91\u5df2\u88ab\u68c4\u7528\u3002\u73fe\u5728\u8acb\u52d9\u5fc5\u6539\u7528\u65b0\u7684\u5c0e\u5165\u8def\u5f91\uff1a <pre><code>from zipline.pipeline.data.TQFundamentals import TQDataSet, TQAltDataSet\n</code></pre></p>"},{"location":"reference/pipeline/datasets/tej-datasets/#3","title":"3. \u5982\u4f55\u7372\u53d6\u6b04\u4f4d\u5217\u8868","text":"<p>\u7531\u65bc <code>TQDataSet</code> \u548c <code>TQAltDataSet</code> \u5305\u542b\u4e86 TEJ \u8cc7\u6599\u5eab\u4e2d\u5927\u91cf\u7684\u6b04\u4f4d\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>._column_names</code> \u5c6c\u6027\u4f86\u67e5\u8a62\u6240\u6709\u53ef\u7528\u7684\u6b04\u4f4d\u540d\u7a31\u3002</p> <pre><code>from zipline.pipeline.data.TQFundamentals import TQDataSet, TQAltDataSet\n\n# \u67e5\u8a62 TQDataSet (\u8ca1\u52d9\u6578\u64da) \u6240\u6709\u53ef\u7528\u6b04\u4f4d\nprint(\"TQDataSet \u53ef\u7528\u6b04\u4f4d\u7bc4\u4f8b:\")\nprint(TQDataSet._column_names[:5]) # \u6253\u5370\u524d 5 \u500b\u6b04\u4f4d\n\n# \u67e5\u8a62 TQAltDataSet (\u975e\u8ca1\u52d9\u6578\u64da) \u6240\u6709\u53ef\u7528\u6b04\u4f4d\nprint(\"\\nTQAltDataSet \u53ef\u7528\u6b04\u4f4d\u7bc4\u4f8b:\")\nprint(TQAltDataSet._column_names[:5]) # \u6253\u5370\u524d 5 \u500b\u6b04\u4f4d\n</code></pre>"},{"location":"reference/pipeline/datasets/tej-datasets/#4-pipeline","title":"4. \u5982\u4f55\u5728 Pipeline \u4e2d\u4f7f\u7528","text":"<p>\u5728 Pipeline \u4e2d\u4f7f\u7528 <code>TQDataSet</code> \u548c <code>TQAltDataSet</code> \u7684\u65b9\u5f0f\u8207 <code>EquityPricing</code> \u985e\u4f3c\uff0c\u90fd\u662f\u900f\u904e <code>DataSet.column_name.latest</code> \u6216 <code>DataSet.column_name.slice(window_length)</code> \u4f86\u7372\u53d6\u6578\u64da\u3002</p>"},{"location":"reference/pipeline/datasets/tej-datasets/#_1","title":"\u5e38\u7528\u6b04\u4f4d\u793a\u4f8b\uff1a","text":"<ul> <li><code>TQDataSet.Gross_Margin_Growth_Rate_A.latest</code>: \u7372\u53d6\u6700\u65b0\u7684\u6bdb\u5229\u7387\u6210\u9577\u7387 (\u5e74)\u3002</li> <li><code>TQDataSet.Return_On_Equity_A.latest</code>: \u7372\u53d6\u6700\u65b0\u7684\u80a1\u6771\u6b0a\u76ca\u5831\u916c\u7387 (\u5e74)\u3002</li> <li><code>TQAltDataSet.Industry.latest</code>: \u7372\u53d6\u6700\u65b0\u7684\u7522\u696d\u5225\u3002</li> <li><code>TQAltDataSet.Market_Cap_Dollars.latest</code>: \u7372\u53d6\u6700\u65b0\u7684\u5e02\u503c\u3002</li> </ul>"},{"location":"reference/pipeline/datasets/tej-datasets/#_2","title":"\u7bc4\u4f8b\uff1a\u7372\u53d6\u6700\u65b0\u7522\u696d\u5225\u548c\u6bdb\u5229\u7387\u6210\u9577\u7387","text":"<pre><code>from zipline.pipeline.data.TQFundamentals import TQDataSet, TQAltDataSet\nfrom zipline.pipeline import Pipeline\n\ndef make_my_tej_pipeline():\n    return Pipeline(\n        columns={\n            'Industry': TQAltDataSet.Industry.latest, # \u7372\u53d6\u6700\u65b0\u7522\u696d\u5225 (\u975e\u8ca1\u52d9)\n            'Gross_Margin_Growth_Rate': TQDataSet.Gross_Margin_Growth_Rate_A.latest, # \u7372\u53d6\u6700\u65b0\u6bdb\u5229\u7387\u6210\u9577\u7387 (\u8ca1\u52d9)\n            'Market_Cap': TQAltDataSet.Market_Cap_Dollars.latest # \u7372\u53d6\u6700\u65b0\u5e02\u503c (\u975e\u8ca1\u52d9)\n        }\n    )\n</code></pre>"},{"location":"reference/pipeline/datasets/tej-datasets/#5","title":"5. \u5b8c\u6574\u7bc4\u4f8b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u500b\u5b8c\u6574\u7684 Pipeline \u7bc4\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u5b9a\u7fa9\u4e00\u500b Pipeline\uff0c\u4f7f\u7528 <code>TQDataSet</code> \u548c <code>TQAltDataSet</code> \u7372\u53d6\u591a\u7a2e\u57fa\u672c\u9762\u6578\u64da\uff0c\u4e26\u5c07\u5176\u8f38\u51fa\u3002</p> <p>```python import pandas as pd from zipline import run_algorithm from zipline.api import (     attach_pipeline,     pipeline_output,     set_benchmark,     symbol,     order_target_percent ) from zipline.pipeline import Pipeline from zipline.pipeline.factors import SimpleMovingAverage # \u7bc4\u4f8b\u4e2d\u53ef\u4f7f\u7528\u5167\u5efa Factor from zipline.pipeline.data import EquityPricing # \u53ef\u540c\u6642\u4f7f\u7528 EquityPricing from zipline.pipeline.data.TQFundamentals import TQDataSet, TQAltDataSet from zipline.pipeline.filters import AverageDollarVolume # \u7be9\u9078\u5668\u7bc4\u4f8b</p>"},{"location":"reference/pipeline/datasets/tej-datasets/#1-pipeline","title":"1. \u5b9a\u7fa9 Pipeline","text":"<p>def make_my_fundamental_pipeline():     # \u7372\u53d6\u6700\u65b0\u6536\u76e4\u50f9 (\u4f86\u81ea EquityPricing\uff0c\u4f5c\u70ba\u53c3\u8003)     latest_close = EquityPricing.close.latest</p> <pre><code># \u7372\u53d6 TEJ \u8ca1\u52d9\u6578\u64da\nroe_q = TQDataSet.Return_On_Equity_Q.latest # \u5b63\u5ea6 ROE\neps_y = TQDataSet.Earnings_Per_Share_Y.latest # \u5e74\u5ea6 EPS\n\n# \u7372\u53d6 TEJ \u975e\u8ca1\u52d9\u6578\u64da\nindustry = TQAltDataSet.Industry.latest\nmarket_cap = TQAltDataSet.Market_Cap_Dollars.latest\n\n# \u7be9\u9078\u5668\uff1a\u904e\u53bb 10 \u5929\u5e73\u5747\u65e5\u6210\u4ea4\u91d1\u984d\u524d 50 \u6a94\u80a1\u7968\nhigh_volume_filter = AverageDollarVolume(window_length=10).top(50)\n\nreturn Pipeline(\n    columns={\n        'Close_Price': latest_close,\n        'ROE_Q': roe_q,\n        'EPS_Y': eps_y,\n        'Industry': industry,\n        'Market_Cap': market_cap\n    },\n    screen=high_volume_filter # \u7be9\u9078 Universe\n)\n</code></pre>"},{"location":"reference/pipeline/datasets/tej-datasets/#2-zipline","title":"2. Zipline \u56de\u6e2c\u8a2d\u7f6e","text":"<p>def initialize(context):     set_benchmark(symbol('IR0001')) # \u8a2d\u5b9a Benchmark     attach_pipeline(make_my_fundamental_pipeline(), 'my_fundamental_pipeline') # \u9644\u639b Pipeline</p> <p>def before_trading_start(context, data):     pipeline_results = pipeline_output('my_fundamental_pipeline')     context.my_universe = pipeline_results.index.get_level_values(1).tolist()     context.pipeline_data = pipeline_results</p> <p>def handle_data(context, data):     if not context.my_universe:         return</p> <pre><code>for asset in context.my_universe:\n    if data.can_trade(asset) and asset in context.pipeline_data.index.get_level_values(1):\n        close_price = context.pipeline_data.loc[(data.current_dt.date(), asset), 'Close_Price']\n        roe = context.pipeline_data.loc[(data.current_dt.date(), asset), 'ROE_Q']\n        eps = context.pipeline_data.loc[(data.current_dt.date(), asset), 'EPS_Y']\n        industry = context.pipeline_data.loc[(data.current_dt.date(), asset), 'Industry']\n\n        # \u793a\u4f8b\u908f\u8f2f\uff1a\u5982\u679c ROE \u548c EPS \u90fd\u70ba\u6b63\uff0c\u4e14\u5c6c\u65bc\u7279\u5b9a\u7522\u696d\uff0c\u5247\u8cb7\u5165\n        if roe &gt; 0 and eps &gt; 0 and industry == '\u534a\u5c0e\u9ad4\u696d': # \u5047\u8a2d\u534a\u5c0e\u9ad4\u696d\u70ba\u7bc4\u4f8b\n            order_target_percent(asset, 1.0 / len(context.my_universe))\n        # \u5426\u5247\uff0c\u5982\u679c\u6301\u6709\u8a72\u80a1\u7968\uff0c\u5247\u6e05\u5009\n        elif (roe &lt;= 0 or eps &lt;= 0) and asset in context.portfolio.positions:\n            order_target_percent(asset, 0.0)\n</code></pre> <p>def analyze(context, results):     print(\"\u56de\u6e2c\u5206\u6790\u5b8c\u6210\u3002\")</p>"},{"location":"reference/pipeline/datasets/tej-datasets/#_3","title":"\u57f7\u884c\u56de\u6e2c","text":"<p>results = run_algorithm(     start=pd.Timestamp('2020-01-01', tz='UTC'),     end=pd.Timestamp('2021-01-01', tz='UTC'),     initialize=initialize,     handle_data=handle_data,     analyze=analyze,     capital_base=1_000_000,     bundle='tquant',     before_trading_start=before_trading_start )</p>"},{"location":"reference/tejtoolapi/","title":"TEJ API \u6982\u8ff0","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b TEJ API \u7684\u6574\u9ad4\u6982\u8ff0\uff0c\u5305\u62ec API \u8a8d\u8b49\u65b9\u5f0f\u3001\u8cc7\u6599\u5eab\u985e\u578b\uff0c\u4ee5\u53ca\u5404\u7a2e\u7a0b\u5f0f\u8a9e\u8a00\u7684 API \u6587\u4ef6\u9023\u7d50\u3002</p>"},{"location":"reference/tejtoolapi/#1-api","title":"1. API \u8a8d\u8b49","text":""},{"location":"reference/tejtoolapi/#11-api-key","title":"1.1 \u53d6\u5f97 API Key","text":"<p>\u60a8\u9700\u8981\u5148\u5411 TEJ \u516c\u53f8\u8a3b\u518a\u5e33\u865f\uff0c\u7136\u5f8c\u7533\u8acb\u53d6\u7528\u8cc7\u6599\u6240\u9700\u7684 API Key\u3002</p> <pre><code>api_key=a8sb1jska2lz03hc2\n</code></pre>"},{"location":"reference/tejtoolapi/#12-api-key","title":"1.2 \u8a2d\u5b9a API Key","text":"<p>\u6bcf\u6b21\u5b58\u53d6\u8cc7\u6599\u6642\uff0c\u90fd\u9700\u8981\u63d0\u4f9b\u60a8\u7684 API Key\u3002</p> \u74b0\u5883\u8b8a\u6578 (\u63a8\u85a6)Python tejapiREST API <pre><code>import os\nos.environ['TEJAPI_KEY'] = \"YOUR_API_KEY\"\nos.environ['TEJAPI_BASE'] = \"https://api.tej.com.tw\"\n</code></pre> <pre><code>import tejapi\ntejapi.ApiConfig.api_key = \"YOUR_API_KEY\"\n</code></pre> <pre><code>GET https://api.tej.com.tw/api/datatables/TWN/APRCD.json?api_key=YOUR_API_KEY\n</code></pre>"},{"location":"reference/tejtoolapi/#2","title":"2. \u8cc7\u6599\u5eab\u985e\u578b","text":"<p>TEJ \u63d0\u4f9b\u514d\u8cbb\u8a66\u7528\u53ca\u4ed8\u8cbb\u8cc7\u6599\u5eab\uff1a</p> \u9805\u76ee \u8a66\u7528\u8cc7\u6599\u5eab \u4ed8\u8cbb\u8cc7\u6599\u5eab \u53ef\u7528\u8cc7\u6599\u8868 \u50c5\u8a66\u7528\u8cc7\u6599\u5eab\u5167\u7684\u8868\u683c \u5b8c\u6574\u8cc7\u6599\u5eab \u6bcf\u65e5\u547c\u53eb\u6b21\u6578 \u6700\u591a 500 \u6b21 \u6700\u591a 2,000 \u6b21 \u6bcf\u6b21\u547c\u53eb\u7b46\u6578 \u6700\u591a 10,000 \u7b46 \u6700\u591a 10,000 \u7b46 \u5206\u9801\u7e3d\u7b46\u6578\u4e0a\u9650 50,000 \u7b46 1,000,000 \u7b46 \u6bcf\u65e5\u8cc7\u6599\u4e0a\u9650 50,000 \u7b46 3,000,000 \u7b46"},{"location":"reference/tejtoolapi/#3-api","title":"3. API \u6587\u4ef6","text":"<ul> <li> <p> REST API</p> <p>\u900f\u904e HTTPS \u76f4\u63a5\u5b58\u53d6 TEJ \u8cc7\u6599\u5eab\uff0c\u652f\u63f4 JSON/XML \u683c\u5f0f\u8f38\u51fa</p> <p> \u67e5\u770b\u6587\u4ef6</p> </li> <li> <p> TejToolAPI (Python)</p> <p>\u4f7f\u7528 <code>get_history_data</code> \u51fd\u6578\u6574\u4f75\u80a1\u50f9\u8207\u8ca1\u52d9\u8cc7\u6599</p> <p> \u67e5\u770b\u6587\u4ef6</p> </li> </ul>"},{"location":"reference/tejtoolapi/#4","title":"4. \u5916\u90e8\u8cc7\u6e90","text":"<ul> <li>TEJ \u8cc7\u6599\u96c6\u7e3d\u89bd</li> <li>TEJ API \u5b98\u65b9\u6587\u4ef6</li> <li>REST API Swagger \u6587\u4ef6</li> <li>PyPI - TejToolAPI</li> </ul>"},{"location":"reference/tejtoolapi/get-history-data/","title":"\u5982\u4f55\u53d6\u5f97\u6b77\u53f2\u8cc7\u6599 (TejToolAPI)","text":"<p>Info</p> <p>\u672c\u9801\u8a73\u7d30\u8aaa\u660e\u5982\u4f55\u4f7f\u7528 TEJ Tool API \u7684 <code>get_history_data</code> \u51fd\u6578\u4f86\u7372\u53d6\u6b77\u53f2\u8cc7\u6599\uff0c\u4e26\u6574\u4f75\u80a1\u50f9\u8207\u4e0d\u540c\u5c6c\u6027\u7684\u8cc7\u6599\u8868\uff0c\u5305\u62ec\u53c3\u6578\u8aaa\u660e\u548c\u4f7f\u7528\u7bc4\u4f8b\u3002</p>"},{"location":"reference/tejtoolapi/get-history-data/#1","title":"1. \u6982\u8ff0","text":"<p>TEJTOOLAPI \u4e3b\u8981\u6574\u4f75\u80a1\u50f9\u8207\u4e0d\u540c\u5c6c\u6027\u7684\u8cc7\u6599\u5eab\uff0c\u900f\u904e\u8f38\u5165\u80a1\u7968\u4ee3\u78bc (TICKERS) \u548c\u6b04\u4f4d (FIELD) \u5f8c\uff0c\u53ef\u5c07\u6b32\u6293\u53d6\u7684\u8cc7\u6599\u6574\u4f75\u70ba\u65e5\u983b\u7387\u7684 DataFrame\u3002</p> <p>\u4e3b\u8981\u6574\u4f75\u65b9\u6cd5\u662f\u4ee5\u4ea4\u6613\u65e5\u671f\u8868\u70ba\u7d22\u5f15\u6574\u4f75\u80a1\u50f9\u8207\u4e0d\u540c\u5c6c\u6027\u7684\u8cc7\u6599\u3002\u8ca1\u52d9\u6578\u64da\u662f\u6839\u64da\u767c\u5e03\u65e5\uff08announcement date\uff09\u4f86 mapping\uff0c\u975e\u767c\u5e03\u65e5\u7684\u8ca1\u52d9\u6578\u64da\u6703\u4f7f\u7528\u7576\u4e0b\u53ef\u7372\u5f97\u6700\u65b0\u7684\u8cc7\u6599\u70ba\u6e96\u9032\u884c\u586b\u503c\u3002</p> <p>\u4f8b\u5982\uff1a2330 \u5728 2010-02-01 \u6642\u6240\u80fd\u7372\u5f97\u6700\u65b0\u7684\u8ca1\u52d9\u8cc7\u6599\u70ba 2009Q3 \u7684\u8ca1\u52d9\u8cc7\u6599\uff0c\u5247 2010-01-01 \u6703\u4ee5 2009Q3 \u7684\u8cc7\u6599\u9032\u884c\u586b\u88dc\u3002\u60df\u516c\u53f8 2009Q4 \u81ea\u7d50\u8ca1\u5831\u65e9\u65bc 2010-02-01 \u767c\u5e03\u6642\uff0c\u4e14 <code>include_self_acc = 'Y'</code>\uff0c\u9019\u6642 2010-02-01 \u7684\u8ca1\u52d9\u6578\u64da\u4f7f\u7528\u81ea\u7d50\u8ca1\u52d9\u6578\u64da\u3002</p> <p>\u53ef\u6293\u53d6\u7684\u8cc7\u6599\u6b04\u4f4d\u53ef\u53c3\u8003\uff1aTEJ \u8cc7\u6599\u96c6</p>"},{"location":"reference/tejtoolapi/get-history-data/#2","title":"2. \u51fd\u6578\u7c3d\u540d","text":"<pre><code>TejToolAPI.get_history_data(ticker, columns, transfer_to_chinese=False, start=None, end=None, fin_type=None, include_self_acc=None)\n</code></pre>"},{"location":"reference/tejtoolapi/get-history-data/#3","title":"3. \u53c3\u6578\u8aaa\u660e","text":"\u53c3\u6578 \u985e\u578b \u8aaa\u660e <code>ticker</code> iterable[str] \u6b32\u67e5\u8a62\u7684\u8cc7\u6599\u7684\u8b49\u5238\u4ee3\u78bc <code>columns</code> iterable[str] \u6b32\u67e5\u8a62\u8cc7\u6599\u7684\u6b04\u4f4d\u540d\u7a31\uff0c\u8a73\u898b API \u6587\u4ef6 <code>transfer_to_chinese</code> boolean \u662f\u5426\u5c07\u6b04\u4f4d\u540d\u7a31\u8f49\u63db\u70ba\u4e2d\u6587\uff0c\u9810\u8a2d\u70ba False <code>start</code> pd.Timestamp or str \u8cc7\u6599\u8d77\u59cb\u6642\u9593 (\u9078\u7528) <code>end</code> pd.Timestamp or str \u8cc7\u6599\u7d50\u675f\u6642\u9593 (\u9078\u7528) <code>fin_type</code> iterable[str] \u6c7a\u5b9a\u8ca1\u52d9\u8cc7\u6599\u578b\u614b\uff1aA (\u7d2f\u7a4d)\u3001F (\u55ae\u5b63)\u3001TTM (\u79fb\u52d5\u56db\u5b63) <code>include_self_acc</code> str Y: \u6295\u8cc7\u7528\u8ca1\u52d9\u5305\u542b\u81ea\u7d50\u548c\u8463\u4e8b\u6703\u6c7a\u8b70\u6578\uff1bN: \u50c5\u6295\u8cc7\u7528\u8ca1\u52d9"},{"location":"reference/tejtoolapi/get-history-data/#4","title":"4. \u56de\u50b3\u503c","text":"<ul> <li>\u985e\u578b\uff1a<code>pd.DataFrame</code></li> <li>\u8aaa\u660e\uff1a\u4ee5\u4ea4\u6613\u65e5\u671f\u70ba\u7d22\u5f15\uff0c\u5305\u542b\u6240\u6709\u8acb\u6c42\u6b04\u4f4d\u7684 DataFrame</li> </ul>"},{"location":"reference/tejtoolapi/get-history-data/#5","title":"5. \u4f7f\u7528\u7bc4\u4f8b","text":""},{"location":"reference/tejtoolapi/get-history-data/#51","title":"5.1 \u74b0\u5883\u8a2d\u5b9a","text":"<pre><code>import os\nos.environ['TEJAPI_KEY'] = \"your key\" \nos.environ['TEJAPI_BASE'] = \"https://api.tej.com.tw\"\n\nimport TejToolAPI \nfrom zipline.data import bundles\n</code></pre>"},{"location":"reference/tejtoolapi/get-history-data/#52-tickers","title":"5.2 \u53d6\u5f97 Tickers","text":"<p>\u65b9\u6cd5\u4e00\uff1a\u5f9e bundle \u53d6\u5f97</p> <pre><code>bundle_data = bundles.load('tquant')\nuniverse = bundle_data.asset_finder.retrieve_all(bundle_data.asset_finder.equities_sids)\ntickers = [col.symbol for col in universe]\n</code></pre> <p>\u65b9\u6cd5\u4e8c\uff1a\u81ea\u884c\u6307\u5b9a</p> <pre><code>tickers = ['2330', '2454', '2317', '2882', '2881']\n</code></pre>"},{"location":"reference/tejtoolapi/get-history-data/#53","title":"5.3 \u7bc4\u4f8b\u4e00\uff1a\u53d6\u5f97\u6708\u71df\u6536\u8cc7\u6599","text":"<pre><code>ticker = tickers\ncolumns = ['Sales_Accu_LastYear', 'Sales_Accu_3M',\n           'Sales_Per_Share_Accu_12M', 'YoY_Accu_Sales', 'YoY_Monthly_Sales',\n           'Sales_Per_Share_Accu_3M', 'Sales_Accu_3M_LastYear', 'Sales_Monthly',\n           'YoY_AccuSales_12M', 'YoY_Accu_Sales_3M', 'MoM_Monthly_Sales',\n           'Sales_Accumulated', 'QoQ_Accu_Sales_3M', 'MoM_Accu_Sales_3M',\n           'Sales_Monthly_LastYear', 'Outstanding_Shares_1000_Shares']\n\ndata = TejToolAPI.get_history_data(ticker=ticker, \n                                   columns=columns,\n                                   transfer_to_chinese=False)\nprint(data)\n</code></pre>"},{"location":"reference/tejtoolapi/get-history-data/#54","title":"5.4 \u7bc4\u4f8b\u4e8c\uff1a\u53d6\u5f97\u96c6\u4fdd\u5eab\u5b58\u8cc7\u6599","text":"<pre><code>ticker = tickers\ncolumns = ['Total_Custodied_Shares_1000_Lots',\n           'Custodied_Under_400_Lots_Total_Lots',\n           'Custodied_Lots_Between_800_1000_Total_Lots',\n           'Custodied_Larger_Than_400_Lots_Pct',\n           'Custodied_Lots_Between_400_600_Total_Lots',\n           'Custodied_Lots_Between_600_800_Pct', \n           'Pledged_Stock_Shares_1000_Lots',\n           'Custodied_Under_400_Lots_Pct',\n           'Custodied_Lots_Between_400_600_Total_Holders',\n           'Custodied_Lots_Between_800_1000_Total_Holders',\n           'Custodied_Under_400_Lots_Total_Holders',\n           'Custodied_Lots_Between_400_600_Pct',\n           'Custodied_Lots_Between_800_1000_Pct',\n           'Custodied_Greater_Than_1000_Lots_Pct']\n\ndata1 = TejToolAPI.get_history_data(ticker=ticker, \n                                    columns=columns,\n                                    transfer_to_chinese=False)\nprint(data1)\n</code></pre>"},{"location":"reference/tejtoolapi/get-history-data/#55","title":"5.5 \u7bc4\u4f8b\u4e09\uff1a\u6293\u53d6\u8ca1\u52d9\u8cc7\u6599","text":""},{"location":"reference/tejtoolapi/get-history-data/#_1","title":"\u53c3\u6578\u8a2d\u5b9a\u8aaa\u660e","text":"<p>ticker - \u55ae\u4e00\u80a1\u7968\uff1a<code>['2330']</code> - \u591a\u80a1\u7968\uff1a<code>['2330', '2317']</code></p> <p>columns - \u6b04\u4f4d\u7bc4\u4f8b\uff1a<code>columns=['r408', 'r409', 'r410', 'r502']</code></p> <p>transfer_to_chinese - \u9810\u8a2d\uff1a<code>False</code> - \u82e5\u8981\u8f49\u63db\u70ba\u4e2d\u6587\u6b04\u4f4d\u540d\u7a31\uff1a<code>True</code></p> <p>fin_type - <code>A</code>\uff1a\u8868\u793a\u7d2f\u7a4d - <code>Q</code>\uff1a\u8868\u793a\u55ae\u5b63 - <code>TTM</code>\uff1a\u8868\u793a\u79fb\u52d5 4 \u5b63</p> <p>include_self_acc - <code>'Y'</code>\uff1a\u6295\u8cc7\u7528\u8ca1\u52d9\u5305\u542b\u81ea\u7d50\u548c\u8463\u4e8b\u6703\u6c7a\u8b70\u6578 - <code>'N'</code>\uff1a\u50c5\u6295\u8cc7\u7528\u8ca1\u52d9</p>"},{"location":"reference/tejtoolapi/get-history-data/#_2","title":"\u5b8c\u6574\u7bc4\u4f8b","text":"<pre><code># \u8f38\u5165\u6b04\u4f4d\nicolumns = ['Open', 'Close', 'Qfii_Diff_Vol', 'Total_Diff_Vol', \n            'Custodied_Lots_Between_800_1000_Total_Lots', \n            'Custodied_Lots_Between_800_1000_Pct',\n            'Attention_Stock_Fg', 'Disposition_Stock_Fg', 'Matching_Period', \n            'Suspended_Trading_Stock_Fg', 'Component_Stock_of_TWN50_Fg', \n            'Gross_Margin_Growth_Rate', 'Net_Income_Rate_percent', \n            'Operating_Income_Growth_Rate']\n\n# \u4f7f\u7528 TEJTOOLAPI \u6574\u4f75\ndata = TejToolAPI.get_history_data(ticker=tickers[:5], \n                                   columns=icolumns,\n                                   transfer_to_chinese=True, \n                                   fin_type=['Q'],\n                                   start='2015-01-01', \n                                   end='2022-12-31')\nprint(data)\n</code></pre>"},{"location":"reference/tejtoolapi/get-history-data/#6","title":"6. \u5e38\u898b\u554f\u984c","text":"<p>Q\uff1a\u5982\u4f55\u77e5\u9053\u6709\u54ea\u4e9b\u6b04\u4f4d\u53ef\u4ee5\u4f7f\u7528\uff1f</p> <p>A\uff1a\u8acb\u53c3\u8003 TEJ \u8cc7\u6599\u96c6\u6587\u4ef6 \u6216 API \u6587\u4ef6</p> <p>Q\uff1a\u6642\u9593\u7be9\u9078\u7684\u683c\u5f0f\u662f\u4ec0\u9ebc\uff1f</p> <p>A\uff1a\u652f\u63f4 <code>pd.Timestamp</code> \u6216\u5b57\u7b26\u4e32\u683c\u5f0f\uff0c\u4f8b\u5982 <code>'2020-01-01'</code> \u6216 <code>'20200101'</code></p> <p>Q\uff1a\u5982\u4f55\u7372\u53d6\u6240\u6709\u53ef\u7528\u7684 tickers\uff1f</p> <p>A\uff1a\u53ef\u4ee5\u900f\u904e <code>bundles.load('tquant')</code> \u5f9e tquant bundle \u4e2d\u53d6\u5f97</p>"},{"location":"reference/tejtoolapi/rest-api/","title":"REST API \u6587\u4ef6","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b TEJ REST API \u7684\u8a73\u7d30\u8aaa\u660e\uff0c\u5305\u62ec Datatables API \u7684\u4f7f\u7528\u65b9\u6cd5\u3001\u7bc4\u4f8b\uff0c\u4ee5\u53ca\u5176\u4ed6\u76f8\u95dc\u7684\u63d0\u793a\u8cc7\u8a0a\u3002</p> <p>TEJ REST API \u63d0\u4f9b\u4e86\u4e00\u5957\u7c21\u6613\u7684\u65b9\u5f0f\u4f86\u5b58\u53d6 TEJ \u8cc7\u6599\u5eab\uff0c\u4e26\u8f38\u51fa JSON \u6216 XML \u683c\u5f0f\u3002\u60a8\u4e5f\u53ef\u4ee5\u900f\u904e\u5404\u7a2e\u7a0b\u5f0f\u6216\u5de5\u5177\u5feb\u901f\u53d6\u5f97\u9700\u8981\u7684\u8cc7\u6599\u3002</p>"},{"location":"reference/tejtoolapi/rest-api/#1-datatables-api","title":"1. Datatables API","text":""},{"location":"reference/tejtoolapi/rest-api/#11","title":"1.1 \u6982\u8ff0","text":"<p>TEJ REST API \u63d0\u4f9b\u4e00\u5957\u7c21\u6613\u7684\u65b9\u5f0f\u4f86\u5b58\u53d6 TEJ \u8cc7\u6599\u5eab\uff0c\u4e26\u8f38\u51fa JSON \u6216 XML \u683c\u5f0f\u3002\u60a8\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u700f\u89bd\u5668\u4f86\u53d6\u5f97\u8cc7\u6599\uff0c\u4e5f\u53ef\u4ee5\u900f\u904e\u5de5\u5177\u7a0b\u5f0f\uff08\u4f8b\u5982 curl\u3001wget \u7b49\uff09\u9032\u884c\u53d6\u5f97\u3002</p> <p>\u60a8\u4e5f\u53ef\u4ee5\u5728\u5b98\u65b9 OPEN API (Swagger) \u8aaa\u660e\u6587\u4ef6\u67e5\u770b\u8a73\u7d30\u7684 API \u898f\u683c\u3002</p>"},{"location":"reference/tejtoolapi/rest-api/#12","title":"1.2 \u4f7f\u7528\u65b9\u6cd5","text":"<p>API \u7aef\u9ede\u5b9a\u7fa9\uff1a</p> <pre><code>GET https://api.tej.com.tw/api/datatables/{datatable_code}/{table_code}.{format}?&lt;row_filter_criteria&gt;\n</code></pre> <p>\u5176\u4e2d\uff1a - <code>datatable_code</code>\uff1a\u8cc7\u6599\u5eab\u4ee3\u78bc\uff08\u4f8b\u5982 TWN \u8868\u793a\u53f0\u7063\u8cc7\u6599\u5eab\uff09 - <code>table_code</code>\uff1a\u8cc7\u6599\u8868\u4ee3\u78bc\uff08\u4f8b\u5982 APRCD \u8868\u793a\u672a\u8abf\u6574\u80a1\u50f9\uff09 - <code>format</code>\uff1a\u8f38\u51fa\u683c\u5f0f\uff08json \u6216 xml\uff09 - <code>row_filter_criteria</code>\uff1a\u7be9\u9078\u689d\u4ef6\uff08\u53ef\u9078\uff09</p>"},{"location":"reference/tejtoolapi/rest-api/#13","title":"1.3 \u7bc4\u4f8b","text":"<p>\u4ee5\u4e0a\u5e02(\u6ac3)\u672a\u8abf\u6574\u80a1\u50f9(\u65e5)(TWN/APRCD)\u70ba\u4f8b\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4e0b\u5217\u65b9\u5f0f\u53d6\u5f97\u8cc7\u6599\uff1a</p> JSONXML <pre><code>GET https://api.tej.com.tw/api/datatables/TWN/APRCD.json?api_key=&lt;YOURAPIKEY&gt;\n</code></pre> <pre><code>GET https://api.tej.com.tw/api/datatables/TWN/APRCD.xml?api_key=&lt;YOURAPIKEY&gt;\n</code></pre>"},{"location":"reference/tejtoolapi/rest-api/#14","title":"1.4 \u56de\u61c9\u7bc4\u4f8b","text":"<p>\u56de\u61c9\u8cc7\u6599\u683c\u5f0f\u5982\u4e0b\uff08\u4ee5 JSON \u70ba\u4f8b\uff09\uff1a</p> <pre><code>{\n    \"datatable\": {\n        \"data\": [\n            [\"Y9999\", \"2018-05-15T00:00:00Z\", 10965.08, 10978.38, ...],\n            [\"Y9999\", \"2018-05-14T00:00:00Z\", 10938.3, 10970.24, ...]\n        ],\n        \"columns\": [\n            {\"name\": \"code\", \"type\": \"string\"},\n            {\"name\": \"mdate\", \"type\": \"date\"},\n            ...\n        ]\n    }\n}\n</code></pre>"},{"location":"reference/tejtoolapi/rest-api/#2","title":"2. \u63d0\u793a","text":"<p>Tip</p> <p>\u60a8\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u700f\u89bd\u5668(Browser)\u4f86\u53d6\u5f97\u8cc7\u6599\uff0c\u4e5f\u53ef\u4ee5\u900f\u904e\u5de5\u5177\u7a0b\u5f0f\uff08\u4f8b\u5982 curl\u3001wget \u7b49\uff09\u9032\u884c\u5b58\u53d6\u3002</p> <p>Note</p> <p>\u8a73\u7d30\u7684 API \u53c3\u6578\u8aaa\u660e\u548c\u66f4\u591a\u7bc4\u4f8b\uff0c\u8acb\u53c3\u8003\u5b98\u65b9 REST API \u6587\u4ef6</p>"},{"location":"reference/zipline/assets/","title":"Zipline API \u53c3\u8003\uff1aAsset \u7269\u4ef6","text":"<p>Info</p> <p>\u672c\u9801\u8aaa\u660e Zipline \u4e2d Asset\uff08\u8cc7\u7522\uff09\u7269\u4ef6\u7684\u6838\u5fc3\u6982\u5ff5\uff0c\u5305\u542b\u80a1\u7968 (Equity) \u8207\u671f\u8ca8 (Future) \u5169\u7a2e\u985e\u578b\u7684\u5c6c\u6027\u8207\u4f7f\u7528\u65b9\u5f0f\u3002</p>"},{"location":"reference/zipline/assets/#1","title":"1. \u6838\u5fc3\u6982\u5ff5","text":"<p>\u5728 Zipline \u4e2d\uff0cAsset\uff08\u8cc7\u7522\uff09 \u7269\u4ef6\u662f\u4efb\u4f55\u53ef\u4ea4\u6613\u91d1\u878d\u5de5\u5177\uff08\u5982\u80a1\u7968\u3001\u671f\u8ca8\uff09\u7684\u552f\u4e00\u6a19\u8b58\u3002\u6bcf\u500b Asset \u7269\u4ef6\u90fd\u5305\u542b\u8a72\u91d1\u878d\u5de5\u5177\u7684\u5143\u6578\u64da\uff0c\u4f8b\u5982\u4ee3\u78bc\u3001\u4ea4\u6613\u6240\u3001\u5230\u671f\u65e5\u7b49\u3002</p> <p>\u5728 TQuant Lab \u7684\u74b0\u5883\u4e2d\uff0c\u60a8\u6700\u5e38\u63a5\u89f8\u5230\u7684 Asset \u4e3b\u8981\u6709\u5169\u7a2e\u985e\u578b\uff1a</p> <ol> <li><code>Equity</code>\uff1a\u4ee3\u8868\u80a1\u7968\u3002</li> <li><code>Future</code>\uff1a\u4ee3\u8868\u671f\u8ca8\u5408\u7d04\u3002</li> </ol>"},{"location":"reference/zipline/assets/#2-equity","title":"2. \u80a1\u7968 (Equity)","text":"<p><code>Equity</code> \u7269\u4ef6\u4ee3\u8868\u55ae\u4e00\u4e00\u652f\u80a1\u7968\uff0c\u4f8b\u5982\u53f0\u7a4d\u96fb (2330)\u3002</p>"},{"location":"reference/zipline/assets/#21-equity","title":"2.1 \u5982\u4f55\u53d6\u5f97 <code>Equity</code> \u7269\u4ef6","text":"<p>\u5728 Zipline API \u4e2d\uff0c\u6700\u5e38\u7528 <code>symbol()</code> \u51fd\u6578\u4f86\u900f\u904e\u80a1\u7968\u4ee3\u78bc\u53d6\u5f97 <code>Equity</code> \u7269\u4ef6\u3002</p> <pre><code>from zipline.api import symbol\n\n# \u53d6\u5f97\u53f0\u7a4d\u96fb (2330) \u7684 Asset \u7269\u4ef6\nasset_tsmc = symbol('2330')\n\n# \u53d6\u5f97\u5927\u76e4\u6307\u6578 (\u7528\u65bc benchmark)\nasset_benchmark = symbol('IR0001')\n</code></pre>"},{"location":"reference/zipline/assets/#22","title":"2.2 \u5e38\u7528\u5c6c\u6027","text":"\u5c6c\u6027 (<code>attribute</code>) \u63cf\u8ff0 \u7bc4\u4f8b <code>sid</code> \u7cfb\u7d71\u5167\u90e8\u552f\u4e00\u7684\u8b49\u5238 ID (Security ID) <code>2317</code> <code>symbol</code> \u80a1\u7968\u4ee3\u78bc <code>'2330'</code> <code>asset_name</code> \u80a1\u7968\u540d\u7a31 <code>'TAIWAN SEMICONDUCTOR MANUFACTURING'</code> <code>exchange</code> \u4ea4\u6613\u6240\u540d\u7a31 <code>'XTAI'</code> (\u53f0\u7063\u8b49\u5238\u4ea4\u6613\u6240)"},{"location":"reference/zipline/assets/#3-future","title":"3. \u671f\u8ca8 (Future)","text":"<p>\u671f\u8ca8\u8cc7\u7522\u5728 Zipline \u4e2d\u6709\u5169\u7a2e\u4e3b\u8981\u5f62\u5f0f\uff1a\u4ee3\u8868\u7279\u5b9a\u6708\u4efd\u7684 <code>Future</code> \u7269\u4ef6\uff0c\u4ee5\u53ca\u7528\u65bc\u5206\u6790\u548c\u4ea4\u6613\u7684 <code>ContinuousFuture</code> \u7269\u4ef6\u3002</p>"},{"location":"reference/zipline/assets/#31-the-future-object","title":"3.1 \u5177\u9ad4\u5408\u7d04 (The <code>Future</code> Object)","text":"<p><code>Future</code> \u7269\u4ef6\u4ee3\u8868\u4e00\u500b \u5177\u9ad4\u7684\u3001\u6709\u5230\u671f\u65e5 \u7684\u671f\u8ca8\u5408\u7d04\uff0c\u4f8b\u5982\u300c2024\u5e7410\u6708\u4efd\u7684\u53f0\u6307\u671f\u8ca8\u5408\u7d04\u300d\u3002\u5728\u4e0b\u55ae\u6216\u67e5\u8a62\u7279\u5b9a\u5408\u7d04\u7684\u6301\u5009\u6642\uff0c\u60a8\u64cd\u4f5c\u7684\u5c0d\u8c61\u5c31\u662f\u9019\u500b\u7269\u4ef6\u3002</p>"},{"location":"reference/zipline/assets/#311","title":"3.1.1 \u5982\u4f55\u53d6\u5f97","text":"<p>\u60a8\u901a\u5e38**\u4e0d\u6703**\u76f4\u63a5\u5efa\u7acb <code>Future</code> \u7269\u4ef6\uff0c\u800c\u662f\u900f\u904e <code>ContinuousFuture</code> \u7269\u4ef6\u5728\u7279\u5b9a\u7684\u4ea4\u6613\u65e5\u67e5\u8a62\u7576\u4e0b\u61c9\u8a72\u4ea4\u6613\u7684\u5408\u7d04\u3002</p> <pre><code># \u5047\u8a2d context.future \u662f\u4e00\u500b\u9023\u7e8c\u5408\u7d04\u7269\u4ef6\n# \u53d6\u5f97\u4eca\u5929\u7684\u5177\u9ad4\u5408\u7d04\ncurrent_contract = data.current(context.future, 'contract')\n</code></pre>"},{"location":"reference/zipline/assets/#312","title":"3.1.2 \u5e38\u7528\u5c6c\u6027","text":"\u5c6c\u6027 (<code>attribute</code>) \u63cf\u8ff0 \u7bc4\u4f8b <code>sid</code> \u7cfb\u7d71\u5167\u90e8\u552f\u4e00\u7684\u5408\u7d04 ID <code>12345</code> <code>symbol</code> \u5408\u7d04\u7684\u4ee3\u78bc <code>'TXF2410'</code> <code>root_symbol</code> \u8a72\u5408\u7d04\u7684\u6839\u4ee3\u78bc\uff0c\u4ee3\u8868\u5176\u6a19\u7684\u5546\u54c1 <code>'TX'</code> <code>start_date</code> \u8a72\u5408\u7d04\u7684\u8d77\u59cb\u4ea4\u6613\u65e5 <code>pd.Timestamp(...)</code> <code>auto_close_date</code> (\u975e\u5e38\u91cd\u8981) \u8a72\u5408\u7d04\u7684\u6700\u5f8c\u4ea4\u6613\u65e5/\u5230\u671f\u7d50\u7b97\u65e5 <code>pd.Timestamp(...)</code> <code>exchange</code> \u4ea4\u6613\u6240\u540d\u7a31 <code>'XTFX'</code> (\u53f0\u7063\u671f\u8ca8\u4ea4\u6613\u6240)"},{"location":"reference/zipline/assets/#32-the-continuousfuture-object","title":"3.2 \u9023\u7e8c\u5408\u7d04 (The ContinuousFuture Object)","text":"<p><code>ContinuousFuture</code> \u662f\u4e00\u500b \u8f14\u52a9\u6027 \u7684\u7269\u4ef6\uff0c\u5b83\u672c\u8eab\u4e0d\u80fd\u88ab\u76f4\u63a5\u4ea4\u6613\u3002\u5b83\u7684\u4f5c\u7528\u662f\u5c07\u4e00\u7cfb\u5217\u6709\u5230\u671f\u65e5\u7684\u7368\u7acb\u671f\u8ca8\u5408\u7d04\uff08\u5982\u53f0\u630709\u3001\u53f0\u630710\u3001\u53f0\u630711...\uff09\u4e32\u63a5\u6210\u4e00\u500b\u6c92\u6709\u5230\u671f\u65e5\u7684\u300c\u9023\u7e8c\u5408\u7d04\u300d\u3002</p> <p>\u9019\u8b93\u60a8\u53ef\u4ee5\u5c0d\u4e00\u500b\u9023\u7e8c\u7684\u50f9\u683c\u5e8f\u5217\u9032\u884c\u6280\u8853\u5206\u6790\uff0c\u800c Zipline \u6703\u5728\u80cc\u666f\u81ea\u52d5\u8655\u7406\u63db\u6708\uff0c\u60a8\u7121\u9700\u624b\u52d5\u7ba1\u7406\u3002</p>"},{"location":"reference/zipline/assets/#321","title":"3.2.1 \u5982\u4f55\u53d6\u5f97","text":"<p>\u4f7f\u7528 <code>continuous_future()</code> \u51fd\u6578\u4f86\u5efa\u7acb\u3002</p> <pre><code>from zipline.api import continuous_future\n\n# \u5efa\u7acb\u4e00\u500b\u4ee3\u8868\u53f0\u6307\u671f\u8fd1\u6708\u5408\u7d04\u7684\u9023\u7e8c\u5408\u7d04\u7269\u4ef6\nfuture_tx = continuous_future(\n    root_symbol='TX',      # \u6839\u4ee3\u78bc\n    offset=0,              # 0 \u4ee3\u8868\u8fd1\u6708\u5408\u7d04\n    roll='calendar',       # \u4f9d\u65e5\u66c6\u63db\u6708\n    adjustment='add'       # \u50f9\u683c\u8abf\u6574\u65b9\u5f0f\n)\n</code></pre>"},{"location":"reference/zipline/assets/#4","title":"4. \u5728\u7b56\u7565\u4e2d\u61c9\u7528","text":"<p>\u5728\u5be6\u969b\u7b56\u7565\u4e2d\uff0c\u60a8\u6703\u900f\u904e <code>context.portfolio.positions</code> \u4f86\u5b58\u53d6\u60a8\u6301\u6709\u7684\u6240\u6709 Asset \u7269\u4ef6\u3002\u60a8\u53ef\u4ee5\u900f\u904e\u6aa2\u67e5\u7269\u4ef6\u7684\u985e\u578b\u4f86\u5224\u65b7\u5b83\u662f\u80a1\u7968\u9084\u662f\u671f\u8ca8\uff0c\u4e26\u57f7\u884c\u76f8\u61c9\u7684\u64cd\u4f5c\u3002</p> <pre><code>from zipline.assets import Equity, Future\n\ndef daily_trade(context, data):\n\n    # \u904d\u6b77\u60a8\u6295\u8cc7\u7d44\u5408\u4e2d\u7684\u6bcf\u4e00\u500b\u90e8\u4f4d\n    for asset, position in context.portfolio.positions.items():\n\n        # \u6aa2\u67e5\u8cc7\u7522\u985e\u578b\n        if isinstance(asset, Equity):\n            # --- \u9019\u662f\u80a1\u7968 --- \n            print(f\"\u6301\u6709\u7684\u80a1\u7968: {asset.symbol}, \u80a1\u6578: {position.amount}\")\n\n        elif isinstance(asset, Future):\n            # --- \u9019\u662f\u671f\u8ca8 --- \n            print(f\"\u6301\u6709\u7684\u671f\u8ca8\u5408\u7d04: {asset.symbol}\")\n            print(f\"  - \u6839\u4ee3\u78bc: {asset.root_symbol}\")\n            print(f\"  - \u5230\u671f\u65e5: {asset.auto_close_date.date()}\")\n            print(f\"  - \u6301\u6709\u53e3\u6578: {position.amount}\")\n</code></pre>"},{"location":"reference/zipline/context/","title":"Zipline \u56de\u6e2c\u4e2d\u7684 context \u7269\u4ef6","text":"<p>Info</p> <p>\u672c\u9801\u6df1\u5165\u4ecb\u7d39 Zipline \u56de\u6e2c\u4e2d\u7684 <code>context</code> \u7269\u4ef6\uff0c\u5305\u62ec\u5176\u6838\u5fc3\u4f5c\u7528\u3001\u4e3b\u8981\u5167\u5efa\u5c6c\u6027\u3001\u81ea\u5b9a\u7fa9\u5c6c\u6027\u4ee5\u53ca\u5b8c\u6574\u7bc4\u4f8b\uff0c\u5e6b\u52a9\u4f7f\u7528\u8005\u7406\u89e3\u5982\u4f55\u5132\u5b58\u548c\u50b3\u905e\u7b56\u7565\u72c0\u614b\u8cc7\u8a0a\u3002</p> <p>\u5728 Zipline \u7684\u4e8b\u4ef6\u9a45\u52d5\u56de\u6e2c\u6846\u67b6\u4e2d\uff0c<code>context</code> \u7269\u4ef6\u662f\u7b56\u7565\u7684\u6838\u5fc3\u3002\u5b83\u5728\u6574\u500b\u56de\u6e2c\u904e\u7a0b\u4e2d\u6301\u7e8c\u5b58\u5728\uff0c\u4e26\u5728 <code>initialize()</code>\u3001<code>before_trading_start()</code>\u3001<code>handle_data()</code> \u548c <code>analyze()</code> \u7b49\u751f\u547d\u9031\u671f\u51fd\u6578\u4e4b\u9593\u50b3\u905e\u7b56\u7565\u7684\u72c0\u614b\u8cc7\u8a0a\u3002\u900f\u904e <code>context</code>\uff0c\u60a8\u53ef\u4ee5\u5b58\u53d6\u6295\u8cc7\u7d44\u5408\u7684\u7576\u524d\u72c0\u614b\u3001\u8a18\u9304\u4ea4\u6613\u8cc7\u8a0a\uff0c\u4ee5\u53ca\u5132\u5b58\u4efb\u4f55\u81ea\u5b9a\u7fa9\u7684\u7b56\u7565\u8b8a\u6578\u3002</p>"},{"location":"reference/zipline/context/#1-context","title":"1. context \u7c21\u4ecb","text":"<p><code>context</code> \u5c31\u50cf\u4e00\u500b\u5c08\u5c6c\u65bc\u60a8\u7b56\u7565\u7684\u5132\u7269\u6ac3\uff0c\u5b83\uff1a *   \u6301\u4e45\u6027: \u4e00\u65e6\u5728 <code>initialize()</code> \u4e2d\u8a2d\u5b9a\uff0c<code>context</code> \u7684\u5167\u5bb9\u5c31\u6703\u5728\u6574\u500b\u56de\u6e2c\u671f\u9593\u4fdd\u6301\u4e0d\u8b8a\uff0c\u9664\u975e\u60a8\u660e\u78ba\u4fee\u6539\u5b83\u3002 *   \u53ef\u8b8a\u6027: \u60a8\u53ef\u4ee5\u5728\u56de\u6e2c\u7684\u4efb\u4f55\u968e\u6bb5\u8b80\u53d6\u6216\u4fee\u6539 <code>context</code> \u7684\u5c6c\u6027\u3002 *   \u5168\u5c40\u6027: \u5b83\u662f\u7b56\u7565\u4e2d\u6240\u6709\u751f\u547d\u9031\u671f\u51fd\u6578\u5171\u4eab\u7684\u552f\u4e00\u72c0\u614b\u5bb9\u5668\u3002</p>"},{"location":"reference/zipline/context/#2-context","title":"2. context \u7684\u4e3b\u8981\u5167\u5efa\u5c6c\u6027","text":"<p><code>context</code> \u7269\u4ef6\u5167\u7f6e\u4e86\u5e7e\u500b\u91cd\u8981\u7684\u5c6c\u6027\uff0c\u63d0\u4f9b\u4e86\u95dc\u65bc\u6295\u8cc7\u7d44\u5408\u548c\u56de\u6e2c\u74b0\u5883\u7684\u5be6\u6642\u8cc7\u8a0a\u3002</p>"},{"location":"reference/zipline/context/#21-contextportfolio","title":"2.1. context.portfolio\uff1a\u6295\u8cc7\u7d44\u5408\u72c0\u614b","text":"<p><code>context.portfolio</code> \u662f\u4e00\u500b\u975e\u5e38\u91cd\u8981\u7684\u5c6c\u6027\uff0c\u5b83\u63d0\u4f9b\u4e86\u7576\u524d\u6295\u8cc7\u7d44\u5408\u7684\u8a73\u7d30\u60c5\u6cc1\u3002</p> <ul> <li><code>context.portfolio.cash</code>: \u7576\u524d\u53ef\u7528\u7684\u73fe\u91d1\u9918\u984d\u3002</li> <li><code>context.portfolio.positions</code>: \u4e00\u500b\u5b57\u5178\u578b\u7269\u4ef6\uff0c\u9375\u70ba\u8cc7\u7522\u7269\u4ef6\uff0c\u503c\u70ba <code>Position</code> \u7269\u4ef6\uff0c\u5305\u542b\u4e86\u60a8\u76ee\u524d\u6301\u6709\u7684\u6240\u6709\u8cc7\u7522\u53ca\u5176\u8a73\u7d30\u8cc7\u8a0a\uff08\u4f8b\u5982\u6301\u80a1\u6578\u91cf <code>amount</code>\uff09\u3002<ul> <li><code>context.portfolio.positions[asset].amount</code>: \u7372\u53d6\u7279\u5b9a\u8cc7\u7522\u7684\u6301\u80a1\u6578\u91cf\u3002</li> <li><code>context.portfolio.positions.keys()</code>: \u7372\u53d6\u4e00\u500b\u5217\u8868\uff0c\u5305\u542b\u6240\u6709\u76ee\u524d\u6301\u6709\u7684\u8cc7\u7522\u7269\u4ef6\u3002</li> </ul> </li> <li><code>context.portfolio.portfolio_value</code>: \u6295\u8cc7\u7d44\u5408\u7684\u7576\u524d\u7e3d\u5e02\u503c\uff08\u73fe\u91d1 + \u6301\u80a1\u50f9\u503c\uff09\u3002</li> <li><code>context.portfolio.positions_value</code>: \u6240\u6709\u6301\u80a1\u7684\u7576\u524d\u7e3d\u5e02\u503c\u3002</li> </ul>"},{"location":"reference/zipline/context/#_1","title":"\u7bc4\u4f8b","text":"<pre><code>def handle_data(context, data):\n    # \u6aa2\u67e5\u662f\u5426\u6709\u8db3\u5920\u7684\u73fe\u91d1\u4f86\u4e0b\u55ae\n    if context.portfolio.cash &gt; 10000:\n        # ... \u57f7\u884c\u8cb7\u5165\u64cd\u4f5c ...\n        pass\n\n    # \u904d\u6b77\u6240\u6709\u6301\u6709\u7684\u90e8\u4f4d\n    for asset, position in context.portfolio.positions.items():\n        print(f\"\u6301\u6709 {asset.symbol} \u80a1\u6578: {position.amount}, \u7576\u524d\u5e02\u503c: {position.last_sale_price * position.amount}\")\n\n    # \u6253\u5370\u6295\u8cc7\u7d44\u5408\u7e3d\u50f9\u503c\n    print(f\"\u6295\u8cc7\u7d44\u5408\u7e3d\u50f9\u503c: {context.portfolio.portfolio_value}\")\n</code></pre>"},{"location":"reference/zipline/context/#22-contextblotter","title":"2.2. context.blotter\uff1a\u4ea4\u6613\u8a18\u9304\u5668","text":"<p><code>context.blotter</code> \u7269\u4ef6\u63d0\u4f9b\u4e86\u5c0d\u4ea4\u6613\u6b77\u53f2\u548c\u672a\u5b8c\u6210\u8a02\u55ae\u7684\u8a2a\u554f\u4ecb\u9762\u3002\u5118\u7ba1\u5728\u4e00\u822c\u7684\u7b56\u7565\u7bc4\u4f8b\u4e2d\u4e0d\u5e38\u7528\uff0c\u4f46\u5c0d\u65bc\u9700\u8981\u7cbe\u7d30\u63a7\u5236\u8a02\u55ae\u72c0\u614b\u6216\u5206\u6790\u6b77\u53f2\u4ea4\u6613\u7684\u9032\u968e\u7b56\u7565\u975e\u5e38\u6709\u7528\u3002</p> <ul> <li><code>context.blotter.open_orders</code>: \u7372\u53d6\u4e00\u500b\u5b57\u5178\uff0c\u5305\u542b\u6240\u6709\u5c1a\u672a\u5b8c\u5168\u6210\u4ea4\u7684\u8a02\u55ae\u3002</li> </ul>"},{"location":"reference/zipline/context/#23-contextasset_finder","title":"2.3. context.asset_finder\uff1a\u8cc7\u7522\u67e5\u627e\u5668","text":"<p><code>context.asset_finder</code> \u662f\u4e00\u500b\u7528\u65bc\u6839\u64da\u7b26\u865f (symbol)\u3001SID (Zipline ID) \u6216\u5176\u4ed6\u5c6c\u6027\u67e5\u627e\u8cc7\u7522\u7269\u4ef6\u7684\u5de5\u5177\u3002\u5728\u5927\u591a\u6578\u60c5\u6cc1\u4e0b\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>zipline.api.symbol()</code> \u6216 <code>asset_finder.lookup_symbol()</code> \u4f86\u7372\u53d6\u8cc7\u7522\u7269\u4ef6\u3002</p>"},{"location":"reference/zipline/context/#3-custom-attributes","title":"3. \u81ea\u5b9a\u7fa9\u5c6c\u6027 (Custom Attributes)","text":"<p>\u60a8\u53ef\u4ee5\u5728 <code>initialize()</code> \u51fd\u6578\u4e2d\u70ba <code>context</code> \u7269\u4ef6\u6dfb\u52a0\u4efb\u610f\u81ea\u5b9a\u7fa9\u5c6c\u6027\uff0c\u4ee5\u4fbf\u5728\u56de\u6e2c\u7684\u5f8c\u7e8c\u968e\u6bb5\uff08\u5982 <code>handle_data()</code>\uff09\u4e2d\u5b58\u5132\u548c\u6aa2\u7d22\u7b56\u7565\u7684\u5167\u90e8\u72c0\u614b\u6216\u984d\u5916\u6578\u64da\u3002</p>"},{"location":"reference/zipline/context/#_2","title":"\u7bc4\u4f8b","text":"<pre><code>def initialize(context):\n    context.my_flag = False          # \u5132\u5b58\u5e03\u6797\u503c\n    context.counter = 0              # \u5132\u5b58\u6574\u6578\u8a08\u6578\u5668\n    context.stock_list = []          # \u5132\u5b58\u80a1\u7968\u5217\u8868\n    context.my_data_dict = {}        # \u5132\u5b58\u5b57\u5178\n\ndef handle_data(context, data):\n    if not context.my_flag:\n        print(\"\u9019\u662f\u7b2c\u4e00\u6b21\u9032\u5165 handle_data\uff01\")\n        context.my_flag = True # \u4fee\u6539\u81ea\u5b9a\u7fa9\u5c6c\u6027\n\n    context.counter += 1\n    if context.counter % 10 == 0:\n        print(f\"\u5df2\u904b\u884c {context.counter} \u6b21 handle_data\u3002\")\n</code></pre>"},{"location":"reference/zipline/context/#4","title":"4. \u5b8c\u6574\u7bc4\u4f8b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u500b\u5b8c\u6574\u7684\u7bc4\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u5728 <code>initialize()</code> \u4e2d\u8a2d\u5b9a <code>context</code>\uff0c\u4e26\u5728 <code>handle_data()</code> \u4e2d\u4f7f\u7528\u5176\u5167\u5efa\u548c\u81ea\u5b9a\u7fa9\u5c6c\u6027\u3002</p> <pre><code>import pandas as pd\nfrom zipline import run_algorithm\nfrom zipline.api import symbol, order_target_percent, record, set_benchmark\n\ndef initialize(context):\n    context.my_asset = symbol('2330') # \u8a2d\u5b9a\u4e00\u500b\u8981\u4ea4\u6613\u7684\u8cc7\u7522\n    context.has_ordered = False       # \u81ea\u5b9a\u7fa9\u65d7\u6a19\uff0c\u8ffd\u8e64\u662f\u5426\u5df2\u4e0b\u55ae\n    context.trade_count = 0           # \u81ea\u5b9a\u7fa9\u8a08\u6578\u5668\n    set_benchmark(symbol('IR0001'))   # \u8a2d\u5b9a Benchmark\n\ndef handle_data(context, data):\n    # \u6aa2\u67e5\u662f\u5426\u5df2\u4e0b\u55ae\n    if not context.has_ordered:\n        # \u4f7f\u7528 context.portfolio.cash \u6aa2\u67e5\u662f\u5426\u6709\u8db3\u5920\u73fe\u91d1\n        if context.portfolio.cash &gt; data.current(context.my_asset, 'price') * 100: # \u5047\u8a2d\u8cb7100\u80a1\n            order_target_percent(context.my_asset, 1.0) # \u5168\u5009\u8cb7\u5165\n            context.has_ordered = True\n            context.trade_count += 1\n            print(f\"\u8cb7\u5165 {context.my_asset.symbol}\uff0c\u73fe\u91d1\u9918\u984d: {context.portfolio.cash}\")\n\n    # \u5728\u6bcf\u9694\u4e00\u6bb5\u6642\u9593\u5f8c\u6253\u5370\u6301\u5009\u4fe1\u606f\n    context.trade_count += 1\n    if context.trade_count % 50 == 0:\n        if context.my_asset in context.portfolio.positions:\n            pos = context.portfolio.positions[context.my_asset]\n            print(f\"\u65e5\u671f: {data.current_dt.date()} \u6301\u6709 {pos.asset.symbol} \u80a1\u6578: {pos.amount}\")\n        print(f\"\u6295\u8cc7\u7d44\u5408\u7e3d\u50f9\u503c: {context.portfolio.portfolio_value}\")\n\ndef analyze(context, results):\n    # \u6b64\u8655\u53ef\u4ee5\u5229\u7528 context \u9032\u884c\u5206\u6790\uff0c\u4f8b\u5982\u6253\u5370\u6700\u7d42\u7684 trade_count\n    print(f\"\u7e3d\u4ea4\u6613\u6b21\u6578: {context.trade_count}\")\n    print(f\"\u6700\u7d42\u6295\u8cc7\u7d44\u5408\u50f9\u503c: {results.iloc[-1]['portfolio_value']}\")\n\n# \u57f7\u884c\u56de\u6e2c\nresults = run_algorithm(\n    start=pd.Timestamp('2022-01-01', tz='UTC'),\n    end=pd.Timestamp('2023-01-01', tz='UTC'),\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=1_000_000,\n    bundle='tquant'\n)\n</code></pre>"},{"location":"reference/zipline/data-object/","title":"Zipline \u8cc7\u6599\u7269\u4ef6\u4ecb\u7d39","text":"<p>Info</p> <p>\u672c\u9801\u4ecb\u7d39 Zipline \u4e2d\u5e38\u898b\u7684\u5167\u5efa\u8cc7\u6599\u7269\u4ef6\uff0c\u5305\u62ec <code>context</code>\u3001<code>data</code>\u3001<code>pipeline_output()</code>\u3001<code>record()</code> \u7b49\uff0c\u4e26\u8aaa\u660e\u5176\u7528\u9014\u548c\u4f7f\u7528\u65b9\u5f0f\uff0c\u5e6b\u52a9\u4f7f\u7528\u8005\u7406\u89e3\u5982\u4f55\u5b58\u53d6\u548c\u7ba1\u7406\u56de\u6e2c\u4e2d\u7684\u6578\u64da\u3002</p> <p>\u5728 Zipline \u4e2d\uff0c\u6709\u591a\u7a2e\u5167\u5efa\u8cc7\u6599\u7269\u4ef6\u53ef\u4f9b\u6f14\u7b97\u6cd5\u5b58\u53d6\u8cc7\u6599\u8207\u8ffd\u8e64\u8b8a\u6578\u3002\u5e38\u898b\u7684\u8cc7\u6599\u7269\u4ef6\u5305\u62ec <code>context</code>\u3001<code>data</code>\u3001<code>pipeline_output()</code>\u3001<code>record()</code>\u3001<code>get_bundle_price()</code>\u3001<code>portfolio</code>\u3001<code>account</code> \u53ca <code>get_open_orders()</code> \u7b49\uff0c\u4ee5\u4e0b\u5c07\u9010\u4e00\u4ecb\u7d39\u5176\u7528\u9014\u8207\u4f7f\u7528\u65b9\u5f0f\u3002</p>"},{"location":"reference/zipline/data-object/#1-context","title":"1. context \u7269\u4ef6","text":"<p><code>context</code> \u662f Zipline \u7b56\u7565\u7684\u6838\u5fc3\uff0c\u7528\u4f86\u5132\u5b58\u7b56\u7565\u57f7\u884c\u904e\u7a0b\u4e2d\u7684\u72c0\u614b\u8207\u8b8a\u6578\uff0c\u8b93\u4f60\u5728\u4e0d\u540c\u7684\u51fd\u6578\uff08\u5982 <code>initialize</code>\u3001<code>before_trading_start</code>\u3001<code>handle_data</code>\uff09\u4e2d\u90fd\u80fd\u5b58\u53d6\u8207\u5171\u4eab\u8cc7\u6599\u3002\u4f8b\u5982\u4f60\u53ef\u4ee5\u5728 <code>initialize()</code> \u4e2d\u5b9a\u7fa9\u6295\u8cc7\u6a19\u7684\u6e05\u55ae\u8207\u53c3\u6578\uff0c\u4e26\u65bc\u5f8c\u7e8c\u7b56\u7565\u57f7\u884c\u4e2d\u6301\u7e8c\u4f7f\u7528\uff1a</p> <pre><code>def initialize(context):\n    context.stocklist = ['2330', '2317']\n    context.max_leverage = 1.0\n</code></pre>"},{"location":"reference/zipline/data-object/#2-data","title":"2. data \u7269\u4ef6","text":"<p><code>data</code> \u63d0\u4f9b\u6bcf\u65e5\u5e02\u5834\u8cc7\u6599\uff0c\u5305\u542b\u5831\u50f9\uff08<code>price</code>\uff09\u3001\u6210\u4ea4\u91cf\uff08<code>volume</code>\uff09\u3001\u662f\u5426\u53ef\u4ea4\u6613\uff08<code>can_trade</code>\uff09\u7b49\u8cc7\u8a0a\u3002\u5e38\u898b\u7528\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>def handle_data(context, data):\n    price = data.current(symbol(\"2330\"), 'price')\n    volume = data.current(symbol(\"2330\"), 'volume')\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u900f\u904e\uff1a</p> <pre><code>data.can_trade(symbol(\"2330\"))\n</code></pre> <p>\u4f86\u78ba\u8a8d\u67d0\u80a1\u7968\u7576\u65e5\u662f\u5426\u53ef\u4ee5\u9032\u884c\u4ea4\u6613\uff08\u5982\u672a\u505c\u724c\u3001\u6d41\u52d5\u6027\u8db3\u5920\u7b49\uff09\u3002</p>"},{"location":"reference/zipline/data-object/#3-pipeline_output","title":"3. pipeline_output()","text":"<p>\u82e5\u4f60\u6709\u5efa\u7acb Pipeline \u7528\u4f86\u9032\u884c\u689d\u4ef6\u7be9\u9078\u6216\u56e0\u5b50\u8a08\u7b97\uff0c\u53ef\u4ee5\u900f\u904e <code>pipeline_output()</code> \u4f86\u53d6\u5f97\u7d50\u679c\u3002\u5b83\u6703\u56de\u50b3\u4e00\u500b DataFrame\uff0c\u5305\u542b\u901a\u904e\u689d\u4ef6\u7684\u6a19\u7684\u8207\u5c0d\u61c9\u7684\u6b04\u4f4d\u6578\u503c\u3002</p> <pre><code>def before_trading_start(context, data):\n    context.output = pipeline_output('my_pipeline')\n</code></pre> <p>\u9019\u4e9b\u7d50\u679c\u53ef\u7528\u4f86\u8a2d\u5b9a\u6bcf\u65e5\u7684\u6295\u8cc7\u6e05\u55ae\uff0c\u642d\u914d\u76ee\u6a19\u6b0a\u91cd\u9032\u884c\u518d\u5e73\u8861\u3002</p>"},{"location":"reference/zipline/data-object/#4-record","title":"4. record()","text":"<p><code>record()</code> \u53ef\u7528\u4f86\u5728\u56de\u6e2c\u904e\u7a0b\u4e2d\u8a18\u9304\u91cd\u8981\u8b8a\u6578\uff0c\u4f8b\u5982\u69d3\u687f\u6bd4\u7387\u3001\u73fe\u91d1\u6c34\u4f4d\u3001\u6295\u8cc7\u5831\u916c\u7b49\uff0c\u4e4b\u5f8c\u53ef\u7522\u88fd\u5716\u8868\u9032\u884c\u8996\u89ba\u5316\u5206\u6790\u3002</p> <pre><code>def handle_data(context, data):\n    record(leverage=context.account.leverage, cash=context.portfolio.cash)\n</code></pre> <p>\u8a18\u9304\u7684\u8b8a\u6578\u6703\u5728\u56de\u6e2c\u5b8c\u6210\u5f8c\uff0c\u81ea\u52d5\u986f\u793a\u65bc\u5716\u8868\u4e2d\u3002</p>"},{"location":"reference/zipline/data-object/#5-get_bundle_price","title":"5. get_bundle_price()","text":"<p><code>get_bundle_price()</code> \u662f TEJ \u5c08\u5c6c\u7684 Zipline \u64f4\u5145\u51fd\u6578\uff0c\u7528\u4f86\u8b80\u53d6\u67d0\u6bb5\u671f\u9593\u5167\u7684\u80a1\u7968\u6b77\u53f2\u8cc7\u6599\uff0c\u4e26\u4ee5 DataFrame \u7684\u5f62\u5f0f\u8f38\u51fa\uff0c\u9069\u5408\u7528\u65bc\u5206\u6790\u6216\u4f5c\u70ba\u5916\u90e8\u8f38\u5165\u8cc7\u6599\u3002</p> <pre><code>from zipline.data.data_portal import get_bundle_price\n\ndf = get_bundle_price(\n    bundle_name='tej_bundle',\n    calendar_name='XTAI',\n    start_dt='2020-01-01',\n    end_dt='2020-12-31'\n)\n</code></pre> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u9019\u4efd\u8cc7\u6599\u505a\u70ba\u56de\u6e2c\u57fa\u790e\uff0c\u4e5f\u53ef\u4ee5\u642d\u914d TA-Lib \u6216\u81ea\u88fd\u56e0\u5b50\u9032\u884c\u8a08\u7b97\u3002</p>"},{"location":"reference/zipline/data-object/#6-portfolio","title":"6. portfolio \u7269\u4ef6","text":"<p><code>context.portfolio</code> \u63d0\u4f9b\u7576\u524d\u6295\u8cc7\u7d44\u5408\u7684\u7e3d\u89bd\u8cc7\u8a0a\uff0c\u5305\u542b\u7e3d\u8cc7\u7522\u3001\u73fe\u91d1\u9918\u984d\u3001\u6bcf\u6a94\u80a1\u7968\u7684\u6301\u80a1\u72c0\u6cc1\u7b49\uff0c\u662f\u76e3\u63a7\u90e8\u4f4d\u8207\u4e0b\u55ae\u908f\u8f2f\u7684\u91cd\u8981\u4f9d\u64da\u3002</p> <p>\u5e38\u898b\u5c6c\u6027\u5305\u62ec\uff1a</p> <ul> <li><code>portfolio.cash</code>\uff1a\u76ee\u524d\u6301\u6709\u7684\u73fe\u91d1</li> <li><code>portfolio.positions</code>\uff1a\u6bcf\u6a94\u6301\u80a1\u8cc7\u8a0a\uff08\u5305\u542b\u80a1\u6578\u3001\u6210\u672c\u3001\u6700\u65b0\u5e02\u503c\uff09</li> <li><code>portfolio.positions[symbol(\"2330\")].amount</code>\uff1a\u67d0\u6a94\u80a1\u7968\u7684\u6301\u80a1\u6578\u91cf</li> <li><code>portfolio.positions[symbol(\"2330\")].cost_basis</code>\uff1a\u8a72\u6a94\u80a1\u7968\u7684\u5e73\u5747\u6210\u672c</li> </ul> <pre><code>def handle_data(context, data):\n    cash = context.portfolio.cash\n    amount = context.portfolio.positions[symbol(\"2330\")].amount\n</code></pre>"},{"location":"reference/zipline/data-object/#7-account","title":"7. account \u7269\u4ef6","text":"<p><code>context.account</code> \u662f Zipline \u63d0\u4f9b\u7684\u5e33\u6236\u5c64\u7d1a\u8cc7\u8a0a\uff0c\u4e3b\u8981\u7528\u4f86\u8ffd\u8e64\u69d3\u687f\u4f7f\u7528\u3001\u6de8\u503c\u7b49\u7b56\u7565\u7e3d\u9ad4\u8ca1\u52d9\u72c0\u6cc1\u3002</p> <p>\u5e38\u898b\u5c6c\u6027\u5305\u62ec\uff1a</p> <ul> <li><code>account.leverage</code>\uff1a\u7576\u524d\u69d3\u687f\u6bd4\u7387</li> <li><code>account.net_leverage</code>\uff1a\u8003\u616e\u7a7a\u982d\u5f8c\u7684\u6de8\u69d3\u687f</li> <li><code>account.portfolio_value</code>\uff1a\u6574\u9ad4\u6295\u8cc7\u7d44\u5408\u50f9\u503c\uff08\u542b\u80a1\u7968\u8207\u73fe\u91d1\uff09</li> </ul> <pre><code>def handle_data(context, data):\n    record(leverage=context.account.leverage)\n</code></pre>"},{"location":"reference/zipline/data-object/#8-get_open_orders","title":"8. get_open_orders()","text":"<p><code>get_open_orders()</code> \u662f Zipline \u63d0\u4f9b\u7684\u67e5\u8a62\u51fd\u6578\uff0c\u53ef\u7528\u4f86\u6aa2\u8996\u76ee\u524d\u6709\u54ea\u4e9b\u639b\u55ae\u5c1a\u672a\u6210\u4ea4\uff08\u5982\u9650\u50f9\u55ae\u3001\u505c\u640d\u55ae\u7b49\uff09\u3002</p> <pre><code>open_orders = get_open_orders()\n</code></pre> <p>\u4f60\u4e5f\u53ef\u4ee5\u6307\u5b9a\u67d0\u4e00\u6a94\u80a1\u7968\u9032\u884c\u67e5\u8a62\uff1a</p> <pre><code>open_orders_tsmc = get_open_orders(symbol(\"2330\"))\n</code></pre> <p>\u56de\u50b3\u5167\u5bb9\u70ba dictionary \u683c\u5f0f\uff1a</p> <ul> <li>key \u70ba\u8cc7\u7522\uff08\u5982 <code>symbol(\"2330\")</code>\uff09</li> <li>value \u70ba\u8a72\u8cc7\u7522\u7684\u639b\u55ae\u5217\u8868</li> </ul> <p>\u901a\u5e38\u642d\u914d <code>cancel_order()</code> \u4f7f\u7528\uff0c\u53ef\u5728\u7279\u5b9a\u908f\u8f2f\u689d\u4ef6\u4e0b\u81ea\u52d5\u53d6\u6d88\u672a\u6210\u4ea4\u639b\u55ae\u3002</p>"},{"location":"reference/zipline/lifecycle-functions/","title":"Zipline \u56de\u6e2c\u751f\u547d\u9031\u671f\u51fd\u6578\u53c3\u8003","text":"<p>Info</p> <p>\u672c\u9801\u8a73\u7d30\u8aaa\u660e Zipline \u56de\u6e2c\u7684\u751f\u547d\u9031\u671f\u51fd\u6578\uff0c\u5305\u62ec <code>initialize()</code>\u3001<code>before_trading_start()</code>\u3001<code>handle_data()</code> \u548c <code>analyze()</code> \u7684\u7528\u9014\u3001\u57f7\u884c\u6642\u6a5f\u548c\u5e38\u898b\u64cd\u4f5c\uff0c\u5e6b\u52a9\u4f7f\u7528\u8005\u7de8\u5beb\u6709\u6548\u7684 Zipline \u7b56\u7565\u3002</p> <p>Zipline \u662f\u4e00\u500b\u4e8b\u4ef6\u9a45\u52d5\u7684\u56de\u6e2c\u6846\u67b6\uff0c\u5b83\u900f\u904e\u4e00\u7cfb\u5217\u5b9a\u7fa9\u597d\u7684\u751f\u547d\u9031\u671f\u51fd\u6578\u4f86\u57f7\u884c\u4ea4\u6613\u7b56\u7565\u3002\u7406\u89e3\u9019\u4e9b\u51fd\u6578\u7684\u7528\u9014\u548c\u57f7\u884c\u6642\u6a5f\uff0c\u5c0d\u65bc\u7de8\u5beb\u6709\u6548\u7684 Zipline \u7b56\u7565\u81f3\u95dc\u91cd\u8981\u3002</p> <p>\u672c\u6587\u4ef6\u5c07\u8a73\u7d30\u8aaa\u660e <code>initialize()</code>\u3001<code>before_trading_start()</code>\u3001<code>handle_data()</code> \u548c <code>analyze()</code> \u9019\u56db\u500b\u6838\u5fc3\u51fd\u6578\u3002</p>"},{"location":"reference/zipline/lifecycle-functions/#1-initializecontext","title":"1. initialize(context)","text":"<ul> <li>\u7528\u9014: \u7b56\u7565\u57f7\u884c\u524d\u7684\u521d\u59cb\u5316\u8a2d\u5b9a\u3002</li> <li>\u57f7\u884c\u6642\u6a5f: \u5728\u56de\u6e2c\u958b\u59cb\u6642\u50c5\u57f7\u884c \u4e00\u6b21\u3002</li> <li>\u53c3\u6578:<ul> <li><code>context</code>: \u4e00\u500b <code>dict</code> \u822c\u7684\u7269\u4ef6\uff0c\u7528\u65bc\u5728\u56de\u6e2c\u671f\u9593\u5132\u5b58\u548c\u50b3\u905e\u7b56\u7565\u7684\u72c0\u614b\u8cc7\u8a0a\u3002\u60a8\u53ef\u4ee5\u5728 <code>context</code> \u4e2d\u5b9a\u7fa9\u4efb\u4f55\u81ea\u5b9a\u7fa9\u8b8a\u6578\u3002</li> </ul> </li> </ul>"},{"location":"reference/zipline/lifecycle-functions/#11","title":"1.1\u5e38\u898b\u64cd\u4f5c","text":"<ul> <li>\u8a2d\u5b9a Benchmark: \u4f7f\u7528 <code>set_benchmark()</code>\u3002</li> <li>\u8a2d\u5b9a\u4ea4\u6613\u6210\u672c: \u4f7f\u7528 <code>set_commission()</code> \u548c <code>set_slippage()</code>\u3002</li> <li>\u8a2d\u5b9a\u4ea4\u6613\u63a7\u5236: \u4f7f\u7528 <code>set_max_leverage()</code> \u7b49\u3002</li> <li>\u9644\u639b Pipeline: \u4f7f\u7528 <code>attach_pipeline()</code>\u3002</li> <li>\u521d\u59cb\u5316\u81ea\u5b9a\u7fa9\u8b8a\u6578: \u4f8b\u5982 <code>context.has_ordered = False</code>\u3002</li> <li>\u8a2d\u5b9a\u6392\u7a0b\u51fd\u6578: \u4f7f\u7528 <code>schedule_function()</code>\u3002</li> </ul>"},{"location":"reference/zipline/lifecycle-functions/#12","title":"1.2\u7bc4\u4f8b","text":"<pre><code>from zipline.api import set_benchmark, symbol, set_commission, set_slippage, attach_pipeline\nfrom zipline.finance import commission, slippage\nfrom zipline.pipeline import Pipeline\nfrom zipline.pipeline.factors import SimpleMovingAverage\nfrom zipline.pipeline.data import EquityPricing\n\ndef make_my_pipeline():\n    # \u9019\u88e1\u5b9a\u7fa9\u4e00\u500b\u7c21\u55ae\u7684 Pipeline\n    return Pipeline(columns={'SMA': SimpleMovingAverage(inputs=[EquityPricing.close], window_length=20)})\n\ndef initialize(context):\n    context.my_stock = symbol('2330')\n    set_benchmark(symbol('IR0001')) # \u8a2d\u5b9aBenchmark\n    set_commission(equities=commission.PerDollar(cost=0.001)) # \u8a2d\u5b9a\u624b\u7e8c\u8cbb\n    set_slippage(equities=slippage.VolumeShareSlippage(volume_limit=0.025, price_impact=0.1)) # \u8a2d\u5b9a\u6ed1\u50f9\n    attach_pipeline(make_my_pipeline(), 'my_strategy_pipeline') # \u9644\u639b Pipeline\n    context.trading_signal_triggered = False # \u521d\u59cb\u5316\u81ea\u5b9a\u7fa9\u8b8a\u6578\n</code></pre>"},{"location":"reference/zipline/lifecycle-functions/#2-before_trading_startcontext-data","title":"2. before_trading_start(context, data)","text":"<ul> <li>\u7528\u9014: \u6bcf\u65e5\u76e4\u524d\u6578\u64da\u6e96\u5099\u548c\u6c7a\u7b56\u3002</li> <li>\u57f7\u884c\u6642\u6a5f: \u6bcf\u500b\u4ea4\u6613\u65e5 \u958b\u76e4\u524d \u57f7\u884c\u4e00\u6b21\uff0c\u5728 <code>handle_data()</code> \u4e4b\u524d\u3002</li> <li>\u53c3\u6578:<ul> <li><code>context</code>: \u7b56\u7565\u72c0\u614b\u7269\u4ef6\u3002</li> <li><code>data</code>: \u6578\u64da\u7269\u4ef6\uff0c\u63d0\u4f9b\u7576\u524d\u65e5\u671f\u4e4b\u524d\u6240\u6709\u53ef\u7528\u7684\u6b77\u53f2\u6578\u64da\u3002</li> </ul> </li> </ul>"},{"location":"reference/zipline/lifecycle-functions/#21","title":"2.1\u5e38\u898b\u64cd\u4f5c","text":"<ul> <li>\u6578\u64da\u9810\u8655\u7406: \u7372\u53d6\u6700\u65b0\u7684\u6b77\u53f2\u6578\u64da\u6216\u8a08\u7b97\u76e4\u524d\u6307\u6a19\u3002</li> <li>\u66f4\u65b0\u8cc7\u7522\u6c60 (Universe): \u57fa\u65bc\u76e4\u524d\u4fe1\u606f\u7be9\u9078\u51fa\u7576\u65e5\u8981\u95dc\u6ce8\u7684\u80a1\u7968\u3002</li> <li>\u6aa2\u7d22 Pipeline \u8f38\u51fa: \u7372\u53d6 Pipeline \u5728\u524d\u4e00\u4ea4\u6613\u65e5\u8a08\u7b97\u51fa\u7684\u56e0\u5b50\u503c\u6216\u4fe1\u865f\uff0c\u4e26\u5132\u5b58\u5230 <code>context</code> \u4e2d\uff0c\u4f9b <code>handle_data()</code> \u4f7f\u7528\u3002</li> </ul> <p>Important</p> <p><code>before_trading_start()</code> \u51fd\u6578 \u4e0d\u80fd \u7528\u65bc\u4e0b\u9054\u4ea4\u6613\u8a02\u55ae\u3002\u8a02\u55ae\u5fc5\u9808\u5728\u5e02\u5834\u958b\u653e\u6642\u9593\u5167\uff0c\u901a\u5e38\u5728 <code>handle_data()</code> \u4e2d\u57f7\u884c\u3002</p>"},{"location":"reference/zipline/lifecycle-functions/#22","title":"2.2\u7bc4\u4f8b","text":"<pre><code>from zipline.api import pipeline_output\n\ndef before_trading_start(context, data):\n    # \u7372\u53d6 Pipeline \u5728\u524d\u4e00\u4ea4\u6613\u65e5\u8a08\u7b97\u7684\u7d50\u679c\uff0c\u4e26\u5b58\u5132\u5230 context \u4e2d\n    context.pipeline_data = pipeline_output('my_strategy_pipeline')\n    # \u53ef\u4ee5\u9032\u884c\u4e00\u4e9b\u76e4\u524d\u6578\u64da\u7684\u7be9\u9078\u6216\u8655\u7406\n    if not context.pipeline_data.empty:\n        context.today_factors = context.pipeline_data['SMA']\n    else:\n        context.today_factors = None\n</code></pre>"},{"location":"reference/zipline/lifecycle-functions/#3-handle_datacontext-data","title":"3. handle_data(context, data)","text":"<ul> <li>\u7528\u9014: \u57f7\u884c\u6838\u5fc3\u4ea4\u6613\u908f\u8f2f\u3002</li> <li>\u57f7\u884c\u6642\u6a5f: \u5728\u56de\u6e2c\u7684\u6bcf\u500b\u6642\u9593\u55ae\u4f4d\uff08\u4f8b\u5982\uff0c\u6bcf\u65e5\u6216\u6bcf\u5206\u9418\uff09\u90fd\u6703\u88ab\u547c\u53eb\u3002</li> <li>\u53c3\u6578:<ul> <li><code>context</code>: \u7b56\u7565\u72c0\u614b\u7269\u4ef6\u3002</li> <li><code>data</code>: \u6578\u64da\u7269\u4ef6\uff0c\u63d0\u4f9b\u7576\u524d\u6642\u9593\u9ede\u53ef\u7528\u7684\u5e02\u5834\u6578\u64da\uff08\u4f8b\u5982\uff0c\u6700\u65b0\u50f9\u683c\u3001\u6210\u4ea4\u91cf\uff09\u3002</li> </ul> </li> </ul>"},{"location":"reference/zipline/lifecycle-functions/#31","title":"3.1\u5e38\u898b\u64cd\u4f5c","text":"<ul> <li>\u7372\u53d6\u5e02\u5834\u6578\u64da: \u4f7f\u7528 <code>data.current()</code> \u6216 <code>data.history()</code> \u7372\u53d6\u7576\u524d\u6216\u6b77\u53f2\u7684\u50f9\u683c\u3001\u6210\u4ea4\u91cf\u7b49\u4fe1\u606f\u3002</li> <li>\u8a08\u7b97\u4ea4\u6613\u4fe1\u865f: \u6839\u64da\u6280\u8853\u6307\u6a19\u3001\u56e0\u5b50\u503c\u6216\u5176\u4ed6\u908f\u8f2f\u5224\u65b7\u8cb7\u8ce3\u6642\u6a5f\u3002</li> <li>\u4e0b\u9054\u8a02\u55ae: \u4f7f\u7528 <code>order()</code>, <code>order_target()</code>, <code>order_percent()</code>, <code>order_target_percent()</code> \u7b49\u51fd\u6578\u57f7\u884c\u4ea4\u6613\u3002</li> <li>\u8a18\u9304\u6578\u64da: \u4f7f\u7528 <code>record()</code> \u51fd\u6578\u8a18\u9304\u60a8\u60f3\u8981\u5728\u56de\u6e2c\u7d50\u679c\u4e2d\u8ffd\u8e64\u7684\u6578\u64da\u3002</li> </ul>"},{"location":"reference/zipline/lifecycle-functions/#32","title":"3.2\u7bc4\u4f8b","text":"<pre><code>from zipline.api import order_target_percent\n\ndef handle_data(context, data):\n    # \u6aa2\u67e5\u662f\u5426\u6709 Pipeline \u6578\u64da\u53ef\u7528\n    if context.today_factors is None or context.my_stock not in context.today_factors.index:\n        return\n\n    current_sma = context.today_factors.loc[context.my_stock]\n    current_price = data.current(context.my_stock, 'price')\n\n    # \u7c21\u55ae\u7684\u5747\u7dda\u7a81\u7834\u7b56\u7565\uff1a\u5982\u679c\u80a1\u50f9\u9ad8\u65bc\u5747\u7dda\uff0c\u5247\u5168\u5009\u8cb7\u5165\n    if current_price &gt; current_sma and not context.trading_signal_triggered:\n        order_target_percent(context.my_stock, 1.0) # \u5168\u5009\u8cb7\u5165\n        context.trading_signal_triggered = True\n    # \u5982\u679c\u80a1\u50f9\u4f4e\u65bc\u5747\u7dda\uff0c\u4e14\u5df2\u6301\u6709\uff0c\u5247\u6e05\u5009\n    elif current_price &lt; current_sma and context.my_stock in context.portfolio.positions:\n        order_target_percent(context.my_stock, 0.0) # \u6e05\u5009\n        context.trading_signal_triggered = False\n\n    # \u8a18\u9304\u6578\u64da (\u4f8b\u5982\u80a1\u50f9\u548c\u5747\u7dda\uff0c\u65b9\u4fbf\u5206\u6790)\n    record(price=current_price, sma=current_sma)\n</code></pre>"},{"location":"reference/zipline/lifecycle-functions/#4-analyzecontext-results","title":"4. analyze(context, results)","text":"<ul> <li>\u7528\u9014: \u56de\u6e2c\u7d50\u675f\u5f8c\u7684\u7e3e\u6548\u5206\u6790\u548c\u8996\u89ba\u5316\u3002</li> <li>\u57f7\u884c\u6642\u6a5f: \u5728\u6574\u500b\u56de\u6e2c\u6d41\u7a0b\u5b8c\u6210\u5f8c\u50c5\u57f7\u884c \u4e00\u6b21\u3002</li> <li>\u53c3\u6578:<ul> <li><code>context</code>: \u7b56\u7565\u72c0\u614b\u7269\u4ef6 (\u8207 <code>initialize</code> \u548c <code>handle_data</code> \u4e2d\u7684 <code>context</code> \u76f8\u540c)\u3002</li> <li><code>results</code>: \u4e00\u500b <code>pandas.DataFrame</code>\uff0c\u5305\u542b\u4e86\u56de\u6e2c\u671f\u9593\u6bcf\u65e5\u7684\u7e3e\u6548\u6578\u64da (\u4f8b\u5982\uff0c\u5831\u916c\u7387\u3001\u8cc7\u91d1\u66f2\u7dda\u3001\u6700\u5927\u56de\u64a4\u7b49)\u3002</li> </ul> </li> </ul>"},{"location":"reference/zipline/lifecycle-functions/#41","title":"4.1\u5e38\u898b\u64cd\u4f5c","text":"<ul> <li>\u4f7f\u7528 Pyfolio \u7522\u751f Tearsheet: \u5c07 <code>results</code> \u6578\u64da\u50b3\u905e\u7d66 Pyfolio\uff0c\u751f\u6210\u6a19\u6e96\u7684\u7e3e\u6548\u5206\u6790\u5831\u8868\u3002</li> <li>\u81ea\u5b9a\u7fa9\u5716\u8868\u7e6a\u88fd: \u4f7f\u7528 Matplotlib \u6216 Seaborn \u7b49\u5eab\u7e6a\u88fd\u81ea\u5b9a\u7fa9\u7684\u7e3e\u6548\u5716\u8868\u3002</li> <li>\u8a08\u7b97\u81ea\u5b9a\u7fa9\u6307\u6a19: \u5f9e <code>results</code> \u4e2d\u63d0\u53d6\u6578\u64da\uff0c\u8a08\u7b97\u7b56\u7565\u7279\u6709\u7684\u6307\u6a19\u3002</li> </ul>"},{"location":"reference/zipline/lifecycle-functions/#42","title":"4.2\u7bc4\u4f8b","text":"<pre><code>import matplotlib.pyplot as plt\nimport pyfolio\nfrom pyfolio.utils import extract_rets_pos_txn_from_zipline\n\ndef analyze(context, results):\n    # \u7e6a\u88fd\u6295\u8cc7\u7d44\u5408\u50f9\u503c\u66f2\u7dda\n    results['portfolio_value'].plot(figsize=(10, 6))\n    plt.title('Portfolio Value Over Time')\n    plt.xlabel('Date')\n    plt.ylabel('Portfolio Value')\n    plt.grid(True)\n    plt.show()\n\n    # \u4f7f\u7528 Pyfolio \u751f\u6210\u7e3e\u6548\u5831\u8868\n    returns, positions, transactions = extract_rets_pos_txn_from_zipline(results)\n    benchmark_rets = results.benchmark_return # \u5047\u8a2d benchmark_return \u5b58\u5728\u65bc results \u4e2d\n\n    # \u6642\u5340\u6a19\u6e96\u5316 (\u70ba Pyfolio \u6e96\u5099)\n    returns.index = returns.index.tz_localize(None).tz_localize('UTC')\n    positions.index = positions.index.tz_localize(None).tz_localize('UTC')\n    transactions.index = transactions.index.tz_localize(None).tz_localize('UTC')\n    benchmark_rets.index = benchmark_rets.index.tz_localize(None).tz_localize('UTC')\n\n    pyfolio.tears.create_full_tear_sheet(\n        returns=returns,\n        positions=positions,\n        transactions=transactions,\n        benchmark_rets=benchmark_rets\n    )\n    plt.show() # \u78ba\u4fdd Pyfolio \u7684\u5716\u8868\u986f\u793a\n</code></pre>"},{"location":"reference/zipline/orders/","title":"Zipline \u4e0b\u55ae\u51fd\u6578\u53c3\u8003","text":"<p>Info</p> <p>\u672c\u9801\u8a73\u7d30\u8aaa\u660e Zipline \u4e2d\u7684\u4e0b\u55ae\u51fd\u6578\uff0c\u5305\u62ec <code>order()</code>\u3001<code>order_target()</code>\u3001<code>order_percent()</code> \u7b49\u7684\u7528\u9014\u3001\u53c3\u6578\u548c\u4f7f\u7528\u7bc4\u4f8b\uff0c\u5e6b\u52a9\u4f7f\u7528\u8005\u5c07\u7b56\u7565\u4fe1\u865f\u8f49\u5316\u70ba\u5be6\u969b\u4ea4\u6613\u884c\u70ba\u3002</p> <p>\u5728 Zipline \u56de\u6e2c\u4e2d\uff0c\u4e0b\u55ae\u662f\u5c07\u7b56\u7565\u4fe1\u865f\u8f49\u5316\u70ba\u5be6\u969b\u4ea4\u6613\u884c\u70ba\u7684\u95dc\u9375\u74b0\u7bc0\u3002Zipline \u63d0\u4f9b\u4e86\u591a\u7a2e\u4e0b\u55ae\u51fd\u6578\uff0c\u4ee5\u61c9\u5c0d\u4e0d\u540c\u7b56\u7565\u908f\u8f2f\u548c\u98a8\u96aa\u7ba1\u7406\u9700\u6c42\u3002\u9019\u4e9b\u51fd\u6578\u4e3b\u8981\u7522\u751f \u5e02\u50f9\u55ae\uff0c\u4e26\u5728\u6bcf\u500b <code>handle_data()</code> \u547c\u53eb\u7684\u672b\u5c3e\u9032\u884c\u64ae\u5408\u3002</p> <p>\u7406\u89e3\u4e0d\u540c\u4e0b\u55ae\u51fd\u6578\u7684\u7279\u6027\uff0c\u5c0d\u65bc\u7cbe\u78ba\u6a21\u64ec\u7b56\u7565\u884c\u70ba\u548c\u907f\u514d\u610f\u5916\u7684\u4ea4\u6613\u7d50\u679c\u81f3\u95dc\u91cd\u8981\u3002</p>"},{"location":"reference/zipline/orders/#1","title":"1. \u4e0b\u55ae\u51fd\u6578\u7c21\u4ecb","text":"<p>Zipline \u7684\u4e0b\u55ae\u51fd\u6578\u901a\u5e38\u5728 <code>handle_data()</code> \u4e2d\u88ab\u547c\u53eb\uff0c\u5b83\u5011\u6703\u5411\u56de\u6e2c\u5f15\u64ce\u767c\u9001\u4ea4\u6613\u6307\u4ee4\u3002Zipline \u7684\u6838\u5fc3\u8a2d\u8a08\u662f\u8655\u7406 \u5e02\u50f9\u55ae\uff0c\u5373\u5047\u8a2d\u8a02\u55ae\u6703\u4ee5\u7576\u524d\u5e02\u5834\u50f9\u683c\u6210\u4ea4\u3002</p> <p>Zipline \u7684\u4e0b\u55ae\u51fd\u6578\u53ef\u4ee5\u5206\u70ba\u5169\u5927\u985e\uff1a *   \u76f4\u63a5\u4e0b\u55ae: \u6839\u64da\u6307\u5b9a\u7684\u80a1\u6578\u3001\u767e\u5206\u6bd4\u6216\u91d1\u984d\u76f4\u63a5\u767c\u51fa\u8cb7\u5165\u6216\u8ce3\u51fa\u8a02\u55ae\u3002 *   \u76ee\u6a19\u4e0b\u55ae: \u6839\u64da\u6307\u5b9a\u7684\u76ee\u6a19\u80a1\u6578\u3001\u76ee\u6a19\u767e\u5206\u6bd4\u6216\u76ee\u6a19\u91d1\u984d\uff0c\u7531 Zipline \u81ea\u52d5\u8a08\u7b97\u6240\u9700\u8cb7\u8ce3\u7684\u6578\u91cf\u4ee5\u9054\u5230\u76ee\u6a19\u3002\u9019\u7a2e\u65b9\u5f0f\u5728\u7b56\u7565\u9700\u8981\u518d\u5e73\u8861\u6216\u8abf\u6574\u6301\u5009\u6642\u7279\u5225\u6709\u7528\u3002</p> <p>Note</p> <p>\u6839\u64da Zipline \u7248\u672c 2.1.0 \u7684\u66f4\u65b0\uff0c<code>order_value()</code>\u3001<code>order_target_value()</code>\u3001<code>order_percent()</code> \u548c <code>order_target_percent()</code> \u51fd\u6578\u5728\u8a08\u7b97\u6578\u91cf\u548c\u76ee\u6a19\u91d1\u984d\u6642\uff0c\u6703\u57fa\u65bc \u7576\u524d\u4ea4\u6613\u50f9\u683c\uff08\u800c\u975e\u524d\u4e00\u65e5\u7684\u6536\u76e4\u50f9\uff09\uff0c\u9019\u6709\u52a9\u65bc\u66f4\u7cbe\u78ba\u5730\u6a21\u64ec\u5728\u591a\u8b8a\u5e02\u5834\u689d\u4ef6\u4e0b\u7684\u4ea4\u6613\u3002</p>"},{"location":"reference/zipline/orders/#2-ziplineapiorder","title":"2. zipline.api.order()\uff1a\u76f4\u63a5\u4e0b\u55ae\u6307\u5b9a\u80a1\u6578","text":"<p><code>zipline.api.order()</code> \u51fd\u6578\u7528\u65bc\u76f4\u63a5\u8cb7\u5165\u6216\u8ce3\u51fa\u6307\u5b9a\u6578\u91cf\u7684\u80a1\u7968\u3002</p> <ul> <li>\u7528\u9014: \u76f4\u63a5\u4e0b\u9054\u8cb7\u5165 (<code>amount &gt; 0</code>) \u6216\u8ce3\u51fa (<code>amount &lt; 0</code>) \u6307\u5b9a\u80a1\u6578\u7684\u5e02\u50f9\u55ae\u3002</li> <li>\u53c3\u6578:<ul> <li><code>asset</code>: (Asset) \u6b32\u4ea4\u6613\u7684\u8cc7\u7522\u7269\u4ef6\u3002</li> <li><code>amount</code>: (int) \u6b32\u4ea4\u6613\u7684\u80a1\u6578\u3002\u6b63\u6578\u8868\u793a\u8cb7\u5165\uff0c\u8ca0\u6578\u8868\u793a\u8ce3\u51fa\u3002</li> </ul> </li> </ul>"},{"location":"reference/zipline/orders/#_1","title":"\u7bc4\u4f8b","text":"<pre><code>from zipline.api import order, symbol\n\ndef handle_data(context, data):\n    my_stock = symbol('2330')\n\n    # \u8cb7\u5165 1000 \u80a1\u53f0\u7a4d\u96fb\n    order(my_stock, 1000) \n\n    # \u8ce3\u51fa 500 \u80a1\u53f0\u7a4d\u96fb\n    order(my_stock, -500)\n</code></pre>"},{"location":"reference/zipline/orders/#3-ziplineapiorder_target","title":"3. zipline.api.order_target()\uff1a\u4ea4\u6613\u5230\u76ee\u6a19\u80a1\u6578","text":"<p><code>zipline.api.order_target()</code> \u51fd\u6578\u6703\u8a08\u7b97\u7576\u524d\u6301\u80a1\u8207\u76ee\u6a19\u80a1\u6578\u4e4b\u9593\u7684\u5dee\u984d\uff0c\u7136\u5f8c\u4e0b\u9054\u76f8\u61c9\u7684\u8cb7\u8ce3\u8a02\u55ae\uff0c\u4f7f\u8a72\u8cc7\u7522\u7684\u7e3d\u6301\u80a1\u6578\u91cf\u9054\u5230\u6307\u5b9a\u7684\u76ee\u6a19\u3002</p> <ul> <li>\u7528\u9014: \u8abf\u6574\u8cc7\u7522\u7684\u6301\u80a1\u6578\u91cf\u5230\u6307\u5b9a\u76ee\u6a19\u3002</li> <li>\u53c3\u6578:<ul> <li><code>asset</code>: (Asset) \u6b32\u4ea4\u6613\u7684\u8cc7\u7522\u7269\u4ef6\u3002</li> <li><code>target_amount</code>: (int) \u8a72\u8cc7\u7522\u7684\u76ee\u6a19\u7e3d\u6301\u80a1\u6578\u91cf\u3002</li> </ul> </li> </ul>"},{"location":"reference/zipline/orders/#_2","title":"\u7bc4\u4f8b","text":"<pre><code>from zipline.api import order_target, symbol\n\ndef handle_data(context, data):\n    my_stock = symbol('2330')\n\n    # \u5c07\u53f0\u7a4d\u96fb\u7684\u6301\u80a1\u6578\u91cf\u8abf\u6574\u5230 2000 \u80a1\n    order_target(my_stock, 2000)\n\n    # \u6e05\u7a7a\u53f0\u7a4d\u96fb\u7684\u6301\u80a1\uff08\u5c07\u6301\u80a1\u6578\u91cf\u8abf\u6574\u5230 0\uff09\n    order_target(my_stock, 0)\n</code></pre>"},{"location":"reference/zipline/orders/#4-ziplineapiorder_percent","title":"4. zipline.api.order_percent()\uff1a\u6309\u6295\u8cc7\u7d44\u5408\u767e\u5206\u6bd4\u4e0b\u55ae","text":"<p><code>zipline.api.order_percent()</code> \u51fd\u6578\u6703\u8a08\u7b97\u7576\u524d\u6295\u8cc7\u7d44\u5408\u7e3d\u50f9\u503c\u7684\u4e00\u500b\u767e\u5206\u6bd4\uff0c\u7136\u5f8c\u5c07\u9019\u500b\u91d1\u984d\u8f49\u63db\u70ba\u80a1\u6578\uff0c\u4e26\u4e0b\u9054\u8cb7\u8ce3\u8a02\u55ae\u3002</p> <ul> <li>\u7528\u9014: \u6309\u6295\u8cc7\u7d44\u5408\u7e3d\u50f9\u503c\u7684\u4e00\u500b\u767e\u5206\u6bd4 (<code>percent</code>) \u4e0b\u55ae\u3002</li> <li>\u53c3\u6578:<ul> <li><code>asset</code>: (Asset) \u6b32\u4ea4\u6613\u7684\u8cc7\u7522\u7269\u4ef6\u3002</li> <li><code>percent</code>: (float) \u4f54\u6295\u8cc7\u7d44\u5408\u7e3d\u50f9\u503c\u7684\u767e\u5206\u6bd4\uff08\u4ee5\u5c0f\u6578\u8868\u793a\uff0c\u4f8b\u5982 <code>0.1</code> \u4ee3\u8868 10%\uff09\u3002\u6b63\u6578\u70ba\u8cb7\u5165\uff0c\u8ca0\u6578\u70ba\u8ce3\u51fa\u3002</li> </ul> </li> </ul>"},{"location":"reference/zipline/orders/#_3","title":"\u7bc4\u4f8b","text":"<pre><code>from zipline.api import order_percent, symbol\n\ndef handle_data(context, data):\n    my_stock = symbol('2330')\n\n    # \u5c07\u6295\u8cc7\u7d44\u5408\u7e3d\u50f9\u503c\u7684 10% \u7528\u65bc\u8cb7\u5165\u53f0\u7a4d\u96fb\n    order_percent(my_stock, 0.1)\n\n    # \u8ce3\u51fa\u6295\u8cc7\u7d44\u5408\u7e3d\u50f9\u503c\u7684 5% \u7684\u53f0\u7a4d\u96fb\n    order_percent(my_stock, -0.05)\n</code></pre>"},{"location":"reference/zipline/orders/#5-ziplineapiorder_target_percent","title":"5. zipline.api.order_target_percent()\uff1a\u4ea4\u6613\u5230\u76ee\u6a19\u6295\u8cc7\u7d44\u5408\u767e\u5206\u6bd4","text":"<p><code>zipline.api.order_target_percent()</code> \u51fd\u6578\u6703\u8a08\u7b97\u6240\u9700\u7684\u4ea4\u6613\u91cf\uff0c\u4f7f\u8a72\u8cc7\u7522\u5728\u6295\u8cc7\u7d44\u5408\u4e2d\u7684\u6b0a\u91cd\u9054\u5230\u6307\u5b9a\u7684\u76ee\u6a19\u767e\u5206\u6bd4\u3002\u9019\u662f\u6700\u5e38\u7528\u65bc\u518d\u5e73\u8861\u7b56\u7565\u7684\u51fd\u6578\u4e4b\u4e00\u3002</p> <ul> <li>\u7528\u9014: \u8abf\u6574\u8cc7\u7522\u5728\u6295\u8cc7\u7d44\u5408\u4e2d\u7684\u6b0a\u91cd\u5230\u6307\u5b9a\u76ee\u6a19\u767e\u5206\u6bd4\u3002</li> <li>\u53c3\u6578:<ul> <li><code>asset</code>: (Asset) \u6b32\u4ea4\u6613\u7684\u8cc7\u7522\u7269\u4ef6\u3002</li> <li><code>target_percent</code>: (float) \u8a72\u8cc7\u7522\u5728\u6295\u8cc7\u7d44\u5408\u4e2d\u7684\u76ee\u6a19\u6b0a\u91cd\u767e\u5206\u6bd4\u3002</li> </ul> </li> </ul>"},{"location":"reference/zipline/orders/#_4","title":"\u7bc4\u4f8b","text":"<pre><code>from zipline.api import order_target_percent, symbol\n\ndef handle_data(context, data):\n    my_stock = symbol('2330')\n\n    # \u5c07\u53f0\u7a4d\u96fb\u5728\u6295\u8cc7\u7d44\u5408\u4e2d\u7684\u6b0a\u91cd\u8abf\u6574\u5230 50%\n    order_target_percent(my_stock, 0.5)\n\n    # \u6e05\u7a7a\u53f0\u7a4d\u96fb\u7684\u6301\u80a1\uff08\u5c07\u6b0a\u91cd\u8abf\u6574\u5230 0%\uff09\n    order_target_percent(my_stock, 0.0)\n</code></pre>"},{"location":"reference/zipline/orders/#6-ziplineapiorder_value","title":"6. zipline.api.order_value()\uff1a\u76f4\u63a5\u4e0b\u55ae\u6307\u5b9a\u91d1\u984d","text":"<p><code>zipline.api.order_value()</code> \u51fd\u6578\u6703\u8a08\u7b97\u8cfc\u8cb7\u6216\u51fa\u552e\u6307\u5b9a\u91d1\u984d\u8cc7\u7522\u6240\u9700\u7684\u80a1\u6578\uff0c\u7136\u5f8c\u4e0b\u9054\u5e02\u50f9\u55ae\u3002</p> <ul> <li>\u7528\u9014: \u76f4\u63a5\u4e0b\u9054\u8cb7\u5165 (<code>value &gt; 0</code>) \u6216\u8ce3\u51fa (<code>value &lt; 0</code>) \u6307\u5b9a\u91d1\u984d\u7684\u5e02\u50f9\u55ae\u3002</li> <li>\u53c3\u6578:<ul> <li><code>asset</code>: (Asset) \u6b32\u4ea4\u6613\u7684\u8cc7\u7522\u7269\u4ef6\u3002</li> <li><code>value</code>: (float) \u6b32\u4ea4\u6613\u7684\u91d1\u984d\u3002\u6b63\u6578\u8868\u793a\u8cb7\u5165\uff0c\u8ca0\u6578\u8868\u793a\u8ce3\u51fa\u3002</li> </ul> </li> </ul>"},{"location":"reference/zipline/orders/#_5","title":"\u7bc4\u4f8b","text":"<pre><code>from zipline.api import order_value, symbol\n\ndef handle_data(context, data):\n    my_stock = symbol('2330')\n\n    # \u8cb7\u5165\u50f9\u503c 10,000 \u5143\u7684\u53f0\u7a4d\u96fb\n    order_value(my_stock, 10000)\n\n    # \u8ce3\u51fa\u50f9\u503c 5,000 \u5143\u7684\u53f0\u7a4d\u96fb\n    order_value(my_stock, -5000)\n</code></pre>"},{"location":"reference/zipline/orders/#7-ziplineapiorder_target_value","title":"7. zipline.api.order_target_value()\uff1a\u4ea4\u6613\u5230\u76ee\u6a19\u91d1\u984d","text":"<p><code>zipline.api.order_target_value()</code> \u51fd\u6578\u6703\u8a08\u7b97\u6240\u9700\u7684\u4ea4\u6613\u91cf\uff0c\u4f7f\u8a72\u8cc7\u7522\u7684\u7e3d\u5e02\u503c\u9054\u5230\u6307\u5b9a\u7684\u76ee\u6a19\u91d1\u984d\u3002</p> <ul> <li>\u7528\u9014: \u8abf\u6574\u8cc7\u7522\u7684\u7e3d\u5e02\u503c\u5230\u6307\u5b9a\u76ee\u6a19\u3002</li> <li>\u53c3\u6578:<ul> <li><code>asset</code>: (Asset) \u6b32\u4ea4\u6613\u7684\u8cc7\u7522\u7269\u4ef6\u3002</li> <li><code>target_value</code>: (float) \u8a72\u8cc7\u7522\u7684\u76ee\u6a19\u7e3d\u5e02\u503c\u3002</li> </ul> </li> </ul>"},{"location":"reference/zipline/orders/#_6","title":"\u7bc4\u4f8b","text":"<pre><code>from zipline.api import order_target_value, symbol\n\ndef handle_data(context, data):\n    my_stock = symbol('2330')\n\n    # \u5c07\u53f0\u7a4d\u96fb\u7684\u6301\u80a1\u5e02\u503c\u8abf\u6574\u5230 50,000 \u5143\n    order_target_value(my_stock, 50000)\n\n    # \u6e05\u7a7a\u53f0\u7a4d\u96fb\u7684\u6301\u80a1\uff08\u5c07\u5e02\u503c\u8abf\u6574\u5230 0 \u5143\uff09\n    order_target_value(my_stock, 0)\n</code></pre>"},{"location":"reference/zipline/other-api/","title":"\u6ed1\u50f9\u6a21\u578b\u4ecb\u7d39","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b Zipline \u4e2d\u6ed1\u50f9\u6a21\u578b\u7684\u8a73\u7d30\u4ecb\u7d39\uff0c\u5305\u62ec\u6ed1\u50f9\u7684\u6982\u5ff5\u3001\u5167\u5efa\u6ed1\u50f9\u6a21\u578b\u985e\u578b\u53ca\u5176\u7528\u9014\uff0c\u5e6b\u52a9\u4f7f\u7528\u8005\u7406\u89e3\u5982\u4f55\u6a21\u64ec\u4ea4\u6613\u6210\u672c\u3002</p> <ul> <li> <p>\u4ea4\u6613\u6210\u672c\uff08transaction costs\uff09\u88ab\u5ee3\u6cdb\u8a8d\u70ba\u662f\u5f71\u97ff\u6295\u8cc7\u7e3e\u6548\u7684\u91cd\u8981\u56e0\u7d20\u3002\u5b83\u5011\u4e0d\u50c5\u5f71\u97ff\u6295\u8cc7\u7e3e\u6548\uff0c\u9084\u5f71\u97ff\u4e86\u5c07\u8cc7\u7522\u8f49\u63db\u6210\u73fe\u91d1\u7684\u96e3\u6613\u5ea6\u3002</p> </li> <li> <p>\u5728\u771f\u5be6\u4e16\u754c\u7684\u4ea4\u6613\u4e2d\u5b58\u5728\u8a31\u591a\u7a2e\u985e\u7684\u4ea4\u6613\u6210\u672c\uff0c\u5176\u4e2d\u4e00\u7a2e\u662f\u9593\u63a5\u6210\u672c\uff08indirect cost\uff09\uff0c\u9593\u63a5\u6210\u672c\u5305\u542b\u4e86\u6ed1\u50f9\uff08slippage\uff09\u3001\u6d41\u52d5\u6027\uff08liquidity\uff09\u7b49\u3002\u56e0\u70ba\u80a1\u50f9\u96a8\u6642\u90fd\u5728\u8b8a\u52d5\uff0c\u4e0b\u55ae\u6642\u7684\u4e9b\u5fae\u6642\u9593\u5dee\u4e5f\u53ef\u80fd\u9020\u6210\u9810\u671f\u7684\u50f9\u683c\u8207\u6210\u4ea4\u50f9\u6709\u843d\u5dee\uff0c\u800c\u9019\u500b\u50f9\u5dee\u5c31\u662f\u6ed1\u50f9\u3002\u6d41\u52d5\u6027\u5247\u6703\u5f71\u97ff\u4ea4\u6613\u7684\u96e3\u6613\u5ea6\uff0c\u6211\u5011\u901a\u5e38\u53ef\u4ee5\u7528\u4ea4\u6613\u91cf\u4f86\u9593\u63a5\u8a55\u4f30\u6d41\u52d5\u6027\u3002\u82e5\u80a1\u7968\u5e73\u5747\u4f86\u8aaa\u4ea4\u6613\u91cf\u9ad8\uff0c\u5247\u901a\u5e38\u4ee3\u8868\u8a72\u80a1\u7968\u6d41\u52d5\u6027\u9ad8\u3001\u53ef\u4ee5\u8fc5\u901f\u9032\u884c\u4ea4\u6613\uff0c\u540c\u6642\u6ed1\u50f9\u7684\u5f71\u97ff\u4e5f\u6703\u964d\u4f4e\u3002</p> </li> <li> <p>\u82e5\u6c92\u6709\u8003\u616e\u6ed1\u50f9\u53ca\u6d41\u52d5\u6027\u53ef\u80fd\u6703\u9ad8\u4f30\u6295\u8cc7\u7b56\u7565\u7684\u7372\u5229\uff0c\u7279\u5225\u662f\u5728\u6295\u8cc7\u7d44\u5408\u4e2d\u6709\u6210\u4ea4\u91cf\u8f03\u4f4e\uff08\u6d41\u52d5\u6027\u5dee\uff09\u7684\u80a1\u7968\u3001\u8cc7\u91d1\u91cf\uff08capital base\uff09\u5927\u6216\u904e\u5ea6\u96c6\u4e2d\u4ea4\u6613\u55ae\u4e00\u500b\u80a1\u6642\uff0c\u5f71\u97ff\u6703\u66f4\u70ba\u660e\u986f\u3002\u9019\u4e5f\u662f\u56de\u6e2c\uff08backtesting\uff09\u7684\u4e00\u5927\u76ee\u7684\uff0c\u8003\u91cf\u6295\u8cc7\u7b56\u7565\u5728\u771f\u5be6\u4e16\u754c\u904b\u884c\u7684\u53ef\u80fd\u6027\u3002</p> </li> </ul>"},{"location":"reference/zipline/other-api/#1-set_slippage","title":"1. set_slippage() \u51fd\u6578","text":"<p><code>zipline.api.set_slippage()</code> \u7528\u65bc\u8a2d\u5b9a\u56de\u6e2c\u6642\u6240\u4f7f\u7528\u7684\u6ed1\u50f9\u6a21\u578b\u3002</p>"},{"location":"reference/zipline/other-api/#_2","title":"\u53c3\u6578","text":"<ul> <li> <p><code>equities</code> (<code>EquitySlippageModel</code>, optional)</p> <ul> <li>\u7528\u65bc\u4ea4\u6613\u80a1\u7968\u7684\u6ed1\u50f9\u6a21\u578b\u3002</li> <li><code>EquitySlippageModel</code>: <code>zipline.finance.slippage</code></li> </ul> </li> <li> <p><code>futures</code> (<code>FutureSlippageModel</code>, optional)</p> <ul> <li>\u7528\u65bc\u4ea4\u6613\u671f\u8ca8\u7684\u6ed1\u50f9\u6a21\u578b\u3002\uff08\u76ee\u524d\u4e0d\u652f\u63f4\uff09</li> <li><code>FutureSlippageModel</code>: <code>zipline.finance.slippage</code></li> </ul> </li> </ul>"},{"location":"reference/zipline/other-api/#raises","title":"\u932f\u8aa4 (Raises)","text":"<ul> <li><code>SetSlippagePostInit</code><ul> <li><code>slippage</code> \u53ea\u80fd\u5728 <code>initialize</code> \u968e\u6bb5\u4f7f\u7528\u3002</li> </ul> </li> </ul>"},{"location":"reference/zipline/other-api/#notes","title":"\u6ce8\u610f\u4e8b\u9805 (Notes)","text":"<ul> <li><code>set_slippage</code> \u53ea\u80fd\u4e00\u6b21\u7528\u4e00\u7a2e\u65b9\u6cd5\u3002</li> </ul>"},{"location":"reference/zipline/other-api/#_3","title":"\u5167\u5efa\u6ed1\u50f9\u6a21\u578b","text":"<ul> <li><code>zipline.finance.slippage.FixedSlippage</code></li> <li><code>zipline.finance.slippage.VolumeShareSlippage</code></li> <li><code>zipline.finance.slippage.FixedBasisPointsSlippage</code></li> </ul>"},{"location":"reference/zipline/other-api/#_4","title":"\u7bc4\u4f8b","text":"<pre><code>from zipline.api import set_slippage\nfrom zipline.finance import slippage\n\ndef initialize(context):\n    set_slippage(slippage.&lt;\u5176\u4e2d\u4e00\u7a2e slippage models&gt;)\n</code></pre>"},{"location":"reference/zipline/scheduling-functions/","title":"Zipline \u6392\u7a0b\u51fd\u6578\u53c3\u8003","text":"<p>Info</p> <p>\u672c\u9801\u8a73\u7d30\u8aaa\u660e Zipline \u6392\u7a0b\u51fd\u6578\uff0c\u5305\u62ec <code>schedule_function()</code> \u7684\u7528\u6cd5\u3001\u65e5\u671f\u898f\u5247 (<code>date_rules</code>) \u548c\u6642\u9593\u898f\u5247 (<code>time_rules</code>) \u7684\u8a2d\u5b9a\uff0c\u5e6b\u52a9\u4f7f\u7528\u8005\u7cbe\u78ba\u63a7\u5236\u56de\u6e2c\u4efb\u52d9\u7684\u57f7\u884c\u6642\u6a5f\u3002</p> <p>\u5728 Zipline \u56de\u6e2c\u4e2d\uff0c\u7b56\u7565\u901a\u5e38\u9700\u8981\u5b9a\u671f\u57f7\u884c\u67d0\u4e9b\u4efb\u52d9\uff0c\u4f8b\u5982 \u6bcf\u65e5\u7684\u518d\u5e73\u8861 \u3001 \u6bcf\u6708\u521d\u7684\u8cc7\u7522\u7be9\u9078 \uff0c\u6216\u8005\u5728\u7279\u5b9a\u7684\u6642\u9593\u9ede\u57f7\u884c\u67d0\u4e9b\u5206\u6790\u3002Zipline \u63d0\u4f9b\u4e86\u5f37\u5927\u7684\u6392\u7a0b\u51fd\u6578\u529f\u80fd\uff0c\u8b93\u60a8\u53ef\u4ee5\u7cbe\u78ba\u5730\u63a7\u5236\u9019\u4e9b\u4efb\u52d9\u7684\u57f7\u884c\u6642\u6a5f\u3002</p> <p>\u6838\u5fc3\u7684\u6392\u7a0b\u51fd\u6578\u662f <code>schedule_function()</code>\uff0c\u5b83\u7d50\u5408\u4e86\u65e5\u671f\u898f\u5247 (<code>date_rules</code>) \u548c\u6642\u9593\u898f\u5247 (<code>time_rules</code>) \u4f86\u5b9a\u7fa9\u4efb\u52d9\u7684\u57f7\u884c\u983b\u7387\u3002</p>"},{"location":"reference/zipline/scheduling-functions/#1-schedule_function","title":"1. schedule_function() \u51fd\u6578","text":"<p><code>zipline.api.schedule_function()</code> \u7528\u65bc\u5c07\u4e00\u500b\u81ea\u5b9a\u7fa9\u51fd\u6578\u6392\u7a0b\u5230\u672a\u4f86\u7684\u7279\u5b9a\u6642\u9593\u9ede\u57f7\u884c\u3002\u5b83\u901a\u5e38\u5728 <code>initialize()</code> \u51fd\u6578\u4e2d\u547c\u53eb\u3002</p> <pre><code>from zipline.api import schedule_function\n# \u4ea6\u9700\u5c0e\u5165 date_rules \u548c time_rules\nfrom zipline.api import date_rules, time_rules\nimport datetime\n</code></pre>"},{"location":"reference/zipline/scheduling-functions/#_1","title":"\u4e3b\u8981\u53c3\u6578\uff1a","text":"<ul> <li><code>func</code>: (callable) \u6b32\u6392\u7a0b\u57f7\u884c\u7684\u51fd\u6578\u3002\u6b64\u51fd\u6578\u5fc5\u9808\u63a5\u53d7 <code>context</code> \u548c <code>data</code> \u4f5c\u70ba\u53c3\u6578\u3002</li> <li><code>date_rule</code>: (zipline.api.date_rules \u7269\u4ef6) \u5b9a\u7fa9\u51fd\u6578\u57f7\u884c\u7684\u65e5\u671f\u983b\u7387\u3002</li> <li><code>time_rule</code>: (zipline.api.time_rules \u7269\u4ef6, \u53ef\u9078) \u5b9a\u7fa9\u51fd\u6578\u5728\u4ea4\u6613\u65e5\u4e2d\u57f7\u884c\u7684\u5177\u9ad4\u6642\u9593\u9ede\u3002\u9810\u8a2d\u70ba <code>time_rules.market_open()</code>\u3002</li> <li><code>half_days</code>: (bool, \u53ef\u9078) \u82e5\u70ba <code>True</code>\uff0c\u5247\u51fd\u6578\u4e5f\u6703\u5728\u534a\u5929\u4ea4\u6613\u65e5\u57f7\u884c\u3002\u9810\u8a2d\u70ba <code>False</code>\u3002</li> <li><code>calendar_days</code>: (bool, \u53ef\u9078) \u82e5\u70ba <code>True</code>\uff0c\u5247\u51fd\u6578\u6703\u5728\u65e5\u66c6\u65e5\u57f7\u884c\uff0c\u800c\u4e0d\u50c5\u9650\u65bc\u4ea4\u6613\u65e5\u3002\u9810\u8a2d\u70ba <code>False</code>\u3002</li> <li><code>exception_rules</code>: (zipline.api.date_rules \u7269\u4ef6, \u53ef\u9078) \u6307\u5b9a\u4e0d\u57f7\u884c\u51fd\u6578\u7684\u65e5\u671f\u898f\u5247\u3002</li> </ul>"},{"location":"reference/zipline/scheduling-functions/#2-date_rules","title":"2. \u65e5\u671f\u898f\u5247 (date_rules)","text":"<p><code>date_rules</code> \u7528\u65bc\u5b9a\u7fa9 <code>schedule_function()</code> \u7684\u65e5\u671f\u89f8\u767c\u689d\u4ef6\u3002</p> <ul> <li>\u5c0e\u5165: <code>from zipline.api import date_rules</code></li> </ul>"},{"location":"reference/zipline/scheduling-functions/#_2","title":"\u5e38\u898b\u65e5\u671f\u898f\u5247\uff1a","text":"<ul> <li> <p><code>date_rules.every_day()</code>: \u6bcf\u500b\u4ea4\u6613\u65e5\u57f7\u884c\u3002     <pre><code>schedule_function(my_daily_task, date_rules.every_day())\n</code></pre></p> </li> <li> <p><code>date_rules.week_start(days_offset=0)</code>: \u6bcf\u9031\u7684\u7b2c\u4e00\u500b\u4ea4\u6613\u65e5\u57f7\u884c\u3002<code>days_offset</code> \u53ef\u7528\u65bc\u5f9e\u7b2c\u4e00\u500b\u4ea4\u6613\u65e5\u504f\u79fb\uff0c\u4f8b\u5982 <code>days_offset=1</code> \u8868\u793a\u6bcf\u9031\u7b2c\u4e8c\u500b\u4ea4\u6613\u65e5\u3002     <pre><code>schedule_function(my_weekly_task, date_rules.week_start()) # \u6bcf\u9031\u4e00\u57f7\u884c\nschedule_function(my_weekly_task_offset, date_rules.week_start(days_offset=2)) # \u6bcf\u9031\u4e09\u57f7\u884c (\u9031\u4e00+2\u5929)\n</code></pre></p> </li> <li> <p><code>date_rules.month_start(days_offset=0)</code>: \u6bcf\u6708\u7684\u7b2c\u4e00\u500b\u4ea4\u6613\u65e5\u57f7\u884c\u3002     <pre><code>schedule_function(my_monthly_task, date_rules.month_start()) # \u6bcf\u6708\u7b2c\u4e00\u500b\u4ea4\u6613\u65e5\u57f7\u884c\n</code></pre></p> </li> <li> <p><code>date_rules.month_end(days_offset=0)</code>: \u6bcf\u6708\u7684\u6700\u5f8c\u4e00\u500b\u4ea4\u6613\u65e5\u57f7\u884c\u3002     <pre><code>schedule_function(my_monthly_end_task, date_rules.month_end()) # \u6bcf\u6708\u6700\u5f8c\u4e00\u500b\u4ea4\u6613\u65e5\u57f7\u884c\n</code></pre></p> </li> </ul>"},{"location":"reference/zipline/scheduling-functions/#3-time_rules","title":"3. \u6642\u9593\u898f\u5247 (time_rules)","text":"<p><code>time_rules</code> \u7528\u65bc\u5b9a\u7fa9 <code>schedule_function()</code> \u5728\u7b26\u5408 <code>date_rules</code> \u7684\u4ea4\u6613\u65e5\u4e2d\uff0c\u5177\u9ad4\u5728\u4ec0\u9ebc\u6642\u9593\u9ede\u57f7\u884c\u3002</p> <ul> <li>\u5c0e\u5165: <code>from zipline.api import time_rules</code></li> </ul>"},{"location":"reference/zipline/scheduling-functions/#_3","title":"\u5e38\u898b\u6642\u9593\u898f\u5247\uff1a","text":"<ul> <li> <p><code>time_rules.market_open(minutes=0)</code>: \u5728\u5e02\u5834\u958b\u76e4\u6642\u57f7\u884c\u3002<code>minutes</code> \u53c3\u6578\u53ef\u4ee5\u6307\u5b9a\u5728\u958b\u76e4\u5f8c\u504f\u79fb\u7684\u5206\u9418\u6578\u3002     <pre><code>schedule_function(my_open_task, date_rules.every_day(), time_rules.market_open()) # \u6bcf\u5929\u958b\u76e4\u57f7\u884c\nschedule_function(my_open_delay_task, date_rules.every_day(), time_rules.market_open(minutes=30)) # \u6bcf\u5929\u958b\u76e4\u5f8c30\u5206\u9418\u57f7\u884c\n</code></pre></p> </li> <li> <p><code>time_rules.market_close(minutes=0)</code>: \u5728\u5e02\u5834\u6536\u76e4\u6642\u57f7\u884c\u3002<code>minutes</code> \u53c3\u6578\u53ef\u4ee5\u6307\u5b9a\u5728\u6536\u76e4\u524d\u504f\u79fb\u7684\u5206\u9418\u6578\uff08\u8ca0\u503c\uff09\u6216\u6536\u76e4\u5f8c\u504f\u79fb\u7684\u5206\u9418\u6578\uff08\u6b63\u503c\uff09\u3002     <pre><code>schedule_function(my_close_task, date_rules.every_day(), time_rules.market_close()) # \u6bcf\u5929\u6536\u76e4\u57f7\u884c\nschedule_function(my_close_before_task, date_rules.every_day(), time_rules.market_close(minutes=-10)) # \u6bcf\u5929\u6536\u76e4\u524d10\u5206\u9418\u57f7\u884c\n</code></pre></p> </li> <li> <p><code>time_rules.before_market_open(minutes=0)</code>: \u5728\u5e02\u5834\u958b\u76e4\u524d\u57f7\u884c\u3002<code>minutes</code> \u53c3\u6578\u6307\u5b9a\u958b\u76e4\u524d\u591a\u5c11\u5206\u9418\u3002     <pre><code>schedule_function(my_pre_open_task, date_rules.every_day(), time_rules.before_market_open(minutes=10)) # \u6bcf\u5929\u958b\u76e4\u524d10\u5206\u9418\u57f7\u884c\n</code></pre></p> </li> <li> <p><code>time_rules.after_market_close(minutes=0)</code>: \u5728\u5e02\u5834\u6536\u76e4\u5f8c\u57f7\u884c\u3002<code>minutes</code> \u53c3\u6578\u6307\u5b9a\u6536\u76e4\u5f8c\u591a\u5c11\u5206\u9418\u3002     <pre><code>schedule_function(my_post_close_task, date_rules.every_day(), time_rules.after_market_close(minutes=10)) # \u6bcf\u5929\u6536\u76e4\u5f8c10\u5206\u9418\u57f7\u884c\n</code></pre></p> </li> <li> <p><code>time_rules.at_time(dt_time)</code>: \u5728\u4ea4\u6613\u65e5\u4e2d\u7684\u7279\u5b9a\u6642\u9593\u57f7\u884c\u3002<code>dt_time</code> \u61c9\u70ba <code>datetime.time</code> \u7269\u4ef6\u3002     <pre><code>schedule_function(my_fixed_time_task, date_rules.every_day(), time_rules.at_time(datetime.time(10, 0))) # \u6bcf\u5929\u65e9\u4e0a10\u9ede\u57f7\u884c\n</code></pre></p> </li> </ul>"},{"location":"reference/zipline/scheduling-functions/#4","title":"4. \u5b8c\u6574\u7bc4\u4f8b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u500b\u5b8c\u6574\u7684\u7a0b\u5f0f\u78bc\u7bc4\u4f8b\uff0c\u6f14\u793a\u5982\u4f55\u5728 <code>initialize()</code> \u51fd\u6578\u4e2d\u8a2d\u5b9a\u591a\u500b\u6392\u7a0b\u4efb\u52d9\u3002</p> <pre><code>import pandas as pd\nfrom zipline import run_algorithm\nfrom zipline.api import (\n    symbol,\n    order_target_percent,\n    record,\n    set_benchmark,\n    schedule_function,\n    date_rules,\n    time_rules\n)\nimport datetime\n\n# --- \u81ea\u5b9a\u7fa9\u4efb\u52d9\u51fd\u6578 ---\ndef rebalance_monthly(context, data):\n    # \u6bcf\u6708\u57f7\u884c\u7684\u518d\u5e73\u8861\u908f\u8f2f\n    current_price = data.current(context.my_asset, 'price')\n    if current_price is not None and not pd.isnull(current_price):\n        order_target_percent(context.my_asset, 0.5) # \u5c07\u4e00\u534a\u8cc7\u91d1\u6295\u5165\n        print(f\"[{data.current_dt.date()}] \u6bcf\u6708\u518d\u5e73\u8861: \u8cb7\u5165 {context.my_asset.symbol}\")\n\ndef log_daily_data(context, data):\n    # \u6bcf\u65e5\u57f7\u884c\u7684\u6578\u64da\u8a18\u9304\u908f\u8f2f\n    current_price = data.current(context.my_asset, 'price')\n    if current_price is not None and not pd.isnull(current_price):\n        record(price=current_price)\n        print(f\"[{data.current_dt.date()}] \u6bcf\u65e5\u8a18\u9304: {context.my_asset.symbol} \u50f9\u683c {current_price}\")\n\ndef pre_market_check(context, data):\n    # \u76e4\u524d\u57f7\u884c\u7684\u6aa2\u67e5\u908f\u8f2f\n    print(f\"[{data.current_dt.date()}] \u76e4\u524d\u6aa2\u67e5: \u5e02\u5834\u5373\u5c07\u958b\u76e4...\")\n\n\n# --- Zipline \u56de\u6e2c\u90e8\u5206 ---\ndef initialize(context):\n    context.my_asset = symbol('2330')\n    set_benchmark(symbol('IR0001'))\n\n    # 1. \u8a2d\u5b9a\u6bcf\u65e5\u6536\u76e4\u524d 10 \u5206\u9418\u8a18\u9304\u6578\u64da\n    schedule_function(\n        log_daily_data,\n        date_rules.every_day(),\n        time_rules.market_close(minutes=-10)\n    )\n\n    # 2. \u8a2d\u5b9a\u6bcf\u6708\u7b2c\u4e00\u500b\u4ea4\u6613\u65e5\u958b\u76e4\u6642\u9032\u884c\u518d\u5e73\u8861\n    schedule_function(\n        rebalance_monthly,\n        date_rules.month_start(),\n        time_rules.market_open()\n    )\n\n    # 3. \u8a2d\u5b9a\u6bcf\u5929\u958b\u76e4\u524d 5 \u5206\u9418\u9032\u884c\u76e4\u524d\u6aa2\u67e5\n    schedule_function(\n        pre_market_check,\n        date_rules.every_day(),\n        time_rules.before_market_open(minutes=5)\n    )\n\ndef handle_data(context, data):\n    pass # \u6838\u5fc3\u4ea4\u6613\u908f\u8f2f\u53ef\u4ee5\u653e\u5728\u9019\u88e1\uff0c\u4e5f\u53ef\u4ee5\u6392\u7a0b\u57f7\u884c\n\ndef analyze(context, results):\n    # \u5206\u6790\u7d50\u679c\n    final_portfolio_value = results.iloc[-1]['portfolio_value']\n    print(f\"\u6700\u7d42\u6295\u8cc7\u7d44\u5408\u50f9\u503c: {final_portfolio_value}\")\n\n# \u57f7\u884c\u56de\u6e2c\nresults = run_algorithm(\n    start=pd.Timestamp('2022-01-01', tz='UTC'),\n    end=pd.Timestamp('2023-01-01', tz='UTC'),\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=1_000_000,\n    bundle='tquant'\n)\n</code></pre>"},{"location":"reference/zipline/stocks_cheat_sheet/","title":"Zipline \u80a1\u7968\u7b56\u7565\u5099\u5fd8\u9304 (API Cheat Sheet)","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b TQuant Lab \u80a1\u7968\u7b56\u7565\u958b\u767c\u7684 API \u5feb\u901f\u53c3\u8003\uff0c\u5305\u542b\u521d\u59cb\u5316\u3001\u6578\u64da\u7372\u53d6\u3001\u4ea4\u6613\u4e0b\u55ae\u3001\u90e8\u4f4d\u7ba1\u7406\u53ca\u56de\u6e2c\u57f7\u884c\u7b49\u5e38\u7528\u51fd\u6578\u3002</p> <p>\u9019\u662f\u4e00\u4efd\u5c08\u70ba TQuant Lab \u4e2d\u9032\u884c**\u80a1\u7968**\u7b56\u7565\u56de\u6e2c\u8a2d\u8a08\u7684 API \u5feb\u901f\u53c3\u8003\u5099\u5fd8\u9304\u3002</p>"},{"location":"reference/zipline/stocks_cheat_sheet/#1-initialize","title":"1. \u521d\u59cb\u5316 (<code>initialize</code>)","text":"API \u51fd\u6578/\u5c6c\u6027 \u8aaa\u660e \u7bc4\u4f8b <code>symbol(ticker_str)</code> \u6839\u64da\u80a1\u7968\u4ee3\u78bc\u53d6\u5f97 <code>Equity</code> \u8cc7\u7522\u7269\u4ef6\u3002 <code>context.asset = symbol('2330')</code> <code>set_benchmark(asset)</code> \u8a2d\u5b9a\u56de\u6e2c\u7684\u7e3e\u6548\u6bd4\u8f03\u57fa\u6e96\u3002 <code>set_benchmark(symbol('IR0001'))</code> <code>set_commission(...)</code> \u8a2d\u5b9a\u4ea4\u6613\u624b\u7e8c\u8cbb\u6a21\u578b\u3002 <code>set_commission(equities=commission.PerDollar(cost=0.001425))</code> <code>set_slippage(...)</code> \u8a2d\u5b9a\u6ed1\u50f9\u6a21\u578b\u3002 <code>set_slippage(equities=slippage.VolumeShareSlippage())</code> <code>schedule_function(...)</code> \u8a3b\u518a\u4e00\u500b\u6392\u7a0b\u51fd\u6578\uff0c\u5728\u7279\u5b9a\u6642\u9593\u9031\u671f\u6027\u57f7\u884c\u3002 <code>schedule_function(my_func, date_rules.every_day())</code> <code>date_rules.every_day()</code> \u65e5\u671f\u898f\u5247\uff1a\u6bcf\u500b\u4ea4\u6613\u65e5\u3002 <code>schedule_function(my_func, date_rules.every_day())</code> <code>date_rules.week_start()</code> \u65e5\u671f\u898f\u5247\uff1a\u6bcf\u9031\u7684\u7b2c\u4e00\u500b\u4ea4\u6613\u65e5\u3002 <code>schedule_function(my_func, date_rules.week_start())</code> <code>date_rules.month_start()</code> \u65e5\u671f\u898f\u5247\uff1a\u6bcf\u500b\u6708\u7684\u7b2c\u4e00\u500b\u4ea4\u6613\u65e5\u3002 <code>schedule_function(my_func, date_rules.month_start())</code> <code>time_rules.market_open()</code> \u6642\u9593\u898f\u5247\uff1a\u6bcf\u65e5\u958b\u76e4\u6642\u3002\u53ef\u52a0 <code>minutes</code> \u6216 <code>hours</code> \u53c3\u6578\u505a\u504f\u79fb\u3002 <code>time_rules.market_open(minutes=30)</code> <code>time_rules.market_close()</code> \u6642\u9593\u898f\u5247\uff1a\u6bcf\u65e5\u6536\u76e4\u6642\u3002\u53ef\u52a0 <code>minutes</code> \u6216 <code>hours</code> \u53c3\u6578\u505a\u504f\u79fb\u3002 <code>time_rules.market_close(minutes=15)</code>"},{"location":"reference/zipline/stocks_cheat_sheet/#2-data-access","title":"2. \u6578\u64da\u7372\u53d6 (Data Access)","text":"API \u51fd\u6578/\u5c6c\u6027 \u8aaa\u660e \u7bc4\u4f8b <code>data.history(...)</code> \u7372\u53d6\u6b77\u53f2\u6578\u64da\uff0c\u56de\u50b3\u4e00\u500b <code>pandas.DataFrame</code>\u3002 <code>hist = data.history(asset, 'price', 50, '1d')</code> <code>data.current(...)</code> \u7372\u53d6\u6307\u5b9a\u8cc7\u7522\u7684\u7576\u524d\u6578\u64da\uff08\u50f9\u683c\u3001\u6210\u4ea4\u91cf\u7b49\uff09\u3002 <code>price = data.current(asset, 'price')</code> <code>data.can_trade(asset)</code> \u6aa2\u67e5\u6307\u5b9a\u8cc7\u7522\u5728\u7576\u524d\u6642\u9593\u9ede\u662f\u5426\u53ef\u4ea4\u6613\u3002 <code>if data.can_trade(my_asset): ...</code> <code>get_datetime()</code> \u53d6\u5f97\u76ee\u524d\u56de\u6e2c\u7684\u6642\u9593\u9ede (UTC)\u3002 <code>current_time = get_datetime()</code>"},{"location":"reference/zipline/stocks_cheat_sheet/#3-trading-orders","title":"3. \u4ea4\u6613\u8207\u8a02\u55ae (Trading &amp; Orders)","text":"API \u51fd\u6578/\u5c6c\u6027 \u8aaa\u660e \u7bc4\u4f8b <code>order(asset, amount)</code> \u4e0b\u4e00\u5f35\u5e02\u50f9\u55ae\uff0c\u8cb7\u5165/\u8ce3\u51fa\u6307\u5b9a <code>amount</code> \u7684\u80a1\u6578\u3002\u6b63\u6578\u70ba\u8cb7\uff0c\u8ca0\u6578\u70ba\u8ce3\u3002 <code>order(symbol('2330'), 1000)</code> <code>order_target(asset, amount)</code> \u4e0b\u55ae\u5c07\u8cc7\u7522\u90e8\u4f4d\u8abf\u6574\u81f3\u76ee\u6a19 <code>amount</code> \u80a1\u6578\u3002 <code>order_target(symbol('2330'), 5000)</code> <code>order_target_percent(asset, pct)</code> \u4e0b\u55ae\u5c07\u8cc7\u7522\u90e8\u4f4d\u8abf\u6574\u81f3\u4f54\u7e3d\u6295\u8cc7\u7d44\u5408\u50f9\u503c\u7684 <code>pct</code> \u6bd4\u4f8b\u3002 <code>order_target_percent(symbol('2330'), 0.1)</code> <code>order_value(asset, value)</code> \u4e0b\u55ae\u8cb7\u5165/\u8ce3\u51fa\u50f9\u503c <code>value</code> \u7684\u80a1\u7968\u3002 <code>order_value(symbol('2330'), 500000)</code> <code>order_target_value(asset, value)</code> \u4e0b\u55ae\u5c07\u8cc7\u7522\u90e8\u4f4d\u8abf\u6574\u81f3\u76ee\u6a19\u50f9\u503c <code>value</code>\u3002 <code>order_target_value(symbol('2330'), 200000)</code> <code>LimitOrder(price)</code> \u9650\u50f9\u55ae\u6a23\u5f0f\uff0c\u9700\u8207 <code>order()</code> \u51fd\u6578\u914d\u5408\u4f7f\u7528\u3002 <code>order(asset, 1000, style=LimitOrder(599.0))</code> <code>StopOrder(price)</code> \u505c\u640d\u55ae\u6a23\u5f0f\uff08\u5e02\u50f9\uff09\u3002 <code>order(asset, -1000, style=StopOrder(550.0))</code> <code>StopLimitOrder(limit, stop)</code> \u505c\u640d\u9650\u50f9\u55ae\u6a23\u5f0f\u3002 <code>order(asset, -1000, style=StopLimitOrder(550, 551))</code> <code>get_order(order_id)</code> \u900f\u904e\u8a02\u55ae ID \u67e5\u8a62\u8a02\u55ae\u7269\u4ef6\u3002<code>order()</code> \u51fd\u6578\u6703\u56de\u50b3 ID\u3002 <code>my_order = get_order(order_id)</code> <code>get_open_orders()</code> \u53d6\u5f97\u6240\u6709\u672a\u6210\u4ea4\u7684\u639b\u55ae\u3002 <code>open_orders = get_open_orders()</code> <code>cancel_order(order_id)</code> \u6839\u64da\u8a02\u55ae ID \u53d6\u6d88\u4e00\u7b46\u672a\u6210\u4ea4\u7684\u639b\u55ae\u3002 <code>cancel_order(my_order_id)</code>"},{"location":"reference/zipline/stocks_cheat_sheet/#4-portfolio-positions","title":"4. \u6295\u8cc7\u7d44\u5408\u8207\u90e8\u4f4d (Portfolio &amp; Positions)","text":"API \u51fd\u6578/\u5c6c\u6027 \u8aaa\u660e \u7bc4\u4f8b <code>context.portfolio.portfolio_value</code> (\u5c6c\u6027) \u6574\u500b\u6295\u8cc7\u7d44\u5408\u7684\u7e3d\u6de8\u503c\u3002 <code>net_worth = context.portfolio.portfolio_value</code> <code>context.portfolio.cash</code> (\u5c6c\u6027) \u5e33\u6236\u4e2d\u7684\u73fe\u91d1\u9918\u984d\u3002 <code>cash_balance = context.portfolio.cash</code> <code>context.portfolio.positions</code> (\u5c6c\u6027) \u4e00\u500b\u5b57\u5178\uff0c\u5305\u542b\u6240\u6709\u7576\u524d\u6301\u6709\u7684\u90e8\u4f4d\u3002 <code>for asset, pos in context.portfolio.positions.items(): ...</code> <code>context.portfolio.positions_value</code> (\u5c6c\u6027) \u6240\u6709\u6301\u5009\u7684\u7e3d\u5e02\u503c\u3002 <code>total_pos_value = context.portfolio.positions_value</code> <code>position.amount</code> (\u5c6c\u6027) \u6301\u6709\u7684\u80a1\u6578\u3002 <code>shares = position.amount</code> <code>position.cost_basis</code> (\u5c6c\u6027) \u5e73\u5747\u6301\u6709\u6210\u672c\u3002 <code>avg_cost = position.cost_basis</code> <code>position.last_sale_price</code> (\u5c6c\u6027) \u6700\u65b0\u6210\u4ea4\u50f9\u683c\u3002 <code>current_price = position.last_sale_price</code>"},{"location":"reference/zipline/stocks_cheat_sheet/#5-execution-analysis","title":"5. \u57f7\u884c\u8207\u5206\u6790 (Execution &amp; Analysis)","text":"API \u51fd\u6578/\u5c6c\u6027 \u8aaa\u660e \u7bc4\u4f8b <code>run_algorithm(...)</code> \u6838\u5fc3\u57f7\u884c\u51fd\u6578\uff0c\u555f\u52d5\u6574\u500b\u56de\u6e2c\u3002 <code>results = run_algorithm(...)</code> <code>record(**kwargs)</code> \u5728\u6bcf\u500b\u6642\u9593\u9ede\u8a18\u9304\u4e00\u500b\u6216\u591a\u500b\u8b8a\u6578\uff0c\u4ee5\u4fbf\u5f8c\u7e8c\u5206\u6790\u3002 <code>record(my_ma=ma_value, price=current_price)</code> <code>get_calendar(name)</code> \u53d6\u5f97\u4e00\u500b\u4ea4\u6613\u65e5\u66c6\u7269\u4ef6\u3002 <code>trading_calendar=get_calendar('TEJ')</code>"},{"location":"reference/zipline/universe/","title":"Zipline \u80a1\u7968\u6c60 (Universe) \u5b9a\u7fa9\u8207\u7ba1\u7406","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b Zipline \u4e2d\u80a1\u7968\u6c60 (Universe) \u5b9a\u7fa9\u8207\u7ba1\u7406\u7684\u8a73\u7d30\u6307\u5357\uff0c\u5305\u62ec <code>get_universe()</code> \u51fd\u6578\u7684\u4f7f\u7528\u3001\u900f\u904e Pipeline \u7684 <code>screen</code> \u53c3\u6578\u9032\u884c\u52d5\u614b\u7be9\u9078\uff0c\u5e6b\u52a9\u4f7f\u7528\u8005\u63d0\u5347\u56de\u6e2c\u6548\u7387\u3002</p> <p>\u5728 Zipline \u56de\u6e2c\u4e2d\uff0c\u300c\u80a1\u7968\u6c60 (Universe)\u300d\u662f\u6307\u60a8\u7684\u4ea4\u6613\u7b56\u7565\u5728\u6bcf\u500b\u6642\u9593\u9ede\u4e0a\u6240\u80fd\u8003\u616e\u6216\u5be6\u969b\u4ea4\u6613\u7684\u8cc7\u7522\u96c6\u5408\u3002\u6709\u6548\u5730\u5b9a\u7fa9\u548c\u7ba1\u7406\u80a1\u7968\u6c60\uff0c\u80fd\u5920\u5927\u5e45\u63d0\u5347\u56de\u6e2c\u6548\u7387\uff0c\u4e26\u78ba\u4fdd\u7b56\u7565\u53ea\u95dc\u6ce8\u76f8\u95dc\u6216\u7b26\u5408\u7279\u5b9a\u689d\u4ef6\u7684\u8cc7\u7522\u3002</p> <p>\u672c\u6587\u4ef6\u5c07\u8aaa\u660e\u5982\u4f55\u5229\u7528 <code>get_universe()</code> \u51fd\u6578\u4f86\u5b9a\u7fa9\u975c\u614b\u80a1\u7968\u6c60\uff0c\u4ee5\u53ca\u5982\u4f55\u900f\u904e <code>Pipeline</code> \u7684 <code>screen</code> \u53c3\u6578\u4f86\u5be6\u73fe\u52d5\u614b\u7be9\u9078\u3002</p>"},{"location":"reference/zipline/universe/#1-ziplinesourcestej_api_dataget_universe","title":"1. zipline.sources.TEJ_Api_Data.get_universe() \u51fd\u6578\uff1a\u5b9a\u7fa9\u975c\u614b\u80a1\u7968\u6c60","text":"<p><code>zipline.sources.TEJ_Api_Data.get_universe()</code> \u51fd\u6578\u662f TQuant Lab \u63d0\u4f9b\u7684\u4e00\u500b\u5f37\u5927\u5de5\u5177\uff0c\u7528\u65bc\u5f9e TEJ \u8cc7\u6599\u5eab\u4e2d\u7372\u53d6\u7b26\u5408\u7279\u5b9a\u7be9\u9078\u689d\u4ef6\u7684\u8cc7\u7522\u5217\u8868\u3002</p> <p>\u5c0e\u5165: <code>from zipline.sources.TEJ_Api_Data import get_universe</code> \u7528\u9014: \u6839\u64da\u65e5\u671f\u548c\u591a\u7a2e\u7be9\u9078\u689d\u4ef6\uff0c\u7372\u53d6\u4e00\u7d44 Zipline \u8cc7\u7522\u7269\u4ef6 (SID) \u5217\u8868\u3002</p> <p>\u53c3\u6578:</p> <ul> <li><code>start</code>: (<code>datetime</code> \u6216 <code>str</code>) \u8d77\u59cb\u65e5\u671f\u3002</li> <li><code>end</code>: (<code>datetime</code> \u6216 <code>str</code>, \u53ef\u9078) \u7d50\u675f\u65e5\u671f\uff0c\u9810\u8a2d\u70ba\u57f7\u884c\u7576\u5929\u3002</li> <li><code>idx_id</code>: (<code>str</code> \u6216 <code>list</code>, \u53ef\u9078) \u6307\u6578\u4ee3\u78bc\uff0c\u4f8b\u5982 <code>'IX0002'</code> (\u53f0\u7063\u4e94\u5341\u6307\u6578)\u3002</li> <li><code>mkt</code>: (<code>str</code> \u6216 <code>list</code>, \u53ef\u9078) \u5e02\u5834\u985e\u578b\uff0c\u4f8b\u5982 <code>'TWSE'</code> (\u53f0\u7063\u8b49\u5238\u4ea4\u6613\u6240)\u3001<code>'OTC'</code> (\u6ac3\u6aaf\u8cb7\u8ce3\u4e2d\u5fc3)\u3002</li> <li><code>stktp_c</code> / <code>stktp_e</code>: (<code>str</code> \u6216 <code>list</code>, \u53ef\u9078) \u80a1\u7968\u985e\u578b\uff0c\u53ef\u4f7f\u7528\u4e2d\u6587\u6216\u82f1\u6587\uff0c\u4f8b\u5982 <code>'\u666e\u901a\u80a1'</code>, <code>'Common Stock'</code>\u3002</li> <li><code>sub_ind_c</code> / <code>sub_ind_e</code>: (<code>str</code> \u6216 <code>list</code>, \u53ef\u9078) \u6b21\u7522\u696d\u5225\u3002</li> <li><code>main_ind_c</code>: (<code>str</code> \u6216 <code>list</code>, \u53ef\u9078) \u4e3b\u8981\u7522\u696d\u5225\u3002</li> <li>\u66f4\u591a\u7be9\u9078\u53c3\u6578\u8acb\u53c3\u8003 <code>get_universe</code> \u7684\u6e90\u78bc\u6216\u76f8\u95dc\u8aaa\u660e\u3002</li> </ul> <p>\u8fd4\u56de\u503c: <code>pd.Series</code> \u6216 <code>list</code>\uff0c\u5305\u542b\u7b26\u5408\u689d\u4ef6\u7684\u8cc7\u7522\u7269\u4ef6 (Zipline <code>Asset</code> \u7269\u4ef6)\u3002</p> <p>Note</p> <p><code>get_universe()</code> \u51fd\u6578\u4f9d\u8cf4\u65bc TEJ API\u3002\u56e0\u6b64\uff0c<code>TEJAPI_KEY</code> \u548c <code>TEJAPI_BASE</code> \u74b0\u5883\u8b8a\u6578\u5fc5\u9808\u9810\u5148\u8a2d\u5b9a\u3002</p>"},{"location":"reference/zipline/universe/#50","title":"\u7bc4\u4f8b\uff1a\u7372\u53d6\u53f0\u706350\u6307\u6578\u6210\u5206\u80a1","text":"<pre><code>import pandas as pd\nfrom zipline.sources.TEJ_Api_Data import get_universe\nimport os\n\n# \u5047\u8a2d\u5df2\u8a2d\u5b9a TEJAPI_KEY \u548c TEJAPI_BASE \u74b0\u5883\u8b8a\u6578\n# os.environ['TEJAPI_KEY'] = 'YOUR_API_KEY'\n# os.environ['TEJAPI_BASE'] = 'https://api.tej.com.tw'\n\nstart_date = pd.Timestamp('2020-01-01', tz='UTC')\nend_date = pd.Timestamp('2023-01-01', tz='UTC')\n\n# \u7372\u53d6\u53f0\u706350\u6307\u6578 (IX0002) \u7684\u6210\u5206\u80a1\ntw50_assets = get_universe(start=start_date, end=end_date, idx_id='IX0002')\n\nprint(f\"\u53f0\u706350\u6307\u6578\u6210\u5206\u80a1\u6578\u91cf: {len(tw50_assets)}\")\nprint(tw50_assets.head())\n</code></pre>"},{"location":"reference/zipline/universe/#2-pipeline-screen","title":"2. \u900f\u904e Pipeline \u7684 screen \u53c3\u6578\u52d5\u614b\u7be9\u9078","text":"<p>\u5728 Zipline \u4e2d\uff0c<code>Pipeline</code> \u63d0\u4f9b\u4e86\u4e00\u7a2e\u66f4\u70ba\u5f37\u5927\u548c\u52d5\u614b\u7684\u65b9\u5f0f\u4f86\u5b9a\u7fa9\u6bcf\u65e5\u7684\u80a1\u7968\u6c60\u3002\u60a8\u53ef\u4ee5\u5229\u7528\u5404\u7a2e\u56e0\u5b50\uff08Factor\uff09\u548c\u904e\u6ffe\u5668\uff08Filter\uff09\u4f86\u69cb\u5efa\u8907\u96dc\u7684\u7be9\u9078\u908f\u8f2f\uff0c\u4e26\u900f\u904e <code>attach_pipeline()</code> \u7684 <code>screen</code> \u53c3\u6578\u5c07\u7be9\u9078\u7d50\u679c\u61c9\u7528\u65bc\u56de\u6e2c\u3002</p> <p><code>screen</code> \u53c3\u6578\u61c9\u63a5\u6536\u4e00\u500b\u5e03\u6797 Series (Boolean Series)\uff0c\u5176\u4e2d <code>True</code> \u8868\u793a\u8a72\u8cc7\u7522\u5305\u542b\u5728 Universe \u4e2d\u3002</p>"},{"location":"reference/zipline/universe/#_1","title":"\u7bc4\u4f8b\uff1a\u7be9\u9078\u5e02\u503c\u6700\u5927\u7684\u80a1\u7968","text":"<pre><code>from zipline.api import attach_pipeline, pipeline_output, set_benchmark, symbol\nfrom zipline.pipeline import Pipeline\nfrom zipline.pipeline.factors import AverageDollarVolume\nfrom zipline.pipeline.filters import StaticAssets\nfrom zipline.pipeline.data import EquityPricing\n\n# 1. \u5b9a\u7fa9 Pipeline\ndef make_my_pipeline():\n    # \u8a08\u7b97\u5e73\u5747\u6bcf\u65e5\u6210\u4ea4\u91d1\u984d\n    dollar_volume = AverageDollarVolume(window_length=20)\n\n    # \u7be9\u9078\u689d\u4ef6\uff1a\u5e02\u503c\u524d 100 \u5927\u7684\u80a1\u7968\n    # \u9019\u88e1\u53ea\u662f\u4e00\u500b\u793a\u610f\uff0c\u5be6\u969b\u7684\u5e02\u503c\u7be9\u9078\u53ef\u80fd\u9700\u8981\u66f4\u8907\u96dc\u7684\u56e0\u5b50\n    top_100_by_volume = dollar_volume.top(100) # \u5047\u8a2d\u6210\u4ea4\u91cf\u8207\u5e02\u503c\u6b63\u76f8\u95dc\n\n    return Pipeline(\n        columns={\n            'dollar_volume': dollar_volume\n        },\n        screen=top_100_by_volume # &lt;--- \u900f\u904e screen \u53c3\u6578\u9032\u884c\u52d5\u614b\u7be9\u9078\n    )\n\n# 2. \u56de\u6e2c\u7684 initialize \u51fd\u6578\ndef initialize(context):\n    set_benchmark(symbol('IR0001'))\n    # \u9644\u639b Pipeline\uff0c\u4e26\u8b93\u5176 screen \u53c3\u6578\u5b9a\u7fa9\u7576\u65e5 Universe\n    attach_pipeline(make_my_pipeline(), 'my_dynamic_universe') \n    context.my_universe = None\n\n# 3. \u56de\u6e2c\u7684 before_trading_start \u51fd\u6578 (\u7372\u53d6 Pipeline \u7be9\u9078\u7d50\u679c)\ndef before_trading_start(context, data):\n    # \u7372\u53d6 Pipeline \u7684\u8f38\u51fa\uff0c\u5176\u7d22\u5f15\u5373\u70ba\u7576\u65e5\u7be9\u9078\u51fa\u7684 Universe\n    context.my_universe = pipeline_output('my_dynamic_universe').index.get_level_values(1).tolist()\n\n# 4. \u56de\u6e2c\u7684 handle_data \u51fd\u6578 (\u5728\u7be9\u9078\u5f8c\u7684 Universe \u4e2d\u64cd\u4f5c)\ndef handle_data(context, data):\n    # \u7b56\u7565\u908f\u8f2f\u53ea\u5c0d context.my_universe \u4e2d\u7684\u80a1\u7968\u57f7\u884c\n    for asset in context.my_universe:\n        if data.can_trade(asset):\n            # ... \u57f7\u884c\u4ea4\u6613\u908f\u8f2f ...\n            pass\n</code></pre>"},{"location":"tutorials/first-spot-strategy/","title":"\u4f60\u7684\u7b2c\u4e00\u500b\u73fe\u8ca8\u7b56\u7565\uff1aKD \u6307\u6a19\u56de\u6e2c\u5be6\u6230","text":"<p>Info</p> <p>\u5728 TQuant Lab \u4ee5 KD \u6307\u6a19\u5b8c\u6210\u5f9e\u8cc7\u6599\u3001\u56de\u6e2c\u5230\u7e3e\u6548\u7684\u6700\u5c0f\u53ef\u884c\u7b56\u7565\uff08MVP\uff09\u3002</p>"},{"location":"tutorials/first-spot-strategy/#1-kd","title":"1. \u7c21\u4ecb\uff1aKD \u6307\u6a19\u8207\u4ea4\u6613\u7b56\u7565","text":"<p>KD \u6307\u6a19 (\u96a8\u6a5f\u6307\u6a19) \u662f\u6280\u8853\u5206\u6790\u4e2d\u5e38\u7528\u7684\u52d5\u91cf\u6307\u6a19\uff0c\u7528\u65bc\u5224\u65b7\u80a1\u50f9\u7684\u8d85\u8cb7\u8d85\u8ce3\u72c0\u614b\u53ca\u53ef\u80fd\u7684\u53cd\u8f49\u6642\u6a5f\u3002</p>"},{"location":"tutorials/first-spot-strategy/#2","title":"2. \u74b0\u5883\u8a2d\u5b9a\u8207\u8cc7\u6599\u6e96\u5099","text":"<p>\u5728\u958b\u59cb\u7b56\u7565\u56de\u6e2c\u524d\uff0c\u8acb\u78ba\u4fdd\u60a8\u5df2\u5b8c\u6210 TQuant Lab \u7684\u74b0\u5883\u5efa\u7f6e\uff0c\u4e26\u8a2d\u5b9a\u597d TEJ API Key\u3002</p>"},{"location":"tutorials/first-spot-strategy/#3","title":"3. \u5efa\u69cb\u4ea4\u6613\u7b56\u7565","text":"<p>\u4f7f\u7528 TQuant Lab \u7684 Pipeline \u5efa\u7acb KD \u6307\u6a19\uff0c\u4e26\u900f\u904e <code>initialize</code> \u548c <code>handle_data</code> \u51fd\u5f0f\u5be6\u4f5c\u4ea4\u6613\u908f\u8f2f\u3002</p>"},{"location":"tutorials/first-spot-strategy/#4","title":"4. \u57f7\u884c\u56de\u6e2c\u8207\u5206\u6790","text":"<p>\u4f7f\u7528 <code>run_algorithm</code> \u57f7\u884c\u7b56\u7565\uff0c\u4e26\u900f\u904e <code>pyfolio</code> \u5957\u4ef6\u5206\u6790\u7b56\u7565\u7684\u7e3e\u6548\u8207\u98a8\u96aa\u8868\u73fe\u3002</p>"},{"location":"tutorials/first-spot-strategy/#1-kd_1","title":"1. \u7c21\u4ecb\uff1aKD \u6307\u6a19\u8207\u4ea4\u6613\u7b56\u7565","text":"<ul> <li> <p>KD \u6307\u6a19\u8a08\u7b97 \uff1a</p> <ul> <li><code>RSV = ((\u7576\u65e5\u6536\u76e4\u50f9 - \u8fd1 N \u65e5\u7684\u6700\u4f4e\u50f9) / (\u8fd1 N \u65e5\u7684\u6700\u9ad8\u50f9 - \u8fd1 N \u65e5\u7684\u6700\u4f4e\u50f9)) * 100</code></li> <li><code>K \u503c = \u6628\u65e5 K \u503c \u00d7 (2/3) + \u7576\u65e5 RSV \u00d7 (1/3)</code></li> <li><code>D \u503c = \u6628\u65e5 D \u503c \u00d7 (2/3) + \u7576\u65e5 K \u503c \u00d7 (1/3)</code></li> </ul> <p>Note</p> <p>\u672c\u7b56\u7565\u4e2d N = 10</p> </li> <li> <p>\u4ea4\u6613\u7b56\u7565\u9032\u51fa\u5834\u898f\u5247 \uff1a</p> <ul> <li>\u8cb7\u5165\u8a0a\u865f (Long Entry)\uff1a\u7576 K \u503c \u2264 20 \u6642\uff0c\u8996\u70ba\u8d85\u8ce3\uff0c\u8cb7\u5165\u80a1\u7968\u6c60\u4e2d\u7b26\u5408\u689d\u4ef6\u7684\u80a1\u7968\uff0c\u914d\u7f6e\u5e33\u6236\u8cc7\u91d1\u7684 1%\u3002</li> <li>\u8ce3\u51fa/\u51fa\u5834\u8a0a\u865f\uff1a\u7576 K \u503c \u2265 80 \u6642\uff0c\u8996\u70ba\u8d85\u8cb7\uff0c\u8ce3\u51fa\u6301\u80a1\u4ee5\u5be6\u73fe\u7372\u5229 (\u672c\u7b56\u7565\u50c5\u6e05\u5009\uff0c\u975e\u653e\u7a7a)\u3002</li> </ul> </li> </ul>"},{"location":"tutorials/first-spot-strategy/#2_1","title":"2. \u74b0\u5883\u8a2d\u5b9a\u8207\u8cc7\u6599\u6e96\u5099","text":"<ol> <li> <p>\u8a2d\u5b9a TEJ API Key \uff1a     \u5c07 <code>YOUR_API_KEY</code> \u66ff\u63db\u70ba\u60a8\u7684 TEJ API Key\u3002</p> <pre><code>import os\ntej_key = 'YOUR_API_KEY' # \u8acb\u66ff\u63db\u70ba\u60a8\u7684 API Key\napi_base = 'https://api.tej.com.tw'\nos.environ['TEJAPI_KEY'] = tej_key\nos.environ['TEJAPI_BASE'] = api_base\n</code></pre> </li> <li> <p>\u8f09\u5165\u6240\u9700\u5957\u4ef6 \uff1a</p> <pre><code>import pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n\nfrom zipline.data import bundles\nfrom zipline.sources.TEJ_Api_Data import get_universe\nfrom zipline.pipeline import Pipeline\nfrom zipline.pipeline.data import TWEquityPricing\nfrom zipline.TQresearch.tej_pipeline import run_pipeline\nfrom zipline.api import *\nfrom zipline.finance.commission import PerDollar\nfrom zipline.finance.slippage import VolumeShareSlippage\nfrom zipline.sources.TEJ_Api_Data import (get_Treasury_Return, get_Benchmark_Return)\nimport pyfolio as pf\n\nplt.rcParams['axes.unicode_minus'] = False # \u89e3\u6c7a Matplotlib \u8ca0\u865f\u986f\u793a\u554f\u984c\n</code></pre> </li> <li> <p>\u8a2d\u5b9a\u56de\u6e2c\u671f\u9593\u8207\u80a1\u7968\u6c60 \uff1a     \u672c\u7bc4\u4f8b\u5c07\u56de\u6e2c 2012 \u5e74\u81f3 2022 \u5e74\u7684\u53f0\u7063 50 \u6307\u6578\u6210\u5206\u80a1\u3002</p> <pre><code># \u8a2d\u5b9a\u56de\u6e2c\u671f\u9593\nstart = '2012-01-01'\nend = '2022-12-30'\n\n# \u6293\u53d6\u53f0\u706350\u6307\u6578\u7684\u80a1\u7968 (IX0002) \u8207\u52a0\u6b0a\u80a1\u50f9\u5831\u916c\u6307\u6578 (IR0001)\nStockList = get_universe(start, end, idx_id='IX0002')\nStockList.append('IR0001')\n\nos.environ['ticker'] = ' '.join(StockList)\nos.environ['mdate'] = start + ' ' + end\n\n# \u8a2d\u5b9a Zipline \u8cc7\u6599 bundle \u540d\u7a31\nbundle_name = 'tquant'\n</code></pre> </li> <li> <p>\u8f09\u5165\u8cc7\u6599 \uff1a     \u5728\u7d42\u7aef\u6a5f\u4e2d\u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\uff0c\u5c07\u8cc7\u6599\u8f09\u5165 Zipline\u3002</p> <pre><code>zipline ingest -b tquant\n</code></pre> </li> </ol>"},{"location":"tutorials/first-spot-strategy/#3_1","title":"3. \u5efa\u69cb\u4ea4\u6613\u7b56\u7565","text":"<p>\u7b56\u7565\u53c3\u6578\u8a2d\u5b9a </p> <pre><code>starting_portfolio = 1e6 # \u521d\u59cb\u8cc7\u91d1 1,000,000 \u5143\ncommission_pct = 0.0029 # \u4f63\u91d1\u8cbb\u7387 0.29%\nslippage_volume_limit = 1.0 # \u6ed1\u50f9\u4ea4\u6613\u91cf\u9650\u5236\nslippage_impact = 0 # \u6ed1\u50f9\u5f71\u97ff\n</code></pre> <p>\u5efa\u7acb Pipeline \u51fd\u5f0f\uff1a\u8a08\u7b97 KD \u6307\u6a19 </p> <pre><code>from zipline.pipeline.factors import FastStochasticOscillator\n\ndef make_pipeline():\n    return Pipeline(\n        columns = {\n            \"FastStochasticOscillator\": FastStochasticOscillator(\n                inputs = [TWEquityPricing.close, TWEquityPricing.low, TWEquityPricing.high],\n                window_length = 10 # \u8a08\u7b97 K \u503c\u6240\u9700\u7684\u8996\u7a97\u9577\u5ea6\uff0c\u8207\u4e0a\u65b9 N=10 \u4e00\u81f4\n            )\n        }\n    )\n</code></pre> <p><code>initialize</code> \u51fd\u5f0f\uff1a\u8a2d\u5b9a\u56de\u6e2c\u74b0\u5883 </p> <pre><code>bundle = bundles.load('tquant')\n\ndef initialize(context):\n    set_commission(PerDollar(cost=commission_pct)) # \u8a2d\u5b9a\u4f63\u91d1\n    set_slippage(VolumeShareSlippage(volume_limit=slippage_volume_limit, price_impact=slippage_impact)) # \u8a2d\u5b9a\u6ed1\u50f9\n    set_benchmark(symbol('IR0001')) # \u8a2d\u5b9a\u57fa\u6e96\u6307\u6578\u70ba\u52a0\u6b0a\u80a1\u50f9\u5831\u916c\u6307\u6578\n    attach_pipeline(make_pipeline(), 'mystrategy') # \u5c0e\u5165 Pipeline\n</code></pre> <p><code>handle_data</code> \u51fd\u5f0f\uff1a\u5be6\u4f5c\u4ea4\u6613\u908f\u8f2f </p> <pre><code>def handle_data(context, data):\n    # \u53d6\u5f97\u6bcf\u5929 Pipeline \u8a08\u7b97\u51fa\u7684 K \u503c\n    out_dir = pipeline_output('mystrategy')\n\n    for asset in out_dir.index:\n        k_value = out_dir.loc[asset, 'FastStochasticOscillator']\n        position = context.portfolio.positions[asset].amount\n\n        # \u8cb7\u5165\u8a0a\u865f\uff1aK \u503c &lt;= 20 \u4e14\u76ee\u524d\u672a\u6301\u6709\u8a72\u80a1\u7968\n        if position == 0 and k_value &lt;= 20:\n            order_target_percent(asset, 0.01) # \u914d\u7f6e 1% \u8cc7\u91d1\u8cb7\u5165\n\n        # \u8ce3\u51fa\u8a0a\u865f\uff1aK \u503c &gt;= 80 \u4e14\u76ee\u524d\u6301\u6709\u8a72\u80a1\u7968\n        elif position &gt; 0 and k_value &gt;= 80:\n            order_target_percent(asset, 0.0) # \u6e05\u5009\u8ce3\u51fa\n</code></pre>"},{"location":"tutorials/first-spot-strategy/#4_1","title":"4. \u57f7\u884c\u56de\u6e2c","text":"<p>\u57f7\u884c\u56de\u6e2c </p> <pre><code>from zipline import run_algorithm\n\nstart_date = pd.Timestamp(start, tz='utc')\nend_date = pd.Timestamp(end, tz='utc')\n\nresults = run_algorithm(\n    start=start_date,\n    end=end_date,\n    initialize=initialize,\n    capital_base=starting_portfolio,\n    handle_data=handle_data,\n    data_frequency='daily',\n    bundle='tquant',\n    trading_calendar=bundle.trading_calendar\n)\n</code></pre>"},{"location":"tutorials/first-spot-strategy/#5","title":"5. \u7b56\u7565\u7e3e\u6548\u5206\u6790","text":"<p>\u7b56\u7565\u7e3e\u6548\u5206\u6790 </p> <pre><code># \u5f9e Zipline \u7d50\u679c\u4e2d\u63d0\u53d6\u5831\u916c\u3001\u90e8\u4f4d\u548c\u4ea4\u6613\u8cc7\u8a0a\nbt_returns, bt_positions, bt_transactions = pf.utils.extract_rets_pos_txn_from_zipline(results)\n\n# \u53d6\u5f97\u57fa\u6e96\u6307\u6578\u5831\u916c\nbenchmark_rets = results.benchmark_return\n\n# \u7522\u751f\u5b8c\u6574\u7684\u7e3e\u6548\u5206\u6790\u5831\u544a\npf.create_full_tear_sheet(\n    bt_returns,\n    positions=bt_positions,\n    transactions=bt_transactions,\n    benchmark_rets=benchmark_rets,\n    round_trips=False\n)\n</code></pre>"},{"location":"tutorials/first-spot-strategy/#6","title":"6. \u4e0b\u4e00\u6b65","text":"<p>\u606d\u559c\u60a8\u5b8c\u6210\u4e86\u7b2c\u4e00\u500b\u73fe\u8ca8\u7b56\u7565\uff01 \u60a8\u53ef\u4ee5\u7e7c\u7e8c\u63a2\u7d22\uff1a</p> <ul> <li>\u74b0\u5883\u5efa\u7f6e\uff1a\u6df1\u5165\u4e86\u89e3 TQuant Lab \u7684\u5b89\u88dd\u8207\u8a2d\u5b9a\u3002</li> <li>10 \u5206\u9418\u9ad4\u9a57\uff1a\u5feb\u901f\u56de\u9867 Zipline \u7684\u6838\u5fc3\u529f\u80fd\u3002</li> </ul>"},{"location":"tutorials/getting-started/","title":"\u65b0\u624b\u5fc5\u8b80\uff1a\u5feb\u901f\u4e86\u89e3 TQuant Lab","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b TQuant Lab \u65b0\u624b\u5165\u9580\u6307\u5357\uff0c\u5feb\u901f\u4e86\u89e3\u5e73\u53f0\u7684\u6838\u5fc3\u50f9\u503c\u3001\u4e3b\u8981\u529f\u80fd\u6a21\u7d44\uff0c\u4e26\u6307\u5f15\u60a8\u958b\u59cb\u4f7f\u7528\u91cf\u5316\u7814\u7a76\u5e73\u53f0\u3002</p> <p>\u6b61\u8fce\u4f86\u5230 TQuant Lab\uff01\u672c\u6307\u5357\u5c07\u5e36\u60a8\u5feb\u901f\u8a8d\u8b58 TQuant Lab \u7684\u6838\u5fc3\u50f9\u503c\u3001\u4e3b\u8981\u529f\u80fd\u6a21\u7d44\uff0c\u4e26\u6307\u5f15\u60a8\u958b\u59cb\u4f7f\u7528\u9019\u500b\u5b8c\u6574\u7684\u91cf\u5316\u7814\u7a76\u5e73\u53f0\u3002</p>"},{"location":"tutorials/getting-started/#tquant-lab_1","title":"\u4ec0\u9ebc\u662f TQuant Lab\uff1f","text":"<p>TQuant Lab \u662f\u4e00\u500b\u4e00\u7ad9\u5f0f\u7684\u91cf\u5316\u7814\u7a76\u5e73\u53f0\uff0c\u65e8\u5728\u63d0\u4f9b\u6700\u5b8c\u5584\u7684\u8cc7\u6599\u54c1\u8cea\u8207\u5167\u5bb9\uff0c\u4e26\u642d\u914d\u5f37\u5927\u7684\u4e8b\u4ef6\u9a45\u52d5\u578b\u56de\u6e2c\u7cfb\u7d71\u3002\u5b83\u6574\u5408\u4e86\uff1a</p> <ul> <li>PIT (Point In Time) \u91cf\u5316\u8cc7\u6599\u5eab\u8207\u8cc7\u6599\u6b78\u7d0d\u5de5\u5177\uff08TejToolAPI\uff09\u3002</li> <li>\u5c08\u696d\u7684\u56e0\u5b50\u5206\u6790\u5de5\u5177\u3002</li> <li>\u5168\u65b9\u4f4d\u7684\u7b56\u7565\u56de\u6e2c\u5f15\u64ce\u3002</li> <li>\u8a73\u7d30\u7684\u53ef\u8996\u5316\u5831\u8868\u5448\u73fe\u3002</li> </ul> <p>Note</p> <p>PIT (Point In Time) \u8cc7\u6599\u662f\u6307\u5728\u6b77\u53f2\u4e0a\u7279\u5b9a\u6642\u9593\u9ede\u6240\u80fd\u53d6\u5f97\u7684\u6700\u65b0\u8cc7\u6599\u3002\u4f7f\u7528 PIT \u8cc7\u6599\u80fd\u6709\u6548\u907f\u514d\u300c\u524d\u8996\u504f\u8aa4 (Look-ahead Bias)\u300d\uff0c\u78ba\u4fdd\u56de\u6e2c\u7d50\u679c\u7684\u771f\u5be6\u6027\u8207\u53ef\u9760\u6027\u3002</p>"},{"location":"tutorials/getting-started/#_1","title":"\u6838\u5fc3\u512a\u52e2","text":"<ul> <li> <p>\u6a21\u7d44\u5316\u7b56\u7565\u5efa\u69cb</p> <p>\u63d0\u4f9b\u9ad8\u5ea6\u81ea\u7531\u5316\u7684\u6a21\u7d44\u5316\u67b6\u69cb\uff0c\u8b93\u60a8\u53ef\u4ee5\u5c07\u8907\u96dc\u7684\u7b56\u7565\u6b65\u9a5f\u5316\u8655\u7406\u3002\u652f\u63f4\u540c\u6642\u8655\u7406\u591a\u91cd\u6a19\u7684\u8cb7\u8ce3\uff0c\u4e26\u5b8c\u6574\u5448\u73fe\u7b56\u7565\u7e3e\u6548\u8207\u98a8\u96aa\u6307\u6a19\u3002</p> </li> <li> <p>\u5b8c\u6574\u4e14\u7dad\u8b77\u826f\u597d\u7684\u8cc7\u6599\u5eab</p> <p>\u6574\u5408\u5b8c\u6574\u4e14\u7dad\u8b77\u826f\u597d\u7684\u8cc7\u6599\u5eab\u7cfb\u7d71\uff0c\u6240\u6709\u8cc7\u6599\u7686\u7d93\u904e\u56b4\u683c\u628a\u95dc\u8207\u7dad\u8b77\uff0c\u78ba\u4fdd\u56de\u6e2c\u7e3e\u6548\u7684\u6e96\u78ba\u6027\u3002</p> </li> <li> <p>\u5f37\u5927\u4e14\u56b4\u8b39\u7684\u56de\u6e2c\u5206\u6790\u5957\u4ef6</p> <p>\u5167\u5efa\u591a\u7a2e Python \u5206\u6790\u5de5\u5177\uff0c\u4e26\u63d0\u4f9b\u8c50\u5bcc\u7684\u53c3\u6578\u8abf\u6574\u9078\u9805\u3002\u5168\u65b9\u4f4d\u6a21\u64ec\u5e02\u5834\u4ea4\u6613\u74b0\u5883\uff0c\u5927\u5e45\u63d0\u5347\u5206\u6790\u7d50\u679c\u7684\u53ef\u4fe1\u5ea6\u3002</p> </li> </ul>"},{"location":"tutorials/getting-started/#_2","title":"\u4e3b\u8981\u529f\u80fd\u6a21\u7d44","text":"<p>TQuant Lab \u6574\u5408\u4e86\u591a\u500b\u696d\u754c\u9818\u5148\u7684\u958b\u6e90\u91cf\u5316\u5206\u6790\u5de5\u5177\uff0c\u4e26\u9032\u884c\u4e86\u512a\u5316\u8207\u6574\u5408\uff1a</p> <ul> <li> <p>Zipline</p> <p>\u4e8b\u4ef6\u9a45\u52d5\u578b\u56de\u6e2c\u5f15\u64ce\uff0c\u7528\u65bc\u6a21\u64ec\u4ea4\u6613\u7b56\u7565\u7684\u57f7\u884c\u3002</p> </li> <li> <p>Pipeline</p> <p>\u5f37\u5927\u7684\u8cc7\u6599\u8655\u7406\u8207\u56e0\u5b50\u751f\u6210\u6846\u67b6\uff0c\u5354\u52a9\u60a8\u69cb\u5efa\u8907\u96dc\u7684\u6295\u8cc7\u8a0a\u865f\u3002</p> </li> <li> <p>Pyfolio</p> <p>\u5c08\u696d\u7684\u7e3e\u6548\u5206\u6790\u5de5\u5177\uff0c\u63d0\u4f9b\u591a\u6a23\u5316\u7684\u5831\u8868\u8207\u8996\u89ba\u5316\u5448\u73fe\u3002</p> </li> <li> <p>Alphalens</p> <p>\u56e0\u5b50\u5206\u6790\u5de5\u5177\uff0c\u7528\u65bc\u8a55\u4f30\u6295\u8cc7\u56e0\u5b50\u7684\u6709\u6548\u6027\u3002</p> </li> <li> <p>TejToolAPI</p> <p>TEJ \u53f0\u7063\u7d93\u6fdf\u65b0\u5831\u63d0\u4f9b\u7684\u8cc7\u6599\u4ecb\u9762\uff0c\u65b9\u4fbf\u60a8\u53d6\u5f97\u9ad8\u54c1\u8cea\u7684\u8ca1\u52d9\u8207\u5e02\u5834\u8cc7\u6599\u3002</p> </li> </ul>"},{"location":"tutorials/getting-started/#_3","title":"\u5feb\u901f\u958b\u59cb","text":"<p>\u6e96\u5099\u597d\u958b\u59cb\u60a8\u7684\u91cf\u5316\u6295\u8cc7\u4e4b\u65c5\u4e86\u55ce\uff1f</p> <ol> <li>\u74b0\u5883\u5efa\u7f6e: \u4f9d\u7167 TQuant Lab \u5b89\u88dd \u6307\u5357\uff0c\u8a2d\u5b9a\u60a8\u7684\u958b\u767c\u74b0\u5883\u3002</li> <li>\u60a8\u7684\u7b2c\u4e00\u500b\u7b56\u7565: \u900f\u904e \u4f60\u7684\u7b2c\u4e00\u500b\u73fe\u8ca8\u7b56\u7565 \u6216 \u4f60\u7684\u7b2c\u4e00\u500b\u671f\u8ca8\u7b56\u7565 \u7bc4\u4f8b\uff0c\u5feb\u901f\u9ad4\u9a57 TQuant Lab \u7684\u56de\u6e2c\u529f\u80fd\u3002</li> </ol>"},{"location":"tutorials/quick-demo/","title":"10 \u5206\u9418\u9ad4\u9a57\uff1a\u60a8\u7684\u7b2c\u4e00\u500b Zipline \u56de\u6e2c\u7b56\u7565","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b Zipline \u56de\u6e2c\u7b56\u7565\u7684 10 \u5206\u9418\u5feb\u901f\u9ad4\u9a57\u6307\u5357\uff0c\u5305\u62ec\u74b0\u5883\u8a2d\u5b9a\u3001\u8cc7\u6599\u8f09\u5165\u3001\u7b56\u7565\u51fd\u5f0f\u8aaa\u660e\u3001\u57f7\u884c\u56de\u6e2c\u8207\u5206\u6790\u7d50\u679c\uff0c\u5e6b\u52a9\u60a8\u5feb\u901f\u4e0a\u624b TQuant Lab\u3002</p> <p>\u672c\u6307\u5357\u5c07\u5e36\u60a8\u900f\u904e\u4e00\u500b\u7c21\u55ae\u7684\u300c\u8cb7\u9032\u6301\u6709\u300d\u7b56\u7565\uff0c\u5feb\u901f\u9ad4\u9a57 TQuant Lab \u7684\u6838\u5fc3\u56de\u6e2c\u529f\u80fd\u3002\u60a8\u5c07\u4e86\u89e3\u5982\u4f55\u8a2d\u5b9a\u74b0\u5883\u3001\u8f09\u5165\u8cc7\u6599\u3001\u5b9a\u7fa9\u4ea4\u6613\u7b56\u7565\uff0c\u4e26\u57f7\u884c\u56de\u6e2c\u8207\u5206\u6790\u7d50\u679c\u3002</p>"},{"location":"tutorials/quick-demo/#1","title":"1. \u74b0\u5883\u8a2d\u5b9a\u8207\u8cc7\u6599\u8f09\u5165","text":"<p>\u5728\u4f7f\u7528 Zipline \u9032\u884c\u56de\u6e2c\u524d\uff0c\u9700\u8981\u8a2d\u5b9a TEJ API \u76f8\u95dc\u74b0\u5883\u8b8a\u6578\uff0c\u4e26\u8f09\u5165\u80a1\u50f9\u8cc7\u6599\u3002</p> <ol> <li> <p>\u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578 \uff1a     \u5728 Jupyter Notebook \u4e2d\u57f7\u884c\u4ee5\u4e0b\u7a0b\u5f0f\u78bc\uff0c\u5c07 <code>YOUR_API_KEY</code> \u66ff\u63db\u70ba\u60a8\u7684 TEJ API Key\u3002<code>mdate</code> \u8a2d\u5b9a\u8cc7\u6599\u5340\u9593\uff0c<code>ticker</code> \u8a2d\u5b9a\u80a1\u7968\u4ee3\u78bc\u3002</p> <pre><code>import os\nos.environ['TEJAPI_BASE'] = \"https://api.tej.com.tw\"\nos.environ['TEJAPI_KEY'] = \"YOUR_API_KEY\" # \u8acb\u66ff\u63db\u70ba\u60a8\u7684 API Key\nos.environ['mdate'] = \"20170601 20230702\" # \u8cc7\u6599\u8d77\u59cb\u65e5\u8207\u7d50\u675f\u65e5\nos.environ['ticker'] = '2330 IR0001' # \u80a1\u7968\u4ee3\u78bc (2330 \u70ba\u53f0\u7a4d\u96fb)\n</code></pre> </li> <li> <p>\u8f09\u5165\u80a1\u50f9\u8cc7\u6599 \uff1a     \u4f7f\u7528 <code>!zipline ingest</code> \u6307\u4ee4\u5c07\u8a2d\u5b9a\u597d\u7684\u8cc7\u6599\u8f09\u5165\u5230 Zipline \u7684 bundle \u4e2d\u3002</p> <pre><code>!zipline ingest -b tquant\n</code></pre> </li> </ol>"},{"location":"tutorials/quick-demo/#2-zipline","title":"2. \u7b56\u7565\u6838\u5fc3\uff1aZipline \u56de\u6e2c\u51fd\u6578","text":"<p>Zipline \u7b56\u7565\u4e3b\u8981\u7531\u56db\u500b\u6838\u5fc3\u51fd\u5f0f\u69cb\u6210\uff1a<code>initialize</code>\u3001<code>handle_data</code>\u3001<code>analyze</code> \u548c <code>run_algorithm</code>\u3002</p>"},{"location":"tutorials/quick-demo/#21-initializecontext","title":"2.1. initialize(context)","text":"<ul> <li>\u529f\u80fd \uff1a\u5728\u56de\u6e2c\u958b\u59cb\u524d\u57f7\u884c\u4e00\u6b21\uff0c\u7528\u65bc\u8a2d\u5b9a\u521d\u59cb\u74b0\u5883\uff0c\u4f8b\u5982\u8a2d\u5b9a\u6ed1\u50f9\u3001\u624b\u7e8c\u8cbb\uff0c\u6216\u521d\u59cb\u5316\u7b56\u7565\u6240\u9700\u7684\u8b8a\u6578\u3002</li> <li> <p>\u7bc4\u4f8b \uff1a\u8a2d\u5b9a\u6ed1\u50f9\u3001\u624b\u7e8c\u8cbb\uff0c\u4e26\u521d\u59cb\u5316 <code>context.day</code> \u548c <code>context.has_ordered</code> \u8b8a\u6578\u3002</p> <pre><code>from zipline.api import set_slippage, set_commission\nfrom zipline.finance import slippage, commission\n\ndef initialize(context):\n    context.day = 0\n    context.has_ordered = False # \u8ffd\u8e64\u662f\u5426\u5df2\u4e0b\u55ae\n    set_slippage(slippage.FixedSlippage()) # \u8a2d\u5b9a\u56fa\u5b9a\u6ed1\u50f9\n    set_commission(commission.PerShare(cost=0.00285)) # \u8a2d\u5b9a\u6bcf\u80a1\u624b\u7e8c\u8cbb\n</code></pre> </li> </ul>"},{"location":"tutorials/quick-demo/#22-handle_datacontext-data","title":"2.2. handle_data(context, data)","text":"<ul> <li>\u529f\u80fd \uff1a\u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u7d50\u675f\u6642\u57f7\u884c\u4e00\u6b21\uff0c\u7528\u65bc\u5b9a\u7fa9\u4ea4\u6613\u908f\u8f2f\u3001\u4e0b\u55ae\u64cd\u4f5c\u53ca\u8a18\u9304\u4ea4\u6613\u8cc7\u8a0a\u3002</li> <li>\u53c3\u6578 \uff1a<ul> <li><code>context</code>: \u5305\u542b\u7b56\u7565\u72c0\u614b\u7684\u7269\u4ef6\uff0c\u53ef\u5728\u4e0d\u540c\u51fd\u5f0f\u9593\u5171\u4eab\u8cc7\u8a0a\u3002</li> <li><code>data</code>: \u5305\u542b\u7576\u524d\u4ea4\u6613\u65e5\u6240\u6709\u8cc7\u7522\u7684\u6b77\u53f2\u8207\u7576\u524d\u5e02\u5834\u8cc7\u6599\u3002</li> </ul> </li> <li> <p>\u7bc4\u4f8b \uff1a\u5728\u7b2c\u4e00\u500b\u4ea4\u6613\u65e5\u8cb7\u5165\u53f0\u7a4d\u96fb (2330) \u80a1\u7968\uff0c\u4e26\u8a18\u9304\u76f8\u95dc\u8cc7\u8a0a\u3002</p> <pre><code>from zipline.api import order, record, symbol\n\ndef handle_data(context, data):\n    context.day += 1\n    if not context.has_ordered:\n        # \u5728\u7b2c\u4e00\u500b\u4ea4\u6613\u65e5\u8cb7\u5165 1000 \u80a1\u53f0\u7a4d\u96fb\n        order(symbol(\"2330\"), 1000)\n        context.has_ordered = True\n\n    # \u8a18\u9304\u4ea4\u6613\u65e5\u3001\u662f\u5426\u5df2\u4e0b\u55ae\u53ca\u53f0\u7a4d\u96fb\u6536\u76e4\u50f9\n    record(\n        trade_days = context.day,\n        has_ordered = context.has_ordered,\n        TSMC = data.current(symbol(\"2330\"), \"close\")\n    )\n</code></pre> </li> </ul>"},{"location":"tutorials/quick-demo/#23-analyzecontext-perf","title":"2.3. analyze(context, perf)","text":"<ul> <li>\u529f\u80fd \uff1a\u5728\u56de\u6e2c\u7d50\u675f\u5f8c\u57f7\u884c\u4e00\u6b21\uff0c\u7528\u65bc\u5206\u6790\u7b56\u7565\u7e3e\u6548\u4e26\u9032\u884c\u8996\u89ba\u5316\u3002</li> <li>\u53c3\u6578 \uff1a<ul> <li><code>context</code>: \u540c <code>initialize</code> \u548c <code>handle_data</code> \u4e2d\u7684 <code>context</code>\u3002</li> <li><code>perf</code>: \u5305\u542b\u56de\u6e2c\u7d50\u679c\u7684 DataFrame\uff0c\u53ef\u63d0\u53d6\u7e3e\u6548\u6307\u6a19\u3002</li> </ul> </li> <li> <p>\u7bc4\u4f8b \uff1a\u7e6a\u88fd\u6295\u8cc7\u7d44\u5408\u50f9\u503c\u8207\u53f0\u7a4d\u96fb\u80a1\u50f9\u8d70\u52e2\u5716\u3002</p> <pre><code>import matplotlib.pyplot as plt\n\ndef analyze(context, perf):\n    fig, (ax1, ax2) = plt.subplots(2, 1, sharex=True, figsize=(18, 8))\n    perf.portfolio_value.plot(ax=ax1, title='\u6295\u8cc7\u7d44\u5408\u50f9\u503c')\n    perf['TSMC'].plot(ax=ax2, title='\u53f0\u7a4d\u96fb\u6536\u76e4\u50f9')\n    plt.tight_layout()\n    plt.show()\n</code></pre> </li> </ul>"},{"location":"tutorials/quick-demo/#24-run_algorithm","title":"2.4. run_algorithm","text":"<ul> <li>\u529f\u80fd \uff1a \u555f\u52d5 Zipline \u56de\u6e2c\u5f15\u64ce\uff0c\u6574\u5408\u4e0a\u8ff0\u51fd\u5f0f\u4e26\u57f7\u884c\u7b56\u7565\u3002</li> <li>\u53c3\u6578 \uff1a<ul> <li><code>start</code>, <code>end</code>: \u56de\u6e2c\u7684\u8d77\u59cb\u8207\u7d50\u675f\u65e5\u671f\u3002</li> <li><code>initialize</code>, <code>handle_data</code>, <code>analyze</code>: \u50b3\u5165\u4e0a\u8ff0\u5b9a\u7fa9\u7684\u51fd\u5f0f\u3002</li> <li><code>capital_base</code>: \u521d\u59cb\u6295\u8cc7\u91d1\u984d\u3002</li> <li><code>bundle</code>: \u4f7f\u7528\u7684\u8cc7\u6599 bundle \u540d\u7a31\u3002</li> </ul> </li> <li> <p>\u7bc4\u4f8b \uff1a\u57f7\u884c\u5f9e 2018 \u5e74\u5e95\u5230 2023 \u5e74\u4e2d\u7684\u56de\u6e2c\u3002</p> <pre><code>from zipline import run_algorithm\nimport pandas as pd\n\nstart_date = pd.Timestamp('2018-12-30', tz='utc')\nend_date = pd.Timestamp('2023-05-26', tz='utc')\n\nresults = run_algorithm(\n    start=start_date,\n    end=end_date,\n    initialize=initialize,\n    capital_base=1e6, # \u521d\u59cb\u8cc7\u91d1 1,000,000\n    handle_data=handle_data,\n    analyze=analyze,\n    data_frequency='daily',\n    bundle='tquant'\n)\n</code></pre> </li> </ul>"},{"location":"tutorials/quick-demo/#3","title":"3. \u57f7\u884c\u56de\u6e2c\u8207\u7d50\u679c\u5206\u6790","text":"<p>\u5c07\u4e0a\u8ff0\u6240\u6709\u7a0b\u5f0f\u78bc\u7247\u6bb5\u4f9d\u5e8f\u5728 Jupyter Notebook \u4e2d\u57f7\u884c\uff0c<code>run_algorithm</code> \u51fd\u5f0f\u5c07\u6703\u555f\u52d5\u56de\u6e2c\uff0c\u4e26\u5728\u7d50\u675f\u5f8c\u81ea\u52d5\u547c\u53eb <code>analyze</code> \u51fd\u5f0f\u986f\u793a\u7e3e\u6548\u5716\u8868\u3002</p> <ol> <li> <p><code>results</code> \u8b8a\u6578\u6703\u5132\u5b58\u56de\u6e2c\u671f\u9593\u7684\u8a73\u7d30\u7e3e\u6548\u6578\u64da\uff0c\u60a8\u53ef\u4ee5\u9032\u4e00\u6b65\u6aa2\u8996\uff1a</p> <pre><code>results.head()\n</code></pre> </li> <li> <p>\u900f\u904e\u9019\u500b\u7c21\u55ae\u7684\u7bc4\u4f8b\uff0c\u60a8\u5df2\u6210\u529f\u57f7\u884c\u4e86\u7b2c\u4e00\u500b TQuant Lab Zipline \u56de\u6e2c\u7b56\u7565\uff01\u60a8\u53ef\u4ee5\u5617\u8a66\u4fee\u6539 <code>handle_data</code> \u4e2d\u7684\u908f\u8f2f\uff0c\u63a2\u7d22\u66f4\u591a\u5143\u7684\u4ea4\u6613\u7b56\u7565\u3002</p> </li> </ol>"},{"location":"tutorials/quick-reference/","title":"\u5e38\u7528\u529f\u80fd\u901f\u67e5\u8868","text":"<p>Info</p> <p>\u672c\u9801\u63d0\u4f9b TQuant Lab \u5e38\u7528\u529f\u80fd\u7684\u5feb\u901f\u67e5\u8a62\u6307\u5357\uff0c\u5e6b\u52a9\u60a8\u8fc5\u901f\u627e\u5230\u95dc\u9375\u51fd\u6578\u8207\u64cd\u4f5c\u65b9\u5f0f\u3002</p> <p>\u5feb\u901f\u67e5\u8a62\u5e38\u898b\u4efb\u52d9\u7684\u89e3\u6c7a\u65b9\u6848\u3002\u6bcf\u500b\u90e8\u5206\u90fd\u5305\u542b\u4ee3\u78bc\u793a\u4f8b\u548c\u6307\u5411\u8a73\u7d30\u6587\u6a94\u7684\u9023\u7d50\u3002</p>"},{"location":"tutorials/quick-reference/#_2","title":"\u5feb\u901f\u8df3\u8f49","text":"<p>\u5728\u4e0b\u65b9\u5feb\u901f\u5b9a\u4f4d\u4f60\u9700\u8981\u7684\u5167\u5bb9\uff1a</p> <ul> <li>\u8cc7\u6599\u7ba1\u7406 - \u7372\u53d6\u80a1\u7968\u6578\u64da\u3001\u57fa\u672c\u9762\u8cc7\u6599\u3001\u57fa\u6e96\u6307\u6578</li> <li>\u7b56\u7565\u7de8\u5beb - \u521d\u59cb\u5316\u53c3\u6578\u3001\u7de8\u5beb\u4ea4\u6613\u908f\u8f2f\u3001\u4f7f\u7528 Pipeline</li> <li>\u4ea4\u6613\u57f7\u884c - \u4e0b\u55ae\u3001\u67e5\u8a62\u6301\u5009\u3001\u8a2d\u7f6e\u624b\u7e8c\u8cbb\u548c\u6ed1\u50f9</li> <li>\u4ea4\u6613\u9650\u5236 - \u8a2d\u7f6e\u69d3\u687f\u3001\u7981\u6b62\u4ea4\u6613\u6e05\u55ae\u3001\u4ea4\u6613\u983b\u7387\u9650\u5236</li> <li>\u7e3e\u6548\u5206\u6790 - Pyfolo \u5831\u8868\u3001\u56e0\u5b50\u5206\u6790\u3001\u81ea\u8a02\u6307\u6a19</li> <li>API \u53c3\u8003 - symbol()\u3001data.history()\u3001context.portfolio</li> <li>\u5e38\u898b\u554f\u984c - \u8abf\u8a66\u6280\u5de7\u3001\u5feb\u901f\u8a3a\u65b7</li> </ul>"},{"location":"tutorials/quick-reference/#data-management","title":"\u8cc7\u6599\u7ba1\u7406","text":""},{"location":"tutorials/quick-reference/#_3","title":"\u5982\u4f55\u53d6\u5f97\u80a1\u7968\u6b77\u53f2\u50f9\u683c\uff1f","text":"<pre><code>from zipline.api import data\nprices = data.history(symbol('2330'), 'close', 100, '1d')\n</code></pre> <p>\u8a73\u898b\uff1a\u5982\u4f55 Ingest \u80a1\u7968\u50f9\u91cf\u8cc7\u6599</p>"},{"location":"tutorials/quick-reference/#tej","title":"\u5982\u4f55\u52a0\u8f09 TEJ \u57fa\u672c\u9762\u8cc7\u6599\uff1f","text":"<pre><code>import TejToolAPI\napi = TejToolAPI.TejToolAPI()\ndf = api.get_history_data(tickers='2330', fields=['PER', 'PBR'], date='20230101')\n</code></pre> <p>\u8a73\u898b\uff1a\u5982\u4f55 Ingest TEJ \u8ca1\u52d9/\u975e\u8ca1\u52d9\u8cc7\u6599</p>"},{"location":"tutorials/quick-reference/#_4","title":"\u5982\u4f55\u53d6\u5f97\u57fa\u6e96\u6307\u6578\u5831\u916c\uff1f","text":"<p>\u5728 <code>run_algorithm()</code> \u4e2d\u6307\u5b9a\uff1a</p> <pre><code>run_algorithm(\n    benchmark_symbol='0050',  # \u53f0\u7063 50 \u6307\u6578\n)\n</code></pre> <p>\u8a73\u898b\uff1a\u5982\u4f55\u53d6\u5f97 Benchmark \u5831\u916c\u7387</p>"},{"location":"tutorials/quick-reference/#strategy-writing","title":"\u7b56\u7565\u7de8\u5beb","text":""},{"location":"tutorials/quick-reference/#_5","title":"\u5982\u4f55\u521d\u59cb\u5316\u7b56\u7565\u53c3\u6578\uff1f","text":"<pre><code>def initialize(context):\n    context.max_leverage = 1.0\n    context.stocks = [symbol('2330'), symbol('2454')]\n    context.long_window = 50\n    context.short_window = 20\n</code></pre> <p>\u8a73\u898b\uff1aZipline \u751f\u547d\u9031\u671f\u51fd\u6578</p>"},{"location":"tutorials/quick-reference/#_6","title":"\u5982\u4f55\u5728\u6bcf\u500b\u4ea4\u6613\u65e5\u57f7\u884c\u64cd\u4f5c\uff1f","text":"<pre><code>def handle_data(context, data):\n    # \u9019\u500b\u51fd\u6578\u6bcf\u5929\u57f7\u884c\u4e00\u6b21\n    prices = data.history(symbol('2330'), 'close', 20, '1d')\n    avg = prices.mean()\n\n    if avg &gt; some_threshold:\n        order(symbol('2330'), 100)\n</code></pre> <p>\u8a73\u898b\uff1aZipline \u751f\u547d\u9031\u671f\u51fd\u6578</p>"},{"location":"tutorials/quick-reference/#_7","title":"\u5982\u4f55\u8a08\u7b97\u56e0\u5b50\u4e26\u904e\u6ffe\u80a1\u7968\uff1f","text":"<pre><code>from zipline.pipeline import Pipeline, screen\nfrom zipline.pipeline.factors import CustomFactor\n\npipeline = Pipeline(\n    columns={\n        'momentum': CustomFactor(...),\n    },\n    screen=Q(pe_ratio &lt; 20),\n)\n</code></pre> <p>\u8a73\u898b\uff1aPipeline \u81ea\u8a02\u56e0\u5b50</p>"},{"location":"tutorials/quick-reference/#trade-execution","title":"\u4ea4\u6613\u57f7\u884c","text":""},{"location":"tutorials/quick-reference/#_8","title":"\u5982\u4f55\u4e0b\u8cb7\u55ae\uff1f","text":"<pre><code>order(symbol('2330'), 100)  # \u8cb7 100 \u80a1\n</code></pre>"},{"location":"tutorials/quick-reference/#_9","title":"\u5982\u4f55\u4e0b\u8ce3\u55ae\uff1f","text":"<pre><code>order(symbol('2330'), -100)  # \u8ce3 100 \u80a1\n</code></pre>"},{"location":"tutorials/quick-reference/#_10","title":"\u5982\u4f55\u4e00\u6b21\u8cb7\u5165\u6240\u6709\u8cc7\u91d1\u53ef\u8cfc\u8cb7\u7684\u80a1\u7968\uff1f","text":"<pre><code>price = data.current(symbol('2330'), 'price')\ncash = context.portfolio.cash\nshares = int(cash / price)\norder(symbol('2330'), shares)\n</code></pre> <p>\u8a73\u898b\uff1a\u4e0b\u55ae\u51fd\u6578</p>"},{"location":"tutorials/quick-reference/#_11","title":"\u5982\u4f55\u67e5\u8a62\u7576\u524d\u6301\u5009\uff1f","text":"<pre><code>positions = context.portfolio.positions\nfor asset, position in positions.items():\n    print(f\"\u80a1\u7968: {asset}, \u6578\u91cf: {position.amount}, \u6210\u672c: {position.cost_basis}\")\n</code></pre> <p>\u8a73\u898b\uff1acontext \u8b8a\u6578</p>"},{"location":"tutorials/quick-reference/#_12","title":"\u5982\u4f55\u8a2d\u5b9a\u624b\u7e8c\u8cbb\uff1f","text":"<pre><code>from zipline.finance import commission\n\nset_commission(commission.PerShare(cost=0.001))  # \u6bcf\u80a1 0.001 \u5143\n</code></pre> <p>\u8a73\u898b\uff1a\u5982\u4f55\u8a2d\u5b9a\u624b\u7e8c\u8cbb\u6a21\u578b</p>"},{"location":"tutorials/quick-reference/#_13","title":"\u5982\u4f55\u8a2d\u5b9a\u6ed1\u50f9\uff1f","text":"<pre><code>from zipline.finance import slippage\n\nset_slippage(slippage.FixedSlippage(0.001))  # \u56fa\u5b9a 0.1%\n</code></pre> <p>\u8a73\u898b\uff1a\u5982\u4f55\u8a2d\u5b9a\u6ed1\u50f9\u6a21\u578b</p>"},{"location":"tutorials/quick-reference/#trading-controls","title":"\u4ea4\u6613\u9650\u5236","text":""},{"location":"tutorials/quick-reference/#_14","title":"\u5982\u4f55\u9650\u5236\u6700\u5927\u69d3\u687f\uff1f","text":"<pre><code>set_max_leverage(2.0)  # \u6700\u591a\u501f 2 \u500d\u8cc7\u91d1\n</code></pre>"},{"location":"tutorials/quick-reference/#_15","title":"\u5982\u4f55\u8a2d\u5b9a\u7981\u6b62\u4ea4\u6613\u6e05\u55ae\uff1f","text":"<pre><code>set_do_not_order_list([symbol('2881'), symbol('2882')])\n</code></pre>"},{"location":"tutorials/quick-reference/#_16","title":"\u5982\u4f55\u8a2d\u5b9a\u55ae\u65e5\u6700\u5927\u4ea4\u6613\u7b46\u6578\uff1f","text":"<pre><code>set_max_order_count(10)  # \u6700\u591a\u4e0b 10 \u55ae\n</code></pre> <p>\u8a73\u898b\uff1a\u5982\u4f55\u8a2d\u5b9a\u4ea4\u6613\u9650\u5236</p>"},{"location":"tutorials/quick-reference/#performance-analysis","title":"\u7e3e\u6548\u5206\u6790","text":""},{"location":"tutorials/quick-reference/#pyfolo","title":"\u5982\u4f55\u751f\u6210 Pyfolo \u5831\u8868\uff1f","text":"<pre><code>import pyfolio as pf\npf.create_tear_sheet(returns, positions, transactions)\n</code></pre> <p>\u8a73\u898b\uff1a\u5982\u4f55\u7522\u751f Pyfolo \u7e3e\u6548\u5831\u8868</p>"},{"location":"tutorials/quick-reference/#_17","title":"\u5982\u4f55\u9032\u884c\u56e0\u5b50\u5206\u6790\uff1f","text":"<pre><code>import alphalens as al\nal.tears.create_factor_tear_sheet(factor, prices)\n</code></pre> <p>\u8a73\u898b\uff1a\u5982\u4f55\u57f7\u884c Alphalens \u56e0\u5b50\u5206\u6790</p>"},{"location":"tutorials/quick-reference/#_18","title":"\u5982\u4f55\u8a18\u9304\u81ea\u8a02\u6307\u6a19\uff1f","text":"<pre><code>def handle_data(context, data):\n    # ... \u4ea4\u6613\u908f\u8f2f ...\n\n    record(\n        portfolio_value=context.portfolio.portfolio_value,\n        leverage=context.account.leverage,\n        custom_signal=some_value\n    )\n</code></pre> <p>\u8a73\u898b\uff1acontext \u8b8a\u6578</p>"},{"location":"tutorials/quick-reference/#api-reference","title":"\u5e38\u7528 API \u53c3\u8003","text":""},{"location":"tutorials/quick-reference/#symbol-","title":"symbol() - \u7372\u53d6\u80a1\u7968\u5c0d\u8c61","text":"<pre><code>from zipline.api import symbol\n\ntsmc = symbol('2330')  # TSMC\n</code></pre>"},{"location":"tutorials/quick-reference/#datahistory-","title":"data.history() - \u7372\u53d6\u6b77\u53f2\u6578\u64da","text":"<pre><code>prices = data.history(stock, 'close', 50, '1d')  # \u904e\u53bb 50 \u65e5\u6536\u76e4\u50f9\nvolumes = data.history(stock, 'volume', 20, '1d')  # \u904e\u53bb 20 \u65e5\u6210\u4ea4\u91cf\n</code></pre>"},{"location":"tutorials/quick-reference/#datacurrent-","title":"data.current() - \u7372\u53d6\u7576\u524d\u50f9\u683c","text":"<pre><code>current_price = data.current(stock, 'price')\ncurrent_volume = data.current(stock, 'volume')\n</code></pre>"},{"location":"tutorials/quick-reference/#contextportfolio-","title":"context.portfolio - \u6295\u8cc7\u7d44\u5408\u4fe1\u606f","text":"<pre><code>context.portfolio.portfolio_value  # \u7e3d\u8cc7\u7522\ncontext.portfolio.cash             # \u73fe\u91d1\ncontext.portfolio.positions        # \u6301\u5009\u5b57\u5178\n</code></pre> <p>\u8a73\u898b\uff1acontext \u8b8a\u6578\u5b8c\u6574\u53c3\u8003</p>"},{"location":"tutorials/quick-reference/#_19","title":"\u5b8c\u6574\u7b56\u7565\u7bc4\u672c","text":"<p>\u4e00\u500b\u6700\u5c0f\u5316\u4f46\u5b8c\u6574\u7684\u7b56\u7565\u6846\u67b6\uff1a</p> <pre><code>from zipline import run_algorithm\nfrom zipline.api import order, symbol, record\nfrom datetime import datetime\n\ndef initialize(context):\n    context.stock = symbol('2330')\n\ndef handle_data(context, data):\n    price = data.current(context.stock, 'price')\n    order(context.stock, 10)\n    record(price=price)\n\ndef analyze(context, perf):\n    print(f\"Return: {perf['algorithm_period_return'][-1]:.2%}\")\n\nrun_algorithm(\n    start=datetime(2022, 1, 1),\n    end=datetime(2023, 1, 1),\n    initialize=initialize,\n    handle_data=handle_data,\n    analyze=analyze,\n    capital_base=100000,\n    bundle='tquant',\n)\n</code></pre>"},{"location":"tutorials/quick-reference/#troubleshooting","title":"\u5feb\u901f\u8a3a\u65b7","text":""},{"location":"tutorials/quick-reference/#_20","title":"\u70ba\u4ec0\u9ebc\u6211\u7684\u7b56\u7565\u6c92\u6709\u4e0b\u55ae\uff1f","text":"\u539f\u56e0 \u6aa2\u67e5\u65b9\u6cd5 \u8cc7\u91d1\u4e0d\u8db3 \u6aa2\u67e5 <code>context.portfolio.cash</code> \u80a1\u7968\u4ee3\u78bc\u932f\u8aa4 \u78ba\u4fdd symbol() \u4f7f\u7528\u6b63\u78ba\u7684\u4ee3\u78bc \u6578\u64da\u4e0d\u53ef\u7528 \u6aa2\u67e5\u56de\u6e2c\u671f\u9593\u662f\u5426\u6709\u8a72\u80a1\u7968\u7684\u6578\u64da \u908f\u8f2f\u932f\u8aa4 \u5728 <code>handle_data()</code> \u4e2d\u6dfb\u52a0 <code>print()</code> \u8abf\u8a66"},{"location":"tutorials/quick-reference/#_21","title":"\u5982\u4f55\u8abf\u8a66\u7b56\u7565\uff1f","text":"<pre><code>def handle_data(context, data):\n    # \u6dfb\u52a0 print \u8a9e\u53e5\n    print(f\"Date: {data.current_dt}\")\n    print(f\"Cash: {context.portfolio.cash}\")\n    print(f\"Portfolio value: {context.portfolio.portfolio_value}\")\n\n    # ... \u5176\u4ed6\u908f\u8f2f ...\n</code></pre>"},{"location":"tutorials/quick-reference/#_22","title":"\u9032\u968e\u4e3b\u984c","text":"<ul> <li>Pipeline \u5167\u5efa\u56e0\u5b50</li> <li>\u81ea\u8a02 Pipeline \u56e0\u5b50</li> <li>\u4ea4\u6613\u65e5\u66c6\u8a2d\u5b9a</li> <li>Zipline \u8cc7\u6599\u7269\u4ef6</li> </ul>"},{"location":"tutorials/quick-reference/#_23","title":"\u7121\u6cd5\u627e\u5230\u7b54\u6848\uff1f","text":"<ul> <li>\u67e5\u770b \u65b0\u624b\u5fc5\u8b80</li> <li>\u95b1\u8b80 \u6838\u5fc3\u6982\u5ff5</li> <li>\u67e5\u8a62 \u5b8c\u6574 API \u53c3\u8003</li> <li>\u67e5\u95b1 10 \u5206\u9418\u5feb\u901f\u9ad4\u9a57</li> </ul>"},{"location":"tutorials/setup/","title":"\u74b0\u5883\u5efa\u7f6e\uff1a\u5b89\u88dd\u8207\u8a2d\u5b9a TQuant Lab","text":"<p>Info</p> <p>\u672c\u6587\u4ef6\u63d0\u4f9b TQuant Lab \u7684\u8a73\u7d30\u5b89\u88dd\u8207\u74b0\u5883\u8a2d\u5b9a\u6307\u5357\uff0c\u78ba\u4fdd\u60a8\u80fd\u9806\u5229\u555f\u52d5\u4e26\u958b\u59cb\u4f7f\u7528\u5e73\u53f0\u3002</p>"},{"location":"tutorials/setup/#_1","title":"\u7cfb\u7d71\u8981\u6c42\u8207\u652f\u63f4\u74b0\u5883","text":"<p>\u5728\u5b89\u88dd TQuant Lab \u4e4b\u524d\uff0c\u8acb\u78ba\u8a8d\u60a8\u7684\u7cfb\u7d71\u7b26\u5408\u4ee5\u4e0b\u8981\u6c42\uff1a</p> <ul> <li>\u4e3b\u8981\u5957\u4ef6\uff1aZipline (Zipline-tej)</li> <li>\u652f\u63f4 Python \u7248\u672c\uff1aPython 3.8 ~ 3.11 ( \u5efa\u8b70\u4f7f\u7528 Python 3.11 )</li> <li>\u652f\u63f4\u4f5c\u696d\u7cfb\u7d71\uff1aMicrosoft Windows OS, macOS \u6216 Linux (Linux \u4f7f\u7528\u8005\u8acb\u512a\u5148\u63a1\u7528\u300cA. \u900f\u904e Docker \u5b89\u88dd\u300d\u6d41\u7a0b)</li> <li>Pandas \u7248\u672c\uff1a\u5efa\u8b70 1.5.3 \u6216 2.0.0\uff1b\u9ad8\u65bc 2.0.0 \u53ef\u80fd\u4e0d\u76f8\u5bb9\u3002</li> <li>NumPy \u7248\u672c\uff1a\u5efa\u8b70 1.23.5\uff1b\u9ad8\u65bc 1.23.5 \u53ef\u80fd\u4e0d\u76f8\u5bb9\u3002</li> </ul>"},{"location":"tutorials/setup/#_2","title":"\u5b89\u88dd\u65b9\u5f0f","text":"<p>\u4ee5\u4e0b\u63d0\u4f9b\u4e09\u7a2e\u5b89\u88dd <code>zipline-tej</code> (TQuant Lab \u7684\u6838\u5fc3\u5957\u4ef6) \u7684\u65b9\u5f0f\uff0c \u5efa\u8b70\u512a\u5148\u63a1\u7528 1 \u6216 2 \u65b9\u5f0f \u3002</p>"},{"location":"tutorials/setup/#1-docker-zipline-tej","title":"1. \u900f\u904e Docker \u5b89\u88dd zipline-tej ( \u63a8\u85a6 )","text":"<p>\u4f7f\u7528 Docker \u5b89\u88dd\u662f\u6700\u63a8\u85a6\u7684\u65b9\u5f0f\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u500b\u9694\u96e2\u4e14\u4e00\u81f4\u7684\u904b\u884c\u74b0\u5883\uff0c\u80fd\u6709\u6548\u907f\u514d\u5957\u4ef6\u76f8\u4f9d\u6027\u554f\u984c\u3002</p>"},{"location":"tutorials/setup/#11","title":"1.1 \u5148\u6c7a\u689d\u4ef6","text":"<p>\u8acb\u78ba\u4fdd\u60a8\u7684\u7cfb\u7d71\u5df2\u5b89\u88dd Docker Desktop\uff1a</p> <ul> <li>Mac \u4f7f\u7528\u8005\u8acb\u9ede\u6b64</li> <li>Windows \u4f7f\u7528\u8005\u8acb\u9ede\u6b64</li> <li>Linux \u4f7f\u7528\u8005\u8acb\u9ede\u6b64</li> </ul> <p>\u91cd\u65b0\u555f\u52d5\u60a8\u7684\u96fb\u8166</p> <p>\u5982\u679c\u60a8\u525b\u5728 Windows \u7cfb\u7d71\u4e0a\u5b89\u88dd\u4e86 Docker\uff0c\u8acb\u8a18\u5f97\u91cd\u65b0\u555f\u52d5\u96fb\u8166\uff0c\u5426\u5247\u53ef\u80fd\u6703\u9047\u5230\u5bb9\u5668\u7db2\u8def\u9023\u7dda\u65b9\u9762\u7684\u7570\u5e38\u554f\u984c\u3002</p>"},{"location":"tutorials/setup/#12","title":"1.2 \u5b89\u88dd\u6b65\u9a5f","text":"<ol> <li> <p>\u5f9e Docker Hub \u4e0b\u8f09\u6620\u50cf\u6a94 \uff1a     \u5728\u7d42\u7aef\u6a5f\u4e2d\u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\uff0c\u4e0b\u8f09\u5b98\u65b9 <code>tquant</code> Docker \u6620\u50cf\u6a94\uff1a</p> <pre><code>docker pull tej87681088/tquant:latest\n</code></pre> </li> <li> <p>\u5efa\u7acb\u8cc7\u6599\u5132\u5b58\u7a7a\u9593 (Volume) \uff1a     \u5efa\u7acb\u4e00\u500b Docker Volume \u4f86\u6301\u4e45\u5316\u60a8\u7684\u8cc7\u6599\uff0c\u907f\u514d\u5bb9\u5668\u522a\u9664\u5f8c\u8cc7\u6599\u907a\u5931\uff1a</p> <pre><code>docker volume create data\n</code></pre> </li> <li> <p>\u555f\u52d5 <code>tquant</code> \u5bb9\u5668 \uff1a     \u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\u555f\u52d5\u5bb9\u5668\u3002\u6b64\u547d\u4ee4\u6703\u5c07 <code>data</code> volume \u639b\u8f09\u5230\u5bb9\u5668\u5167\u90e8\u7684 <code>/app</code> \u76ee\u9304\uff0c\u4e26\u5c07\u60a8\u7684\u672c\u6a5f 8888 \u57e0\u6620\u5c04\u5230\u5bb9\u5668\u5167\u7684 8888 \u57e0\u3002</p> <pre><code>docker run -v data:/app -p 8888:8888 --name tquant tej87681088/tquant\n</code></pre> <p>\u88dc\u5145\u8aaa\u660e</p> <ul> <li><code>volume</code> \u5728 Windows 10 WSL \u74b0\u5883\u4e2d\u7684\u4f4d\u7f6e\u901a\u5e38\u70ba\uff1a<code>\\wsl$\\docker-desktop-data\\data\\docker\\volumes\\data\\_data</code></li> <li>\u82e5\u60a8\u5e0c\u671b\u5bb9\u5668\u5728\u505c\u6b62\u6642\u81ea\u52d5\u79fb\u9664\uff0c\u53ef\u4ee5\u5728 <code>docker run</code> \u547d\u4ee4\u4e2d\u52a0\u5165 <code>--rm</code> \u53c3\u6578\u3002</li> </ul> </li> </ol>"},{"location":"tutorials/setup/#13-jupyter-notebook","title":"1.3 \u4f7f\u7528 Jupyter Notebook","text":"<p>\u5bb9\u5668\u555f\u52d5\u5f8c\uff0c\u60a8\u6703\u5728\u7d42\u7aef\u6a5f\u4e2d\u770b\u5230\u985e\u4f3c\u4ee5\u4e0b\u7684\u7db2\u5740\u3002\u8907\u88fd\u8a72\u7db2\u5740\u4e26\u8cbc\u81f3\u700f\u89bd\u5668\u5373\u53ef\u958b\u59cb\u4f7f\u7528 Jupyter Notebook\u3002</p> <pre><code>http://127.0.0.1:8888/tree?token=XXXXXXXXXXXXXXXX\n</code></pre>"},{"location":"tutorials/setup/#14-container","title":"1.4 \u64cd\u4f5c\u5df2\u95dc\u9589\u7684\u5bb9\u5668 (Container)","text":"<p>\u82e5\u60a8\u9700\u8981\u64cd\u4f5c\u4e4b\u524d\u5275\u5efa\u4f46\u5df2\u95dc\u9589\u7684\u5bb9\u5668\uff0c\u8acb\u4f9d\u7167\u4ee5\u4e0b\u6b65\u9a5f\uff1a</p> <ol> <li> <p>\u5217\u51fa\u6240\u6709\u5bb9\u5668 (\u5305\u62ec\u5df2\u505c\u6b62\u7684)\uff1a</p> <pre><code>docker ps -a\n</code></pre> </li> <li> <p>\u555f\u52d5\u6307\u5b9a\u5bb9\u5668 \uff1a     \u5c07 <code>&lt;CONTAINER_ID&gt;</code> \u66ff\u63db\u70ba <code>docker ps -a</code> \u67e5\u8a62\u5230\u7684\u5be6\u969b\u5bb9\u5668 ID\u3002</p> <pre><code>docker start &lt;CONTAINER_ID&gt;\n</code></pre> </li> <li> <p>\u67e5\u770b\u5bb9\u5668\u65e5\u8a8c \uff1a     \u986f\u793a\u6307\u5b9a\u5bb9\u5668\u7684\u6700\u8fd1\u65e5\u8a8c (\u4f8b\u5982\u6700\u5f8c 50 \u884c)\uff1a</p> <pre><code>docker logs --tail 50 &lt;CONTAINER_ID&gt;\n</code></pre> </li> </ol>"},{"location":"tutorials/setup/#15-tquant-docker","title":"1.5 \u66f4\u65b0 tquant Docker \u5bb9\u5668","text":"<p>\u70ba\u78ba\u4fdd\u60a8\u4f7f\u7528\u7684 <code>tquant</code> \u74b0\u5883\u662f\u6700\u65b0\u7248\u672c\uff0c\u8acb\u5b9a\u671f\u66f4\u65b0\u60a8\u7684 Docker \u5bb9\u5668\u3002\u9019\u4e9b\u6b65\u9a5f\u6703\u505c\u6b62\u4e26\u522a\u9664\u73fe\u6709\u5bb9\u5668\uff0c\u4f46\u7531\u65bc\u8cc7\u6599\u5132\u5b58\u5728 <code>volume</code> \u4e2d\uff0c\u60a8\u7684\u8cc7\u6599\u5c07\u4e0d\u6703\u907a\u5931\u3002</p> <ol> <li> <p>\u505c\u6b62\u4e26\u522a\u9664\u73fe\u6709 <code>tquant</code> \u5bb9\u5668 \uff1a</p> <pre><code>docker stop tquant\ndocker rm tquant\n</code></pre> </li> <li> <p>\u4e0b\u8f09\u6700\u65b0 <code>tquant</code> \u6620\u50cf\u6a94 \uff1a</p> <pre><code>docker pull tej87681088/tquant:latest\n</code></pre> </li> <li> <p>\u91cd\u65b0\u555f\u52d5\u5bb9\u5668 \uff1a     \u4f7f\u7528\u5efa\u7acb <code>volume</code> \u7684\u65b9\u5f0f\u91cd\u65b0\u555f\u52d5\u5bb9\u5668\u3002</p> <pre><code>docker run -v data:/app -p 8888:8888 --name tquant tej87681088/tquant\n</code></pre> </li> </ol>"},{"location":"tutorials/setup/#2-anaconda-prompt-zipline-tej","title":"2. \u900f\u904e Anaconda Prompt \u4e00\u9375\u5b89\u88dd zipline-tej ( \u63a8\u85a6 )","text":"<p>\u6b64\u65b9\u5f0f\u9069\u7528\u65bc\u5df2\u5b89\u88dd Anaconda \u7684\u4f7f\u7528\u8005\uff0c\u53ef\u900f\u904e\u9810\u8a2d\u7684\u74b0\u5883\u914d\u7f6e\u6587\u4ef6\u5feb\u901f\u8a2d\u5b9a\u597d\u904b\u884c\u74b0\u5883\u3002</p> <ol> <li> <p>\u4e0b\u8f09\u74b0\u5883\u914d\u7f6e\u6587\u4ef6 \uff1a     \u6839\u64da\u60a8\u7684\u4f5c\u696d\u7cfb\u7d71\u4e0b\u8f09\u5c0d\u61c9\u7684 <code>yml</code> \u6a94\u6848\uff1a</p> <ul> <li>Windows (zipline-tej.yml) (Raw \u9023\u7d50)</li> <li>Mac (zipline-tej_mac.yml) (Raw \u9023\u7d50)</li> </ul> </li> <li> <p>\u5efa\u7acb\u4e26\u555f\u52d5\u865b\u64ec\u74b0\u5883 \uff1a     \u958b\u555f Anaconda Prompt \uff0c\u5c07\u4e0b\u8f09\u597d\u7684 <code>yml</code> \u6a94\u6848\u653e\u7f6e\u65bc\u4efb\u4e00\u76ee\u9304\u5f8c\uff0c\u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\uff1a</p> <pre><code># Windows \u4f7f\u7528\u8005\n# \u5c07 zipline-tej.yml \u6a94\u6848\u6240\u5728\u7684\u76ee\u9304\u66ff\u63db\u5230 &lt;C:\\Users\\username\\Downloads&gt;\ncd &lt;C:\\Users\\username\\Downloads&gt;\n\n# \u900f\u904e yml \u6a94\u5b89\u88dd\u6240\u9700\u5957\u4ef6\u4e26\u5275\u5efa\u865b\u64ec\u74b0\u5883\nconda env create -f zipline-tej.yml\n\n# \u555f\u52d5\u865b\u64ec\u74b0\u5883\nconda activate zipline-tej\n</code></pre> <pre><code># Mac \u4f7f\u7528\u8005\n# \u5c07 zipline-tej_mac.yml \u6a94\u6848\u6240\u5728\u7684\u76ee\u9304\u66ff\u63db\u5230 /Users/username/Downloads\ncd /Users/username/Downloads\n\n# \u900f\u904e yml \u6a94\u5b89\u88dd\u6240\u9700\u5957\u4ef6\u4e26\u5275\u5efa\u865b\u64ec\u74b0\u5883\nconda env create -f zipline-tej_mac.yml\n\n# \u555f\u52d5\u865b\u64ec\u74b0\u5883\nconda activate zipline-tej\n</code></pre> <p>\u70ba\u4ec0\u9ebc\u5efa\u8b70\u4f7f\u7528\u865b\u64ec\u74b0\u5883\uff1f</p> <p>\u4f7f\u7528\u865b\u64ec\u74b0\u5883\u53ef\u4ee5\u70ba\u4e0d\u540c\u7684\u5c08\u6848\u5efa\u7acb\u7368\u7acb\u7684 Python \u904b\u884c\u74b0\u5883\uff0c\u6709\u6548\u907f\u514d\u4e0d\u540c\u5c08\u6848\u9593\u7684\u5957\u4ef6\u885d\u7a81\u554f\u984c\u3002</p> </li> </ol>"},{"location":"tutorials/setup/#3-pip-install-zipline-tej","title":"3. \u76f4\u63a5\u900f\u904e pip install \u5b89\u88dd zipline-tej (\u53ef\u80fd\u6703\u6709\u672a\u9810\u671f\u7684\u932f\u8aa4)","text":"<p>\u6b64\u65b9\u6cd5\u8f03\u4e0d\u63a8\u85a6\uff0c\u56e0\u70ba\u53ef\u80fd\u6703\u6709\u672a\u9810\u671f\u7684\u5957\u4ef6\u76f8\u4f9d\u6027\u554f\u984c\uff0c\u9700\u81ea\u884c\u9664\u932f\u3002</p>"},{"location":"tutorials/setup/#31-zipline-tej","title":"3.1 \u65bc\u672c\u6a5f\u7aef\u5b89\u88dd zipline-tej","text":"<p>\u5efa\u8b70\u5728\u7368\u7acb\u7684\u865b\u64ec\u74b0\u5883\u4e2d\u9032\u884c\u5b89\u88dd\uff1a</p> <ol> <li> <p>\u5efa\u7acb\u8207\u555f\u52d5\u865b\u64ec\u74b0\u5883 \uff1a\u900f\u904e Anaconda \u6216 Python \u539f\u751f <code>venv</code> \u5efa\u7acb\u3002</p> <ul> <li> <p>\u65b9\u6cd5\u4e00\uff1aAnaconda \u6307\u4ee4     \u958b\u555f Anaconda Prompt\uff1a</p> <pre><code># \u5275\u5efa\u865b\u64ec\u74b0\u5883\nconda create -n &lt;env_name&gt; python=3.11\n\n# \u555f\u52d5\u865b\u64ec\u74b0\u5883\nconda activate &lt;env_name&gt;\n</code></pre> </li> <li> <p>\u65b9\u6cd5\u4e8c\uff1aPython \u539f\u751f\u6307\u4ee4     \u958b\u555f\u7d42\u7aef\u6a5f (CMD)\uff1a</p> <p><pre><code># \u5275\u5efa\u865b\u64ec\u74b0\u5883\npython -m venv venv\n\n# \u555f\u52d5\u865b\u64ec\u74b0\u5883 (Windows)\nvenv\\Scripts\\activate.bat\n</code></pre> <pre><code># \u6216 (macOS/Linux)\nsource venv/bin/activate\n</code></pre></p> </li> </ul> </li> <li> <p>\u5b89\u88dd\u5957\u4ef6 \uff1a</p> </li> </ol>"},{"location":"tutorials/setup/#311-pip","title":"3.1.1 \u4f7f\u7528 pip \u5b89\u88dd","text":"<pre><code>pip install zipline-tej notebook\n</code></pre>"},{"location":"tutorials/setup/#312-conda-jupyter","title":"3.1.2 \u4f7f\u7528 conda \u5b89\u88dd (\u91dd\u5c0d Jupyter \u6838\u5fc3)","text":"<pre><code>conda install -c conda-forge nb_conda_kernels\n</code></pre>"},{"location":"tutorials/setup/#32-google-colab-zipline-tej","title":"3.2 \u65bc Google Colab \u4f7f\u7528 zipline-tej","text":"<p>\u82e5\u5728 Google Colab \u74b0\u5883\u4e0b\u4f7f\u7528\uff0c\u53ef\u76f4\u63a5\u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\u5b89\u88dd\uff1a</p> <pre><code>!pip install zipline-tej\n</code></pre> <ul> <li> <p>\u9078\u7528\uff1aColab \u5b57\u9ad4\u8a2d\u5b9a (\u91dd\u5c0d Pyfolio \u63d0\u9192) \uff1a     \u82e5\u60a8\u5728 Colab \u4e2d\u4f7f\u7528 Pyfolio \u9032\u884c\u8996\u89ba\u5316\u5206\u6790\uff0c\u53ef\u80fd\u6703\u9047\u5230\u5b57\u9ad4\u986f\u793a\u554f\u984c\u3002\u53ef\u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\u5b89\u88dd\u4e2d\u6587\u5b57\u9ad4\u4ee5\u907f\u514d\u8b66\u544a\u6216\u4e82\u78bc\u3002</p> <p>\u5b57\u9ad4\u4f86\u6e90\u8207\u6388\u6b0a\u63d0\u9192</p> <p>\u4ee5\u4e0b\u6307\u4ee4\u6703\u5f9e\u5916\u90e8\u9023\u7d50\u4e0b\u8f09\u5b57\u9ad4\u6a94\u6848\u3002\u8acb\u6ce8\u610f\u5b57\u9ad4\u6a94\u6848\u7684\u6388\u6b0a\u689d\u6b3e\uff0c\u4e26\u81ea\u884c\u8a55\u4f30\u4f7f\u7528\u98a8\u96aa\u3002\u82e5\u6709\u7591\u616e\uff0c\u5efa\u8b70\u4f7f\u7528\u60a8\u672c\u5730\u5df2\u6709\u7684\u5b57\u9ad4\u6216\u516c\u53f8\u5167\u90e8\u63d0\u4f9b\u7684\u5b57\u9ad4\u8cc7\u6e90\u3002</p> <pre><code>import matplotlib\nimport matplotlib.font_manager as fm\n!wget -O MicrosoftJhengHei.ttf https://github.com/a7532ariel/ms-web/raw/master/Microsoft-JhengHei.ttf\n!wget -O ArialUnicodeMS.ttf https://github.com/texttechnologylab/DHd2019BoA/raw/master/fonts/Arial%20Unicode%20MS.TTF\n\nfm.fontManager.addfont('MicrosoftJhengHei.ttf')\nmatplotlib.rc('font', family='Microsoft Jheng Hei')\n\nmatplotlib.font_manager.fontManager.addfont('ArialUnicodeMS.ttf')\nmatplotlib.rc('font', family='Arial Unicode MS')\n</code></pre> </li> </ul>"},{"location":"tutorials/setup/#4-tquant-lab","title":"4. \u6aa2\u67e5\u8207\u66f4\u65b0 TQuant Lab","text":""},{"location":"tutorials/setup/#41","title":"4.1 \u6aa2\u67e5\u7248\u672c","text":"<p>\u5b89\u88dd\u5b8c\u6210\u5f8c\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u6307\u4ee4\u6aa2\u67e5 <code>zipline-tej</code> \u7684\u7576\u524d\u7248\u672c\uff1a</p> <pre><code>!pip show zipline-tej\n</code></pre>"},{"location":"tutorials/setup/#42","title":"4.2 \u66f4\u65b0\u81f3\u6700\u65b0\u7248\u672c","text":"<p>\u70ba\u78ba\u4fdd\u60a8\u4f7f\u7528\u7684\u662f\u6700\u65b0\u529f\u80fd\u8207\u4fee\u5fa9\uff0c\u8acb\u57f7\u884c\u4ee5\u4e0b\u6307\u4ee4\u66f4\u65b0 <code>zipline-tej</code>\uff1a</p> <pre><code>!pip install --upgrade zipline-tej\n</code></pre> <ul> <li>\u5b98\u65b9\u7248\u672c\u8cc7\u8a0a \uff1a\u60a8\u53ef\u4ee5\u5728 PyPI - zipline-tej \u9801\u9762\u67e5\u770b\u6700\u65b0\u7684\u7248\u672c\u8cc7\u8a0a\u3002</li> </ul>"}]}